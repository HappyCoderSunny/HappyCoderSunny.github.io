<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ã€Hexoã€‘Butterfly å¦‚ä½•æ›¿æ¢jsdelivræå‡ç½‘ç«™è®¿é—®é€Ÿåº¦</title>
    <url>/posts/e94df8dd/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</h2>
<p>å¤§å®¶éƒ½çŸ¥é“<code>jsdelivr</code>ï¼Œè€Œä¸”ç»å¸¸ç”¨è¿™ä¸ªCDNæœåŠ¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¿«è€Œä¸”å…è´¹çš„CDNæœåŠ¡ï¼Œä½†æ˜¯ä»å»å¹´è¿˜æ˜¯å•¥æ—¶å€™å¼€å§‹å°±é€æ¸å‡ºç°æŒ‚æ‰ï¼Œä¸å¤ªå¥½ç”¨çš„æƒ…å†µï¼Œå‰æ®µæ—¶é—´æ›´æ˜¯å¤§è§„æ¨¡çš„æŒ‚æ‰ï¼Œå¯¹æˆ‘æœ€ç›´æ¥çš„å½±å“å°±æ˜¯ï¼šæˆ‘è¿™ä¸ªåšå®¢ç½‘ç«™æ‰“å¼€å°±æ˜¯å·¨æ…¢æ— æ¯”ï¼Œæ§åˆ¶å°ä¸€å †æŠ¥é”™ï¼Œå„ç§å›¾ç‰‡æ— æ³•æ˜¾ç¤ºï¼Œè¿™å¯¹äºä¸€ä¸ªå¼ºè¿«ç—‡æ¥è¯´çœŸçš„ä¸èƒ½å¿ï¼Œäºæ˜¯æ‰“ç®—æ¢æ‰Butterflyä¸»é¢˜ä¸‹çš„<code>jsdelivr</code>CDNæœåŠ¡ã€‚</p>
<h2 id="è§£å†³åŠæ³•">è§£å†³åŠæ³•</h2>
<h3 id="åŠæ³•ä¸€">åŠæ³•ä¸€</h3>
<p>è¿™ç§æ–¹æ³•è¶…çº§ç®€å•ï¼Œåªéœ€è¦ç®€å•çš„ä¸€æ­¥ï¼š</p>
<p><code>butterflyä¸»é¢˜ä¸‹</code> - <code>scripts</code> - <code>events</code> - <code>config.js</code>æ–‡ä»¶ ä¿®æ”¹<code>jsdelivr</code>cdnã€‚</p>
<p>å°†<code>https://cdn.jsdelivr.net</code> æ¢æˆ <code>https://fastly.jsdelivr.net</code>æˆ–<code>https://gcore.jsdelivr.net</code></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220529/20220529_01.png" alt="20220529_01"></p>
<p>å…¶ä¸­<code>fastly</code>æ˜¯ç¾å›½çš„æœåŠ¡å™¨ï¼Œ<code>gcore</code>æ˜¯ä¿„ç½—æ–¯çš„æœåŠ¡å™¨ï¼Œä¸¤ä¸ªéƒ½äº²æµ‹å¥½ç”¨ï¼Œå«Œå¼ƒéº»çƒ¦çš„åŒå­¦å¯ä»¥ç›´æ¥æ›¿æ¢æˆè¿™ä¸ªï¼Œè®¿é—®é€Ÿåº¦ç›®å‰æ¥çœ‹è¿˜æ˜¯å¾ˆå¿«çš„ã€‚</p>
<h3 id="åŠæ³•äºŒ">åŠæ³•äºŒ</h3>
<p>ä¿®æ”¹<code>butterflyä¸»é¢˜</code>ä¸­çš„<code>_config.yml</code>æ–‡ä»¶ï¼š</p>
<p>å°†<code>third_party_provider</code>ç”±<code>jsdelivr</code>æ¢æˆ<code>local</code>ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220529/20220529_02.png" alt="20220529_02"></p>
<p>æ›¿æ¢CDNï¼ˆéƒ¨åˆ†ï¼‰ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">main_css:</span> <span class="string">/css/index.css</span></span><br><span class="line"><span class="attr">main:</span> <span class="string">/js/main.js</span></span><br><span class="line"><span class="attr">utils:</span> <span class="string">/js/utils.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jquery:</span> <span class="string">https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.6.0/jquery.min.js</span></span><br><span class="line"><span class="attr">translate:</span> <span class="string">https://npm.elemecdn.com/js-heo@1.0.6/translate/tw_cn.js</span></span><br><span class="line"><span class="attr">pjax:</span> <span class="string">https://npm.elemecdn.com/pjax/pjax.min.js</span></span><br><span class="line"><span class="attr">twikoo:</span> <span class="string">https://npm.elemecdn.com/js-heo@1.0.3/twikoo/twikoo.all.min.js</span></span><br><span class="line"><span class="attr">lazyload:</span> <span class="string">https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js</span></span><br><span class="line"><span class="attr">instantpage:</span> <span class="string">https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js</span></span><br><span class="line"><span class="attr">fancybox_css_v4:</span> <span class="string">https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css</span></span><br><span class="line"><span class="attr">fancybox_v4:</span> <span class="string">https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js</span></span><br><span class="line"><span class="attr">snackbar_css:</span> <span class="string">https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.css</span></span><br><span class="line"><span class="attr">snackbar:</span> <span class="string">https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.js</span></span><br><span class="line"><span class="attr">fontawesomeV6:</span> <span class="string">https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css</span></span><br><span class="line"><span class="attr">aplayer_css:</span> <span class="string">https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css</span></span><br><span class="line"><span class="attr">aplayer_js:</span> <span class="string">https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js</span></span><br><span class="line"><span class="attr">meting_js:</span> <span class="string">https://npm.elemecdn.com/js-heo@1.0.12/metingjs/Meting.min.js</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šæ˜¯æˆ‘ä½¿ç”¨çš„ä¸€äº›cdnï¼Œå…¶ä»–çš„cdnå¦‚æœ‰è¡¥å……çš„å¯ä»¥åœ¨è¯„è®ºé‡Œç•™è¨€ã€‚</p>
<p>è¿™é‡Œæ¨èå­—èŠ‚è·³åŠ¨çš„é™æ€èµ„æºå…¬å…±åº“ï¼š<a href="https://cdn.bytedance.com">https://cdn.bytedance.com</a></p>
<h3 id="åŠæ³•ä¸‰">åŠæ³•ä¸‰</h3>
<p>ä¸º<code>jsdelivr</code>æ­å»ºåå‘ä»£ç†æœåŠ¡ï¼Œæ¯”å¦‚ä½¿ç”¨<a href="https://www.cloudflare.com/zh-cn/">Cloudflare</a>è‡ªè¡Œå»æ­å»ºã€‚</p>
<h2 id="æœ€å">æœ€å</h2>
<p>æœ¬æ–‡å°±å†™åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿éšæ—¶è”ç³»åšä¸»ï¼Œåšä¸»é©¬ä¸Šä¿®æ”¹ã€‚</p>
]]></content>
      <tags>
        <tag>Hexo</tag>
        <tag>Butterfly</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hexoã€‘Butterflyä¸»é¢˜é…ç½®ï¼ˆæŒç»­æ›´æ–°ï¼‰</title>
    <url>/posts/391caf66/</url>
    <content><![CDATA[<h2 id="å‡çº§å»ºè®®">å‡çº§å»ºè®®</h2>
<p>ä¸ºäº†å‡å°‘å‡çº§ä»¥åå¸¦æ¥çš„ä¸ä¾¿ï¼Œå»ºè®®è¯·æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼è¿›è¡Œæ“ä½œï¼š</p>
<p>åœ¨åšå®¢æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š<code>_config.butterfly.yml</code>ï¼Œå¹¶æŠŠ<code>butterfly</code>ä¸»é¢˜ç›®å½•ä¸‹çš„<code>_config.yml</code>å†…å®¹å¤åˆ¶åˆ°è¯¥æ–‡ä»¶ä¸­ï¼ˆæ³¨æ„ï¼šå¤åˆ¶çš„æ˜¯<a href="">butterflyä¸»é¢˜ç›®å½•</a>ä¸‹çš„<code>_config.yml</code>ä¸æ˜¯åšå®¢æ ¹ç›®å½•ä¸­çš„<code>_config.yml</code>ï¼‰ã€‚</p>
<p>ä»¥ååªéœ€è¦åœ¨<code>_config.butterfly.yml</code>æ–‡ä»¶é‡Œè¿›è¡Œä¿®æ”¹å³å¯ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šbutterlyä¸»é¢˜ç›®å½•ä¸‹çš„<code>_config.yml</code><strong>ä¸è¦åˆ é™¤ï¼Œä¸è¦åˆ é™¤ï¼Œä¸è¦åˆ é™¤ï¼Œé‡è¦çš„äº‹æƒ…è¯´ä¸‰éã€‚</strong></p>
</blockquote>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœä½ é¡¹ç›®ä¸­ä½¿ç”¨äº†<code>_config.butterfly.yml</code>æ–‡ä»¶ï¼Œåœ¨ä¸»é¢˜ç›®å½•ä¸‹çš„<code>_config.yml</code>ä¿®æ”¹ä¸ä¼šæœ‰æ•ˆæœã€‚</p>
</blockquote>
<p>å¦‚å›¾ï¼Œä»¥åæˆ‘ä»¬åªéœ€è¦å…³æ³¨è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶å³å¯ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_01.png" alt="20220514_01_01"></p>
<h2 id="scaffoldsæ–‡ä»¶å¤¹">scaffoldsæ–‡ä»¶å¤¹</h2>
<p>åšå®¢ç›®å½•ä¸‹æœ‰ä¸€ä¸ªæ–‡ä»¶å¤¹<code>scaffolds</code>ï¼Œè¿™ä¸ªæ˜¯æ¨¡ç‰ˆæ–‡ä»¶å¤¹ï¼Œå½“æˆ‘ä»¬æ–°å»ºé¡µé¢æˆ–è€…æ–‡ç« æ—¶ï¼Œ<code>hexo</code> ä¼šæ ¹æ®<code>scaffolds</code>æ¥å»ºç«‹æ–‡ä»¶ã€‚</p>
<p>é¡¾åæ€ä¹‰ï¼Œæ¨¡ç‰ˆå°±æ˜¯æŒ‡æ–°å»ºçš„æ–‡ç« æˆ–é¡µé¢é»˜è®¤çš„å†…å®¹ï¼Œæ¯”å¦‚æˆ‘ä¿®æ”¹äº†<code>scaffolds</code>ä¸‹çš„<code>post.md</code>ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_02.png" alt="20220514_01_02"></p>
<p>è¿™æ ·æ¯æ¬¡æˆ‘æ–°å»ºçš„æ–‡ç« é¡¶éƒ¨éƒ½æœ‰è¿™äº›é»˜è®¤å†…å®¹ï¼Œèƒ½æ·»åŠ çš„å­—æ®µå¾ˆå¤šï¼Œå…·ä½“å‚è€ƒ<a href="https://butterfly.js.org/posts/dc584b87/#Post-Front-matter">butterflyä¸»é¢˜å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h2 id="config-ymlæ–‡ä»¶">_config.ymlæ–‡ä»¶</h2>
<h3 id="ä¿®æ”¹ç½‘ç«™æ ‡é¢˜ã€å‰¯æ ‡é¢˜ç­‰ä¿¡æ¯">ä¿®æ”¹ç½‘ç«™æ ‡é¢˜ã€å‰¯æ ‡é¢˜ç­‰ä¿¡æ¯</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç½‘ç«™è®¾ç½®</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">Sunny</span> <span class="comment"># ç½‘ç«™åç§°</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">&#x27;&#x27;</span> <span class="comment"># å‰¯æ ‡é¢˜</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹</span> <span class="comment">#  æè¿°è¡Œæ–‡å­—ï¼šä½ å¯ä»¥ç†è§£ä¸ºä¸ªæ€§ç­¾å</span></span><br><span class="line"><span class="attr">keywords:</span> <span class="comment"># å…³é”®è¯</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">Sunny</span> <span class="comment"># ä½œè€… </span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span> <span class="comment"># è¯­è¨€ default(en)/ zh-CNï¼ˆç®€ä½“ï¼‰/ zh-TWï¼ˆç¹ä½“ï¼‰</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">Asia/Shanghai</span> <span class="comment"># æ—¶åŒº</span></span><br></pre></td></tr></table></figure>
<h3 id="urlç›¸å…³é…ç½®">urlç›¸å…³é…ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç½‘ç«™url é»˜è®¤æ˜¯https://example.com å¦‚æœä½¿ç”¨çš„æ˜¯github pages è¯·è®¾ç½®æˆ https://xxx.github.io</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">https://codersunny.com</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">:title/</span> <span class="comment"># æ°¸ä¹…é“¾æ¥</span></span><br><span class="line"><span class="attr">permalink_defaults:</span> <span class="comment"># é»˜è®¤æ°¸ä¹…é“¾æ¥</span></span><br><span class="line"><span class="attr">pretty_urls:</span></span><br><span class="line">  <span class="attr">trailing_index:</span> <span class="literal">true</span> <span class="comment"># Set to false to remove trailing &#x27;index.html&#x27; from permalinks</span></span><br><span class="line">  <span class="attr">trailing_html:</span> <span class="literal">true</span> <span class="comment"># Set to false to remove trailing &#x27;.html&#x27; from permalinks</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœ<code>url</code>ä¸ä¿®æ”¹ä½¿ç”¨é»˜è®¤<code>https://example.com</code>ï¼Œæ–‡ç« æœ«å°¾çš„é“¾æ¥æ˜¯æ‰“ä¸å¼€çš„ã€‚</p>
</blockquote>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_03.png" alt="20220514_01_03"></p>
<h2 id="config-butterfly-ymlæ–‡ä»¶">_config.butterfly.ymlæ–‡ä»¶</h2>
<h3 id="å†™åœ¨å‰é¢-2">å†™åœ¨å‰é¢</h3>
<p>æœ¬æ–‡åŸºæœ¬ä¸Šæ˜¯æŒ‰ç…§<code>_config.butterfly.yml</code>æ–‡ä»¶ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºæ¥æ€»ç»“çš„ï¼Œå¤§å®¶çœ‹çš„æ—¶å€™å¯¹ç…§ç€è®¾ç½®å³å¯ã€‚</p>
<h3 id="å¯¼èˆªæ èœå•">å¯¼èˆªæ èœå•</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">   <span class="string">é¦–é¡µ:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-home</span></span><br><span class="line">   <span class="string">éŸ³ä¹åº“:</span> <span class="string">/music/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-music</span></span><br><span class="line">  <span class="comment"># Archives: /archives/ || fas fa-archive</span></span><br><span class="line">  <span class="comment"># Tags: /tags/ || fas fa-tags</span></span><br><span class="line">  <span class="comment"># Categories: /categories/ || fas fa-folder-open</span></span><br><span class="line">  <span class="comment"># List||fas fa-list:</span></span><br><span class="line">  <span class="comment"># Movie: /movies/ || fas fa-video</span></span><br><span class="line">  <span class="comment"># Link: /link/ || fas fa-link</span></span><br><span class="line">  <span class="comment"># About: /about/ || fas fa-heart</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¿…é¡»æ˜¯<code>/xxx/</code> + <code>||</code> + <code>å›¾æ ‡å</code>ï¼Œå¦‚æœä¸æƒ³å±•ç¤ºå›¾æ ‡å¯ä»¥ä¸å†™å›¾æ ‡åã€‚</p>
</blockquote>
<p>æˆ‘è¿™é‡Œæš‚æ—¶åªé…ç½®äº†ä¸¤ä¸ªï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_06.png" alt="20220514_01_06"></p>
<h3 id="ä»£ç é«˜äº®ç›¸å…³è®¾ç½®">ä»£ç é«˜äº®ç›¸å…³è®¾ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">highlight_theme:</span> <span class="string">mac</span> <span class="comment"># é«˜äº®ä¸»é¢˜ï¼š darker / pale night / light / ocean / mac / mac light / false</span></span><br><span class="line"><span class="attr">highlight_copy:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å±•ç¤ºå¤åˆ¶æŒ‰é’® copy button</span></span><br><span class="line"><span class="attr">highlight_lang:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å±•ç¤ºä»£ç å—è¯­è¨€ show the code language</span></span><br><span class="line"><span class="attr">highlight_shrink:</span> <span class="literal">false</span> <span class="comment"># æ˜¯å¦å±•å¼€ä»£ç æ¡† true: shrink the code blocks / false: expand the code blocks | none: expand code blocks and hide the button</span></span><br><span class="line"><span class="attr">highlight_height_limit:</span> <span class="literal">false</span> <span class="comment"># unit: px</span></span><br><span class="line"><span class="attr">code_word_wrap:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å…³é—­ä»£ç æ»šåŠ¨æ¡</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_07.png" alt="20220514_01_07"></p>
<h3 id="å¤åˆ¶ç›¸å…³é…ç½®">å¤åˆ¶ç›¸å…³é…ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># copy settings</span></span><br><span class="line"><span class="comment"># copyright: Add the copyright information after copied content (å¤åˆ¶çš„å†…å®¹åŠ ä¸Šç‰ˆæƒä¿¡æ¯)</span></span><br><span class="line"><span class="attr">copy:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å¼€å¯ç½‘ç«™å¤åˆ¶æƒé™</span></span><br><span class="line">  <span class="attr">copyright:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å¼€å¯å¤åˆ¶ç‰ˆæƒä¿¡æ¯æ·»åŠ </span></span><br><span class="line">    <span class="attr">limit_count:</span> <span class="number">50</span> <span class="comment"># è¶…è¿‡è¿™ä¸ªå­—æ•°ä¼šåœ¨å¤åˆ¶å†…å®¹åé¢åŠ ä¸Šç‰ˆæƒä¿¡æ¯</span></span><br></pre></td></tr></table></figure>
<h3 id="ç¤¾äº¤å›¾æ ‡">ç¤¾äº¤å›¾æ ‡</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># social settings (ç¤¾äº¤å›¾æ ‡è®¾ç½®)</span></span><br><span class="line"><span class="comment"># formal:</span></span><br><span class="line"><span class="comment">#   icon: link || the description</span></span><br><span class="line"><span class="comment"># ä¹¦å†™æ ¼å¼ï¼šå›¾æ ‡å:url || æè¿°æ€§æ–‡å­—</span></span><br><span class="line"><span class="attr">social:</span></span><br><span class="line">   <span class="attr">fab fa-github:</span> <span class="string">https://github.com/xxx</span> <span class="string">||</span> <span class="string">Github</span></span><br><span class="line">   <span class="attr">fas fa-envelope:</span>  <span class="string">mailto:xxx@gmail.com</span> <span class="string">||</span> <span class="string">Email</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_08.png" alt="20220514_01_08"></p>
<h3 id="å¤´åƒå’Œé¡¶éƒ¨å›¾é…ç½®">å¤´åƒå’Œé¡¶éƒ¨å›¾é…ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Faviconï¼ˆç½‘ç«™å›¾æ ‡ï¼‰</span></span><br><span class="line"><span class="attr">favicon:</span> <span class="string">/images/avatar.png</span></span><br><span class="line"><span class="comment"># Avatar (å¤´åƒ)</span></span><br><span class="line"><span class="attr">avatar:</span></span><br><span class="line">  <span class="attr">img:</span> <span class="string">/images/avatar.png</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="literal">false</span> <span class="comment"># æ˜¯å¦å¼€å¯å¤´åƒçš„åŠ¨æ•ˆ</span></span><br><span class="line"><span class="attr">disable_top_img:</span> <span class="literal">false</span> <span class="comment"># å¦‚æœä¸éœ€è¦å±•ç¤ºé¡¶éƒ¨å›¾ è®¾ç½®ä¸ºtrue</span></span><br><span class="line"><span class="attr">index_img:</span> <span class="string">/images/background.png</span> <span class="comment"># ä¸»é¡µçš„top_img</span></span><br><span class="line"><span class="attr">default_top_img:</span> <span class="string">/images/default_post_cover.png</span> <span class="comment"># é»˜è®¤çš„é¡¶éƒ¨å›¾ å¦‚æœtop_imgæ²¡æœ‰é…ç½®æ—¶ï¼Œä¼šæ˜¾ç¤ºdefault_top_img</span></span><br><span class="line"><span class="attr">archive_img:</span> <span class="string">/images/default_post_cover.png</span> <span class="comment"># å½’æ¡£é¡µé¢çš„top_img</span></span><br><span class="line"><span class="attr">tag_img:</span> <span class="string">/images/default_post_cover.png</span> <span class="comment"># tagå­é¡µé¢çš„top_img</span></span><br><span class="line"><span class="attr">tag_per_img:</span> <span class="comment"># tagå­é¡µé¢çš„ top_imgï¼Œå¯é…ç½®æ¯ä¸ªtag çš„ top_img</span></span><br><span class="line"><span class="attr">category_img:</span> <span class="string">/images/default_post_cover.png</span>  <span class="comment"># categoryå­é¡µé¢çš„top_img</span></span><br><span class="line"><span class="attr">category_per_img:</span>  <span class="comment"># categoryå­é¡µé¢çš„ category_imgï¼Œå¯é…ç½®æ¯ä¸ªcategory çš„ top_img</span></span><br></pre></td></tr></table></figure>
<p>éƒ¨åˆ†æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_09.png" alt="20220514_01_09"></p>
<h3 id="æ–‡ç« å°é¢é…ç½®">æ–‡ç« å°é¢é…ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">cover:</span></span><br><span class="line">  <span class="attr">index_enable:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦æ˜¾ç¤ºæ–‡ç« å°é¢</span></span><br><span class="line">  <span class="attr">aside_enable:</span> <span class="literal">true</span> <span class="comment"># æ–‡ç« ä¾§è¾¹æ æ˜¯å¦å¼€å¯</span></span><br><span class="line">  <span class="attr">archives_enable:</span> <span class="literal">true</span> <span class="comment"># å½’æ¡£æ˜¯å¦å¼€å¯</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">both</span> <span class="comment"># å°é¢æ˜¾ç¤ºçš„ä½ç½® left/right/both bothè¡¨ç¤ºå·¦å³ä¸¤è¾¹äº¤æ›¿æ˜¾ç¤º</span></span><br><span class="line">  <span class="attr">default_cover:</span> <span class="comment"># å½“æ²¡æœ‰è®¾ç½®æ–‡ç« å°é¢æ—¶ é»˜è®¤çš„å°é¢å±•ç¤º</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">https://sunny-blog.oss-cn-beijing.aliyuncs.com/default_post_cover.png</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_10.png" alt="20220514_01_10"></p>
<h3 id="404é¡µé¢å’Œæ— æ³•æ˜¾ç¤ºçš„å›¾ç‰‡é…ç½®">404é¡µé¢å’Œæ— æ³•æ˜¾ç¤ºçš„å›¾ç‰‡é…ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ›¿æ¢æ— æ³•æ˜¾ç¤ºçš„å›¾ç‰‡çš„å›¾ç‰‡</span></span><br><span class="line"><span class="attr">error_img:</span></span><br><span class="line">  <span class="attr">flink:</span> <span class="string">/images/friend_404.gif</span></span><br><span class="line">  <span class="attr">post_page:</span> <span class="string">/images/404.jpg</span></span><br><span class="line"><span class="comment"># 404é¡µé¢</span></span><br><span class="line"><span class="attr">error_404:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">subtitle:</span> <span class="string">&#x27;æŠ±æ­‰ï¼Œé¡µé¢æ²¡æœ‰æ‰¾åˆ°ï½&#x27;</span></span><br><span class="line">  <span class="attr">background:</span> <span class="string">https://i.loli.net/2020/05/19/aKOcLiyPl2JQdFD.png</span></span><br></pre></td></tr></table></figure>
<h3 id="æ–‡ç« æ˜¾ç¤ºä¿¡æ¯é…ç½®">æ–‡ç« æ˜¾ç¤ºä¿¡æ¯é…ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">post_meta:</span></span><br><span class="line">  <span class="attr">page:</span> <span class="comment"># Home Page</span></span><br><span class="line">    <span class="attr">date_type:</span> <span class="string">created</span> <span class="comment"># created or updated or both ä¸»é¡µæ–‡ç« æ—¥æœŸæ˜¯åˆ›å»ºæ—¥æˆ–è€…æ›´æ–°æ—¥æˆ–éƒ½æ˜¾ç¤º</span></span><br><span class="line">    <span class="attr">date_format:</span> <span class="string">date</span> <span class="comment"># date/relative æ˜¾ç¤ºæ—¥æœŸè¿˜æ˜¯ç›¸å¯¹æ—¥æœŸ</span></span><br><span class="line">    <span class="attr">categories:</span> <span class="literal">true</span> <span class="comment"># true or false ä¸»é¡µæ˜¯å¦æ˜¾ç¤ºåˆ†ç±»</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="literal">true</span> <span class="comment"># true or false ä¸»é¡µæ˜¯å¦æ˜¾ç¤ºæ ‡ç­¾</span></span><br><span class="line">    <span class="attr">label:</span> <span class="literal">true</span> <span class="comment"># true or false æ˜¾ç¤ºæè¿°æ€§æ–‡å­—</span></span><br><span class="line">  <span class="attr">post:</span></span><br><span class="line">    <span class="attr">date_type:</span> <span class="string">created</span> <span class="comment"># created or updated or both æ–‡ç« æ—¥æœŸæ˜¯åˆ›å»ºæ—¥æˆ–è€…æ›´æ–°æ—¥æˆ–éƒ½æ˜¾ç¤º</span></span><br><span class="line">    <span class="attr">date_format:</span> <span class="string">date</span> <span class="comment"># date/relative æ˜¾ç¤ºæ—¥æœŸè¿˜æ˜¯ç›¸å¯¹æ—¥æœŸ</span></span><br><span class="line">    <span class="attr">categories:</span> <span class="literal">true</span> <span class="comment"># true or false æ–‡ç« æ˜¯å¦æ˜¾ç¤ºåˆ†ç±»</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="literal">true</span> <span class="comment"># true or false æ–‡ç« é æ˜¯å¦æ˜¾ç¤ºæ ‡ç­¾</span></span><br><span class="line">    <span class="attr">label:</span> <span class="literal">true</span> <span class="comment"># true or false æ˜¾ç¤ºæè¿°æ€§æ–‡å­—</span></span><br></pre></td></tr></table></figure>
<h3 id="å­—æ•°ç»Ÿè®¡">å­—æ•°ç»Ÿè®¡</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># wordcount (å­—æ•°ç»Ÿè®¡)</span></span><br><span class="line"><span class="comment"># see https://butterfly.js.org/posts/ceeb73f/#å­—æ•°ç»Ÿè®¡</span></span><br><span class="line"><span class="attr">wordcount:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">post_wordcount:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">min2read:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_wordcount:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœæ‰“å¼€å­—æ•°ç»Ÿè®¡æ’ä»¶ï¼Œè¯·åŠ¡å¿…è¦å…ˆå®‰è£…æ’ä»¶ã€‚</p>
<p>è¿›å…¥æ ¹ç›®å½•ä¸‹ï¼Œä½¿ç”¨å‘½ä»¤<code>npm install hexo-wordcount --save</code>æˆ–<code>yarn add hexo-wordcount</code>å®‰è£…å­—æ•°ç»Ÿè®¡çš„æ’ä»¶ã€‚</p>
</blockquote>
<h3 id="æ–‡ç« æœ«å°¾ç‰ˆæƒä¿¡æ¯è®¾ç½®">æ–‡ç« æœ«å°¾ç‰ˆæƒä¿¡æ¯è®¾ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">post_copyright:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å¼€å¯æ–‡ç« åé¢çš„å¤åˆ¶ä¿¡æ¯</span></span><br><span class="line">  <span class="attr">decode:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦è§£ç </span></span><br><span class="line">  <span class="attr">author_href:</span></span><br><span class="line">  <span class="attr">license:</span> <span class="string">CC</span> <span class="string">BY-NC-SA</span> <span class="number">4.0</span></span><br><span class="line">  <span class="attr">license_url:</span> <span class="string">https://creativecommons.org/licenses/by-nc-sa/4.0/</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_11.png" alt="20220514_01_11"></p>
<h3 id="æ‰“èµåŠŸèƒ½é…ç½®">æ‰“èµåŠŸèƒ½é…ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰“èµåŠŸèƒ½</span></span><br><span class="line"><span class="attr">reward:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å¼€å¯</span></span><br><span class="line">  <span class="attr">QR_code:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">img:</span> <span class="string">/images/wechat_pay.png</span></span><br><span class="line">       <span class="attr">link:</span></span><br><span class="line">       <span class="attr">text:</span> <span class="string">å¾®ä¿¡</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">img:</span> <span class="string">/images/ali_pay.png</span></span><br><span class="line">       <span class="attr">link:</span></span><br><span class="line">       <span class="attr">text:</span> <span class="string">æ”¯ä»˜å®</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_12.png" alt="20220514_01_12"></p>
<h3 id="åˆ†äº«åŠŸèƒ½é…ç½®">åˆ†äº«åŠŸèƒ½é…ç½®</h3>
<p>æœ‰ä¸‰ä¸ªåˆ†äº«æœåŠ¡å•†ï¼š<code>AddThis</code>ã€<code>Sharejs</code>ã€<code>Addtoany</code>ï¼Œåªèƒ½é€‰æ‹©å…¶ä¸­ä¸€ä¸ªï¼Œæˆ‘è¿™é‡Œä½¿ç”¨é»˜è®¤çš„<code>Sharejs</code>ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Share.js</span></span><br><span class="line"><span class="comment"># https://github.com/overtrue/share.js</span></span><br><span class="line"><span class="attr">sharejs:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">sites:</span> <span class="string">facebook,twitter,wechat,weibo,qq</span></span><br></pre></td></tr></table></figure>
<h3 id="ç½‘ç«™é¡µè„šé…ç½®">ç½‘ç«™é¡µè„šé…ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">footer:</span></span><br><span class="line">  <span class="attr">owner:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">since:</span> <span class="number">2020</span></span><br><span class="line">  <span class="attr">custom_text:</span> <span class="string">Hi,</span> <span class="string">welcome</span> <span class="string">to</span> <span class="string">my</span> <span class="string">&lt;a</span> <span class="string">href=&quot;https://codersunny.com&quot;&gt;blog&lt;/a&gt;!</span></span><br><span class="line">  <span class="attr">copyright:</span> <span class="literal">true</span> <span class="comment"># Copyright of theme and framework</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_13.png" alt="20220514_01_13"></p>
<h3 id="ç½‘ç«™èƒŒæ™¯å›¾ç‰‡é…ç½®">ç½‘ç«™èƒŒæ™¯å›¾ç‰‡é…ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Website Background (è®¾ç½®ç½‘ç«™èƒŒæ™¯)</span></span><br><span class="line"><span class="comment"># can set it to color or image (å¯è¨­ç½®å›¾ç‰‡ æˆ–è€… é¢œè‰²)</span></span><br><span class="line"><span class="comment"># The formal of image: url(http://xxxxxx.com/xxx.jpg)</span></span><br><span class="line"><span class="attr">background:</span> <span class="string">/images/background.png</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_14.png" alt="20220514_01_14"></p>
<h3 id="ç½‘ç«™å‰¯æ ‡é¢˜è®¾ç½®">ç½‘ç«™å‰¯æ ‡é¢˜è®¾ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># the subtitle on homepage (ä¸»é¡µsubtitle)</span></span><br><span class="line"><span class="attr">subtitle:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Typewriter Effect (æ‰“å­—æ•ˆæœ)</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># loop (å¾ªç¯æ‰“å­—)</span></span><br><span class="line">  <span class="attr">loop:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># source è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡</span></span><br><span class="line">  <span class="comment"># source: false å¼€é—­è°ƒç”¨</span></span><br><span class="line">  <span class="comment"># source: 1  è°ƒç”¨ä¸€è¨€ç½‘çš„ä¸€å¥è©±ï¼ˆç®€ä½“ï¼‰ https://hitokoto.cn/</span></span><br><span class="line">  <span class="comment"># source: 2  è°ƒç”¨ä¸€å¥ç½‘ï¼ˆç®€ä½“ï¼‰ http://yijuzhan.com/</span></span><br><span class="line">  <span class="comment"># source: 3  è°ƒç”¨ä»Šæ—¥è¯—è¯ï¼ˆç®€ä½“ï¼‰ https://www.jinrishici.com/</span></span><br><span class="line">  <span class="comment"># subtitle æœƒå…ˆæ˜¾ç¤º source , å†æ˜¾ç¤º sub çš„å…§å®¹</span></span><br><span class="line">  <span class="attr">source:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># å¦‚æœå…³é—­æ‰“å­—æ•ˆæœï¼Œsubtitle åªä¼šæ˜¾ç¤º sub çš„ç¬¬ä¸€è¡Œæ–‡å­—</span></span><br><span class="line">  <span class="attr">sub:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">è‡ªä¿¡ä¸”æ¸©å’Œï¼Œæ¸©å’Œä¸”åšå®š</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Loading Animation (åŠ è½½åŠ¨ç”»)</span></span><br><span class="line"><span class="attr">preloader:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="ä¾§è¾¹æ é…ç½®">ä¾§è¾¹æ é…ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">aside:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># ä¾§è¾¹æ æ˜¯å¦å¼€å¯</span></span><br><span class="line">  <span class="attr">hide:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">button:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦åœ¨æ‰‹æœºä¸Šæ˜¾ç¤º</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">left</span> <span class="comment"># ä¾§è¾¹æ ä½ç½® left or right</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">card_author:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">description:</span></span><br><span class="line">    <span class="attr">button:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">fab</span> <span class="string">fa-github</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">Github</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">https://github.com/xxx</span></span><br><span class="line">  <span class="attr">card_announcement:</span> <span class="comment"># å…¬å‘Šæ å†…å®¹</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">content:</span> <span class="string">æ¬¢è¿æ¥åˆ°Sunnyçš„æŠ€æœ¯æ‚è´§é“ºï¼Œå¦‚æœå–œæ¬¢è®°å¾—æ”¶è—å¥¥ï½</span></span><br><span class="line">  <span class="attr">card_recent_post:</span> <span class="comment"># æœ€æ–°æ–‡ç« </span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">5</span> <span class="comment"># å¦‚æœè®¾ç½®ä¸º0 å°†ä¼šå±•ç¤ºæ‰€æœ‰æ–‡ç« </span></span><br><span class="line">    <span class="attr">sort:</span> <span class="string">date</span> <span class="comment"># date or updated</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_15.png" alt="20220514_01_15"></p>
<h3 id="ç®€ç¹è½¬æ¢ã€å¤œé—´æ¨¡å¼ç­‰é…ç½®">ç®€ç¹è½¬æ¢ã€å¤œé—´æ¨¡å¼ç­‰é…ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Conversion between Traditional and Simplified Chinese (ç®€ç¹è½¬æ¢)</span></span><br><span class="line"><span class="attr">translate:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">default:</span> <span class="string">ç®€</span> <span class="comment"># é»˜è®¤çš„æŒ‰é’®æ–‡å­—</span></span><br><span class="line">  <span class="comment"># the language of website (1 - Traditional Chinese/ 2 - Simplified Chineseï¼‰</span></span><br><span class="line">  <span class="attr">defaultEncoding:</span> <span class="number">2</span></span><br><span class="line">  <span class="comment"># Time delay</span></span><br><span class="line">  <span class="attr">translateDelay:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">msgToTraditionalChinese:</span> <span class="string">&#x27;ç¹&#x27;</span> <span class="comment"># å½“å‰æ˜¯ç®€ä½“æ—¶ æŒ‰é’®æ–‡å­—</span></span><br><span class="line">  <span class="attr">msgToSimplifiedChinese:</span> <span class="string">&#x27;ç®€&#x27;</span> <span class="comment"># å½“å‰æ˜¯ç¹ä½“æ—¶ æŒ‰é’®æ–‡å­—</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Read Mode (é˜…è¯»æ¨¡å¼)</span></span><br><span class="line"><span class="attr">readmode:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦æ‰“å¼€é˜…è¯»æ¨¡å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·±è‰²æ¨¡å¼</span></span><br><span class="line"><span class="attr">darkmode:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Toggle Button to switch dark/light mode</span></span><br><span class="line">  <span class="attr">button:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">autoChangeMode:</span> <span class="literal">false</span> <span class="comment"># æ˜¯å¦è‡ªåŠ¨åˆ‡æ¢</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_16.png" alt="20220514_01_16"></p>
<h3 id="æŸ¥çœ‹å¤§å›¾é…ç½®">æŸ¥çœ‹å¤§å›¾é…ç½®</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Lightbox (å›¾ç‰‡å¤§å›¾æŸ¥çœ‹æ¨¡å¼)</span></span><br><span class="line"><span class="comment"># You can only choose one, or neither (åªèƒ½é€‰æ‹©ä¸€ä¸ª æˆ–è€… ä¸¤ä¸ªéƒ½ä¸é€‰)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># medium-zoom</span></span><br><span class="line"><span class="comment"># https://github.com/francoischalifour/medium-zoom</span></span><br><span class="line"><span class="attr">medium_zoom:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># fancybox</span></span><br><span class="line"><span class="comment"># http://fancyapps.com/fancybox/3/</span></span><br><span class="line"><span class="attr">fancybox:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202205/20220514_01_17.png" alt="20220514_01_17"></p>
<h2 id="æœ€å-2">æœ€å</h2>
<p>åŸºæœ¬ä¸Šåˆ°è¿™é‡Œï¼Œå…³äº<code>butterfly</code>ä¸»é¢˜çš„ä¸€äº›åŸºç¡€é…ç½®å°±å¯ä»¥äº†ï¼Œå…³äºæ›´å¤šçš„æ¨¡å—é…ç½®å¯ä»¥å‚è€ƒ<a href="https://butterfly.js.org/">butterflyä¸»é¢˜å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£æ°¸è¿œæ˜¯æœ€å¥½çš„å­¦ä¹ èµ„æ–™ã€‚</p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Butterfly</tag>
        <tag>æ•™ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hexoã€‘Mac OSä¸Šä½¿ç”¨Hexo + Githubæ­å»ºåšå®¢æ•™ç¨‹</title>
    <url>/posts/47556fe7/</url>
    <content><![CDATA[<h2 id="Hexoä»‹ç»">Hexoä»‹ç»</h2>
<p>Hexoæ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ï¼Œå…·ä½“å¯ä»¥è§<a href="https://hexo.io/zh-cn">Hexoå®˜ç½‘</a>ï¼Œå®ƒåœ¨githubä¸Šçš„staræ•°ç°åœ¨å·²ç»åˆ°34.7kï¼ŒHexoä¸»è¦æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ol>
<li>è¶…å¿«é€Ÿåº¦ï¼šNode.jsæ‰€å¸¦æ¥çš„è¶…å¿«ç”Ÿæˆé€Ÿåº¦ï¼Œå¯ä»¥è®©ä¸Šç™¾ä¸ªé¡µé¢åœ¨å‡ ç§’å†…å®Œæˆæ¸²æŸ“ã€‚</li>
<li>æ”¯æŒMarkdownï¼šHexo æ”¯æŒ GitHub Flavored Markdown çš„æ‰€æœ‰åŠŸèƒ½ï¼Œç”šè‡³å¯ä»¥æ•´åˆ Octopress çš„å¤§å¤šæ•°æ’ä»¶ã€‚</li>
<li>ä¸€é”®éƒ¨ç½²ï¼šåªéœ€ä¸€æ¡æŒ‡ä»¤å³å¯éƒ¨ç½²åˆ° GitHub Pages, Heroku æˆ–å…¶ä»–å¹³å°ã€‚</li>
<li>æ’ä»¶æˆ–å¯æ‰©å±•æ€§ï¼šå¼ºå¤§çš„ API å¸¦æ¥æ— é™çš„å¯èƒ½ï¼Œä¸æ•°ç§æ¨¡æ¿å¼•æ“ï¼ˆEJSï¼ŒPugï¼ŒNunjucksï¼‰å’Œå·¥å…·ï¼ˆBabelï¼ŒPostCSSï¼ŒLess/Sassï¼‰è½»æ˜“é›†æˆã€‚</li>
</ol>
<h2 id="å®‰è£…ç¯å¢ƒ">å®‰è£…ç¯å¢ƒ</h2>
<h3 id="å®‰è£…Node-js">å®‰è£…<code>Node.js</code></h3>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://nodejs.org/en/">Node.js</a></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_01.png" alt="20220509_01"></p>
<h3 id="å®‰è£…æ·˜å®é•œåƒ">å®‰è£…æ·˜å®é•œåƒ</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// ä½¿ç”¨å‘½ä»¤å®‰è£…æ·˜å®é•œåƒï¼š</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org </span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£…Hexo">å®‰è£…Hexo</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// ä½¿ç”¨å‘½ä»¤å»å®‰è£…Hexo</span><br><span class="line">cnpm install -g hexo-cli </span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…æˆåŠŸ">å®‰è£…æˆåŠŸ</h3>
<p>å®‰è£…æˆåŠŸåï¼Œä½¿ç”¨<code>hexo -v</code>å‘½ä»¤å»æŸ¥çœ‹Hexoçš„ç‰ˆæœ¬ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_02.png" alt="20220509_02"></p>
<h2 id="åˆå§‹åŒ–Hexo-Blog">åˆå§‹åŒ–Hexo Blog</h2>
<h3 id="æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹">æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</h3>
<p>æˆ‘è¿™é‡Œåˆ›å»ºä¸€ä¸ªåä¸ºBlogsçš„æ–‡ä»¶å¤¹ï¼Œå¹¶è¿›å…¥è¯¥æ–‡ä»¶å¤¹å†…</p>
<h3 id="åˆå§‹åŒ–Hexo">åˆå§‹åŒ–Hexo</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// åˆå§‹åŒ–hexo</span><br><span class="line">hexo init</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–æˆåŠŸå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_03.png" alt="20220509_03"></p>
<p>è¿™æ—¶å€™Blogsä¸‹çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_04.png" alt="20220509_04"></p>
<h3 id="æœ¬åœ°å¯åŠ¨Hexo">æœ¬åœ°å¯åŠ¨Hexo</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// å¯åŠ¨Hexo</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_05.png" alt="20220509_05"></p>
<p>æµè§ˆå™¨æ‰“å¼€åšå®¢ç½‘ç«™</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_06.png" alt="20220509_06"></p>
<h2 id="åˆ›å»ºåšå®¢æ–‡ç« ">åˆ›å»ºåšå®¢æ–‡ç« </h2>
<h3 id="åˆ›å»ºåšå®¢">åˆ›å»ºåšå®¢</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// åˆ›å»ºä¸€ç¯‡åšå®¢</span><br><span class="line">hexo n <span class="string">&quot;æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢æ–‡ç« &quot;</span></span><br></pre></td></tr></table></figure>
<p>æ–‡ç« åœ¨Blogsç›®å½•ä¸‹çš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_07.png" alt="20220509_07"></p>
<h3 id="æ¸…ç†é¡¹ç›®ç¼“å­˜">æ¸…ç†é¡¹ç›®ç¼“å­˜</h3>
<p>æ–°å¢åšå®¢æ–‡ç« æˆ–è€…ä¿®æ”¹åšå®¢æ–‡ç« å†…å®¹ï¼Œéœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// æ¸…ç†ä¹‹å‰ç”Ÿæˆçš„ç½‘ç«™</span><br><span class="line">hexo clean</span><br></pre></td></tr></table></figure>
<h3 id="é‡æ–°ç”Ÿæˆåšå®¢">é‡æ–°ç”Ÿæˆåšå®¢</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// é‡æ–°ç”Ÿæˆåšå®¢</span><br><span class="line">hexo g</span><br></pre></td></tr></table></figure>
<h3 id="å†æ¬¡å¯åŠ¨é¡¹ç›®">å†æ¬¡å¯åŠ¨é¡¹ç›®</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// å†æ¬¡å¯åŠ¨åšå®¢ç½‘ç«™</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure>
<p>æµè§ˆå™¨é¡µé¢å±•ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_08.png" alt="20220509_08"></p>
<h2 id="ä¿®æ”¹ç½‘ç«™ä¸»é¢˜">ä¿®æ”¹ç½‘ç«™ä¸»é¢˜</h2>
<p>Hexoæ¡†æ¶é»˜è®¤çš„æ˜¯landscapeä¸»é¢˜ï¼ŒHexoä¸Šæœ‰ä¸‰ç™¾å¤šç§ä¸»é¢˜ï¼Œå¤§å®¶å¯ä»¥ä¸Š<a href="https://hexo.io/themes/">Hexoå®˜ç½‘</a>é€‰æ‹©è‡ªå·±å–œæ¬¢çš„ä¸»é¢˜ï¼Œæˆ‘è¿™é‡Œä»¥butterflyä¸ºä¾‹ï¼š</p>
<h3 id="ä¸‹è½½butterflyä¸»é¢˜">ä¸‹è½½butterflyä¸»é¢˜</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// ä¸‹è½½butterfly</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly</span><br></pre></td></tr></table></figure>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_09.png" alt="20220509_09"></p>
<p>æˆ‘ä»¬ä¸‹è½½çš„ä¸»é¢˜éƒ½å­˜æ”¾åœ¨Blogs/themesæ–‡ä»¶å¤¹ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_10.png" alt="20220509_10"></p>
<h3 id="ä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶">ä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶</h3>
<p>ä¸»é¢˜ä¸‹è½½ä¸‹æ¥ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®é…ç½®æ–‡ä»¶_config.ymlé‡Œé¢ä¿®æ”¹æˆ‘ä»¬çš„ä¸»é¢˜ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_11.png" alt="20220509_11"></p>
<p>æŠŠé»˜è®¤çš„<code>landscape</code>ä¿®æ”¹ä¸ºæˆ‘ä»¬ä¸‹è½½å¥½çš„ä¸»é¢˜ <code>butterfly</code></p>
<h3 id="é‡æ–°ç”Ÿæˆé¡¹ç›®">é‡æ–°ç”Ÿæˆé¡¹ç›®</h3>
<p>è¿™æ—¶å€™å†æ‰§è¡Œæˆ‘ä»¬Hexoä¸‰è¿ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// æ¸…ç†é¡¹ç›®ç¼“å­˜</span><br><span class="line">hexo clean</span><br><span class="line"></span><br><span class="line">// é‡æ–°ç”Ÿæˆé¡¹ç›®</span><br><span class="line">hexo g</span><br><span class="line"></span><br><span class="line">// æœ¬åœ°å¯åŠ¨é¡¹ç›®</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure>
<p>Tipsï¼šé‡æ–°ç”Ÿæˆé¡¹ç›®å’Œæœ¬åœ°å¯åŠ¨é¡¹ç›®å¯ä»¥åˆå¹¶ï¼š<code>hexo g &amp; hexo s</code></p>
<p>å†æ¬¡æ‰“å¼€é¡¹ç›®ï¼Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_12.png" alt="20220509_12"></p>
<p>å“ˆå“ˆå“ˆå“ˆï¼ŒæƒŠä¸æƒŠå–œï¼Œæ„ä¸æ„å¤–ï¼Œè¿™æ˜¯ä¸ªä»€ä¹ˆé¬¼ä¸œè¥¿ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>åˆ«æ…Œï¼Œå‘ç°é—®é¢˜ - æ‰¾åˆ°é—®é¢˜ - åˆ†æé—®é¢˜ - è§£å†³é—®é¢˜ï¼š</p>
<p>åŸå› å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬æ²¡æœ‰å®‰è£…pugå’Œstylusçš„æ¸²æŸ“å™¨ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// åœ¨Blogsç›®å½•ä¸‹ å®‰è£…pug å’Œ stylusæ¸²æŸ“å™¨</span><br><span class="line">npm install --save hexo-renderer-jade hexo-generator-feed hexo-generator-sitemap hexo-browsersync hexo-generator-archive</span><br></pre></td></tr></table></figure>
<p>å®‰è£…å®Œæˆåï¼Œé‡æ–°ç”Ÿæˆé¡¹ç›®ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_13.png" alt="20220509_13"></p>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„ä¸»é¢˜ä¿®æ”¹å°±å®Œæˆäº†ï¼ŒåæœŸæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦å»ä¿®æ”¹butterflyçš„é…ç½®æ–‡ä»¶ï¼Œè®©æˆ‘ä»¬çš„åšå®¢ç½‘ç«™æ›´åŠ ä¸ªæ€§åŒ–ã€‚</p>
<p>ä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘å°†è¯´è¯´å¦‚ä½•ä¿®æ”¹ä¸»é¢˜è®©æˆ‘ä»¬çš„åšå®¢ç½‘ç«™æ›´å…·ä¸ªæ€§åŒ–ã€‚</p>
<p>å…³äºHexoæ­å»ºåšå®¢åˆ°è¿™é‡Œå°±è®²å¾—å·®ä¸å¤šäº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±æƒ³æ€ä¹ˆæŠŠåšå®¢éƒ¨ç½²åˆ°Githubä¸Šã€‚</p>
<h2 id="éƒ¨ç½²åšå®¢åˆ°Github">éƒ¨ç½²åšå®¢åˆ°Github</h2>
<p>é¦–å…ˆï¼Œä½ å¾—è¦æœ‰ä¸€ä¸ªè‡ªå·±çš„Githubè´¦å·å§ï¼Œæˆ‘ç›¸ä¿¡99.99%çš„å¼€å‘è€…éƒ½æ˜¯æœ‰Githubè´¦å·çš„ï¼Œå¦‚æœä½ æ˜¯é‚£0.01%ï¼Œè¯·å‰å¾€<a href="https://github.com/">Github</a>è‡ªè¡Œæ³¨å†Œã€‚</p>
<h3 id="åˆ›å»ºä»“åº“">åˆ›å»ºä»“åº“</h3>
<p>åœ¨Githubé‡Œåˆ›å»ºä¸€ä¸ªå­˜æ”¾åšå®¢é¡¹ç›®çš„ä»“åº“ï¼Œæ“ä½œå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_14.png" alt="20220509_14"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_15.png" alt="20220509_15"></p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼š</p>
<ol>
<li>ä»“åº“çš„åç§°å¿…é¡»ä¸ä½ Githubè´¦å·åç›¸åŒ</li>
<li>ä»“åº“å¿…é¡»ä»¥<code>gitHub.io</code>ç»“å°¾</li>
</ol>
<p>æ¯”å¦‚ä½ Githubè´¦å·åå«ï¼š<code>zhangsan</code>ï¼Œé‚£ä½ æ–°å»ºçš„è¿™ä¸ªä»“åº“åå°±å«ï¼š<code>zhangsan.github.io</code></p>
<p>åˆ›å»ºä¹‹åï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªå­˜æ”¾åšå®¢é¡¹ç›®ä»“åº“ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_16.png" alt="20220509_16"></p>
<h3 id="å®‰è£…Hexoéƒ¨ç½²æ’ä»¶">å®‰è£…Hexoéƒ¨ç½²æ’ä»¶</h3>
<p>è¿›å…¥åˆ°Blogsç›®å½•ä¸‹ï¼Œå®‰è£…éƒ¨ç½²æ’ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cnpm install --save hexo-deployer-git</span><br></pre></td></tr></table></figure>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_17.png" alt="20220509_17"></p>
<h3 id="ä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶-2">ä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶</h3>
<p>å¥½äº†ï¼Œä¸‡äº‹ä¿±å¤‡ï¼Œåªæ¬ ä¿®æ”¹_config.ymlæ–‡ä»¶äº†ï¼Œæ‰“å¼€_config.ymlæ–‡ä»¶ï¼Œæ‹–æ‹½åˆ°æœ€åï¼Œä¿®æ”¹æ–‡ä»¶ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_18.png" alt="20220509_18"></p>
<p>ä¿®æ”¹ä¸ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_19.png" alt="20220509_19"></p>
<p>æ³¨æ„ï¼šrepoä¸ºä½ åˆšåˆ›å»ºçš„Githubé¡¹ç›®çš„åœ°å€ï¼Œå¦‚æœä½ æ˜¯ä½¿ç”¨çš„vimæ‰“å¼€çš„_config.ymlï¼Œè®°å¾—ä¿®æ”¹äº†è¦:wqä¿å­˜é€€å‡º</p>
<h3 id="é‡æ–°ç”Ÿæˆé¡¹ç›®-2">é‡æ–°ç”Ÿæˆé¡¹ç›®</h3>
<p>æ¸…ç†é¡¹ç›®ç¼“å­˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br></pre></td></tr></table></figure>
<p>é‡æ–°ç”Ÿæˆåšå®¢ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure>
<p>éƒ¨ç½²åˆ°äº‘ç«¯ï¼ˆGithubï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šè¿™é‡Œæ¯æ¬¡ä½¿ç”¨<code>hexo d</code>éƒ¨ç½²åˆ°Githubä¸ºäº†å®‰å…¨éƒ½è¦æ±‚è¾“å…¥è´¦å·å¯†ç ï¼Œå¦‚æœä½ ä¸å¸Œæœ›æ¯æ¬¡éƒ½è¾“å…¥è´¦å·å¯†ç ï¼Œå¯ä»¥è·Ÿåšä¸»ä¸€æ ·è®¾ç½®Githubçš„SSH Keysï¼Œä»¥åæ¯æ¬¡å‘å¸ƒåˆ°Githubå°±ä¸éœ€è¦è¾“å…¥è´¦å·å¯†ç äº†ã€‚</p>
<h3 id="è®¿é—®äº‘ç«¯åšå®¢ä¸»é¡µ">è®¿é—®äº‘ç«¯åšå®¢ä¸»é¡µ</h3>
<p>è®¿é—®åœ°å€ï¼š<a href="https://happycodersunny.github.io/">https://happycodersunny.github.io</a></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220509/20220509_20.png" alt="20220509_20"></p>
<h2 id="æœ€å-3">æœ€å</h2>
<p>åŸºæœ¬ä¸Šåˆ°è¿™é‡Œï¼Œå±äºæˆ‘ä»¬è‡ªå·±çš„åšå®¢å°±æ­å»ºå®Œæˆå•¦ï¼Œæ’’èŠ±ğŸ‰ğŸ‰ğŸ‰ï½ï¼Œæ•´ä¸ªæ­å»ºæµç¨‹å¦‚æœä¸å‡ºé”™åŠä¸ªå°æ—¶ä¹‹å†…å…¶å®æ˜¯å¯ä»¥æå®šçš„ï¼Œä½†æ˜¯è¿™è·¯å“ªé‡Œé‚£ä¹ˆå¥½èµ°å‘¢ï¼Œæ¯ä¸ªäººå»æ­å»ºçš„è¿‡ç¨‹ä¸­æˆ–å¤šæˆ–å°‘éƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œæˆ‘è‡ªå·±åœ¨æ­å»ºçš„è¿‡ç¨‹ä¸­ä¹Ÿç¢°åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæˆ‘ä¼šæŠ½ç©ºæŠŠé‡åˆ°çš„é—®é¢˜è¯¦ç»†æ•´ç†å‡ºæ¥ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©å¤§å®¶å¦‚æœè¦æ­å»ºåšå®¢çš„æ—¶å€™å°‘è¸©ç‚¹å‘ã€‚</p>
<p>å˜»å˜»å˜»ï¼Œéƒ½çœ‹åˆ°è¿™é‡Œäº†ï¼Œä¸è¦åå•¬ä½ çš„å°æ˜Ÿæ˜Ÿå˜›ï¼Œä¸ºåšä¸»ç‚¹ä¸ªèµå‘ï½</p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Butterfly</tag>
        <tag>æ•™ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hexoã€‘Hexoåšå®¢å¤‡ä»½åˆ°Github</title>
    <url>/posts/da31eaeb/</url>
    <content><![CDATA[<h2 id="ä¸ºä»€ä¹ˆè¦å¤‡ä»½">ä¸ºä»€ä¹ˆè¦å¤‡ä»½</h2>
<p>åœ¨<a href="https://happycodersunny.github.io/2022/05/09/%E3%80%90Hexo%E3%80%91Mac%20OS%E4%B8%8A%E4%BD%BF%E7%94%A8Hexo%20+%20Github%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/">è¿™ç¯‡æ–‡ç« </a>ä¸­æˆ‘ä»¬æŠŠ<code>Hexo</code> å’Œ <code>Github</code>ç»“åˆèµ·æ¥æ­å»ºäº†è‡ªå·±çš„ä¸ªäººåšå®¢ï¼Œ<code>hexo d</code>éƒ¨ç½²åˆ°<code>Github</code>çš„å…¶å®<code>Hexo</code>ç¼–è¯‘åçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æ˜¯ç”¨æ¥ç”Ÿæˆç½‘é¡µçš„ï¼Œå¹¶ä¸åŒ…å«æˆ‘ä»¬çš„æºæ–‡ä»¶ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220511/20220511_01.png" alt="20220511_01"></p>
<p>å®ƒå…¶å®ä¸Šä¼ åˆ°<code>Github</code> çš„æ˜¯åœ¨æˆ‘ä»¬æœ¬åœ°ç›®å½•é‡Œçš„<code>.deploy_git</code>é‡Œé¢çš„å†…å®¹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220511/20220511_02.png" alt="20220511_02"></p>
<p>æˆ‘ä»¬çš„æºæ–‡ä»¶æ¯”å¦‚ç›¸å…³<code>source </code>æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ç­‰éƒ½æ˜¯æ²¡æœ‰ä¸Šä¼ åˆ°<code>Github</code>ä¸Šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åˆ©ç”¨<code>git</code>æ¥åšåˆ†æ”¯ç®¡ç†ï¼Œå¯¹æˆ‘ä»¬çš„æºæ–‡ä»¶è¿›è¡Œå¤‡ä»½ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å¦ä¸€å°ç”µè„‘ä¸ŠæŠŠæºæ–‡ä»¶<code>clone</code>åˆ°æœ¬åœ°å®‰è£…ç›¸åº”çš„ç¯å¢ƒå°±å¯ä»¥ç»§ç»­å†™æˆ‘ä»¬çš„åšå®¢äº†ã€‚</p>
<p>å¥½äº†ï¼ŒåºŸè¯å°‘è¯´ï¼Œæˆ‘ä»¬ç›´æ¥æ¥è¯´å¦‚ä½•è¿›è¡Œåšå®¢æºæ–‡ä»¶çš„å¤‡ä»½ã€‚</p>
<h2 id="Hexo-åšå®¢å¤‡ä»½">Hexo åšå®¢å¤‡ä»½</h2>
<h3 id="åˆ›å»ºæ–°åˆ†æ”¯">åˆ›å»ºæ–°åˆ†æ”¯</h3>
<p>åœ¨<code>Github</code>ä¸Šåšå®¢ä»“åº“ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯<code>hexo</code>ï¼Œå¹¶ä¸”å°†è¿™ä¸ªåˆ†æ”¯è®¾ç½®ä¸ºé»˜è®¤åˆ†æ”¯ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220511/20220511_03.png" alt="20220511_03"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220511/20220511_04.png" alt="20220511_04"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220511/20220511_05.png" alt="20220511_05"></p>
<h3 id="å…‹éš†Hexoåˆ†æ”¯">å…‹éš†Hexoåˆ†æ”¯</h3>
<p>åœ¨æœ¬åœ°æŠŠæˆ‘ä»¬åˆšå»ºçš„åˆ†æ”¯<code>hexo</code>å…‹éš†åˆ°æœ¬åœ°ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220511/20220511_06.png" alt="20220511_06"></p>
<p>æŠŠå…‹éš†ä¸‹æ¥çš„é¡¹ç›®é‡Œé¢çš„<code>.git</code>æ–‡ä»¶å¤åˆ¶åˆ°æˆ‘ä»¬çš„Hexoåšå®¢ç›®å½•ä¸‹:</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220511/20220511_07.png" alt="20220511_07"></p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœä¹‹å‰æ­å»ºåšå®¢çš„æ—¶å€™è‡ªå·±æ›´æ¢è¿‡ä¸»é¢˜æ–‡ä»¶çš„ï¼Œè¯·æŠŠä¸»é¢˜æ–‡ä»¶é‡Œé¢çš„<code>.git</code>æ–‡ä»¶åˆ é™¤ã€‚</p>
</blockquote>
<h3 id="å¼€å§‹å¤‡ä»½">å¼€å§‹å¤‡ä»½</h3>
<p>è¿›å…¥åˆ°Blogsæ ¹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;Blogæºæ–‡ä»¶å¤‡ä»½&quot;</span></span><br><span class="line">git push origin hexo</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™æˆ‘ä»¬ä¼šçœ‹åˆ°<code>Github</code>ä¸Šçš„<code>hexo</code> åˆ†æ”¯å°±æœ‰æˆ‘ä»¬çš„æºæ–‡ä»¶äº†ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220511/20220511_08.png" alt="20220511_08"></p>
<p>å¦‚æœä½ æƒ³è¦æ¯æ¬¡æ›´æ”¹ä¸œè¥¿éƒ½å¸Œæœ›å¤‡ä»½åˆ°<code>hexo</code> åˆ†æ”¯ä¸Šï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹æ­¥éª¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;å¤‡ä»½&quot;</span></span><br><span class="line">git push</span><br><span class="line">hexo g &amp; hexo d</span><br></pre></td></tr></table></figure>
<h2 id="å¦‚ä½•æ¢å¤åšå®¢">å¦‚ä½•æ¢å¤åšå®¢</h2>
<p>å‡å¦‚æˆ‘ä»¬ç°åœ¨æ›´æ¢äº†ç”µè„‘ï¼Œå¸Œæœ›åœ¨æ–°çš„ç”µè„‘ä¸Šç»§ç»­å†™åšå®¢ï¼ŒæŠŠ<code>Github</code>ä¸Š<code>hexo</code>åˆ†æ”¯ä¸Šçš„é¡¹ç›®å…‹éš†åˆ°æœ¬åœ°ï¼ˆæ³¨æ„ï¼šæ˜¯æˆ‘ä»¬å¤‡ä»½çš„é‚£ä¸ªåˆ†æ”¯ï¼‰</p>
<p>è¿›å…¥åˆ°å…‹éš†ä¸‹æ¥çš„æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-cli</span><br><span class="line">npm install hexo-deployer-git</span><br></pre></td></tr></table></figure>
<p>ç„¶åå†å»å®‰è£…ä¸»é¢˜ç›¸å…³çš„æ’ä»¶å³å¯ï¼Œå½“ç„¶å¦‚æœä½ ç”µè„‘ä¸Šè¿˜æ²¡æœ‰ <code>Node.js</code>ç­‰ç¯å¢ƒçš„è¯å¯èƒ½è¿˜éœ€è¦å»å®‰è£…ç›¸å…³çš„ç¯å¢ƒã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å°±åŸºæœ¬ä¸Šå¯ä»¥åœ¨å¦ä¸€å°ç”µè„‘ä¸Šç»§ç»­æˆ‘ä»¬çš„åšå®¢ä¹‹æ—…å•¦ï½</p>
<h2 id="æœ€å-4">æœ€å</h2>
<p>åˆ°è¿™é‡Œï¼Œå¦‚ä½•å¤‡ä»½Hexoåšå®¢ä»¥åŠå¦‚ä½•æ¢å¤Hexoåšå®¢å°±åŸºæœ¬ç»“æŸå•¦ã€‚</p>
<p>å˜»å˜»å˜»ï¼Œéƒ½çœ‹åˆ°è¿™é‡Œäº†ï¼Œä¸è¦åå•¬ä½ çš„å°æ˜Ÿæ˜Ÿå˜›ï¼Œä¸ºåšä¸»ç‚¹ä¸ªèµå‘ï½</p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hexoã€‘Twikooè¯„è®ºç³»ç»Ÿé…ç½®æ•™ç¨‹</title>
    <url>/posts/feb84685/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-3">å†™åœ¨å‰é¢</h2>
<p>Hexoåšå®¢é‡Œé¢æ”¯æŒçš„è¯„è®ºç³»ç»Ÿæœ‰ï¼š<code>Disqus</code>ã€<code>Disqusjs</code>ã€<code>Livere</code>ã€<code>Gitalk</code>ã€<code>Valine</code>ã€<code>Waline</code>ã€<code>Utterances</code>ã€<code>Facebook Comments</code>ã€<code>Twikoo</code>ã€<code>Giscus</code>ï¼Œè¿™é‡Œé¢æœ‰çš„è¯„è®ºæœ‰çš„æ˜¯å›½å¤–çš„æœåŠ¡å™¨ã€æœ‰çš„æœ‰å¹¿å‘Šï¼Œæœ¬æ–‡è¦è®²çš„<code>Twikoo</code>æ˜¯åœ¨butterfly3.3ä¹‹åæ”¯æŒçš„ï¼Œå®ƒæ”¯æŒé‚®ä»¶æé†’ã€å¾®ä¿¡æé†’ç­‰åŠŸèƒ½ï¼Œè¿˜æ˜¯éå¸¸å¥½ç”¨çš„ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šæœ¬æ–‡ä»…é’ˆå¯¹è…¾è®¯äº‘çš„éƒ¨ç½²æ–¹å¼ä¸­çš„ã€Œæ‰‹åŠ¨éƒ¨ç½²ã€ï¼Œå…¶ä»–è¯¦ç»†éƒ¨ç½²æ–¹å¼è¯·å‚è€ƒ<a href="https://cloud.tencent.com/act?cps_key=44b3b34da3e3b77bae971b11ed4b2639&amp;fromSource=gwzcw.3814800.3814800.3814800&amp;utm_id=gwzcw.3814800.3814800.3814800&amp;utm_medium=cps&amp;page=cloudbase01">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
</blockquote>
<h2 id="è´­ä¹°äº‘å¼€å‘å¥—é¤">è´­ä¹°äº‘å¼€å‘å¥—é¤</h2>
<p><strong>æ¸©é¦¨æç¤º</strong>ï¼šå¦‚æœä½ å·²ç»æ‹¥æœ‰äº‘å¼€å‘ç¯å¢ƒï¼Œå¯ä»¥å¿½ç•¥è¿™ä¸€æ­¥ï¼Œç›´æ¥åˆ°ã€ç™»å½•æˆæƒã€‘ã€‚</p>
<p><strong>1ã€<strong>è¿›å…¥<a href="https://cloud.tencent.com/act?cps_key=44b3b34da3e3b77bae971b11ed4b2639&amp;fromSource=gwzcw.3814800.3814800.3814800&amp;utm_id=gwzcw.3814800.3814800.3814800&amp;utm_medium=cps&amp;page=cloudbase01">äº‘å¼€å‘CloudBase</a>ï¼Œè¿›è¡Œ</strong>ç™»å½•</strong>ã€<strong>å®åè®¤è¯</strong>æ“ä½œï¼Œç‚¹å‡»<strong>æ§åˆ¶å°</strong>ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060501.png" alt="2022060501"></p>
<p><strong>2ã€<strong>ç‚¹å‡»</strong>äº‘äº§å“</strong>ï¼Œé€‰æ‹©<strong>äº‘å¼€å‘CloudBase</strong>ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060502.png" alt="2022060502"></p>
<p><strong>3ã€<strong>ç‚¹å‡»</strong>æ–°å»º</strong>ï¼Œé€‰æ‹©<strong>ç©ºæ¨¡æ¿</strong>ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060503.png" alt="2022060503"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060504.png" alt="2022060504"></p>
<p><strong>4</strong>ã€é€‰æ‹©åˆé€‚çš„å¥—é¤è¿›è¡Œè´­ä¹°ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060505.png" alt="2022060505"></p>
<blockquote>
<p><strong>æ¸©é¦¨æç¤º</strong>ï¼š</p>
<p>åœ°åŸŸé€‰æ‹©ã€ä¸Šæµ·ã€‘</p>
<p>è®¡è´¹æ–¹å¼é€‰æ‹©ã€åŒ…å¹´åŒ…æœˆã€‘</p>
<p>ç¯å¢ƒåç§°è‡ªç”±å¡«å†™</p>
<p>å¥—é¤ç‰ˆæœ¬é€‰æ‹©ã€ç‰¹æƒ åŸºç¡€ç‰ˆ1ã€‘</p>
</blockquote>
<p><strong>5</strong>ã€æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æ“ä½œä¹‹åï¼Œæˆ‘ä»¬ä¼šæ‹¥æœ‰ä¸€ä¸ªäº‘å¼€å‘ç¯å¢ƒï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060506.png" alt="2022060506"></p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šè®°å½•ä¸€ä¸‹è¿™ä¸ªç¯å¢ƒIDï¼Œæˆ‘ä»¬åé¢ä¼šç”¨ã€‚</p>
</blockquote>
<h2 id="ç™»å½•æˆæƒ">ç™»å½•æˆæƒ</h2>
<p>ç¯å¢ƒ - ç™»å½•æˆæƒ - å¼€å¯ã€åŒ¿åç™»å½•ã€‘</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060507.png" alt="2022060507"></p>
<h2 id="å®‰å…¨é…ç½®">å®‰å…¨é…ç½®</h2>
<p>ç¯å¢ƒ - å®‰å…¨é…ç½® - æ·»åŠ åŸŸåï¼šå°†è‡ªå·±çš„åŸŸåæ·»åŠ è¿›å»</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060508.png" alt="2022060508"></p>
<blockquote>
<p><strong>æ¸©é¦¨æç¤º</strong>ï¼š</p>
<p>å¦‚æœæ›´æ”¹äº†åŸŸåå‘ç°è¯„è®ºåŠ è½½ä¸å‡ºæ¥çš„æƒ…å†µï¼Œè¯·è®°å¾—å›æ¥æ›´æ”¹ä¸ºæœ€æ–°åŸŸåï¼Œå°¤å…¶æ˜¯é‚£äº›åˆšå¼€å§‹ä½¿ç”¨ github.ioæ¥ä½œä¸ºè‡ªå·±åšå®¢åŸŸåçš„ç«¥é‹ï¼Œå“ªå¤©è´­ä¹°äº†è‡ªå·±çš„åŸŸåï¼Œè®°å¾—æ¢ï¼Œè®°å¾—æ¢ï¼Œè®°å¾—æ¢ï¼ˆé‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼‰ã€‚</p>
</blockquote>
<h2 id="äº‘å‡½æ•°">äº‘å‡½æ•°</h2>
<p><strong>1</strong>ã€ç¯å¢ƒ - äº‘å‡½æ•° - æ–°å»ºäº‘å‡½æ•°</p>
<blockquote>
<p><strong>æ¸©é¦¨æç¤º</strong>ï¼š</p>
<p>å‡½æ•°åç§°å¡«å†™ï¼š<code>twikoo</code></p>
<p>åˆ›å»ºæ–¹å¼é€‰æ‹©ï¼šç©ºç™½å‡½æ•°</p>
<p>è¿è¡Œç¯å¢ƒé€‰æ‹©ï¼šNodejs10.15</p>
<p>å‡½æ•°å†…å­˜é€‰æ‹©ï¼š128M</p>
<p>å¿…é¡»æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼é€‰æ‹©ï¼Œä¸è¦çé€‰çå†™å¥½å§ã€‚</p>
</blockquote>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060509.png" alt="2022060509"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060510.png" alt="2022060510"></p>
<p><strong>2</strong>ã€æ¸…ç©ºä¸Šå›¾ä¸­ã€Œå‡½æ•°ä»£ç ã€æ¡†é‡Œçš„å†…å®¹ï¼Œå¤åˆ¶<code>exports.main = require('twikoo-func').main</code>åˆ°é‡Œé¢ï¼Œç‚¹å‡»ç¡®å®šï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060511.png" alt="2022060511"></p>
<p><strong>3</strong>ã€ç‚¹å‡»ã€Œ<strong>twikoo</strong>ã€å‡½æ•°åè¿›å…¥äº‘å‡½æ•°è¯¦æƒ…é¡µ - <strong>å‡½æ•°ä»£ç </strong> - <strong>æ–‡ä»¶</strong> - <strong>æ–°å»ºæ–‡ä»¶</strong>ï¼Œè¾“å…¥<code>package.json</code>ç¡®å®šï¼Œå°†<code>&#123; &quot;dependencies&quot;: &#123; &quot;twikoo-func&quot;: &quot;1.5.11&quot; &#125; &#125;</code>å†…å®¹å¤åˆ¶åˆ°æ–°å»ºçš„æ–‡ä»¶<code>package.json</code>é‡Œé¢ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060512.png" alt="2022060512"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060513.png" alt="2022060513"></p>
<h2 id="é…ç½®butterflyä¸»é¢˜æ–‡ä»¶">é…ç½®butterflyä¸»é¢˜æ–‡ä»¶</h2>
<p>æ‰“å¼€<code>ä¸»é¢˜butterfly</code>ä¸‹çš„é…ç½®æ–‡ä»¶</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">comments:</span></span><br><span class="line">  <span class="comment"># Up to two comments system, the first will be shown as default</span></span><br><span class="line">  <span class="comment"># Choose: Disqus/Disqusjs/Livere/Gitalk/Valine/Waline/Utterances/Facebook Comments/Twikoo/Giscus/Remark42</span></span><br><span class="line">  <span class="attr">use:</span> <span class="string">Twikoo</span> <span class="comment"># Valine,Disqus</span></span><br><span class="line">  <span class="attr">text:</span> <span class="literal">true</span> <span class="comment"># Display the comment name next to the button</span></span><br><span class="line">  <span class="comment"># lazyload: The comment system will be load when comment element enters the browser&#x27;s viewport.</span></span><br><span class="line">  <span class="comment"># If you set it to true, the comment count will be invalid</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">count:</span> <span class="literal">true</span> <span class="comment"># æ–‡ç« top_imageä¸Šæ˜¯å¦æ˜¾ç¤ºè¯„è®ºæ•°é‡</span></span><br><span class="line">  <span class="attr">card_post_count:</span> <span class="literal">true</span> <span class="comment"># é¦–é¡µæ–‡ç« æ˜¯å¦æ˜¾ç¤ºè¯„è®ºæ•°é‡</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># Twikoo</span></span><br><span class="line"><span class="comment"># https://github.com/imaegoo/twikoo</span></span><br><span class="line"><span class="attr">twikoo:</span></span><br><span class="line">  <span class="attr">envId:</span> <span class="string">xxxxxxxxxxxxx</span> <span class="comment"># ç¯å¢ƒIDï¼Œå³æ˜¯ä¸Šé¢åˆ›å»ºçš„äº‘ç¯å¢ƒçš„ID</span></span><br><span class="line">  <span class="attr">region:</span></span><br><span class="line">  <span class="attr">visitor:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">option:</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220605/2022060514.png" alt="2022060514"></p>
<h2 id="æœ€å-5">æœ€å</h2>
<p>å…³äºå…¶ä»–çš„è¯„è®ºç³»ç»Ÿçš„é…ç½®è¯·å‚è€ƒï¼š<a href="https://butterfly.js.org/posts/ceeb73f/">butterflyä¸»é¢˜å®˜æ–¹æ–‡æ¡£</a></p>
<p>å…³äºTwikooè¯„è®ºç³»ç»Ÿè¯¦ç»†æ–‡æ¡£è¯·å‚è€ƒï¼š<a href="https://twikoo.js.org/quick-start.html">Twikooå®˜æ–¹æ–‡æ¡£</a></p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Butterfly</tag>
        <tag>æ•™ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hexoã€‘å¦‚ä½•æ‹¥æœ‰ä¸€ä¸ªè‡ªå®šä¹‰åŸŸåçš„Hexoåšå®¢</title>
    <url>/posts/9fce234e/</url>
    <content><![CDATA[<h2 id="å¦‚ä½•æ‹¥æœ‰è‡ªå·±çš„åŸŸå">å¦‚ä½•æ‹¥æœ‰è‡ªå·±çš„åŸŸå</h2>
<p>åœ¨<a href="https://happycodersunny.github.io/2022/05/09/%E3%80%90Hexo%E3%80%91Mac%20OS%E4%B8%8A%E4%BD%BF%E7%94%A8Hexo%20+%20Github%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/">è¿™ç¯‡æ–‡ç« </a>ä¸­æˆ‘ä»¬åˆ©ç”¨Hexoå’ŒGithubæ­å»ºäº†è‡ªå·±çš„åšå®¢ï¼Œæ­å»ºå‡ºæ¥çš„åšå®¢åœ°å€æ ¼å¼éƒ½æ˜¯ï¼š<code>https://+Githubåšå®¢ä»“åº“å.github.io </code></p>
<p>æ¯”å¦‚æˆ‘çš„åšå®¢åœ°å€å°±æ˜¯ï¼š<code>https://happycodersunny.github.io</code></p>
<p>æ˜¯ä¸æ˜¯è§‰å¾—ä¸å¥½çœ‹ï¼Œå¤§å®¶çš„ç½‘å€éƒ½é•¿ä¸€æ ·ï¼Œå¥½åƒæ˜¯æµæ°´çº¿ä¸Šç”Ÿäº§å‡ºæ¥çš„ä¸€æ ·ï¼Œé‚£ä¹ˆæ€ä¹ˆæ›¿æ¢æˆè‡ªå·±çš„åŸŸåæ˜¾å¾—æ›´ä¸ªæ€§åŒ–å‘¢ï¼Ÿ</p>
<h2 id="è´­ä¹°åŸŸå">è´­ä¹°åŸŸå</h2>
<p>é¦–å…ˆä¸€ä¸ªæ™®é€šçš„åŸŸåä¹Ÿä¸è´µï¼Œä½ å¯ä»¥ä¸ŠXXäº‘ä¹°ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„åŸŸåï¼Œæˆ‘è¿™é‡Œä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220512/20220512_01.png" alt="20220512_01"></p>
<p>åœ¨è´­ä¹°çš„æ—¶å€™éœ€è¦ä½ å®åï¼Œå°±æŒ‰ç…§è¦æ±‚å¡«å†™ç›¸å…³ä¿¡æ¯å³å¯ï¼Œå¡«å†™ä¹‹åéœ€è¦ä¸€ä¼šçš„å®¡æ ¸æ—¶é—´ï¼Œä¸€èˆ¬è¿˜æ˜¯å¾ˆå¿«çš„ã€‚</p>
<p>å¦‚æœä½ å®åœ¨æ˜¯ä¸æƒ³èŠ±é’±ä¹°åŸŸåä¹Ÿå¯ä»¥<a href="%5Bhttp://freenom.com%5D(https://link.zhihu.com/?target=http%3A//freenom.com/)">åœ¨è¿™é‡Œ</a>å…è´¹æ³¨å†Œä¸€ä¸ªåŸŸåï¼Œå…·ä½“æ³¨å†Œå’Œè§£ææ­¥éª¤å¯ä»¥å‚è€ƒ<a href="https://www.zhihu.com/question/31377141/answer/2266363145">çŸ¥ä¹æ–‡ç« </a>ã€‚</p>
<h2 id="åŸŸåè§£æ">åŸŸåè§£æ</h2>
<p>è´­ä¹°åŸŸåä¹‹åæˆ‘ä»¬è¿˜éœ€è¦å¯¹åŸŸåè¿›è¡Œè§£æä¹‹åæ‰èƒ½ä½¿ç”¨ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220512/20220512_02.png" alt="20220512_02"></p>
<p>åœ¨è¿™é‡Œé¢æ·»åŠ ä¸¤æ¡è®°å½•å¦‚ä¸Šæ‰€ç¤ºã€‚</p>
<p>è®°å½•ç±»å‹ä¸ºAçš„å››ä¸ªè®°å½•å€¼æ˜¯Github pageå®˜ç½‘è¯´çš„å››ä¸ªè®°å½•å€¼ï¼Œå¥½å¤šæ–‡ç« å†™çš„192å¼€å¤´çš„ä¸¤ä¸ªå·²ç»ä¸æ˜¯æœ€æ–°çš„äº†ï¼Œå¤§å®¶æœ€å¥½è¿˜æ˜¯å¯¹ç…§<a href="https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/managing-a-custom-domain-for-your-github-pages-site">Github Pages</a>è¿›è¡Œè®¾ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>ping xxx.github.io</code>æ¥éªŒè¯ä¸€ä¸‹ã€‚</p>
<p>è®°å½•ç±»å‹ä¸ºCNAMEçš„è®°å½•å€¼å¿…é¡»æ˜¯<code>xxx.github.io</code>ã€‚</p>
<h2 id="æ·»åŠ CNAMEæ–‡ä»¶">æ·»åŠ CNAMEæ–‡ä»¶</h2>
<p>ä¸€ã€åœ¨<code>Github</code>ä¸Šåšå®¢é¡¹ç›®é‡ŒæŒ‰ç…§ä¸‹é¢æ­¥éª¤é…ç½®è‡ªå®šä¹‰åŸŸåï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220512/20220512_03.png" alt="20220512_03"></p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šæˆ‘ä»¬éœ€è¦å‹¾é€‰<code>Enforce HTTPS</code>ï¼Œè¿™æ ·ä»¥åè®¿é—®æˆ‘ä»¬çš„åšå®¢æ‰å®‰å…¨ä¸ä¼šæç¤ºç½‘ç«™é“¾æ¥ä¸å®‰å…¨çš„é—®é¢˜ï¼Œ<code>Github Pages</code>å®˜ç½‘ä¸Šè¯´å‹¾é€‰è¿™ä¸ªä¹‹åä¸€èˆ¬éœ€è¦ç­‰å¾…24hæ‰å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œä¸è¿‡æœ‰æ—¶å€™ä¹Ÿå¿«ï¼Œæˆ‘è¿™ä¸ªç­‰äº†ä¸¤ä¸‰åˆ†é’Ÿå°±å¯ä»¥äº†ã€‚</p>
<p>äºŒã€é…ç½®å®Œæˆä¹‹åï¼Œåšå®¢é¡¹ç›®ä¸‹ä¼šå¤šä¸€ä¸ª<code>CNAME</code>æ–‡ä»¶ï¼Œé‡Œé¢çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬ä¸Šé¢é…ç½®çš„è‡ªå®šä¹‰åŸŸåï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220512/20220512_04.png" alt="20220512_04"></p>
<p>ä¸‰ã€æ£€æŸ¥åšå®¢æ ¹ç›®å½•ä¸‹çš„sourceæ–‡ä»¶å¤¹ä¸‹æ˜¯å¦æœ‰ä¸€ä¸ªCNAMEæ–‡ä»¶ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰è¯·è‡ªè¡Œåœ¨<code>/source</code>ç›®å½•ä¸‹æ–°æ·»åŠ ä¸€ä¸ªCNAMEæ–‡ä»¶ï¼Œå†…å®¹è·Ÿä¸Šé¢ä¸€æ ·è¿˜æ˜¯å¡«å†™è‡ªå·±è´­ä¹°çš„åŸŸåï¼Œä¿å­˜ã€‚</p>
<h2 id="ä¿®æ”¹åšå®¢é…ç½®æ–‡ä»¶">ä¿®æ”¹åšå®¢é…ç½®æ–‡ä»¶</h2>
<p>æ‰“å¼€æˆ‘ä»¬æœ¬åœ°åšå®¢ç›®å½•ä¸‹çš„<code>_config.yml</code>æ–‡ä»¶ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220512/20220512_05.png" alt="20220512_05"></p>
<p>å°†é‡Œé¢çš„urlæ›¿æ¢æˆæˆ‘ä»¬è‡ªå·±çš„å³å¯ã€‚</p>
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>
<p>å†æ¬¡è¿è¡Œåšå®¢ï¼š</p>
<p>å¦‚æœä¸æ·»åŠ <code>HTTPS</code>ï¼Œç½‘ç«™å·¦ä¸Šè§’ä¼šæç¤ºè¯¥ç½‘ç«™ä¸å®‰å…¨ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220512/20220512_06.png" alt="20220512_06"></p>
<p>æ­£å¸¸æ·»åŠ <code>HTTPS</code>ï¼Œç½‘ç«™å·¦ä¸Šè§’ä¼šæœ‰ä¸€ä¸ªé”å¤´æ ‡å¿—ï¼Œè¯´æ˜è¿™ä¸ªç½‘ç«™æ˜¯å®‰å…¨çš„ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220512/20220512_07.png" alt="20220512_07"></p>
<p>è¿™æ ·æˆ‘ä»¬å°±æŠŠè‡ªå·±è´­ä¹°çš„åŸŸåç”¨ä¸Šäº†ï¼Œä¹Ÿä½¿è‡ªå·±çš„ç½‘ç«™æ›´å…·ä¸ªæ€§åŒ–ä¸€ç‚¹ã€‚</p>
<h2 id="æœ€å-6">æœ€å</h2>
<p>å˜»å˜»å˜»ï¼Œéƒ½çœ‹åˆ°è¿™é‡Œäº†ï¼Œä¸è¦åå•¬ä½ çš„å°æ˜Ÿæ˜Ÿå˜›ï¼Œä¸ºåšä¸»ç‚¹ä¸ªèµå‘ï½</p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>æ•™ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€PSå­¦ä¹ ã€‘åˆè¯†PSç•Œé¢</title>
    <url>/posts/70b04f6f/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-4">å†™åœ¨å‰é¢</h2>
<p>æˆ‘è¿™é‡Œä»¥ã€<strong>PS2020</strong>ã€‘å’Œã€<strong>Mac</strong>ã€‘ä¸ºä¾‹æ¥å¸¦å¤§å®¶åˆæ­¥è®¤è¯†PSï¼Œä¹Ÿé¡ºä¾¿æ•´ç†ä¸€ä¸‹æˆ‘ä¹‹å‰å­¦ä¹ PSçš„ç¬”è®°ã€‚</p>
<h2 id="åˆè¯†PSç•Œé¢">åˆè¯†PSç•Œé¢</h2>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220705/2022070501-20220706104214108.png" alt="2022070501"></p>
<div class="note green no-icon flat"><p>1:ã€èœå•æ ã€‘- åŒ…å«äº†æ–‡ä»¶ã€ç¼–è¾‘ã€å›¾åƒã€å›¾å±‚ã€æ–‡å­—ã€é€‰æ‹©ã€æ»¤é•œã€3Dã€è§†å›¾ã€çª—å£ã€å¸®åŠ©</p>
<p>2:ã€å·¥å…·é€‰é¡¹æ ã€‘ - è®¾ç½®å·¥å…·é€‰é¡¹çš„ï¼Œæ ¹æ®æ‰€é€‰çš„å·¥å…·ä¸åŒã€å·¥å…·é€‰é¡¹æ ã€‘ä¸­çš„å†…å®¹ä¹Ÿä¸åŒ</p>
<p>3:ã€å·¥å…·æ ã€‘- PSç›¸å…³çš„å·¥å…·</p>
<p>4:ã€å·¥ä½œåŒºã€‘- æ‰€æœ‰çš„æ“ä½œéƒ½ä¼šæ˜¾ç¤ºåœ¨å·¥ä½œåŒº</p>
<p>5:ã€å·¥ä½œé¢æ¿ã€‘- ç”¨æ¥è®¾ç½®é¢œè‰²ã€å·¥å…·å‚æ•°ç­‰</p>
</div>
<h2 id="PSå·¥å…·æ ä»‹ç»">PSå·¥å…·æ ä»‹ç»</h2>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220705/2022070530.png" alt="2022070530"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220705/2022070531.png" alt="2022070531"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220705/2022070532.png" alt="2022070532"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220705/2022070533.png" alt="2022070533"></p>
<div class="note green no-icon flat"><p><strong>æ€»ç»“</strong>ï¼šä¸Šé¢æŒ‰ç…§ã€PS2020ã€‘çš„å·¥å…·æ ä»ä¸Šè‡³ä¸‹ç®€å•åšäº†ä¸ªä»‹ç»ï¼Œä½†æ˜¯å¤§å®¶ä¼šå‘ç°æœ‰çš„å›¾æ ‡å³ä¸‹è§’æœ‰<strong>å±•å¼€</strong>æ ‡è®°ï¼Œè¯´æ˜ç€é‡Œé¢è¿˜åŒ…å«äº†å…¶ä»–å·¥å…·ï¼Œå¤§æ¦‚åŒ…å«äº†69ç§å·¥å…·ã€‚</p>
<p>è¿™é‡Œå°±ä¸ä¸€ä¸€ç½—åˆ—å‡ºæ¥ï¼Œå¤§å®¶å¯ä»¥æ‰“å¼€PSçœ‹ä¸€ä¸‹ã€‚</p>
</div>
<h2 id="éƒ¨åˆ†PSæ“ä½œ">éƒ¨åˆ†PSæ“ä½œ</h2>
<h3 id="é¢æ¿æ˜¾ç¤ºä¸éšè—">é¢æ¿æ˜¾ç¤ºä¸éšè—</h3>
<p>éšè—æ‰€æœ‰é¢æ¿ï¼š<label style="color:red">tabé”®</label></p>
<p>åªæ˜¾ç¤ºã€å·¥å…·æ ã€‘å’Œã€å·¥å…·é€‰é¡¹æ ã€‘é¢æ¿ï¼š<label style="color:red">tabé”® + shift</label></p>
<div class="note green no-icon flat"><p><strong>æ³¨æ„</strong>ï¼šå½“é¼ æ ‡é è¿‘å·¦è¾¹ï¼Œå·¦è¾¹é¢æ¿ä¼šå‡ºç°ï¼Œå½“é¼ æ ‡é è¿‘å³è¾¹ï¼Œå³è¾¹é¢æ¿ä¼šå‡ºç°ã€‚</p>
</div>
<h3 id="PSç•Œé¢å¦‚ä½•å¤ä½">PSç•Œé¢å¦‚ä½•å¤ä½</h3>
<p><label style="color:red">ã€PSç•Œé¢ã€‘å³ä¸Šè§’ - å¤ä½åŸºæœ¬åŠŸèƒ½</label></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220705/2022070502.png" alt="2022070502"></p>
<h3 id="å¤šä¸ªæ–‡æ¡£ä¹‹é—´å¦‚ä½•åˆ‡æ¢">å¤šä¸ªæ–‡æ¡£ä¹‹é—´å¦‚ä½•åˆ‡æ¢</h3>
<p><label style="color:red">å¿«æ·é”®ï¼šcontrol + tabé”®</label></p>
<h3 id="å¦‚ä½•å…³é—­å½“å‰æ‰“å¼€çš„æ‰€æœ‰æ–‡æ¡£">å¦‚ä½•å…³é—­å½“å‰æ‰“å¼€çš„æ‰€æœ‰æ–‡æ¡£</h3>
<p><strong>1</strong>ã€<label style="color:red">ã€èœå•æ ã€‘æ–‡ä»¶ - å…³é—­å…¨éƒ¨ </label></p>
<p><strong>2</strong>ã€<label style="color:red">å¿«æ·é”®ï¼šoption + command + W </label></p>
<h3 id="å¦‚ä½•ä¿å­˜è‡ªå®šä¹‰çš„å·¥ä½œåŒº">å¦‚ä½•ä¿å­˜è‡ªå®šä¹‰çš„å·¥ä½œåŒº</h3>
<p><label style="color:red">ã€PSç•Œé¢ã€‘å³ä¸Šè§’ - æ–°å»ºå·¥ä½œåŒº</label></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220705/2022070502-20220705194235045.png" alt="2022070502"></p>
<h3 id="å¦‚ä½•ç¼©æ”¾å›¾ç‰‡">å¦‚ä½•ç¼©æ”¾å›¾ç‰‡</h3>
<p><strong>æ”¾å¤§</strong>ã€<label style="color:red">å¿«æ·é”®ï¼šZé”®</label> ã€<label style="color:red">å¿«æ·é”®ï¼šcommand + +</label></p>
<p><strong>ç¼©å°</strong>ã€<label style="color:red">é•¿æŒ‰option</label>ã€<label style="color:red">å¿«æ·é”®ï¼šcommand + -</label></p>
<p><strong>é€‚åˆå±å¹•</strong>ã€<label style="color:red">ã€å·¥å…·é€‰é¡¹æ ã€‘ -é€‚åˆå±å¹•</label>ã€<label style="color:red">å¿«æ·é”®ï¼šcommand + 0</label></p>
<h3 id="å¦‚ä½•è‡ªå®šä¹‰PSé‡Œçš„å¿«æ·é”®">å¦‚ä½•è‡ªå®šä¹‰PSé‡Œçš„å¿«æ·é”®</h3>
<p><strong>1</strong>ã€<label style="color:red">ã€èœå•æ ã€‘ç¼–è¾‘ - é”®ç›˜å¿«æ·é”®</label></p>
<p><strong>2</strong>ã€<label style="color:red">å¿«æ·é”®ï¼šshift + option + command + K</label></p>
<h3 id="å¦‚ä½•ä½¿ç”¨æ™ºèƒ½å‚è€ƒçº¿">å¦‚ä½•ä½¿ç”¨æ™ºèƒ½å‚è€ƒçº¿</h3>
<p><label style="color:red">ã€èœå•æ ã€‘è§†å›¾ - æ˜¾ç¤º - æ™ºèƒ½å‚è€ƒçº¿</label></p>
<div class="note green no-icon flat"><p><strong>æ³¨æ„</strong>ï¼šè®¾ç½®æ˜¾ç¤ºæ™ºèƒ½å‚è€ƒçº¿åï¼Œåœ¨ç§»åŠ¨ç‰©ä½“çš„æ—¶å€™å°±ä¼šå‡ºç°æ™ºèƒ½å‚è€ƒçº¿ã€‚</p>
</div>
<h3 id="å¦‚ä½•ä½¿ç”¨ç½‘æ ¼">å¦‚ä½•ä½¿ç”¨ç½‘æ ¼</h3>
<p><label style="color:red">ã€èœå•æ ã€‘è§†å›¾ - æ˜¾ç¤º - ç½‘æ ¼</label></p>
<h3 id="å¦‚ä½•ä¿®æ”¹ç½‘æ ¼çš„å¤§å°">å¦‚ä½•ä¿®æ”¹ç½‘æ ¼çš„å¤§å°</h3>
<p><label style="color:red">ã€èœå•æ ã€‘PhotoShop - é¦–é€‰é¡¹ - å‚è€ƒçº¿ã€ç½‘æ ¼å’Œåˆ‡ç‰‡</label></p>
<h3 id="å¦‚ä½•åœ¨PSç•Œé¢æ·»åŠ æ›´å¤šé¢æ¿">å¦‚ä½•åœ¨PSç•Œé¢æ·»åŠ æ›´å¤šé¢æ¿</h3>
<p><label style="color:red">ã€èœå•æ ã€‘ - çª—å£ - é€‰æ‹©æƒ³è¦å±•ç¤ºçš„é¢æ¿</label></p>
]]></content>
      <categories>
        <category>PS</category>
      </categories>
      <tags>
        <tag>PS</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€PSå­¦ä¹ ã€‘å›¾å±‚ç›¸å…³åŸºæœ¬æ“ä½œ</title>
    <url>/posts/c0e79a01/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-5">å†™åœ¨å‰é¢</h2>
<p>ç›¸å…³æ–‡ç« ï¼š</p>
<p>1ã€<a href="!https://codersunny.com/posts/70b04f6f/">ã€PSå­¦ä¹ ã€‘åˆè¯†PSç•Œé¢</a></p>
<p>2ã€<a href="!https://codersunny.com/posts/52ee9edd/">ã€PSå­¦ä¹ ã€‘æ–‡ä»¶åŸºæœ¬æ“ä½œ</a></p>
<p>3ã€<a href="!https://codersunny.com/posts/b55c64d0/">ã€PSå­¦ä¹ ã€‘è‰²å½©åŸºç¡€</a></p>
<p>æœ¬æ–‡ä¸»è¦è®°å½•ä¸€ä¸‹å›¾å±‚çš„ä¸€äº›åŸºæœ¬æ“ä½œï¼ŒPSç‰ˆæœ¬ä¸ºã€PS2020ã€‘ã€‚</p>
<h2 id="åˆè¯†å›¾å±‚">åˆè¯†å›¾å±‚</h2>
<h3 id="å›¾å±‚çš„æ˜¾ç¤ºä¸éšè—">å›¾å±‚çš„æ˜¾ç¤ºä¸éšè—</h3>
<p>ã€èœå•æ ã€‘çª—å£ - å›¾å±‚ï¼ˆå¿«æ·é”®<strong>F7</strong>ï¼‰</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/1.png" alt="1"></p>
<h3 id="æ”¹å˜å›¾å±‚ç¼©ç•¥å›¾å¤§å°">æ”¹å˜å›¾å±‚ç¼©ç•¥å›¾å¤§å°</h3>
<p>é€‰æ‹©å›¾å±‚ - å³å‡» - æ”¹å˜ç¼©ç•¥å›¾å¤§å°</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/2.png" alt="2"></p>
<div class="note green no-icon flat"><p>æ–°å»ºçš„å›¾å±‚é»˜è®¤æ˜¯é€æ˜çš„ï¼Œå¦‚ä½•æƒ³è¦ç»™å½“å‰å›¾å±‚è®¾ç½®é¢œè‰²ï¼Œåœ¨é€‰æ‹©é¢œè‰²ä¹‹åå¡«å……å³å¯æ”¹å˜å›¾å±‚çš„é¢œè‰²ã€‚</p>
<p><strong>å¦‚ä½•å¡«å……ï¼Ÿ</strong></p>
<p>å¿«æ·é”®ï¼šShift + F5</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/3.png" alt="3"></p>
</div>
<h3 id="å¦‚ä½•é€‰æ‹©å¤šä¸ªå›¾å±‚è¿›è¡Œç¼–è¾‘">å¦‚ä½•é€‰æ‹©å¤šä¸ªå›¾å±‚è¿›è¡Œç¼–è¾‘</h3>
<p>Shift + éœ€è¦é€‰æ‹©çš„å›¾å±‚ï¼ˆè¿ç»­æ€§ï¼‰</p>
<p>command + éœ€è¦é€‰æ‹©çš„å›¾å±‚ï¼ˆéè¿ç»­æ€§ï¼‰</p>
<h3 id="å¦‚ä½•å¤åˆ¶ä¸€ä¸ªå›¾å±‚">å¦‚ä½•å¤åˆ¶ä¸€ä¸ªå›¾å±‚</h3>
<p>å›¾å±‚ - å³å‡» - å¤åˆ¶å›¾å±‚</p>
<p>option + éœ€è¦å¤åˆ¶çš„å›¾å±‚ - æ‹–åŠ¨</p>
<h3 id="ä¿®æ”¹å›¾å±‚çš„åç§°å’Œé¢œè‰²">ä¿®æ”¹å›¾å±‚çš„åç§°å’Œé¢œè‰²</h3>
<p>å›¾å±‚é¢æ¿ - é€‰æ‹©å›¾å±‚ - å³é”®é€‰æ‹©é¢œè‰²ï¼ˆå¯ä»¥ç”¨æ¥çªå‡ºå›¾å±‚ï¼‰</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/7.png" alt="7"></p>
<h3 id="å¤åˆ¶å›¾å±‚">å¤åˆ¶å›¾å±‚</h3>
<ol>
<li>é€‰æ‹©å›¾å±‚ - å³é”® - å¤åˆ¶å›¾å±‚</li>
<li>command + J</li>
</ol>
<h3 id="é”å®šå›¾å±‚">é”å®šå›¾å±‚</h3>
<p>é”å®šé€æ˜åƒç´ ï¼šé”å®šä¹‹å ç”»ç¬”å·¥å…·æ— æ³•åœ¨é€æ˜åŒºåŸŸè¿›è¡Œç»˜åˆ¶ã€‚</p>
<p>é”å®šå›¾åƒåƒç´ ï¼šé”å®šä¹‹å æ— æ³•åœ¨è¯¥å›¾å±‚ä¸Šä½¿ç”¨ç”»ç¬”å·¥å…·ã€‚</p>
<p>é”å®šä½ç½®ï¼šé”å®šä¹‹å å›¾åƒçš„ä½ç½®å°±ä¸èƒ½ç§»åŠ¨ã€‚</p>
<p>é”å®šå…¨éƒ¨ï¼šåŒ…æ‹¬é”å®šé€æ˜åƒç´ ã€å›¾åƒåƒç´ ã€ä½ç½®ç­‰ã€‚</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/8.png" alt="8"></p>
<h3 id="æŸ¥æ‰¾å›¾å±‚">æŸ¥æ‰¾å›¾å±‚</h3>
<p>æ ¹æ®ä¸åŒç±»å‹å»è¿‡æ»¤å›¾å±‚ æ–¹ä¾¿å¿«é€Ÿæ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„å›¾å±‚ã€‚</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/9.png" alt="9"></p>
<h3 id="å¯¹é½å›¾å±‚">å¯¹é½å›¾å±‚</h3>
<ol>
<li>å›¾å±‚é¢æ¿é€‰æ‹©éœ€è¦å¯¹é½çš„å›¾å±‚ - ã€å·¥å…·æ ã€‘ç§»åŠ¨å·¥å…·ï¼ˆVï¼‰ - ã€å·¥å…·é€‰é¡¹æ ã€‘é€‰æ‹©å¯¹é½æ–¹å¼</li>
<li>ã€èœå•æ ã€‘å›¾å±‚ - å¯¹é½ - é€‰æ‹©å¯¹é½æ–¹å¼</li>
</ol>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/10.png" alt="10"></p>
<h3 id="åˆ†å¸ƒå›¾å±‚">åˆ†å¸ƒå›¾å±‚</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/11.png" alt="11"></p>
<h3 id="å›¾å±‚çš„å¤åˆ¶-ç²˜è´´åŠŸèƒ½">å›¾å±‚çš„å¤åˆ¶/ç²˜è´´åŠŸèƒ½</h3>
<ol>
<li>command + C å¤åˆ¶ / command + D ç²˜è´´</li>
<li>æ‹–æ‹½éœ€è¦å¤åˆ¶çš„å›¾å±‚åˆ°å¦ä¸€ä¸ªå›¾å±‚ä¸Š</li>
<li>ã€å›¾å±‚é¢æ¿ã€‘- é€‰æ‹©å›¾å±‚ - å³é”®å¤åˆ¶å›¾å±‚</li>
</ol>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/18.png" alt="18"></p>
<h3 id="åŸä½ç²˜è´´">åŸä½ç²˜è´´</h3>
<p>command + V - ã€èœå•æ ã€‘ç¼–è¾‘ - é€‰æ‹©æ€§ç²˜è´´ - åŸä½ç²˜è´´</p>
<h2 id="èƒŒæ™¯å›¾å±‚">èƒŒæ™¯å›¾å±‚</h2>
<h3 id="èƒŒæ™¯å›¾å±‚å’Œæ™®é€šå›¾å±‚çš„åŒºåˆ«">èƒŒæ™¯å›¾å±‚å’Œæ™®é€šå›¾å±‚çš„åŒºåˆ«</h3>
<ol>
<li>èƒŒæ™¯å›¾å±‚æ˜¯é”å®šçš„ï¼Œå›¾å±‚å³è¾¹æœ‰ä¸€ä¸ªã€é”å¤´ã€‘çš„æ ‡å¿—ã€‚</li>
<li>èƒŒæ™¯å›¾å±‚ä¸èƒ½æ”¹å˜å åŠ é¡ºåºã€‚</li>
<li>èƒŒæ™¯å›¾å±‚ä¸èƒ½æ”¹å˜ä¸é€æ˜åº¦ç­‰ã€‚</li>
</ol>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/4.png" alt="4"></p>
<h3 id="èƒŒæ™¯å›¾å±‚è½¬åŒ–ä¸ºæ™®é€šå›¾å±‚">èƒŒæ™¯å›¾å±‚è½¬åŒ–ä¸ºæ™®é€šå›¾å±‚</h3>
<p>ç‚¹å‡»èƒŒæ™¯å›¾å±‚å³è¾¹çš„ã€é”å¤´ã€‘æ ‡å¿—ã€‚</p>
<h2 id="é€‰æ‹©-å–æ¶ˆé€‰æ‹©å›¾å±‚">é€‰æ‹©/å–æ¶ˆé€‰æ‹©å›¾å±‚</h2>
<p>å·¥å…·æ  - é€‰æ‹©ç§»åŠ¨å·¥å…·ï¼ˆVï¼‰- é€‰æ‹©å›¾å±‚è¿›è¡Œç§»åŠ¨ã€‚</p>
<div class="note green no-icon flat"><p>å½“ä¸¤ä¸ªå›¾å±‚é‡å æ—¶éœ€è¦ç§»åŠ¨ä¸‹é¢çš„å›¾å±‚ï¼Œéœ€è¦å°†ã€å·¥å…·é€‰é¡¹æ ã€‘çš„ã€è‡ªåŠ¨é€‰æ‹©ã€‘å–æ¶ˆï¼Œåœ¨å›¾å±‚é¢æ¿é€‰æ‹©éœ€è¦ç§»åŠ¨çš„å›¾å±‚è¿›è¡Œç§»åŠ¨ã€‚</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/5.png" alt="5"></p>
</div>
<h2 id="é“¾æ¥å›¾å±‚">é“¾æ¥å›¾å±‚</h2>
<p>é“¾æ¥å›¾å±‚ï¼šä¸¤ä¸ªå›¾å±‚å½¢æˆä¸€ä¸ªå›¾å±‚ç»„ï¼Œæ“ä½œå…¶ä¸­ä¸€ä¸ªå›¾å±‚ï¼Œå¦ä¸€ä¸ªå›¾å±‚ä¹Ÿä¼šè·Ÿç€ç§»åŠ¨ã€‚</p>
<p>é“¾æ¥ï¼šé€‰ä¸­éœ€è¦é“¾æ¥çš„å›¾å±‚ ç‚¹å‡»ã€é“¾æ¥å›¾å±‚ã€‘ã€‚</p>
<p>å–æ¶ˆé“¾æ¥ï¼šé€‰ä¸­é“¾æ¥çš„å›¾å±‚ å†æ¬¡ç‚¹å‡»ã€é“¾æ¥å›¾å±‚ã€‘ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/6.png" alt="6"></p>
<h2 id="å›¾å±‚ç»„">å›¾å±‚ç»„</h2>
<p>å¦‚ä½•åˆ›å»ºå›¾å±‚ç»„ï¼Ÿ</p>
<ol>
<li>é€‰ä¸­éœ€è¦çš„å›¾å±‚ - ç‚¹å‡»ã€å›¾å±‚é¢æ¿ã€‘åˆ›å»ºæ–°ç»„</li>
<li>é€‰ä¸­éœ€è¦çš„å›¾å±‚ - command + G</li>
</ol>
<div class="note green no-icon flat"><p>æ³¨æ„ï¼šå›¾å±‚ç»„æ˜¯å¯ä»¥å åŠ çš„ã€‚</p>
</div>
<h2 id="å›¾å±‚æ ·å¼">å›¾å±‚æ ·å¼</h2>
<ol>
<li>åŒå‡»å›¾å±‚ç©ºç™½å¤„ - å›¾å±‚æ ·å¼</li>
<li>é€‰æ‹©å›¾å±‚ - ã€å›¾å±‚é¢æ¿ã€‘æ·»åŠ å›¾å±‚æ ·å¼ - æ··åˆé€‰é¡¹</li>
</ol>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/12.png" alt="12"></p>
<div class="note red no-icon flat"><p><strong>å¦‚ä½•å¤åˆ¶æ·»åŠ çš„ä¸€äº›å›¾å±‚æ ·å¼çš„æ•ˆæœåˆ°å…¶ä»–å›¾å±‚ï¼Ÿ</strong></p>
<p>option + å›¾å±‚æ ·å¼æ•ˆæœ + æ‹–åˆ°åˆ°éœ€è¦çš„å›¾å±‚ä¸‹</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/13.png" alt="13"></p>
</div>
<h3 id="ç¼©æ”¾å›¾å±‚æ ·å¼å¤§å°">ç¼©æ”¾å›¾å±‚æ ·å¼å¤§å°</h3>
<p>ã€èœå•æ ã€‘å›¾å±‚ - å›¾å±‚æ ·å¼ - ç¼©æ”¾æ•ˆæœ</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/14.png" alt="14"></p>
<h3 id="å°†å›¾å±‚æ ·å¼åˆ›å»ºä¸ºå›¾å±‚">å°†å›¾å±‚æ ·å¼åˆ›å»ºä¸ºå›¾å±‚</h3>
<p>ã€èœå•æ ã€‘å›¾å±‚ - å›¾å±‚æ ·å¼ - åˆ›å»ºå›¾å±‚ï¼ˆæœ‰å‡ ç§æ ·å¼å°±ä¼šè½¬åŒ–ä¸ºå‡ ç§å›¾å±‚ï¼‰</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/15.png" alt="15"></p>
<p>å°†å›¾å±‚æ ·å¼è½¬åŒ–ä¸ºå›¾å±‚ä¹‹å æˆ‘ä»¬å¯ä»¥å•ç‹¬å¯¹æŸä¸ªå›¾å±‚è¿›è¡Œè°ƒèŠ‚ æ¯”å¦‚è‰²ç›¸/é¥±å’Œåº¦ï¼ˆå¿«æ·é”®ï¼šcommand + Uï¼‰</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/16.png" alt="16"></p>
<h3 id="å›¾å±‚æ ·å¼çš„å åŠ ">å›¾å±‚æ ·å¼çš„å åŠ </h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/10/17.png" alt="17"></p>
<div class="note green no-icon flat"><p>å¦‚æœå›¾å±‚æ ·å¼é¢æ¿æ˜¾ç¤ºçš„ä¸æ˜¯æ‰€æœ‰çš„æ•ˆæœ å¯ä»¥é€‰æ‹©å·¦ä¸‹è§’çš„fx - æ˜¾ç¤ºæ‰€æœ‰æ•ˆæœ</p>
<p>option + å¤ä½ï¼šå–æ¶ˆæœ¬æ¬¡æ‰€æœ‰å›¾å±‚æ ·å¼çš„æ‰€æœ‰è®¾ç½®ã€‚</p>
</div>
<h2 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å</h2>
<p>å…³äºå›¾å±‚çš„ä¸€äº›åŸºæœ¬æ“ä½œçš„ç¬”è®°è®°å½•åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>PS</category>
      </categories>
      <tags>
        <tag>PS</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€PSå­¦ä¹ ã€‘æ–‡ä»¶åŸºæœ¬æ“ä½œ</title>
    <url>/posts/52ee9edd/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-6">å†™åœ¨å‰é¢</h2>
<p>ç›¸å…³æ–‡ç« ï¼š1ã€<a href="https://codersunny.com/posts/70b04f6f/">åˆè¯†PSç•Œé¢</a></p>
<p>æœ¬ç¯‡ä¸»è¦è®²ä¸€ä¸‹PSä¸­å…³äºæ–‡ä»¶çš„ä¸€äº›æ“ä½œï¼ŒPSç‰ˆæœ¬ä¸ºã€PS2020ã€‘ã€‚</p>
<h2 id="æ–‡ä»¶çš„ç›¸å…³æ“ä½œ">æ–‡ä»¶çš„ç›¸å…³æ“ä½œ</h2>
<h3 id="å¦‚ä½•æ–°å»ºæ–‡æ¡£">å¦‚ä½•æ–°å»ºæ–‡æ¡£</h3>
<p><strong>1</strong>ã€<label style="color:red">PSç•Œé¢å·¦è¾¹ã€æ–°å»ºã€‘æŒ‰é’®</label></p>
<p><strong>2</strong>ã€<label style="color:red">ã€èœå•æ ã€‘æ–‡ä»¶ - æ–°å»º</label></p>
<p><strong>3</strong>ã€<label style="color:red">å¿«æ·é”®ï¼šcommand + N</label></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070701.png" alt="2022070701"></p>
<div class="note green no-icon flat"><p><strong>æç¤º</strong>ï¼šé‡Œé¢æœ‰å¾ˆå¤šPSé»˜è®¤ä¸ºæˆ‘ä»¬æä¾›çš„æ¨¡ç‰ˆï¼Œå¦‚æœæœ‰åˆé€‚çš„å¯ä»¥ç›´æ¥åˆ›å»ºã€‚</p>
</div>
<h3 id="å¦‚ä½•ä¿å­˜é¢„è®¾æ–‡æ¡£">å¦‚ä½•ä¿å­˜é¢„è®¾æ–‡æ¡£</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070702.png" alt="2022070702"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070703.png" alt="2022070703"></p>
<h3 id="æ–°å»ºæ–‡æ¡£æ³¨æ„äº‹é¡¹">æ–°å»ºæ–‡æ¡£æ³¨æ„äº‹é¡¹</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070704.png" alt="2022070704"></p>
<div class="note green no-icon flat"><p><strong>æç¤º</strong>ï¼š</p>
<ol>
<li>å½“å¸Œæœ›å°†å¤šä¸ªé¡µé¢çš„UIæ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œåœ¨åˆ›å»ºæ–‡ä»¶æ—¶éœ€è¦å‹¾é€‰ã€ç”»æ¿ã€‘ã€‚</li>
<li>å¦‚æœæ–‡æ¡£æ˜¯é’ˆå¯¹ã€æ‰“å°è¾“å‡ºã€‘ï¼Œé¢œè‰²æ¨¡å¼ä¸€èˆ¬é€‰æ‹©<label style="color:red">CMYKæ¨¡å¼</label>ï¼Œä½æ•°ä¿æŒ<label style="color:red">8bit</label>ã€‚</li>
<li>å¦‚æœæ–‡æ¡£æ˜¯é’ˆå¯¹ã€å±å¹•æ˜¾ç¤ºã€‘ï¼Œé¢œè‰²æ¨¡å¼ä¸€èˆ¬é€‰æ‹©<label style="color:red">RGBæ¨¡å¼</label>ï¼Œä½æ•°ä¿æŒ<label style="color:red">8bit</label>ã€‚</li>
<li>é¢œè‰²æ¨¡å¼çš„ä½æ•°è¶Šé«˜å‘ˆç°çš„é¢œè‰²å°±è¶Šå¤šï¼Œä¸è¿‡ä¸€èˆ¬æˆ‘ä»¬è‚‰çœ¼ä¹Ÿæ— æ³•è¯†åˆ«é‚£ä¹ˆå¤šé¢œè‰²æ‰€ä»¥ä½æ•°ä¸€èˆ¬ä¿æŒ8bitå³å¯ã€‚</li>
</ol>
</div>
<h3 id="å¦‚ä½•æ‰“å¼€æ–‡ä»¶">å¦‚ä½•æ‰“å¼€æ–‡ä»¶</h3>
<p><strong>1</strong>ã€<label style="color:red">PSç•Œé¢å·¦è¾¹ã€æ‰“å¼€ã€‘æŒ‰é’®</label></p>
<p><strong>2</strong>ã€<label style="color:red">ã€èœå•æ ã€‘æ–‡ä»¶ - æ‰“å¼€</label></p>
<p><strong>3</strong>ã€<label style="color:red">command + O</label></p>
<p><strong>4</strong>ã€<label style="color:red">é€‰æ‹©éœ€è¦æ‰“å¼€çš„æ–‡ä»¶æ‹–æ‹½åˆ°PS</label></p>
<h3 id="å¦‚ä½•æ‰“å¼€åºåˆ—æ–‡ä»¶">å¦‚ä½•æ‰“å¼€åºåˆ—æ–‡ä»¶</h3>
<p><label style="color:red">é€‰æ‹©æŸä¸€åºåˆ—æ–‡ä»¶ - å‹¾é€‰ã€å›¾åƒåºåˆ—ã€‘</label></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070705.png" alt="2022070705"></p>
<div class="note green no-icon flat"><p><strong>æ³¨æ„</strong>ï¼šPSå·¥ä½œåŒºä¼šå‡ºç°æ—¶é—´è½´ï¼Œå¦‚æœæ²¡æœ‰é€šè¿‡<label style="color:red">ã€èœå•æ ã€‘çª—å£ - æ—¶é—´è½´</label>é…ç½®ã€‚</p>
</div>
<h3 id="ç½®å…¥é“¾æ¥çš„æ™ºèƒ½å¯¹è±¡">ç½®å…¥é“¾æ¥çš„æ™ºèƒ½å¯¹è±¡</h3>
<p><label style="color:red">ã€èœå•æ ã€‘æ–‡ä»¶ - ç½®å…¥é“¾æ¥çš„æ™ºèƒ½å¯¹è±¡</label></p>
<p>ğŸŒ°ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070706.png" alt="2022070706"></p>
<p>ç‚¹å‡»å·¦è¾¹å›¾å±‚é¢æ¿ç½®å…¥çš„é“¾æ¥å¯¹è±¡ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070707.png" alt="2022070707"></p>
<p>ä¿®æ”¹è¿™ä¸ªç½®å…¥çš„é“¾æ¥å¯¹è±¡ã€ä¿å­˜ã€‘ä¼šå‘ç°åŸæ¥å·²ç»çš„æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070708.png" alt="2022070708"></p>
<h3 id="ç½®å…¥åµŒå…¥å¯¹è±¡">ç½®å…¥åµŒå…¥å¯¹è±¡</h3>
<p><label style="color:red">ã€èœå•æ ã€‘æ–‡ä»¶ - ç½®å…¥åµŒå…¥å¯¹è±¡</label></p>
<div class="note green no-icon flat"><p><strong>ç½®å…¥é“¾æ¥çš„æ™ºèƒ½å¯¹è±¡ å’Œ ç½®å…¥åµŒå…¥å¯¹è±¡çš„åŒºåˆ«</strong>ï¼šæ™ºèƒ½é“¾æ¥å¯¹è±¡<strong>ä¼š</strong>éšç€æºæ–‡ä»¶çš„ä¿®æ”¹è€Œå‘ç”Ÿå˜åŒ– åµŒå…¥å¯¹è±¡<strong>ä¸ä¼š</strong>éšç€æºæ–‡ä»¶çš„ä¿®æ”¹è€Œå‘ç”Ÿå˜åŒ–ã€‚</p>
</div>
<h3 id="å¦‚ä½•å­˜å‚¨æ–‡ä»¶">å¦‚ä½•å­˜å‚¨æ–‡ä»¶</h3>
<p><strong>1</strong>ã€<label style="color:red">ã€èœå•æ ã€‘æ–‡ä»¶ - å­˜å‚¨ä¸º</label></p>
<p><strong>2</strong>ã€<label style="color:red">å¿«æ·é”®ï¼šoption + command + S</label></p>
<h3 id="ç”»æ¿çš„åˆ›å»ºä¸ä¿®æ”¹">ç”»æ¿çš„åˆ›å»ºä¸ä¿®æ”¹</h3>
<p><strong>1</strong>ã€<label style="color:red">ã€å›¾å±‚é¢æ¿ã€‘å³è¾¹æŒ‰é’® - æ–°å»ºç”»æ¿</label></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070709.png" alt="2022070709"></p>
<p>å±æ€§é¢æ¿å¯ä»¥è°ƒèŠ‚ç”»æ¿çš„å±æ€§ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070710.png" alt="2022070710"></p>
<p><strong>2</strong>ã€<label style="color:red">ã€å·¥å…·æ ã€‘- ç”»æ¿å·¥å…·ï¼ˆVï¼‰- ã€å·¥å…·é€‰é¡¹æ ã€‘æ·»åŠ æ–°ç”»æ¿ - åœ¨å·¥ä½œåŒºåˆé€‚çš„ä½ç½®å•å‡»</label></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070711.png" alt="2022070711"></p>
<div class="note green no-icon flat"><p><strong>æç¤º</strong>ï¼šé¼ æ ‡æ”¾ç½®åœ¨ã€ç”»æ¿åç§°ä¸Šã€‘ç§»åŠ¨å³å¯ç§»åŠ¨ç”»æ¿ã€‚</p>
</div>
<h3 id="å¦‚ä½•å¯¼å‡ºç”»æ¿">å¦‚ä½•å¯¼å‡ºç”»æ¿</h3>
<p><label style="color:red">ã€èœå•æ ã€‘æ–‡ä»¶ - å¯¼å‡º - å°†ç”»æ¿å¯¼å‡ºåˆ°PDF</label></p>
<p>ä¹Ÿå¯ä»¥å¯¼å‡ºä¸ºå…¶ä»–çš„æ ¼å¼ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070712.png" alt="2022070712"></p>
<div class="note green no-icon flat"><p><strong>æç¤º</strong>ï¼š</p>
<ol>
<li>ã€å¯¼å‡ºä¸ºã€‘å¯ä»¥ä¸ºæ¯ä¸ªç”»æ¿ä»¥ä¸åŒçš„æ ¼å¼å¯¼å‡ºã€‚</li>
<li>ã€å¯¼å‡ºä¸ºã€‘ - åŒè”æ˜¯ã€PS2020ã€‘æ–°å¢çš„åŠŸèƒ½</li>
<li><label style="color:red">command + ç”»æ¿ç‚¹å‡»</label> å¯ä»¥å±•ç¤ºæˆ–æ”¶èµ·å¤šä¸ªé¢æ¿</li>
<li>ç”»æ¿å¯ä»¥å•ç‹¬å¯¼å‡º</li>
</ol>
</div>
<h3 id="å¦‚ä½•ä¸ºæ–‡ä»¶æ·»åŠ ç‰ˆæƒä¿¡æ¯å’Œç®€ä»‹">å¦‚ä½•ä¸ºæ–‡ä»¶æ·»åŠ ç‰ˆæƒä¿¡æ¯å’Œç®€ä»‹</h3>
<p><strong>1</strong>ã€<label style="color:red">ã€èœå•æ ã€‘æ–‡ä»¶ - æ–‡ä»¶ç®€ä»‹ - è¾“å…¥ç›¸å…³æè¿°ä¿¡æ¯</label></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070716.png" alt="2022070716"></p>
<p><strong>2</strong>ã€<label style="color:red">ã€èœå•æ ã€‘PhotoShop - é¦–é€‰é¡¹ - å¯¼å‡º</label></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022070718.png" alt="2022070718"></p>
]]></content>
      <categories>
        <category>PS</category>
      </categories>
      <tags>
        <tag>PS</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€PSå­¦ä¹ ã€‘è‰²å½©åŸºç¡€</title>
    <url>/posts/b55c64d0/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-7">å†™åœ¨å‰é¢</h2>
<p>ç›¸å…³æ–‡ç« ï¼š</p>
<p>1ã€<a href="https://codersunny.com/posts/70b04f6f/">ã€PSå­¦ä¹ ã€‘åˆè¯†PSç•Œé¢</a></p>
<p>2ã€<a href="https://codersunny.com/posts/52ee9edd/">ã€PSå­¦ä¹ ã€‘æ–‡ä»¶åŸºæœ¬æ“ä½œ</a></p>
<p>æœ¬ç¯‡ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹å…³äºPSä¸­è‰²å½©ç›¸å…³åŸºç¡€ï¼ŒPSç‰ˆæœ¬ä¸ºã€PS2020ã€‘ã€‚</p>
<h2 id="è‰²å½©åŸºç¡€">è‰²å½©åŸºç¡€</h2>
<h3 id="è‰²å½©ä¸“ä¸šæœ¯è¯­">è‰²å½©ä¸“ä¸šæœ¯è¯­</h3>
<p><strong>1</strong>ã€<label style="color:red">è‰²ç›¸</label></p>
<p>é¢œè‰²åœ¨ç”»æ¿ä¸Šçš„åæ˜  å¯ä»¥ç†è§£ä¸ºå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„é¢œè‰²ã€‚</p>
<p><strong>2</strong>ã€<label style="color:red">çº¯åº¦</label></p>
<p>å½©åº¦ - Chroma æ˜¯ç›¸å¯¹äºç°è‰²è€Œè¨€ ä»å·¦åˆ°å³ å½©åº¦è¶Šæ¥è¶Šé«˜</p>
<p>é¥±å’Œåº¦ - Saturation ä»å·¦åˆ°å³ é¥±å’Œåº¦è¶Šæ¥è¶Šä½</p>
<p>å¼ºåº¦ - Intensity ä¸­é—´çš„é¢œè‰² å¼ºåº¦æ˜¯æœ€é«˜çš„</p>
<div class="note green no-icon flat"><p>å½©åº¦ã€é¥±å’Œåº¦ã€å¼ºåº¦éƒ½å¯ä»¥ç”¨æ¥å½¢å®¹çº¯åº¦ã€‚</p>
</div>
<p><strong>3</strong>ã€<label style="color:red">æ˜åº¦</label></p>
<p>å…‰äº®åº¦ - Luminance è¶Šæš—çš„é¢œè‰²å…‰äº®åº¦è¶Šä½ è¶Šäº®çš„é¢œè‰²å…‰äº®åº¦è¶Šé«˜</p>
<p>æš—è‰² - Shade ä»å·¦åˆ°å³è¶Šæ¥è¶Šæš—</p>
<p>æµ…è‰² - Tint ä»å·¦åˆ°å³è¶Šæ¥è¶Šæµ…</p>
<p>â€‹</p>
<p>å…³äºè‰²å½©å¯ä»¥çœ‹çœ‹ä¸‹å›¾ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220707/2022072101.png" alt="2022072101"></p>
<h2 id="é¢œè‰²çš„åŠ æ³•ä¸å‡æ³•">é¢œè‰²çš„åŠ æ³•ä¸å‡æ³•</h2>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220721/2022072102.png" alt="2022072102"></p>
<p><strong>1</strong>ã€<label style="color:red">å°åˆ·ä¸‰åŸè‰²</label>ï¼šé’è‰²ã€å“çº¢ã€é»„è‰²</p>
<p><strong>2</strong>ã€<label style="color:red">å…‰çš„ä¸‰åŸè‰²</label>ï¼šçº¢è‰²ã€è“è‰²ã€ç»¿è‰²</p>
<h2 id="è‰²ç¯æ„æˆåŸç†">è‰²ç¯æ„æˆåŸç†</h2>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220721/2022072103.png" alt="2022072103"></p>
<h2 id="å¦‚ä½•ä½¿ç”¨åŒè‰²æ¨¡å¼æ‰“é€ å•è‰²è°ƒçš„ç…§ç‰‡æ•ˆæœ">å¦‚ä½•ä½¿ç”¨åŒè‰²æ¨¡å¼æ‰“é€ å•è‰²è°ƒçš„ç…§ç‰‡æ•ˆæœ</h2>
<p><label style="color:red">ã€èœå•æ ã€‘ - å›¾åƒ - æ¨¡å¼ - ç°åº¦</label></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220721/2022072104.png" alt="2022072104"></p>
<p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220721/2022072105.png" alt="2022072105"></p>
<h2 id="ç”¨å¸ç®¡å·¥å…·é€‰å–é¢œè‰²">ç”¨å¸ç®¡å·¥å…·é€‰å–é¢œè‰²</h2>
<p><label style="color:red">ã€å·¥å…·æ ã€‘ - å¸ç®¡å·¥å…·</label></p>
<p><label style="color:red">å¿«æ·é”®ï¼šI</label></p>
<div class="note green no-icon flat"><p>1ã€ä½¿ç”¨ã€å¸ç®¡å·¥å…·ã€‘å¸å–çš„é¢œè‰²é»˜è®¤æ˜¯ä½œä¸ºã€å‰æ™¯è‰²ã€‘çš„</p>
<p>2ã€ä½¿ç”¨ <label style="color:red">option + å¸ç®¡å·¥å…·</label>å¸å–çš„é¢œè‰²æ˜¯ä½œä¸ºã€èƒŒæ™¯è‰²ã€‘çš„</p>
<p>3ã€ã€å·¥å…·é€‰é¡¹æ ã€‘- å–æ ·å¤§å°æ˜¯æŒ‡å–æ ·åŒºåŸŸï¼šåœ¨è¿™ä¸ªèŒƒå›´å†…çš„åƒç´ éƒ½ä¼šå‚ä¸å¸å–é¢œè‰²çš„è®¡ç®—</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220721/2022072106.png" alt="2022072106"></p>
</div>
<h2 id="è‰²è½®å–è‰²æ¨¡å¼">è‰²è½®å–è‰²æ¨¡å¼</h2>
<p><label style="color:red">é¢œè‰² - è‰²è½®</label></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220721/2022072108.png" alt="2022072108"></p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220721/2022072109.png" alt="2022072109"></p>
<div class="note green no-icon flat"><p>Hï¼šè‰²ç›¸</p>
<p>Sï¼šé¥±å’Œåº¦ï¼ˆçº¯åº¦ï¼‰</p>
<p>Bï¼šæ˜åº¦</p>
</div>
<h2 id="ç”¨æ‹¾è‰²å™¨é€‰å–é¢œè‰²ï¼šè®¾ç½®å‰æ™¯è‰²-å–è‰²å™¨">ç”¨æ‹¾è‰²å™¨é€‰å–é¢œè‰²ï¼šè®¾ç½®å‰æ™¯è‰² - å–è‰²å™¨</h2>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220721/2022072110.png" alt="2022072110"></p>
<div class="note green no-icon flat"><p>å‰é¢çš„æ–¹å—ï¼šä»£è¡¨çš„æ˜¯å‰æ™¯è‰²</p>
<p>åé¢çš„æ–¹å—ï¼šä»£è¡¨çš„æ˜¯èƒŒæ™¯è‰²</p>
<p>ç‚¹å‡»å·¦ä¸‹è§’çš„å°å—å³å°†å‰æ™¯è‰²å’ŒèƒŒæ™¯è‰²è®¾ç½®ä¸ºé»˜è®¤ï¼ˆå‰æ™¯è‰²ä¸ºé»‘è‰² èƒŒæ™¯è‰²ä¸ºç™½è‰²ï¼‰</p>
<p><strong>æç¤º</strong>ï¼šæŒ‰é”®ç›˜ä¸Šçš„ã€Dã€‘ä¹Ÿå¯ä»¥æŠŠé¢œè‰²å¤åŸ</p>
<p>â€‹		   ã€Xã€‘åˆ‡æ¢å‰æ™¯è‰²å’ŒèƒŒæ™¯è‰²</p>
</div>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220721/2022072111.png" alt="2022072111"></p>
<div class="note green no-icon flat"><p><strong>è­¦å‘Šæç¤º</strong>ï¼šå¦‚æœæ­£åœ¨åšçš„å›¾ç‰‡åªæ˜¯é’ˆå¯¹äºæ‰‹æœºå±å¹•ç­‰æ˜¾ç¤º å¯ä»¥å¿½ç•¥ å¦‚æœæ˜¯ç”¨äºæ‰“å° å°±è¡¨ç¤ºå¯èƒ½ä¼šæ‰“å°ä¸å‡ºæ¥ å¯ä»¥ç‚¹å‡»è­¦å‘Šæ ‡è¯†ä¸‹é¢çš„é¢œè‰² pså³ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨å¾®è°ƒã€‚</p>
</div>
<h2 id="åˆ©ç”¨è‰²æ¿ç”»æ¿è°ƒæ•´é¢œè‰²">åˆ©ç”¨è‰²æ¿ç”»æ¿è°ƒæ•´é¢œè‰²</h2>
<p>ã€PSç•Œé¢ã€‘ - è‰²æ¿ï¼šç›´æ¥ç‚¹å‡»å¯ä»¥æ”¹å˜ã€èƒŒæ™¯è‰²ã€‘é¢œè‰² ã€option + ç‚¹å‡»ã€‘å¯ä»¥æ”¹å˜ã€å‰æ™¯è‰²ã€‘</p>
<h2 id="å¢å¼ºçš„è‰²æ¿åŠŸèƒ½ï¼šæ™ºèƒ½å¡«è‰²">å¢å¼ºçš„è‰²æ¿åŠŸèƒ½ï¼šæ™ºèƒ½å¡«è‰²</h2>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220721/2022072112.png" alt="2022072112"></p>
<p>å¦‚ä½•æ”¹å˜æ½œæ°´è‰‡çš„é¢œè‰²ï¼šåœ¨ã€è‰²æ¿ã€‘ä¸Šé€‰ä¸­é¢œè‰²ç›´æ¥æ‹–æ‹½åˆ°æ½œæ°´è‰‡çš„ä½ç½®å³å¯ã€‚</p>
<p>å¦‚ä½•å®ç°å¦‚ä¸‹æ•ˆæœï¼Ÿ</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220721/2022072113.png" alt="2022072113"></p>
<p><strong>1</strong>ã€<label style="color:red">option + command + æ‹–æ‹½é¢œè‰²</label></p>
<p><strong>2</strong>ã€<label style="color:red">å›¾å±‚é¢æ¿ - æ·»åŠ å›¾å±‚æ ·å¼ - é¢œè‰²å åŠ </label></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220721/2022072114.png" alt="2022072114"></p>
]]></content>
      <categories>
        <category>PS</category>
      </categories>
      <tags>
        <tag>PS</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé€†å‘ã€‘Cycriptçš„åŸºæœ¬ä½¿ç”¨</title>
    <url>/posts/7495500c/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-8">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡ä¸»è¦æ˜¯ä»‹ç»ä¸€ä¸‹é€†å‘ä¸­Cycriptçš„åŸºæœ¬ç”¨æ³•ã€‚</p>
<h2 id="ç®€å•ä»‹ç»">ç®€å•ä»‹ç»</h2>
<p>Cycriptæ˜¯OCã€C++ã€JSã€Javaç­‰å¤šç§è¯­æ³•çš„ä¸€ä¸ªæ··åˆç‰©ï¼Œå®ƒæ˜¯ç”¨æ¥æ¢ç´¢ã€ä¿®æ”¹ã€è°ƒè¯•å½“å‰æ­£åœ¨è¿è¡Œçš„APPï¼Œè¿™ä¸ªåœ¨æˆ‘ä»¬ä»¥åé€†å‘çš„è¿‡ç¨‹ä¸­ä¼šç»å¸¸ä½¿ç”¨åˆ°ï¼Œå…³äºCycriptçš„æ›´å¤šä»‹ç»å¤§å®¶å¯ä»¥å‚è€ƒ<a href="!http://www.cycript.org/">Cycriptå®˜ç½‘</a>ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/1.png" alt="1"></p>
<h2 id="å®‰è£…Cycript">å®‰è£…Cycript</h2>
<p>åœ¨Cydiaé‡Œé¢æœç´¢Cycriptè¿›è¡Œä¸‹è½½ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/2.png" alt="2"></p>
<h2 id="Cycriptçš„åŸºæœ¬ä½¿ç”¨">Cycriptçš„åŸºæœ¬ä½¿ç”¨</h2>
<h3 id="Cycriptçš„å¼€å¯å’Œå…³é—­">Cycriptçš„å¼€å¯å’Œå…³é—­</h3>
<p>1ã€å¼€å¯</p>
<ul>
<li>ä¿æŒMacå’ŒiPhoneçš„å®‰å…¨è¿æ¥</li>
<li>ä½¿ç”¨å‘½ä»¤<code>cycript -p è¿›ç¨‹ID</code>æˆ–<code>cycript -p è¿›ç¨‹åç§°</code></li>
</ul>
<div class="note green no-icon flat"><p>å¦‚æœä¸å¤ªäº†è§£Macå’ŒiPhoneæ€ä¹ˆä¿æŒè¿æ¥çš„ï¼Œå¯ä»¥å‚è€ƒåšä¸»çš„å¦ä¸€ç¯‡æ–‡ç« ï¼š<a href="!https://codersunny.com/posts/7df93f3b/">ã€iOSé€†å‘ã€‘å¦‚ä½•è®©Macå’ŒiPhoneå»ºç«‹å®‰å…¨è¿æ¥</a>ã€‚</p>
</div>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/3.png" alt="3"></p>
<p>è¿™æ ·æˆ‘ä»¬å°±å¤„äºä¸€ä¸ªCycriptçš„è¯­æ³•ç¯å¢ƒã€‚</p>
<p>2ã€å…³é—­</p>
<p>å¿«æ·é”®ï¼š<code>control + D</code></p>
<p>3ã€æ¸…å±</p>
<p>å¿«æ·é”®ï¼š<code>command + R</code></p>
<h3 id="æŸ¥çœ‹è¿›ç¨‹çš„IDå’Œåç§°">æŸ¥çœ‹è¿›ç¨‹çš„IDå’Œåç§°</h3>
<p>åœ¨ä»¥åé€†å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>cycript -p è¿›ç¨‹ID</code>æˆ–<code>cycript -p è¿›ç¨‹åç§°</code>æ¥æ¢ç©¶æŸä¸ªAPPï¼Œé‚£ä¹ˆè¿™ä¸ªè¿›ç¨‹IDå’Œè¿›ç¨‹åç§°æˆ‘ä»¬åº”è¯¥ä»å“ªé‡Œè·å–å‘¢ã€‚</p>
<p>1ã€åœ¨Cydiaä¸­æœç´¢<code>adv_cmds</code>å¹¶å®‰è£…</p>
<p>2ã€ä½¿ç”¨<code>ps</code>ç›¸å…³å‘½ä»¤æŸ¥çœ‹</p>
<div class="note pink no-icon flat"><p>åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹ï¼š<code>ps -A</code></p>
<p>æ ¹æ®å…³é”®è¯æ˜¾ç¤ºæŸäº›è¿›ç¨‹ï¼š<code>ps -A|grep å…³é”®è¯</code></p>
</div>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/4.png" alt="4"></p>
<p>æˆ‘ä»¬è¿™é‡Œä»¥ã€å–œé©¬æ‹‰é›…ã€‘APPä¸ºä¾‹ï¼š7091å°±æ˜¯è¿›ç¨‹IDï¼Œtingå°±æ˜¯è¿›ç¨‹åç§°ï¼Œç”±äºè¿›ç¨‹IDå¯èƒ½éšæ—¶ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå»ºè®®ä»¥åä½¿ç”¨è¿›ç¨‹åç§°ã€‚</p>
<div class="note pink no-icon flat"><p><strong>æ³¨æ„</strong>ï¼šè¦æƒ³æˆ–è€…æŸä¸ªAPPçš„è¿›ç¨‹åç§°ã€IDï¼Œå¿…é¡»è¦æ‰“å¼€è¿™ä¸ªAPPã€‚</p>
</div>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/5.png" alt="5"></p>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›‘å¬è¿™ä¸ªè¿›ç¨‹äº†ã€‚</p>
<h3 id="Cycriptä¸­å¸¸ç”¨çš„è¯­æ³•">Cycriptä¸­å¸¸ç”¨çš„è¯­æ³•</h3>
<ul>
<li>è·å–å½“å‰è¿›ç¨‹çš„Application</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">[<span class="built_in">UIApplication</span> sharedApplication] æˆ– <span class="built_in">UIApp</span></span><br></pre></td></tr></table></figure>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/6.png" alt="6"></p>
<ul>
<li>å®šä¹‰å˜é‡</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">var å˜é‡å = å˜é‡å€¼</span><br></pre></td></tr></table></figure>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/7.png" alt="7"></p>
<p>è¿™æ ·åœ¨å½“å‰å†…å­˜ç¯å¢ƒä¸‹ï¼Œåªè¦æˆ‘ä»¬è¾“å…¥<code>app</code>å°±å¯ä»¥è·å–windowã€‚</p>
<ul>
<li>è·å–å½“å‰APPçš„RootViewController</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">UIApp</span>.keyWindow.rootViewController</span><br></pre></td></tr></table></figure>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/8.png" alt="8"></p>
<ul>
<li>æ ¹æ®å†…å­˜åœ°å€è·å–å¯¹è±¡</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">#å†…å­˜åœ°å€</span><br></pre></td></tr></table></figure>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/9.png" alt="9"></p>
<ul>
<li>æŸ¥çœ‹å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜å˜é‡</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">*å¯¹è±¡</span><br><span class="line">æˆ–</span><br><span class="line">*#å¯¹è±¡çš„å†…å­˜åœ°å€</span><br></pre></td></tr></table></figure>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/10.png" alt="10"></p>
<ul>
<li>é€’å½’æ‰“å°viewçš„æ‰€æœ‰å­æ§ä»¶</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">UIApp</span>.keyWindow.recursiveDescription().toString()</span><br></pre></td></tr></table></figure>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/11.png" alt="11"></p>
<ul>
<li>ç­›é€‰ä¸­æŸç§ç±»å‹çš„å¯¹è±¡</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">choose(<span class="built_in">UIViewController</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/12.png" alt="12"></p>
<div class="note green no-icon flat"><p>è¿™é‡Œæ‰“å°çš„æ˜¯å½“å‰åœ¨å†…å­˜é‡Œé¢çš„VCï¼Œæ²¡æœ‰è¢«åˆ›å»ºçš„VCæ˜¯ä¸ä¼šè¢«æ‰“å°å‡ºæ¥çš„ã€‚</p>
</div>
<h3 id="å°è£…Cycriptæ–‡ä»¶">å°è£…Cycriptæ–‡ä»¶</h3>
<p>ä¸€èˆ¬æˆ‘ä»¬ä¼šæŠŠä¸€äº›å¸¸ç”¨çš„cycriptè¯­æ³•å°è£…åœ¨.cyæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨èµ·æ¥ä¼šæ–¹ä¾¿å¾ˆå¤šï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>å°è£…å¥½.cyæ–‡ä»¶</li>
<li>å¤åˆ¶.cyæ–‡ä»¶åˆ°iFunBoxçš„ç›®å½•<code>usr/lib/cycript0.9</code>é‡Œé¢</li>
<li>å…³æ‰å½“å‰è¿›ç¨‹ é‡æ–°è¿›å…¥ï¼šcycript -p è¿›ç¨‹åç§°</li>
<li>å¯¼å…¥è¯¥æ–‡ä»¶ï¼š@import cyæ–‡ä»¶</li>
</ul>
<h3 id="MJCycriptæ–‡ä»¶">MJCycriptæ–‡ä»¶</h3>
<p>å¤§ä½¬å·²ç»æŠŠä¸€äº›å¸¸ç”¨çš„ã€å®ç”¨çš„ç›¸å…³å‡½æ•°ç»™å°è£…å¥½äº†ï¼Œå¤§å®¶å¯ä»¥å»ä¸‹è½½<a href="https://github.com/CoderMJLee/mjcript">Github</a>ã€‚</p>
<p>æŒ‰ç…§æˆ‘ä»¬ä¸Šé¢è®²çš„æ–¹å¼å¯¼å…¥å°±å¯ä»¥ä½¿ç”¨ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/13.png" alt="13"></p>
<p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¾‹å­ï¼šå¦‚ä½•åˆ›å»ºä¸€ä¸ªViewå¹¶æŠŠå®ƒæ·»åŠ åˆ°APPä¸Šã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1210/14.png" alt="14"></p>
<h2 id="å†™åœ¨æœ€å-2">å†™åœ¨æœ€å</h2>
<p>å…³äºCycriptçš„ç®€å•ä»‹ç»æˆ‘ä»¬å°±åˆ†äº«åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>é€†å‘</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé€†å‘ã€‘ä¸€é”®è¶Šç‹±æ•™ç¨‹</title>
    <url>/posts/1bf7fb0b/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-9">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹å¦‚ä½•è¶Šç‹±ï¼Œåšä¸»è¿™é‡ŒæŒ‡çš„æ˜¯ä¸å®Œç¾è¶Šç‹±ï¼Œåšä¸»è¿™é‡Œè¶Šç‹±çš„æ‰‹æœºæ˜¯ï¼šiPhone5s  iOS12.5.6ã€‚</p>
<p>é¦–å…ˆï¼Œä½ éœ€è¦æœ‰ï¼šiPhoneæ‰‹æœºã€Macç”µè„‘ï¼Œä¿è¯Macå’Œæ‰‹æœºä¸Šéƒ½æœ‰<a href="https://www.i4.cn/">çˆ±æ€åŠ©æ‰‹</a>ã€‚</p>
<h2 id="è¶Šç‹±çš„ç®€å•ä»‹ç»">è¶Šç‹±çš„ç®€å•ä»‹ç»</h2>
<h3 id="ä»€ä¹ˆæ˜¯è¶Šç‹±ï¼Ÿ">ä»€ä¹ˆæ˜¯è¶Šç‹±ï¼Ÿ</h3>
<p>è¶Šç‹±ï¼šiOS jailbreakï¼Œåˆ©ç”¨iOSç³»ç»Ÿçš„æ¼æ´è·å–iOSç³»ç»Ÿçš„æœ€é«˜æƒé™ï¼Œè§£å¼€ä¹‹å‰çš„å„ç§é™åˆ¶ã€‚</p>
<div class="note red no-icon flat"><p><strong>è¶Šç‹±çš„ä¼˜ç‚¹</strong>ï¼š</p>
<p>1ã€å¯ä»¥æ‰“é€ ä¸ªæ€§åŒ–ã€ä¸ä¼—ä¸åŒçš„iPhone</p>
<p>2ã€å¯ä»¥ä¿®æ”¹APPçš„ä¸€äº›é»˜è®¤è¡Œä¸º</p>
<p>3ã€å¯ä»¥è‡ªç”±å®‰è£…éApp Storeæ¥æºçš„App</p>
<p>4ã€çµæ´»ç®¡ç†æ–‡ä»¶ç³»ç»Ÿï¼Œè®©iPhoneå¯ä»¥åƒUç›˜é‚£ä¹ˆçµæ´»</p>
<p>5ã€ç»™å¼€å‘è€…æä¾›äº†é€†å‘åŠŸèƒ½çš„ç¯å¢ƒ</p>
<p><strong>è¶Šç‹±çš„ç¼ºç‚¹</strong>ï¼š</p>
<p>1ã€è¶Šç‹±çš„æ‰‹æœºä¸äºˆä¿ä¿®</p>
<p>2ã€æ¯”è¾ƒè€—ç”µï¼Œè¶Šç‹±ä¹‹åçš„æ‰‹æœºä¼šå¸¸é©»ä¸€äº›è¿›ç¨‹ï¼Œè€—ç”µé€Ÿåº¦çº¦æå‡10%</p>
<p>3ã€ä¸å†å—iOSç³»ç»Ÿé»˜è®¤çš„å®‰å…¨ä¿æŠ¤ï¼Œå®¹æ˜“è¢«æ¶æ„è½¯ä»¶æ”»å‡»ï¼Œä¸ªäººéšç§æœ‰è¢«çªƒå–çš„é£é™©</p>
<p>4ã€å¦‚æœå®‰è£…äº†ä¸ç¨³å®šçš„æ’ä»¶ï¼Œå®¹æ˜“è®©ç³»ç»Ÿä¸ç¨³å®šã€å˜æ…¢æˆ–è€…å‡ºç°â€œç™½è‹¹æœâ€ç°è±¡</p>
</div>
<h3 id="å®Œç¾è¶Šç‹±å’Œä¸å®Œç¾è¶Šç‹±">å®Œç¾è¶Šç‹±å’Œä¸å®Œç¾è¶Šç‹±</h3>
<p>å®Œç¾è¶Šç‹±ï¼šæ‰‹æœºåœ¨è¶Šç‹±ä¹‹åå¯ä»¥æ­£å¸¸å…³æœºå’Œé‡å¯ã€‚</p>
<p>ä¸å®Œç¾è¶Šç‹±ï¼šæ‰‹æœºä¸èƒ½å…³æœºæˆ–é‡å¯ï¼Œå…³æœºä¹‹åå¯èƒ½ä¼šå‡ºç°è¶Šç‹±è½¯ä»¶<code>Cydia</code>ç­‰æ— æ³•æ‰“å¼€éœ€è¦é‡æ–°è¶Šç‹±ï¼Œä¸¥é‡ç”šè‡³å‡ºç°â€œç™½è‹¹æœâ€ç°è±¡ã€‚</p>
<h3 id="Cydia">Cydia</h3>
<p>Cydiaï¼šå¯ä»¥ç†è§£ä¸ºæ˜¯è¶Šç‹±ä¹‹åçš„&quot;App store&quot;ï¼Œå¯ä»¥åœ¨Cydiaé‡Œé¢å®‰è£…ä¸€äº›ç¬¬ä¸‰æ–¹è½¯ä»¶ã€è¡¥ä¸ã€æ’ä»¶ç­‰ã€‚</p>
<div class="note red no-icon flat"><p><strong>Cydiaå®‰è£…è½¯ä»¶çš„æ­¥éª¤</strong>ï¼š</p>
<p>1ã€æ·»åŠ è½¯ä»¶æºï¼ˆä¸åŒçš„è½¯ä»¶è½¯ä»¶æºå¯èƒ½ä¸ä¸€æ ·ï¼‰ï¼ˆCydia - è½¯ä»¶æº - ç¼–è¾‘ - æ·»åŠ  - è¾“å…¥è½¯ä»¶æºåœ°å€ï¼‰</p>
<p>2ã€è¿›å…¥è½¯ä»¶æº - æ‰¾åˆ°å¯¹åº”çš„è½¯ä»¶å¼€å§‹ä¸‹è½½</p>
</div>
<p>æœ‰çš„æ’ä»¶å®‰è£…å®Œæˆä¹‹åä¼šè¦æ±‚é‡å¯SpringBoardï¼ŒSpringBoardå¯ä»¥ç†è§£ä¸ºiOSçš„æ¡Œé¢ã€‚</p>
<h2 id="å¦‚ä½•è¶Šç‹±">å¦‚ä½•è¶Šç‹±</h2>
<p>ç”¨æ•°æ®çº¿è¿æ¥ä¸Šæ‰‹æœºå’Œç”µè„‘ï¼Œæ‰“å¼€ã€çˆ±æ€åŠ©æ‰‹ã€‘- å·¥å…·ç®± - ä¸€é”®è¶Šç‹±ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/1.png" alt="1"></p>
<p>ä¼šæ˜¾ç¤ºå½“å‰æ‰‹æœºç³»ç»Ÿã€å‹å·ã€æ˜¯å¦è¶Šç‹±ç­‰ä¿¡æ¯ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/2.png" alt="2"></p>
<p>åšä¸»è¿™é‡Œé€‰æ‹©Checkra1nè¿›è¡Œè¶Šç‹±ï¼Œå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/3.png" alt="3"></p>
<p>ç‚¹å‡»Startï¼ŒæŒ‰ç…§å¦‚ä¸‹æ“ä½œå¼€å§‹ä¸‹è½½è¶Šç‹±è½¯ä»¶CheckRa1nï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/4.png" alt="4"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/5.png" alt="5"></p>
<p>å®‰è£…å®ŒCheckra1nä¹‹åï¼Œæ‰‹æœºä¸Šä¼šæœ‰ä¸€ä¸ªcheckra1nçš„è½¯ä»¶ï¼Œæ‰“å¼€å®ƒå¼€å§‹å®‰è£…Cydiaè½¯ä»¶ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/6.png" alt="6"></p>
<p>å®‰è£…å®ŒCydiaä¹‹åï¼Œæ‰‹æœºæ¡Œé¢ä¼šå¤šä¸€ä¸ªè½¯ä»¶å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/7.png" alt="7"></p>
<p>æ­¤æ—¶è¿æ¥çˆ±æ€åŠ©æ‰‹ï¼Œä¼šå‘ç°é¡¶éƒ¨å…³äºæ‰‹æœºçš„ä¿¡æ¯ä¼šå‘ç”Ÿå˜åŒ–ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/8.png" alt="8"></p>
<p>ä¼šçœ‹åˆ°ä¸Šé¢æç¤ºæˆ‘ä»¬å»å®‰è£…AFC2å’ŒAppSyncä¸¤ä¸ªæ’ä»¶ï¼Œè¿™ä¸¤ä¸ªæ’ä»¶å…·ä½“æœ‰ä½•ç”¨å¤„å¦‚ä¸‹ï¼š</p>
<div class="note red no-icon flat"><p>AFC2ï¼šå¯ä»¥ä¿è¯èƒ½å¤Ÿè®¿é—®æ•´ä¸ªiOSçš„æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>AppSyncï¼šä¿è¯ç»•è¿‡éªŒè¯éšæ„å®‰è£…ã€è¿è¡Œç ´è§£çš„ipaåŒ…ã€‚</p>
</div>
<p>ç‚¹å‡»å®‰è£…AFC2ä¼šæç¤ºæˆ‘ä»¬å¦‚ä½•å®‰è£…ï¼Œå¤§å®¶æŒ‰ç…§è‡ªå·±æ‰‹æœºçš„ç³»ç»Ÿæ¥å®‰è£…ï¼ŒCydia - æœç´¢Apple Fileâ€¦ - å®‰è£…ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/9.png" alt="9"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/10.png" alt="10"></p>
<p>å®‰è£…å®Œæˆä¹‹åï¼Œç‚¹å‡»é‡å¯SpringBoardå³å¯ã€‚</p>
<p>æ­¤æ—¶è¿æ¥Macå’Œæ‰‹æœºï¼Œçˆ±æ€åŠ©æ‰‹é¡¶éƒ¨ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/11.png" alt="11"></p>
<p>è¿™æ—¶æˆ‘ä»¬å¦‚æœç›´æ¥ç‚¹å‡»ã€å®‰è£…AppSyncã€‘å¯èƒ½ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/12.png" alt="12"></p>
<p>ä¸ç”¨ç†ä¼šï¼Œç›´æ¥åœ¨Cydia - æ·»åŠ è½¯ä»¶æºï¼š<a href="http://cydia.angelxwind.net">cydia.angelxwind.net</a>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/13.png" alt="13"></p>
<p>é€‰æ‹©æˆ‘ä»¬åˆšæ·»åŠ çš„æº - æ’ä»¶ - æœç´¢AppSync - å®‰è£…ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/14.png" alt="14"></p>
<p>å®‰è£…å®Œæˆä¹‹ååŒæ ·éœ€è¦é‡å¯SpringBoardï¼Œåœ¨Cydia - å·²å®‰è£… é‡Œé¢å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšå®‰è£…çš„ä¸¤ä¸ªæ’ä»¶ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/15.png" alt="15"></p>
<p>ä¸¤ä¸ªéƒ½å®‰è£…æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°çˆ±æ€åŠ©æ‰‹é¡¶éƒ¨ä¿¡æ¯å‘ç”Ÿå˜åŒ–ï¼Œå‘Šè¯‰æˆ‘ä»¬è¯¥è®¾å¤‡å·²è¶Šç‹±ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1129/16.png" alt="16"></p>
<h2 id="å†™åœ¨æœ€å-3">å†™åœ¨æœ€å</h2>
<p>å…³äºå¦‚ä½•ç®€å•ä¸€é”®è¶Šç‹±çš„æ“ä½œï¼Œåšä¸»å°±ä»‹ç»åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>é€†å‘</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>é€†å‘</tag>
        <tag>iPhone</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé€†å‘ã€‘å¦‚ä½•è®©Macå’ŒiPhoneå»ºç«‹å®‰å…¨è¿æ¥</title>
    <url>/posts/7df93f3b/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-10">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹åœ¨iOSé€†å‘è¿‡ç¨‹ä¸­ï¼ŒMacæ˜¯å¦‚ä½•å’ŒiPhoneå»ºç«‹å®‰å…¨è¿æ¥æ¥å®ç°åœ¨Macä¸Šå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ“ä½œiPhoneçš„ã€‚</p>
<h2 id="SSH-å’Œ-OpenSSH">SSH å’Œ OpenSSH</h2>
<p>SSHï¼šSecure Shellçš„ç¼©å†™ï¼Œæ„æ€ä¸ºâ€œå®‰å…¨å¤–å£³åè®®â€ï¼Œæ˜¯ä¸€ç§å¯ä»¥ä¸ºã€è¿œç¨‹ç™»å½•ã€‘æä¾›å®‰å…¨ä¿éšœçš„åè®®ï¼Œä½¿ç”¨SSHå¯ä»¥æŠŠæ‰€æœ‰çš„æ•°æ®åŠ å¯†ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ç­‰æ¬ºéª—ã€‚</p>
<p>OpenSSHï¼šæ˜¯SSHçš„å…è´¹å¼€æºå®ç°ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1201/1.png" alt="1"></p>
<div class="note pink no-icon flat"><p><strong>æ‹“å±•</strong>ï¼š</p>
<p>SSLï¼šSecure Socket Layerçš„ç¼©å†™ï¼Œæ˜¯ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§çš„ä¸€ç§å®‰å…¨åè®®ï¼Œåœ¨ä¼ è¾“å±‚å¯¹ç½‘ç»œè¿æ¥è¿›è¡ŒåŠ å¯†ã€‚</p>
<p>OpenSSLï¼šSSLçš„å¼€æºå®ç°ã€‚</p>
<p>ç»å¤§éƒ¨åˆ†çš„httpsè¯·æ±‚ç­‰ä»·äºhttp + OpenSSLã€‚</p>
<p>OpenSSHæ˜¯ç”¨æ¥ä¿è¯ç™»å½•å®‰å…¨æ€§çš„ï¼Œè€Œè¿™ä¸ªå®‰å…¨ç”±OpenSSLæ¥å…·ä½“å®ç°ã€‚</p>
</div>
<h2 id="Macå¦‚ä½•è¿œç¨‹ç™»å½•åˆ°iPhone">Macå¦‚ä½•è¿œç¨‹ç™»å½•åˆ°iPhone</h2>
<h3 id="æ–¹å¼ä¸€ï¼šé€šè¿‡ç½‘ç»œè¿æ¥">æ–¹å¼ä¸€ï¼šé€šè¿‡ç½‘ç»œè¿æ¥</h3>
<p>iOSä¸‹æœ‰ä¸¤ä¸ªå¸¸ç”¨çš„è´¦æˆ·ï¼šrootã€mobileã€‚</p>
<p>rootè´¦æˆ·æ‹¥æœ‰æœ€é«˜æƒé™ï¼Œmobileæ˜¯æ™®é€šæƒé™è´¦æˆ·ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹å¦‚ä½•åœ¨Macä¸Šè¿œç¨‹ç™»å½•iPhoneï¼š</p>
<div class="note green no-icon flat"><p>1.é¦–å…ˆåœ¨Cydiaä¸­ä¸‹è½½æ’ä»¶<code>OpenSSH</code></p>
<p>2.ä¿è¯Macå’ŒiPhoneåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ä¸‹ï¼ˆè¿æ¥åŒä¸€ä¸ªWifiï¼‰</p>
<p>3.ä½¿ç”¨å‘½ä»¤<code>ssh è´¦æˆ·å@æœåŠ¡ä¸»æœºåœ°å€</code>ç™»å½•åˆ°iPhoneï¼Œè¿™é‡Œè´¦æˆ·åï¼šrootï¼ŒæœåŠ¡ä¸»æœºåœ°å€ï¼šè¿æ¥çš„Wifiè®¾ç½®é‡Œé¢æŸ¥çœ‹</p>
<p><strong>æ³¨æ„</strong>ï¼šé¦–æ¬¡ç™»å½•çš„åˆå§‹åŒ–å¯†ç ä¸ºï¼šalpine</p>
</div>
<p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1201/2.png" alt="2"></p>
<p>æ­¤æ—¶æˆ‘ä»¬é€šè¿‡å‘½ä»¤è¡Œåœ¨iPhoneä¸‹åˆ›å»ºä¸€ä¸ª<code>test.txt</code>çš„æ–‡æœ¬ï¼Œæ­¤æ—¶é€šè¿‡<code>iFunBox</code>æŸ¥çœ‹ï¼Œä¼šå‘ç°rootè´¦æˆ·ä¸‹å¤šäº†ä¸€ä¸ªåˆšåˆ›å»ºçš„æ–‡æœ¬ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1201/3.png" alt="3"></p>
<p>åˆ°è¿™é‡Œï¼Œè¯´æ˜æˆ‘ä»¬å·²ç»æˆåŠŸå»ºç«‹Macå’ŒiPhoneçš„è¿æ¥ã€‚</p>
<div class="note red no-icon flat"><p><strong>æç¤º</strong>ï¼š</p>
<p>å¦‚æœåœ¨ç™»å½•çš„è¿‡ç¨‹ä¸­å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š<code>ssh: connect to host xxx port 22: Operation timed out</code>ï¼Œå¯ä»¥<code>ping ä¸»æœºåœ°å€</code>çœ‹çœ‹ç½‘ç»œæ˜¯å¦è¿æ¥ä¸Šã€‚</p>
</div>
<h3 id="æ–¹å¼äºŒï¼šé€šè¿‡USBè¿æ¥">æ–¹å¼äºŒï¼šé€šè¿‡USBè¿æ¥</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSSHèµ°çš„åè®®æ˜¯TCPåè®®ï¼ŒMacæ˜¯é€šè¿‡ç½‘ç»œè¿æ¥çš„æ–¹å¼ç™»å½•åˆ°iPhoneï¼Œæ‰€ä»¥å¦‚æœç½‘ç»œç¯å¢ƒä¸å¥½å¯èƒ½ä¼šé€ æˆä¼ è¾“é€Ÿåº¦æ¯”è¾ƒæ…¢çš„æƒ…å†µã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1201/4.png" alt="4"></p>
<p>ä¸ºäº†åŠ å¿«ä¼ è¾“çš„é€Ÿåº¦å¯ä»¥ä½¿ç”¨USBçš„æ–¹å¼è¿›è¡Œç™»å½•ï¼ŒMacä¸Šæœ‰ä¸ªæœåŠ¡ç¨‹åº<code>usbmuxd</code>ï¼Œ<code>usbmuxd</code>æ˜¯å¼€æœºå¯åŠ¨çš„ï¼Œå®ƒå¯ä»¥å°†Macçš„æ•°æ®é€šè¿‡USBä¼ è¾“åˆ°iPhoneä¸Šã€‚</p>
<p>ä½¿ç”¨USBçš„æ–¹å¼è¿æ¥çš„å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<div class="note pink no-icon flat"><ol>
<li>
<p>ä¸‹è½½<code>usbmuxd</code>å·¥å…·åŒ…</p>
</li>
<li>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°†iPhoneçš„22ç«¯å£ï¼ˆSSHç«¯å£ï¼‰æ˜ å°„åˆ°æœ¬åœ°çš„xxxxxç«¯å£ï¼ˆè¿™ä¸ªç«¯å£æ˜¯ä»»æ„çš„ï¼Œåªè¦ä¸æ˜¯ä¿ç•™ç«¯å£å°±å¯ä»¥ï¼‰</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">cd usbmuxd<span class="number">-1.0</span><span class="number">.8</span>/python-client <span class="comment">// ä¸‹è½½usbmuxdå·¥å…·ç›®å½•ä¸‹</span></span><br><span class="line">python tcprelay.py -t <span class="number">22</span>:<span class="number">10010</span> <span class="comment">// 10010åªè¦ä¸æ˜¯ä¿ç•™ç«¯å£å°±è¡Œ -tæ˜¯ä¸ºäº†èƒ½å¤Ÿæ”¯æŒå¤šä¸ªSSHè¿æ¥</span></span><br></pre></td></tr></table></figure>
<p>ç«¯å£æ˜ å°„å®Œæ¯•åï¼Œä»¥åè¦æƒ³è·ŸiPhoneçš„22ç«¯å£é€šä¿¡åªéœ€è¦è·ŸMacæœ¬åœ°çš„10010ç«¯å£é€šä¿¡å³å¯ï¼Œ<code>usbmuxd</code>ä¼šå°†Macæœ¬åœ°10010ç«¯å£çš„TCPåè®®æ•°æ®é€šè¿‡USBçš„æ–¹å¼ä¼ åˆ°iPhoneçš„22ç«¯å£ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ–°å¼€ä¸€ä¸ªç»ˆç«¯çª—å£ï¼ŒSSHç™»å½•åˆ°Macæœ¬åœ°çš„10010ç«¯å£</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">ssh root@localhost -p <span class="number">10010</span></span><br><span class="line">æˆ–</span><br><span class="line">ssh root@MacIPåœ°å€ -p <span class="number">10010</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</div>
<p>åšä¸»è¿™é‡Œçš„æ“ä½œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1201/5.png" alt="5"></p>
<p>æ­¤æ—¶ï¼Œæ˜ å°„å…³ç³»å·²ç»å»ºç«‹å®Œæ¯•ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1201/6.png" alt="6"></p>
<p>ç™»å½•åˆ°Macæœ¬åœ°çš„10010ç«¯å£ï¼Œæ­¤æ—¶è¿æ¥å·²ç»å®Œæˆï¼Œåˆ›å»º<code>touch usbLoginTest.txt</code>çš„ä¸€ä¸ªæ–‡æœ¬æµ‹è¯•ä¸€ä¸‹ï¼Œä¼šå‘ç°iPhoneä¸Šå¤šäº†æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„æ–‡æœ¬ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1201/7.png" alt="7"></p>
<p>USBç™»å½•çš„æ•´ä¸ªæµç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1201/8.png" alt="8"></p>
<h2 id="å†™åœ¨æœ€å-4">å†™åœ¨æœ€å</h2>
<p>å…³äºã€å¦‚ä½•è®©Macå’ŒiPhoneå»ºç«‹å®‰å…¨è¿æ¥çš„ä¸¤ç§æ–¹å¼ã€‘çš„æ–‡ç« å°±å†™åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>é€†å‘</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>é€†å‘</tag>
        <tag>iPhone</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé€†å‘ã€‘æœ€å…¨çš„SSHé€šä¿¡è¿‡ç¨‹</title>
    <url>/posts/beccfc53/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-11">å†™åœ¨å‰é¢</h2>
<p>åœ¨<a href="https://codersunny.com/posts/7df93f3b/">ã€iOSé€†å‘ã€‘å¦‚ä½•è®©Macå’ŒiPhoneå»ºç«‹å®‰å…¨è¿æ¥</a>æ–‡ç« ä¸­æˆ‘ä»¬ä¸»è¦è®²äº†Macå’ŒiPhoneå¦‚ä½•å»ºç«‹å®‰å…¨è¿æ¥ï¼Œè®©æˆ‘ä»¬åœ¨Macä¸Šå¯ä»¥é€šè¿‡å‘½ä»¤æ¥æ§åˆ¶iPhoneï¼Œä½†æ˜¯å…¶å®æˆ‘ä»¬ä½¿ç”¨ç›¸å…³ç™»å½•å‘½ä»¤åˆ°ç™»å½•åˆ°iPhoneä¸­é—´æ˜¯æœ‰ä¸€ä¸ªè¿‡ç¨‹çš„ï¼Œæˆ‘ä»¬æœ¬ç¯‡æ–‡ç« å°±æ˜¯æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬ï¼š</p>
<ul>
<li>å»ºç«‹å®‰å…¨è¿æ¥</li>
<li>å®¢æˆ·ç«¯è®¤è¯</li>
</ul>
<h2 id="å»ºç«‹å®‰å…¨è¿æ¥">å»ºç«‹å®‰å…¨è¿æ¥</h2>
<p>åœ¨å»ºç«‹å®‰å…¨è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨ä¼šæä¾›è‡ªå·±çš„èº«ä»½è¯æ˜ï¼šå…¬é’¥ä¿¡æ¯ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1209/1.png" alt="1"></p>
<p>å¦‚æœå®¢æˆ·ç«¯å¹¶æ²¡æœ‰ä¿å­˜è¿‡æœåŠ¡å™¨çš„å…¬é’¥ä¿¡æ¯ï¼Œä¼šå‡ºç°å¦‚ä¸‹æç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1209/2.png" alt="2"></p>
<p>è¿™å…¶å®æ˜¯åœ¨é—®æˆ‘ä»¬æ˜¯å¦éœ€è¦ä¿å­˜è¿™ä¸ªå…¬é’¥ä¿¡æ¯ï¼Œæˆ‘ä»¬é€‰æ‹©ã€yesã€‘ä¹‹åä¿å­˜ï¼Œåœ¨å®¢æˆ·ç«¯çš„sshæ–‡ä»¶ä¸­æŸ¥çœ‹ç›¸åº”çš„å†…å®¹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1209/3.png" alt="3"></p>
<p>å¦‚æœæ˜¯é¦–æ¬¡è¿›è¡Œè¯¥æ“ä½œï¼Œä¼šæç¤ºæˆ‘ä»¬è¾“å…¥å¯†ç è¿›è¡Œç™»å½•ã€‚</p>
<h2 id="å®¢æˆ·ç«¯è®¤è¯">å®¢æˆ·ç«¯è®¤è¯</h2>
<p>SSHæä¾›äº†ä¸¤ç§è®¤è¯çš„æ–¹å¼ï¼š</p>
<p>1ã€å¯†ç ç™»å½•çš„è®¤è¯æ–¹å¼</p>
<p>2ã€åŸºäºã€å¯†é’¥ã€‘çš„è®¤è¯æ–¹å¼</p>
<div class="note pink no-icon flat"><p>SSHä¼šä¼˜å…ˆä½¿ç”¨å¯†é’¥çš„è®¤è¯æ–¹å¼ï¼Œå¦‚æœè®¤è¯å¤±è´¥æ‰ä¼šé‡‡ç”¨å¯†ç ç™»å½•çš„æ–¹å¼è¿›è¡Œè®¤è¯ã€‚</p>
</div>
<p>æˆ‘ä»¬è¿™é‡Œé‡ç‚¹æ¥è¯´ä¸€ä¸‹åŸºäºå¯†é’¥çš„è®¤è¯æ–¹å¼æ˜¯æ€ä¹ˆæ ·çš„ã€‚</p>
<h3 id="å®¢æˆ·ç«¯ç”Ÿæˆå…¬é’¥å’Œç§é’¥ä¿¡æ¯">å®¢æˆ·ç«¯ç”Ÿæˆå…¬é’¥å’Œç§é’¥ä¿¡æ¯</h3>
<p>1ã€é€šè¿‡ä¸‹é¢çš„æ–¹å¼æŸ¥çœ‹å®¢æˆ·ç«¯æ˜¯å¦ç”Ÿæˆè¿‡å…¬é’¥å’Œå¯†é’¥ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1209/4.png" alt="4"></p>
<p>å¦‚æœæ²¡æœ‰ç”Ÿæˆï¼Œé€šè¿‡å‘½ä»¤<code>ssh-keygen</code>æ¥ç”Ÿæˆå…¬é’¥å’Œç§é’¥ä¿¡æ¯ï¼Œå¦‚æœå·²ç»ç”Ÿæˆï¼Œç›´æ¥åˆ°ç¬¬äºŒæ­¥ã€‚</p>
<p>2ã€ä½¿ç”¨å‘½ä»¤<code>ssh-copy-id root@æœåŠ¡å™¨ipåœ°å€</code>å°†å…¬é’¥ä¿¡æ¯è¿½åŠ åˆ°æˆæƒæ–‡ä»¶å°¾éƒ¨ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1209/5.png" alt="5"></p>
<p>æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å­˜å‚¨çš„ä¿¡æ¯æ˜¯å¦ä¸€è‡´ï¼Ÿ</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1209/6.png" alt="6"></p>
<p>å®Œæˆä¸Šè¿°æ“ä½œåï¼Œä¸‹æ¬¡ç™»å½•åˆ°iPhoneå°±ä¸å†éœ€è¦å¯†ç äº†ã€‚</p>
<div class="note orange no-icon flat"><p>å¦‚æœæŒ‰ç…§ä¸Šé¢æ–¹å¼é…ç½®äº†è¿˜æ˜¯éœ€è¦å¯†ç ç™»å½•ï¼Œéœ€è¦ä½¿ç”¨ä¸‹é¢æ“ä½œä¿®æ”¹ä¸€ä¸‹æƒé™ï¼ˆåœ¨iPhoneçš„rootè´¦æˆ·ä¸‹ï¼‰ï¼š</p>
<p><code>chmod 755 ~</code></p>
<p><code>chmod 755 ~/.ssh</code></p>
<p><code>chmod 644 ~/.ssh/authorized_keys</code></p>
</div>
<h2 id="åˆ é™¤å®¢æˆ·ç«¯ä¿å­˜çš„æœåŠ¡å™¨çš„å…¬é’¥ä¿¡æ¯">åˆ é™¤å®¢æˆ·ç«¯ä¿å­˜çš„æœåŠ¡å™¨çš„å…¬é’¥ä¿¡æ¯</h2>
<p>æœ‰æ—¶å€™æä¾›æœåŠ¡å™¨çš„èº«ä»½ä¿¡æ¯ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åˆ æ‰å®¢æˆ·ç«¯ä¿å­˜çš„å…¬é’¥ä¿¡æ¯ï¼š</p>
<p>ç¬¬ä¸€ç§æ–¹å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~./ssh</span><br><span class="line"><span class="built_in">ls</span> -l</span><br><span class="line">vim known_hosts(æ‰¾åˆ°å¯¹åº”çš„ä¿¡æ¯è¿›è¡Œåˆ é™¤)</span><br><span class="line">:wq</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§æ–¹å¼ï¼š<code>ssh-keygen -R æœåŠ¡å™¨ipåœ°å€</code></p>
<h2 id="å†™åœ¨æœ€å-5">å†™åœ¨æœ€å</h2>
<p>å…³äºSSHå¦‚ä½•å»ºç«‹å®‰å…¨è¿æ¥å’Œå®¢æˆ·ç«¯è®¤è¯çš„æ–‡ç« å°±å†™åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>é€†å‘</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘Blockåº•å±‚åŸç†ï¼ˆäºŒï¼‰</title>
    <url>/posts/57c4c4a9/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-12">å†™åœ¨å‰é¢</h2>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://codersunny.com/posts/67d22871/">ã€iOSé‡å­¦ã€‘Blockåº•å±‚åŸç†ï¼ˆä¸€ï¼‰</a>ä¸­æˆ‘ä»¬ä¸»è¦è®²äº†Blockçš„åŸºæœ¬ä½¿ç”¨ã€åº•å±‚åŸç†ã€å¯¹å˜é‡çš„æ•è·æœºåˆ¶ä»¥åŠBlockçš„å‡ ç§ç±»å‹ï¼Œæœ¬æ–‡æ˜¯ç¬¬äºŒç¯‡ï¼Œä¸»è¦å†…å®¹åŒ…å«ï¼š</p>
<ul>
<li><code>__block</code>ä¿®é¥°ç¬¦çš„åŸºæœ¬ä½¿ç”¨</li>
<li><code>__block</code>ä¿®é¥°çš„å˜é‡åœ¨Blockå†…éƒ¨çš„åº•å±‚ç»“æ„</li>
<li><code>__block</code>çš„å†…å­˜ç®¡ç†</li>
<li>å¾ªç¯å¼•ç”¨</li>
</ul>
<h2 id="Blockçš„åŸºæœ¬ä½¿ç”¨">__Blockçš„åŸºæœ¬ä½¿ç”¨</h2>
<p>å¦‚æœæƒ³åœ¨Blockå†…éƒ¨ä¿®æ”¹autoå˜é‡çš„å€¼ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯æ— æ³•ç›´æ¥ä¿®æ”¹çš„ï¼Œä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1208/1.png" alt="1"></p>
<p><code>__block</code>ä¿®é¥°ç¬¦å°±æ˜¯ç”¨æ¥è§£å†³Blockå†…éƒ¨æ— æ³•ä¿®æ”¹autoå˜é‡å€¼çš„é—®é¢˜ã€‚</p>
<div class="note green no-icon flat"><p><code>__block</code>ä¸èƒ½ç”¨æ¥ä¿®é¥°å…¨å±€å˜é‡ã€staticå˜é‡ã€‚</p>
</div>
<h2 id="blockä¿®é¥°çš„å˜é‡åº•å±‚ç»“æ„æ¢ç©¶">__blockä¿®é¥°çš„å˜é‡åº•å±‚ç»“æ„æ¢ç©¶</h2>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">__block <span class="type">int</span> age = <span class="number">10</span>;</span><br><span class="line"><span class="type">void</span>(^Block)(<span class="type">void</span>) = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;age is %d&quot;</span>,age);</span><br><span class="line">&#125;;</span><br><span class="line">Block();</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼Œä½¿ç”¨<code>__block</code>ä¿®é¥°çš„å˜é‡åœ¨Blockå†…éƒ¨ä¹‹åçš„åº•å±‚ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿè·Ÿä¹‹å‰å¯¹æ¯”æœ‰ä»€ä¹ˆä¸ä¸€æ ·ã€‚</p>
<p>ä¸ä½¿ç”¨<code>__block</code>ä¿®é¥°ç¬¦ï¼ŒBlockåº•å±‚ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1208/2.png" alt="2"></p>
<p>ä½¿ç”¨<code>__block</code>ä¿®é¥°ç¬¦ï¼ŒBlockåº•å±‚ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1208/3.png" alt="3"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1208/4.png" alt="4"></p>
<p>æˆ‘ä»¬å‘ç°åº•å±‚ç»“æ„ç¡®å®å‘ç”Ÿäº†å˜åŒ–ï¼šè¢«<code>__block</code>ä¿®é¥°çš„å˜é‡ä¼šè¢«åŒ…è£…æˆä¸€ä¸ª<code>__Block_byref_age_0</code>çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„ç»“æ„é‡Œé¢æœ‰ä¸ª<code>int age</code>ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">__Block_byref_age_0</span> &#123;</span><br><span class="line">  <span class="type">void</span> *__isa;</span><br><span class="line">  __Block_byref_age_0 *__forwarding; <span class="comment">// æ˜¯æŒ‡å‘è‡ªå·±çš„ä¸€ä¸ªæŒ‡é’ˆ</span></span><br><span class="line">  <span class="type">int</span> __flags;</span><br><span class="line">  <span class="type">int</span> __size;</span><br><span class="line">  <span class="type">int</span> age;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<div class="note orange no-icon flat"><p><strong>é—®é¢˜</strong>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSMutableArray</span> *tempArr = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line"><span class="type">void</span>(^Block)(<span class="type">void</span>) =  ^()&#123;</span><br><span class="line">  [tempArr addObject:<span class="string">@&quot;1&quot;</span>];</span><br><span class="line">&#125;;</span><br><span class="line">Block();</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä»£ç ç»“æœæ˜¯å¦ä¼šæŠ¥é”™ï¼Ÿ</p>
<p>ä¸ä¼šï¼Œ<code>[tempArr addObject:@&quot;1&quot;]</code>åªæ˜¯åœ¨ä½¿ç”¨<code>tempArr</code>æŒ‡é’ˆå¹¶æ²¡æœ‰ä¿®æ”¹<code>tempArr</code>ã€‚</p>
</div>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">__block <span class="type">int</span> age = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;1---%p&quot;</span>,&amp;age);</span><br><span class="line"><span class="type">void</span>(^Block)(<span class="type">void</span>) = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;age is %d&quot;</span>,age);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;2---%p&quot;</span>,&amp;age);</span><br><span class="line">&#125;;</span><br><span class="line">Block();</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;3---%p&quot;</span>,&amp;age);</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ‰“å°<code>age</code>çš„åœ°å€çœ‹ä¸€ä¸‹:</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-08</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">52.006645</span>+<span class="number">0800</span> BlockDemo[<span class="number">8781</span>:<span class="number">6613854</span>] <span class="number">1</span>--<span class="number">-0x7ff7bfeff2d8</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-08</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">52.007272</span>+<span class="number">0800</span> BlockDemo[<span class="number">8781</span>:<span class="number">6613854</span>] age is <span class="number">10</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-08</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">52.007357</span>+<span class="number">0800</span> BlockDemo[<span class="number">8781</span>:<span class="number">6613854</span>] <span class="number">2</span>--<span class="number">-0x100b478a8</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-08</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">52.007395</span>+<span class="number">0800</span> BlockDemo[<span class="number">8781</span>:<span class="number">6613854</span>] <span class="number">3</span>--<span class="number">-0x100b478a8</span></span><br></pre></td></tr></table></figure>
<p>ä»æ‰“å°ç»“æœæˆ‘ä»¬çœ‹åˆ°1å’Œ2ã€3çš„ageçš„åœ°å€å€¼ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸Šé¢çš„åº•å±‚ç»“æ„æ¢ç´¢æ¥è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆï¼Ÿ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">__Block_byref_age_0</span> &#123;</span><br><span class="line"> <span class="type">void</span> *__isa;</span><br><span class="line"> <span class="keyword">struct</span> <span class="title class_">__Block_byref_age_0</span> *__forwarding;</span><br><span class="line"> <span class="type">int</span> __flags;</span><br><span class="line"> <span class="type">int</span> __size;</span><br><span class="line"> <span class="type">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__block_impl</span> &#123;</span><br><span class="line">  <span class="type">void</span> *isa;</span><br><span class="line">  <span class="type">int</span> Flags;</span><br><span class="line">  <span class="type">int</span> Reserved;</span><br><span class="line">  <span class="type">void</span> *FuncPtr;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__main_block_desc_0</span> &#123;</span><br><span class="line">  <span class="type">size_t</span> reserved;</span><br><span class="line">  <span class="type">size_t</span> Block_size;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__main_block_impl_0</span> &#123;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">__block_impl</span> impl;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">__main_block_desc_0</span>* Desc;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">__Block_byref_age_0</span> *age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">__block <span class="type">int</span> age = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">NSLog</span>(@<span class="string">&quot;1---%p&quot;</span>,&amp;age);</span><br><span class="line"><span class="built_in">void</span>(^Block)(<span class="type">void</span>) = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(@<span class="string">&quot;age is %d&quot;</span>,age);</span><br><span class="line">    <span class="built_in">NSLog</span>(@<span class="string">&quot;2---%p&quot;</span>,&amp;age);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__main_block_impl_0</span> *implBlock = (__bridge <span class="keyword">struct</span> __main_block_impl_0  *)Block;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æŠŠBlockè½¬ä¸º<code>__main_block_impl_0</code>çš„ç»“æ„ä½“æ¥åˆ†æä¸€ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1208/5.png" alt="5"></p>
<p>Blockå†…éƒ¨çš„<code>__Block_byref_age_0</code>ç»“æ„ä½“åœ°å€å€¼æ˜¯ï¼š<code>0x100e1c7e0</code>ï¼Œè€Œæˆ‘ä»¬æ‰“å°ageçš„åœ°å€å€¼æ˜¯ï¼š<code>0x100e1c7f8</code>ï¼Œä¸¤ä¸ªä¸ä¸€æ ·ï¼Œè¯´æ˜æ‰“å°çš„ageçš„åœ°å€å€¼ä¸æ˜¯<code>__Block_byref_age_0</code>ç»“æ„ä½“ageçš„å€¼ï¼Œæ¥ç€å¾€ä¸‹åˆ†æï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ°å€å€¼ï¼š0x100e1c7e0</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__Block_byref_age_0</span> &#123;</span><br><span class="line"> <span class="type">void</span> *__isa; <span class="comment">// 8byte __isaåœ°å€å€¼ï¼š0x100e1c7e0</span></span><br><span class="line"> <span class="keyword">struct</span> <span class="title class_">__Block_byref_age_0</span> *__forwarding; <span class="comment">// 8byte __forwardingåœ°å€å€¼ï¼š0x100e1c7e8</span></span><br><span class="line"> <span class="type">int</span> __flags;<span class="comment">// 4byte __flagsåœ°å€å€¼ï¼š0x100e1c7d2</span></span><br><span class="line"> <span class="type">int</span> __size; <span class="comment">// 4byte __sizeåœ°å€å€¼ï¼š0x100e1c7d6</span></span><br><span class="line"> <span class="type">int</span> age;<span class="comment">// 4byte ageåœ°å€å€¼ï¼š0x100e1c7d8</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬çœ‹åˆ°ï¼šæˆ‘ä»¬æ‰“å°çš„ageçš„åœ°å€å€¼å…¶å®æ˜¯<code>__Block_byref_age_0</code>ç»“æ„ä½“ä¸­ageçš„åœ°å€å€¼ã€‚</p>
<h2 id="blockçš„å†…å­˜ç®¡ç†">__blockçš„å†…å­˜ç®¡ç†</h2>
<p>åœ¨ä¸Šé¢æˆ‘ä»¬åˆ†æçš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ç”¨<code>__block</code>æ¥ä¿®é¥°ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹æ›´å¤æ‚çš„æƒ…å†µï¼š<code>__block</code>ç”¨æ¥ä¿®é¥°å¯¹è±¡ç±»å‹ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">__block <span class="built_in">NSObject</span> *object = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line"><span class="type">void</span>(^Block)(<span class="type">void</span>) = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;object is %@&quot;</span>,object);</span><br><span class="line">&#125;;</span><br><span class="line">Block();</span><br></pre></td></tr></table></figure>
<p>åº•å±‚ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1208/6.png" alt="6"></p>
<p>è¿™é‡Œæœ‰ä¸¤ç‚¹å€¼å¾—æˆ‘ä»¬æ³¨æ„ä¸€ä¸‹ï¼š</p>
<p>1çš„ä½ç½®å¤šäº†ä¸¤ä¸ªå‡½æ•°<code>copy</code>å’Œ<code>dispose</code>ï¼Œè¿™ç‚¹æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« è®²åˆ°è¿‡å› ä¸ºBlockæ•è·çš„å˜é‡æ˜¯å¯¹è±¡ç±»å‹ï¼Œæ‰€ä»¥ä¼šæœ‰è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸èµ˜è¿°äº†ï¼Œé™¤æ­¤ä¹‹å¤–æˆ‘ä»¬å‘ç°<code>__Block_byref_object_0</code>è¿™ä¸ªç»“æ„ä½“é‡Œé¢ä¹Ÿå¤šäº†ä¸¤ä¸ªå‡½æ•°ï¼š<code>__Block_byref_id_object_copy</code>å’Œ<code>__Block_byref_id_object_dispose</code>ï¼Œé‡Œé¢å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> __Block_byref_id_object_copy_131(<span class="type">void</span> *dst, <span class="type">void</span> *src) &#123;</span><br><span class="line"> _Block_object_assign((<span class="type">char</span>*)dst + <span class="number">40</span>, *(<span class="type">void</span> * *) ((<span class="type">char</span>*)src + <span class="number">40</span>), <span class="number">131</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __Block_byref_id_object_dispose_131(<span class="type">void</span> *src) &#123;</span><br><span class="line"> _Block_object_dispose(*(<span class="type">void</span> * *) ((<span class="type">char</span>*)src + <span class="number">40</span>), <span class="number">131</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†…éƒ¨ä¹Ÿæ˜¯è°ƒç”¨çš„<code>_Block_object_assign</code>å’Œ<code>_Block_object_dispose</code>ï¼Œå’Œæˆ‘ä»¬ä¹‹å‰è®²çš„æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>å¹¶ä¸”æˆ‘ä»¬çœ‹åˆ°<code>__Block_byref_object_0</code>ç»“æ„ä½“é‡Œé¢ä¼šå¯¹<code>object</code>è¿™ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ï¼š</p>
<p>1ã€å½“Blockåœ¨æ ˆä¸Šæ—¶ï¼Œå¹¶ä¸ä¼šå¯¹<code>__block</code>ä¿®é¥°çš„å˜é‡äº§ç”Ÿå¼ºå¼•ç”¨ã€‚</p>
<p>2ã€å½“Blockè¢«copyåˆ°å †ä¸Šæ—¶ï¼Œä¼šè°ƒç”¨Blockå†…éƒ¨çš„<code>copy</code>å‡½æ•°ï¼Œ<code>copy</code>å‡½æ•°å†…éƒ¨ä¼šè°ƒç”¨<code>__Block_object_assign</code>å‡½æ•°ï¼Œ<code>__Block_object_assign</code>å‡½æ•°ä¼šå¯¹<code>__block</code>ä¿®é¥°çš„å˜é‡å½¢æˆå¼ºå¼•ç”¨ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1208/7.png" alt="7"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1208/8.png" alt="8"></p>
<p>3ã€å½“Blockä»å †ä¸­ç§»é™¤æ—¶ï¼Œä¼šè°ƒç”¨Blockå†…éƒ¨çš„<code>dispose</code>å‡½æ•°ï¼Œ<code>dispose</code>å‡½æ•°å†…éƒ¨ä¼šè°ƒç”¨<code>__Block_object_dispose</code>å‡½æ•°ï¼Œ<code>__Block_object_dispose</code>ä¼šå¯¹<code>__block</code>ä¿®é¥°çš„å˜é‡è¿›è¡Œä¸€æ¬¡releaseæ“ä½œã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1208/9.png" alt="9"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1208/10.png" alt="10"></p>
<h2 id="Blockçš„å¾ªç¯å¼•ç”¨">Blockçš„å¾ªç¯å¼•ç”¨</h2>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Person ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="type">int</span> age;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="type">void</span>(^PersonBlock)(<span class="type">void</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)dealloc &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// mainå‡½æ•°</span></span><br><span class="line"><span class="type">int</span> main(<span class="type">int</span> argc, <span class="keyword">const</span> <span class="type">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        Person *person = [[Person alloc] init];</span><br><span class="line">        person.age = <span class="number">10</span>;</span><br><span class="line">        person.PersonBlock = ^&#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;person&#x27;s age is %d&quot;</span>,person.age);</span><br><span class="line">        &#125;;</span><br><span class="line">        person.PersonBlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;--------&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-08</span> <span class="number">16</span>:<span class="number">07</span>:<span class="number">45.878556</span>+<span class="number">0800</span> BlockDemo[<span class="number">9541</span>:<span class="number">6681377</span>] person<span class="string">&#x27;s age is 10</span></span><br><span class="line"><span class="string">2022-12-08 16:07:45.879146+0800 BlockDemo[9541:6681377] --------</span></span><br></pre></td></tr></table></figure>
<p>å‘ç°<code>person</code>å¯¹è±¡å¹¶æ²¡æœ‰è¢«é‡Šæ”¾è¿˜å­˜åœ¨å†…å­˜é‡Œé¢ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å¾ªç¯å¼•ç”¨ï¼ˆå†…å­˜æ³„æ¼ï¼‰ã€‚</p>
<p>ä¸‹å›¾è¡¨ç¤ºäº†ä¸Šé¢å¯¹è±¡ä¹‹é—´çš„æŒæœ‰å…³ç³»ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1208/11.png" alt="11"></p>
<p>å¦‚ä½•è§£å†³å¾ªç¯å¼•ç”¨ï¼Ÿ</p>
<p>å…¶å®å°±æ˜¯æŠŠ2å’Œ3å…¶ä¸­ä¸€ä¸ªå˜æˆå¼±å¼•ç”¨å³å¯ï¼Œé‚£ä¹ˆåˆ°åº•2å’Œ3è°å˜æˆå¼±å¼•ç”¨æ›´åˆé€‚å‘¢ï¼Œ3æ˜¯<code>Person</code>å¯¹è±¡æœ‰ä¸€ä¸ª<code>PersonBlock</code>è¿™ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å¸Œæœ›å½“è¿™ä¸ª<code>Person</code>å¯¹è±¡è¿˜åœ¨çš„æ—¶å€™éšæ—¶èƒ½è®¿é—®åˆ°<code>PersonBlock</code>ï¼Œæ‰€ä»¥3åº”è¯¥æ˜¯ä¸ªå¼ºå¼•ç”¨ï¼Œæˆ‘ä»¬æŠŠ2æ¢æˆå¼±å¼•ç”¨å³å¯ã€‚</p>
<ul>
<li>ä½¿ç”¨<code>__weak</code>ï¼Œ<code>__unsafe_unretain</code></li>
<li>ä½¿ç”¨<code>_block</code>ï¼Œä½†æ˜¯å¿…é¡»è°ƒç”¨block</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼ä¸€</span></span><br><span class="line">Person *person = [[Person alloc] init];</span><br><span class="line">__<span class="keyword">weak</span> <span class="keyword">typeof</span>(person) weakPerson = person;</span><br><span class="line">person.age = <span class="number">10</span>;</span><br><span class="line">person.PersonBlock = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;person&#x27;s age is %d&quot;</span>,weakPerson.age);</span><br><span class="line">&#125;;</span><br><span class="line">person.PersonBlock();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼äºŒ</span></span><br><span class="line">Person *person = [[Person alloc] init];</span><br><span class="line">__<span class="keyword">unsafe_unretained</span> <span class="keyword">typeof</span>(person) weakPerson = person;</span><br><span class="line">person.age = <span class="number">10</span>;</span><br><span class="line">person.PersonBlock = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;person&#x27;s age is %d&quot;</span>,weakPerson.age);</span><br><span class="line">&#125;;</span><br><span class="line">person.PersonBlock();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼ä¸‰</span></span><br><span class="line">__block Person *person = [[Person alloc] init];</span><br><span class="line">person.age = <span class="number">10</span>;</span><br><span class="line">person.PersonBlock = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;person&#x27;s age is %d&quot;</span>,person.age);</span><br><span class="line">    person = <span class="literal">nil</span>;</span><br><span class="line">&#125;;</span><br><span class="line">person.PersonBlock();</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹<code>__block</code>ä¿®é¥°çš„å˜é‡çš„å†…å­˜é—®é¢˜ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">__block Person *person = [[Person alloc] init];</span><br><span class="line">person.age = <span class="number">10</span>;</span><br><span class="line">person.PersonBlock = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;person&#x27;s age is %d&quot;</span>,person.age);</span><br><span class="line">&#125;;</span><br><span class="line">person.PersonBlock();</span><br></pre></td></tr></table></figure>
<p>ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤ºä»–ä»¬ä¹‹é—´çš„å¼•ç”¨å…³ç³»ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1208/12.png" alt="12"></p>
<p>å¦‚ä½•è§£å†³å¾ªç¯å¼•ç”¨ï¼Ÿ</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">Person *person = [[Person alloc] init];</span><br><span class="line">__block __<span class="keyword">weak</span> <span class="keyword">typeof</span>(person) weakPerson = person;</span><br><span class="line">person.age = <span class="number">10</span>;</span><br><span class="line">person.PersonBlock = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;person&#x27;s age is %d&quot;</span>,weakPerson.age);</span><br><span class="line">&#125;;</span><br><span class="line">person.PersonBlock();</span><br></pre></td></tr></table></figure>
<p>åº•å±‚ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1208/13.png" alt="13"></p>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è§£å†³Blockå¸¦æ¥çš„ä¸€äº›å¾ªç¯å¼•ç”¨çš„é—®é¢˜å•¦ã€‚</p>
<h2 id="å†™åœ¨æœ€å-6">å†™åœ¨æœ€å</h2>
<p>å…³äºBlockçš„åº•å±‚åŸç†åœ¨è¿™é‡Œå°±å…¨éƒ¨ç»“æŸäº†ï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘Blockåº•å±‚åŸç†ï¼ˆä¸€ï¼‰</title>
    <url>/posts/67d22871/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-13">å†™åœ¨å‰é¢</h2>
<p>å…³äº<code>Block</code>çš„åº•å±‚åŸç†ç›¸å…³ä¸œè¥¿ï¼Œéœ€è¦äº†è§£çš„ä¸œè¥¿æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥åšä¸»è¿™é‡Œæ‰“ç®—ç”¨ä¸¤ç¯‡æ–‡ç« æ¥è¯¦ç»†åˆ†æä¸€ä¸‹OCé‡Œé¢çš„<code>Block</code>ï¼Œè¿™æ˜¯ç¬¬ä¸€ç¯‡ï¼Œå†…å®¹ä¸»è¦åŒ…å«ï¼š</p>
<ul>
<li>Blockçš„åŸºæœ¬ä½¿ç”¨</li>
<li>Blockçš„åº•å±‚æ•°æ®ç»“æ„</li>
<li>Blockå¯¹å˜é‡çš„æ•è·</li>
<li>Blockçš„ç±»å‹</li>
</ul>
<p>å¥½äº†ï¼ŒåºŸè¯å°‘è¯´ï¼Œç°åœ¨è·Ÿç€åšä¸»å¼€å§‹ä»å¤´äº†è§£Blockå§ã€‚</p>
<h2 id="Blockçš„åŸºæœ¬ä½¿ç”¨-2">Blockçš„åŸºæœ¬ä½¿ç”¨</h2>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªBlock</span></span><br><span class="line"><span class="type">void</span>(^WWBlock)(<span class="type">void</span>) = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;This is a block...&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line">        </span><br><span class="line"><span class="comment">// è°ƒç”¨Block</span></span><br><span class="line">WWBlock();</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šæ˜¯æœ€ç®€å•çš„ä¸€ä¸ªBlockï¼Œè°ƒç”¨<code>Block()</code>ä¼šæ‰“å°ï¼š<code>This is a block...</code>ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Person ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)fetchDataWithSuccess:(<span class="type">void</span>(^)(<span class="built_in">NSString</span> *message))successBlock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)fetchDataWithSuccess:(<span class="type">void</span>(^)(<span class="built_in">NSString</span> *message))successBlock &#123;</span><br><span class="line">    <span class="keyword">if</span> (successBlock) &#123;</span><br><span class="line">        successBlock(<span class="string">@&quot;è¿™æ˜¯ä¸€ä¸ªæˆåŠŸçš„å›è°ƒ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">Person *person = [[Person alloc] init];</span><br><span class="line">[person fetchDataWithSuccess:^(<span class="built_in">NSString</span> *message) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;---- %@&quot;</span>, message);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼š</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-06</span> <span class="number">19</span>:<span class="number">30</span>:<span class="number">08.775142</span>+<span class="number">0800</span> BlockDemo[<span class="number">53402</span>:<span class="number">5642770</span>] ---- è¿™æ˜¯ä¸€ä¸ªæˆåŠŸçš„å›è°ƒ...</span><br></pre></td></tr></table></figure>
<p>ç›¸ä¿¡è¿™ç§ç±»ä¼¼çš„Blockå¤§å®¶åœ¨æ—¥å¸¸é¡¹ç›®ä¸­ä¼šçœ‹åˆ°å¾ˆå¤šå¾ˆå¤šï¼Œæˆ‘ä»¬è¿™é‡Œå°±ä¸å†ä¸€ä¸€åˆ—ä¸¾äº†ã€‚</p>
<h2 id="Blockçš„åº•å±‚æ•°æ®ç»“æ„">Blockçš„åº•å±‚æ•°æ®ç»“æ„</h2>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªBlock</span></span><br><span class="line"><span class="type">void</span>(^WWBlock)(<span class="type">void</span>) = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;This is a block...&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line">        </span><br><span class="line"><span class="comment">// è°ƒç”¨Block</span></span><br><span class="line">WWBlock();</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸Šé¢æœ€ç®€å•çš„Blockçš„åº•å±‚C++ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œä½¿ç”¨å‘½ä»¤<code>xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc main.m -o main.cpp</code>è½¬ä¸ºC++ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* @autoreleasepool */</span> &#123; __AtAutoreleasePool __autoreleasepool; </span><br><span class="line">        <span class="comment">// å®šä¹‰Block</span></span><br><span class="line">        <span class="built_in">void</span>(*WWBlock)(<span class="type">void</span>) = ((<span class="built_in">void</span> (*)())&amp;__main_block_impl_0((<span class="type">void</span> *)__main_block_func_0, &amp;__main_block_desc_0_DATA));</span><br><span class="line">                            </span><br><span class="line">        <span class="comment">// è°ƒç”¨Block               </span></span><br><span class="line">        ((<span class="built_in">void</span> (*)(__block_impl *))((__block_impl *)WWBlock)-&gt;FuncPtr)((__block_impl *)WWBlock);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠç›¸åº”çš„å¼ºåˆ¶è½¬æ¢ç»™å»æ‰èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´æ¸…æ™°çš„ç†è§£Blockçš„ç»“æ„ï¼Œå»æ‰ä¸€äº›å¼ºåˆ¶è½¬æ¢ä¹‹åå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰Block</span></span><br><span class="line"><span class="built_in">void</span>(*WWBlock)(<span class="type">void</span>) = &amp;__main_block_impl_0(__main_block_func_0, &amp;__main_block_desc_0_DATA));</span><br><span class="line"><span class="comment">// è°ƒç”¨Block      </span></span><br><span class="line">WWBlock-&gt;<span class="built_in">FuncPtr</span>(WWBlock);</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°è·ŸBlockç›¸å…³çš„æœ‰ï¼š<code>__main_block_impl_0</code>ã€<code>__main_block_func_0</code>ã€<code>__main_block_dec_0_DATA</code>è¿™å‡ ä¸ªç±»ï¼Œåœ¨ç”Ÿæˆçš„C++æ–‡ä»¶é‡Œé¢æ‰¾åˆ°ç›¸å…³çš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1206/1.png" alt="1"></p>
<p>ä»ä¸Šé¢çš„å›¾é‡Œé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒBlockçš„ç»“æ„é‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ª<code>isa</code>æŒ‡é’ˆï¼Œæ‰€ä»¥Blockçš„æœ¬è´¨å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªã€<strong>OCå¯¹è±¡</strong>ã€‘ï¼Œæ˜¯ä¸€ä¸ªå°è£…äº†å‡½æ•°è°ƒç”¨åŠå…¶è°ƒç”¨ç¯å¢ƒçš„OCå¯¹è±¡ã€‚</p>
<p>å¯¹åº”å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1206/2.png" alt="2"></p>
<p>åœ¨è°ƒç”¨çš„æ—¶å€™<code>WWBlock-&gt;FuncPtr(WWBlock)</code>ï¼Œç›¸å½“äºæ˜¯æ‹¿åˆ°<code>WWBlock</code>ç»“æ„é‡Œé¢çš„å‡½æ•°æŒ‡é’ˆ<code>FuncPtr</code>å»è°ƒç”¨å¯¹åº”çš„æ–¹æ³•ï¼Œè¿™ä¸ªå‡½æ•°æŒ‡é’ˆé‡Œé¢å…¶å®å­˜æ”¾çš„å°±æ˜¯Blockä»£ç å—çš„åœ°å€ã€‚</p>
<h2 id="Blockå¯¹å˜é‡çš„æ•è·">Blockå¯¹å˜é‡çš„æ•è·</h2>
<p>ä¸ºä»€ä¹ˆBlockä¼šå¯¹å˜é‡è¿›è¡Œæ•è·ï¼Ÿ</p>
<p>å› ä¸ºåœ¨Blocké‡Œé¢å¯èƒ½éœ€è¦è®¿é—®Blockå¤–éƒ¨å˜é‡çš„å€¼ï¼Œæ‰€ä»¥éœ€è¦æ•è·ï¼ˆcaptureï¼‰å˜é‡ä¿è¯æˆ‘ä»¬èƒ½æ­£ç¡®è®¿é—®åˆ°å˜é‡ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨åˆ†åˆ«æ¥åˆ†æã€autoå˜é‡ã€‘ã€ã€staticå˜é‡ã€‘ã€ã€å…¨å±€å˜é‡ã€‘ä¸‰ç§ä¸åŒçš„å˜é‡ï¼ŒBlockå¯¹å…¶æ•è·æ˜¯ä¸æ˜¯ä¹Ÿä¸ä¸€æ ·å‘¢ï¼Ÿ</p>
<h3 id="autoå˜é‡">autoå˜é‡</h3>
<p>autoå˜é‡ï¼šç¦»å¼€å½“å‰ä½œç”¨åŸŸå°±ä¼šé”€æ¯çš„å˜é‡ã€‚</p>
<h4 id="1ã€éå¯¹è±¡ç±»å‹çš„autoå˜é‡">1ã€éå¯¹è±¡ç±»å‹çš„autoå˜é‡</h4>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªBlock</span></span><br><span class="line"><span class="type">int</span> age = <span class="number">10</span>;</span><br><span class="line"><span class="type">void</span>(^WWBlock)(<span class="type">void</span>) = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;å¯¹auotoå˜é‡çš„æ•è· - %d&quot;</span>,age);</span><br><span class="line">&#125;;</span><br><span class="line">age = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨Block</span></span><br><span class="line">WWBlock();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼š</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-06</span> <span class="number">20</span>:<span class="number">18</span>:<span class="number">28.957166</span>+<span class="number">0800</span> BlockDemo[<span class="number">54326</span>:<span class="number">5689813</span>] å¯¹auotoå˜é‡çš„æ•è· - <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>åº•å±‚C++ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1206/3.png" alt="3"></p>
<p>è·Ÿå‰é¢æˆ‘ä»¬æ²¡æœ‰æ•è·å˜é‡ç›¸æ¯”ï¼Œä¼šæŠŠ<code>age</code>ä¼ é€’åˆ°Blocké‡Œé¢ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1206/4.png" alt="4"></p>
<p>ä»åº•å±‚ç»“æ„æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†ï¼šBlockä¼šå¯¹autoå˜é‡è¿›è¡Œæ•è·ï¼Œè®¿é—®çš„æ–¹å¼æ˜¯ã€å€¼ä¼ é€’ã€‘ã€‚</p>
<h4 id="2ã€å¯¹è±¡ç±»å‹çš„autoå˜é‡">2ã€å¯¹è±¡ç±»å‹çš„autoå˜é‡</h4>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> main(<span class="type">int</span> argc, <span class="keyword">const</span> <span class="type">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="type">void</span>(^WWBlock)(<span class="type">void</span>);</span><br><span class="line">        &#123;</span><br><span class="line">            Person *person = [[Person alloc] init];</span><br><span class="line">            person.age = <span class="number">10</span>;</span><br><span class="line">            WWBlock = ^&#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@&quot;person&#x27;s age is %d&quot;</span>,person.age);</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;-----&quot;</span>);</span><br><span class="line">        WWBlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼š</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-07</span> <span class="number">15</span>:<span class="number">45</span>:<span class="number">31.593895</span>+<span class="number">0800</span> BlockDemo[<span class="number">2248</span>:<span class="number">6132111</span>] -----</span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-07</span> <span class="number">15</span>:<span class="number">45</span>:<span class="number">31.594542</span>+<span class="number">0800</span> BlockDemo[<span class="number">2248</span>:<span class="number">6132111</span>] person<span class="string">&#x27;s age is 10</span></span><br><span class="line"><span class="string">2022-12-07 15:45:31.594693+0800 BlockDemo[2248:6132111] -[Person dealloc]</span></span><br></pre></td></tr></table></figure>
<p>åº•å±‚ç»“æ„ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1206/11.png" alt="11"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1206/12.png" alt="12"></p>
<p>å¯¹ç…§ä¸Šé¢çš„åº•å±‚æ•°æ®ç»“æ„å‘ç°ï¼šå¤šäº†ä¸¤ä¸ªå‡½æ•°<code>__main_block_copy_0</code>å’Œ<code>__main_block_dispose_0</code>ã€‚</p>
<p>å½“Blockè¢«æ‹·è´åˆ°å †ä¸Šæ—¶ï¼Œä¼šè°ƒç”¨Blockå†…éƒ¨çš„copyå‡½æ•°<code>__main_block_copy_0</code>ï¼Œå‡½æ•°é‡Œé¢è°ƒç”¨<code>_Block_object_assign</code>ï¼Œåœ¨<code>_Block_object_assign</code>é‡Œé¢æ ¹æ®autoå˜é‡çš„ä¿®é¥°ç¬¦åšå‡ºç›¸åº”çš„æ“ä½œï¼šå¼ºå¼•ç”¨æˆ–å¼±å¼•ç”¨ã€‚</p>
<p>å½“Blockä»å¯¹ä¸Šç§»é™¤æ—¶ï¼Œä¼šè°ƒç”¨Blockå†…éƒ¨çš„disposeå‡½æ•°<code>__main_block_dispose_0</code>ï¼Œå‡½æ•°é‡Œé¢è°ƒç”¨<code>_Block_object_dispose</code>ï¼Œ<code>_Block_object_dispose</code>å»å¯¹å¼•ç”¨çš„autoå˜é‡è¿›è¡Œä¸€æ¬¡releaseæ“ä½œã€‚</p>
<div class="note pink no-icon flat"><p>åœ¨ä½¿ç”¨clangè½¬æ¢OCä¸ºC++ä»£ç æ—¶ï¼Œå¦‚æœæœ‰<code>__weak</code>å¯èƒ½ä¼šå‡ºç°ä¸‹é¢æŠ¥é”™ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1206/13.png" alt="13"></p>
<p>è®©å…¶æ”¯æŒARCã€æŒ‡å®šè¿è¡Œæ—¶ç³»ç»Ÿç‰ˆæœ¬å³å¯ï¼Œæ¯”å¦‚ï¼š</p>
<p>xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc -fobjc-arc -fobjc-runtime=ios-14.0.0 main.m</p>
</div>
<h3 id="staticå˜é‡">staticå˜é‡</h3>
<p>staticå˜é‡ï¼šç¦»å¼€å½“å‰ä½œç”¨åŸŸä¸ä¼šé”€æ¯çš„å˜é‡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªBlock</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> age = <span class="number">10</span>;</span><br><span class="line"><span class="type">void</span>(^WWBlock)(<span class="type">void</span>) = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;å¯¹staticå˜é‡çš„æ•è· - %d&quot;</span>,age);</span><br><span class="line">&#125;;</span><br><span class="line">age = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨Block</span></span><br><span class="line">WWBlock();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼š</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-06</span> <span class="number">20</span>:<span class="number">27</span>:<span class="number">55.716204</span>+<span class="number">0800</span> BlockDemo[<span class="number">54594</span>:<span class="number">5700817</span>] å¯¹<span class="keyword">static</span>å˜é‡çš„æ•è· - <span class="number">20</span></span><br></pre></td></tr></table></figure>
<p>åº•å±‚C++ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1206/5.png" alt="5"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1206/6.png" alt="6"></p>
<p>ä»åº•å±‚ç»“æ„æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†ï¼šBlockä¼šå¯¹staticå˜é‡è¿›è¡Œæ•è·ï¼Œè®¿é—®çš„æ–¹å¼æ˜¯ã€æŒ‡é’ˆä¼ é€’ã€‘ã€‚</p>
<h3 id="å…¨å±€å˜é‡">å…¨å±€å˜é‡</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> age;</span><br><span class="line"><span class="type">int</span> main(<span class="type">int</span> argc, <span class="keyword">const</span> <span class="type">char</span> * argv[]) &#123;</span><br><span class="line">  <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">      <span class="comment">// å®šä¹‰ä¸€ä¸ªBlock</span></span><br><span class="line">      age = <span class="number">10</span>;</span><br><span class="line">      <span class="type">void</span>(^WWBlock)(<span class="type">void</span>) = ^&#123;</span><br><span class="line">          <span class="built_in">NSLog</span>(<span class="string">@&quot;age is %d&quot;</span>,age);</span><br><span class="line">      &#125;;</span><br><span class="line">      age = <span class="number">20</span>;</span><br><span class="line">      <span class="comment">// è°ƒç”¨Block</span></span><br><span class="line">      WWBlock();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼š</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-07</span> <span class="number">13</span>:<span class="number">39</span>:<span class="number">45.012065</span>+<span class="number">0800</span> BlockDemo[<span class="number">197</span>:<span class="number">6032120</span>] age is <span class="number">20</span></span><br></pre></td></tr></table></figure>
<p>åº•å±‚C++ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1206/7.png" alt="7"></p>
<p>ä»åº•å±‚ç»“æ„æˆ‘ä»¬å‘ç°ï¼šBlockä¸ä¼šå¯¹å…¨å±€å˜é‡è¿›è¡Œæ•è·ï¼Œç›´æ¥è®¿é—®å…¨å±€å˜é‡å³å¯ã€‚</p>
<div class="note green no-icon flat"><p><strong>æ€è€ƒ</strong>ï¼š</p>
<p>1ã€ä¸ºä»€ä¹ˆBlockä¸ä¼šæ•è·å…¨å±€å˜é‡ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡éœ€è¦æ•è·ï¼Ÿ</p>
<p>å…¨å±€å˜é‡åœ¨ä»»ä½•æ—¶å€™ä»»ä½•åœ°æ–¹éƒ½æ˜¯å¯ä»¥è®¿é—®åˆ°çš„ï¼Œå› æ­¤ä¸éœ€è¦æ•è·å¯ä»¥ç›´æ¥è®¿é—®ã€‚</p>
<p>å±€éƒ¨å˜é‡å› ä¸ºä½œç”¨åŸŸçš„é—®é¢˜éœ€è¦è¢«æ•è·ï¼Œä¿è¯Blockå†…éƒ¨èƒ½å¤Ÿæ­£ç¡®è®¿é—®åˆ°è¯¥å˜é‡ã€‚</p>
<p>2ã€Blockä¼šå¯¹æ•è·selfå—ï¼Ÿ</p>
<p>ä¼šï¼Œè¯´æ˜selfæ˜¯ä¸ªå±€éƒ¨å˜é‡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="type">void</span>)test &#123;</span><br><span class="line">    <span class="keyword">self</span>.age = <span class="number">10</span>;</span><br><span class="line">    <span class="type">void</span>(^WWBlock)(<span class="type">void</span>) = ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;age is %d&quot;</span>, <span class="keyword">self</span>.age);</span><br><span class="line">    &#125;;</span><br><span class="line">    WWBlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åº•å±‚C++ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1206/9.png" alt="9"></p>
<p><code>self</code>å’Œ<code>_cmd</code>å…¶å®æ˜¯ä¸¤ä¸ªéšå¼å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½åœ¨é‡Œé¢æ­£å¸¸è®¿é—®<code>self</code>ã€<code>_cmd</code>ã€‚</p>
</div>
<h3 id="Blockæ•è·å˜é‡æ€»ç»“">Blockæ•è·å˜é‡æ€»ç»“</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1206/8.png" alt="8"></p>
<h2 id="Blockçš„ç±»å‹">Blockçš„ç±»å‹</h2>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span>(^block1)(<span class="type">void</span>) = ^&#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@&quot;This is block...&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> age = <span class="number">10</span>;</span><br><span class="line"><span class="type">void</span>(^block2)(<span class="type">void</span>) = ^&#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@&quot;age is %d&quot;</span>,age);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%@ %@ %@&quot;</span>,[block1 <span class="keyword">class</span>],[block2 <span class="keyword">class</span>],[^&#123;<span class="built_in">NSLog</span>(<span class="string">@&quot;age is %d&quot;</span>, age);&#125; <span class="keyword">class</span>]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%@ %@ %@&quot;</span>,[[block1 <span class="keyword">class</span>] superclass], [[block2 <span class="keyword">class</span>] superclass], [[^&#123;<span class="built_in">NSLog</span>(<span class="string">@&quot;age is %d&quot;</span>, age);&#125; <span class="keyword">class</span>] superclass]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼š</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-07</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">29.626370</span>+<span class="number">0800</span> BlockDemo[<span class="number">2188</span>:<span class="number">6126897</span>] __NSGlobalBlock__ __NSMallocBlock__ __NSStackBlock__</span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-07</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">29.627050</span>+<span class="number">0800</span> BlockDemo[<span class="number">2188</span>:<span class="number">6126897</span>] <span class="built_in">NSBlock</span> <span class="built_in">NSBlock</span> <span class="built_in">NSBlock</span></span><br></pre></td></tr></table></figure>
<p>Blockæœ‰ä¸‰ç§ç±»å‹ï¼š<code>__NSGlobalBlock__</code>ã€<code>__NSMallocBlock__</code>ã€<code>__NSStackBlock__</code>ï¼Œéƒ½ç»§æ‰¿è‡ª<code>NSBlock</code>ã€‚</p>
<div class="note blue no-icon flat"><p><strong>æ³¨æ„</strong>ï¼šç¼–è¯‘å®Œçš„Blockç±»å‹å’Œè¿è¡Œæ—¶çš„Blockç±»å‹ä¼šæœ‰ä¸€äº›åŒºåˆ«ã€‚</p>
</div>
<h3 id="åº”ç”¨ç¨‹åºçš„å†…å­˜åˆ†é…">åº”ç”¨ç¨‹åºçš„å†…å­˜åˆ†é…</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1206/10.png" alt="10"></p>
<p>ç¨‹åºåŒºåŸŸï¼ˆä»£ç æ®µï¼‰ï¼šå­˜æ”¾çš„å°±æ˜¯æˆ‘ä»¬å†™çš„ä¸€äº›ä»£ç ã€‚</p>
<p>æ•°æ®åŒºåŸŸï¼šä¸€èˆ¬æ˜¯å­˜æ”¾ä¸€äº›å…¨å±€å˜é‡ã€‚</p>
<p>å †ï¼šåŠ¨æ€åˆ†é…å†…å­˜ï¼Œè‡ªå·±ç®¡ç†å†…å­˜ã€‚</p>
<p>æ ˆï¼šç³»ç»Ÿè‡ªåŠ¨åˆ†é…å†…å­˜ï¼Œä¸éœ€è¦è‡ªå·±ç®¡ç†å†…å­˜ã€‚</p>
<h3 id="Blockç±»å‹æ€»ç»“">Blockç±»å‹æ€»ç»“</h3>
<div class="note blue no-icon flat"><p>1ã€åªè¦æ²¡æœ‰è®¿é—®autoå˜é‡çš„Blockéƒ½æ˜¯<code>__NSGlobalBlock__</code>ç±»å‹çš„ã€‚</p>
<p>2ã€è®¿é—®äº†autoå˜é‡çš„Blockæ˜¯<code>__NSStackBlock__</code>ç±»å‹çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åœ¨ARCç¯å¢ƒä¸‹ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œcopyæ“ä½œï¼Œæ‰€ä»¥æ˜¯<code>__NSMallocBlock__</code>ç±»å‹çš„ã€‚</p>
<p>3ã€<code>__NSGlobalBlock__</code>ç±»å‹çš„Blockè°ƒç”¨äº†copyè¿˜æ˜¯<code>__NSGlobalBlock__</code>ç±»å‹ã€‚</p>
</div>
<h3 id="Blockçš„copyæ“ä½œ">Blockçš„copyæ“ä½œ</h3>
<p>åœ¨ARCç¯å¢ƒä¸‹ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®æƒ…å†µè‡ªåŠ¨å°†æ ˆä¸Šçš„Blockå¤åˆ¶åˆ°å †ä¸Šï¼Œæ¯”å¦‚ä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>blockä½œä¸ºå‡½æ•°è¿”å›å€¼</li>
<li>å°†blockèµ‹å€¼ç»™<code>__strong</code>æŒ‡é’ˆæ—¶</li>
<li>blockä½œä¸ºCocoa APIä¸­æ–¹æ³•åå«æœ‰usingBlockçš„æ–¹æ³•å‚æ•°æ—¶</li>
<li>blockä½œä¸ºGCD APIçš„æ–¹æ³•å‚æ•°æ—¶</li>
</ul>
<div class="note orange no-icon flat"><p><strong>æ³¨æ„</strong>ï¼šMRCä¸‹Blockä½¿ç”¨copyå…³é”®å­—ä¿®é¥°ï¼ŒARCä¸‹Blockä½¿ç”¨strongæˆ–copyéƒ½å¯ä»¥ï¼Œå»ºè®®ä½¿ç”¨copyï¼Œä¸MRCä¸‹ä¿æŒä¸€è‡´ã€‚</p>
</div>
<h2 id="å†™åœ¨æœ€å-7">å†™åœ¨æœ€å</h2>
<p>å…³äºBlockåº•å±‚åŸç†çš„ç¬¬ä¸€ç¯‡æˆ‘ä»¬å°±åˆ†äº«åˆ°è¿™é‡Œï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘Categoryçš„åº•å±‚åŸç†</title>
    <url>/posts/dfd029e5/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-14">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡åšä¸»å°†ä»<code>Category</code>çš„åŸºæœ¬ä½¿ç”¨å’Œåº•å±‚åŸç†æ¥çª¥æ¢ä¸€ä¸‹Runtimeä¸‹çš„<code>Category</code> æ˜¯å¦‚ä½•å®ç°çš„ã€‚åšä¸»è¿™é‡Œå‚è€ƒçš„è‹¹æœæºç ç‰ˆæœ¬æ˜¯ï¼š<code>objc4_838</code>ç‰ˆæœ¬ã€‚</p>
<h2 id="Categoryçš„åŸºæœ¬ä½¿ç”¨">Categoryçš„åŸºæœ¬ä½¿ç”¨</h2>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Person ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)run;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)run &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Person + Test åˆ†ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> (<span class="title">Test</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">Test</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)test &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨å‘½ä»¤ï¼š<code>xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc Person+Test.m -o Person+test.cpp</code>å°†<code>Person+Test.m</code>æ–‡ä»¶è½¬åŒ–ä¸ºc++åº•å±‚ä»£ç ï¼Œåˆ†æè¯¥c++æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åˆ†ç±»çš„åº•å±‚ç»“æ„ä¸ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> _category_t &#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="type">char</span> *name; <span class="comment">// ç±»å</span></span><br><span class="line">	<span class="keyword">struct</span> _class_t *cls;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">struct</span> _method_list_t *instance_methods; <span class="comment">// å®ä¾‹æ–¹æ³•åˆ—è¡¨</span></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">struct</span> _method_list_t *class_methods; <span class="comment">// ç±»æ–¹æ³•åˆ—è¡¨</span></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">struct</span> _protocol_list_t *protocols; <span class="comment">// åè®®åˆ—è¡¨</span></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">struct</span> _prop_list_t *properties; <span class="comment">// å±æ€§åˆ—è¡¨</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>Person+Test.m</code>åº•å±‚ç»“æ„ä¸ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1124/8.png" alt="8"></p>
<p>å¯¹åº”ä¸Šé¢<code>_category_t</code>ç»“æ„å¯ä»¥çœ‹åˆ°ï¼š</p>
<div class="note red no-icon flat"><p>1.æœ¬ç±»åä¸º<code>Person</code>ã€‚</p>
<p>2.å› ä¸º<code>Person+Test.m</code>æˆ‘ä»¬åªå†™äº†ä¸€ä¸ªtestçš„å®ä¾‹æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œä¹Ÿå¾ˆæ˜æ˜¾çœ‹åˆ°è¿™é‡Œä¼ äº†ä¸€ä¸ªæ–¹æ³•åˆ—è¡¨ã€‚</p>
<p><strong>æ³¨</strong>ï¼šè¿™é‡Œçš„<code>_OBJC_$_CATEGORY_INSTANCE_METHODS_Person_$_Test</code>å…¶å®å°±æ˜¯ä¸€ä¸ªç»“æ„ä½“åç§°ã€‚</p>
</div>
<h2 id="Categoryåº•å±‚åŸç†çª¥æ¢">Categoryåº•å±‚åŸç†çª¥æ¢</h2>
<p>è¿è¡Œæ—¶Runtimeå…¥å£ï¼š<code>objc-os.mm</code>æ–‡ä»¶ã€‚</p>
<p>Categoryæºç é˜…è¯»é¡ºåºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// objc-os.mm æ–‡ä»¶</span></span><br><span class="line"><span class="number">1.</span> _objc_init </span><br><span class="line"><span class="number">3.</span> map_images_nolock</span><br><span class="line"></span><br><span class="line"><span class="comment">// objc_runtime_new.mm æ–‡ä»¶</span></span><br><span class="line"><span class="number">2.</span> map_images</span><br><span class="line"><span class="number">4.</span> loadAllCategories();</span><br><span class="line"><span class="number">5.</span> load_categories_nolock();</span><br><span class="line"><span class="number">6.</span> attachCategories();</span><br><span class="line"><span class="number">7.</span> attachLists();</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ 4 - 7 æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥éœ€è¦é‡ç‚¹åˆ†æçš„ã€‚</p>
<h3 id="Category-t-ç»“æ„ä½“">Category_t ç»“æ„ä½“</h3>
<p>Runtimeä¸‹<code>Category_t</code>ç»“æ„ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> category_t &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="type">char</span> *name;</span><br><span class="line">  classref_t cls;</span><br><span class="line">  WrappedPtr&lt;method_list_t, method_list_t::Ptrauth&gt; instanceMethods;</span><br><span class="line">  WrappedPtr&lt;method_list_t, method_list_t::Ptrauth&gt; classMethods;</span><br><span class="line">  <span class="keyword">struct</span> protocol_list_t *protocols;</span><br><span class="line">  <span class="keyword">struct</span> property_list_t *instanceProperties;</span><br><span class="line">  <span class="comment">// Fields below this point are not always present on disk.</span></span><br><span class="line">  <span class="keyword">struct</span> property_list_t *_classProperties;</span><br><span class="line"></span><br><span class="line">  method_list_t *methodsForMeta(<span class="type">bool</span> isMeta) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isMeta) <span class="keyword">return</span> classMethods;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">return</span> instanceMethods;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  property_list_t *propertiesForMeta(<span class="type">bool</span> isMeta, <span class="keyword">struct</span> header_info *hi);</span><br><span class="line"></span><br><span class="line">  protocol_list_t *protocolsForMeta(<span class="type">bool</span> isMeta) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isMeta) <span class="keyword">return</span> nullptr;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">return</span> protocols;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="map-images-nolock">map_images_nolock</h3>
<p><code>map_images_nolock</code>å¯ä»¥ç†è§£ä¸ºæ˜¯è¿è¡Œæ—¶çš„å¼€å§‹ï¼Œå†…éƒ¨å®ç°å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1124/9.png" alt="9"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼šè¿™é‡Œå› ä¸ºæ˜¯å€’åºéå†ä¹Ÿå°±å½±å“äº†åˆ†ç±»æ–¹æ³•ä¹‹é—´çš„ä¼˜å…ˆçº§é¡ºåºï¼Œæ‰€ä»¥åç¼–è¯‘çš„åˆ†ç±»æ–¹æ³•ä¼šæ”¾åœ¨å…ˆç¼–è¯‘çš„å‰é¢ã€‚</p>
<h3 id="loadAllCategories">loadAllCategories</h3>
<p>è¯¥æ–¹æ³•æŒ‡çš„æ˜¯ï¼šåŠ è½½é¡¹ç›®ä¸­æ‰€æœ‰åˆ†ç±»ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">void</span> loadAllCategories() &#123;</span><br><span class="line">  mutex_locker_t lock(runtimeLock);</span><br><span class="line">  <span class="keyword">for</span> (auto *hi = FirstHeader; hi != <span class="literal">NULL</span>; hi = hi-&gt;getNext()) &#123;</span><br><span class="line">    <span class="comment">// åŠ è½½æ¯ä¸ªç±»æ‰€æœ‰çš„åˆ†ç±»æ¨¡å—</span></span><br><span class="line">    load_categories_nolock(hi);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="load-categories-nolock">load_categories_nolock</h3>
<p>è¯¥æ–¹æ³•æŒ‡çš„æ˜¯ï¼šåŠ è½½ä¸€ä¸ªç±»æ‰€æœ‰çš„åˆ†ç±»æ¨¡å—ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">void</span> load_categories_nolock(header_info *hi) &#123;</span><br><span class="line">  <span class="comment">// æ˜¯å¦æœ‰ç±»å±æ€§</span></span><br><span class="line">  <span class="type">bool</span> hasClassProperties = hi-&gt;info()-&gt;hasCategoryClassProperties();</span><br><span class="line"></span><br><span class="line">  size_t count;</span><br><span class="line">  auto processCatlist = [&amp;](category_t * <span class="keyword">const</span> *catlist) &#123;</span><br><span class="line">      <span class="comment">// éå†éœ€è¦å¤„ç†çš„åˆ†ç±»åˆ—è¡¨</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="type">unsigned</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">          category_t *cat = catlist[i];</span><br><span class="line">          <span class="comment">// è·å–åˆ†ç±»çš„ä¸»ç±»</span></span><br><span class="line">          Class cls = remapClass(cat-&gt;cls);</span><br><span class="line">          locstamped_category_t lc&#123;cat, hi&#125;;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!cls) &#123;</span><br><span class="line">              <span class="comment">// è·å–ä¸åˆ°æœ¬ç±» å¯èƒ½æ˜¯å¼±é“¾æ¥</span></span><br><span class="line">              <span class="keyword">if</span> (PrintConnecting) &#123;</span><br><span class="line">                  _objc_inform(<span class="string">&quot;CLASS: IGNORING category \?\?\?(%s) %p with &quot;</span></span><br><span class="line">                               <span class="string">&quot;missing weak-linked target class&quot;</span>,</span><br><span class="line">                               cat-&gt;name, cat);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Process this category.</span></span><br><span class="line">          <span class="keyword">if</span> (cls-&gt;isStubClass()) &#123;</span><br><span class="line">              <span class="comment">// æ— æ³•ç¡®å®šå…ƒç±»å¯¹è±¡æ˜¯å“ªä¸ª æ‰€ä»¥å…ˆé™„ç€åœ¨stubClassèº«ä¸Š</span></span><br><span class="line">              <span class="comment">// Stub classes are never realized. Stub classes</span></span><br><span class="line">              <span class="comment">// don&#x27;t know their metaclass until they&#x27;re</span></span><br><span class="line">              <span class="comment">// initialized, so we have to add categories with</span></span><br><span class="line">              <span class="comment">// class methods or properties to the stub itself.</span></span><br><span class="line">              <span class="comment">// methodizeClass() will find them and add them to</span></span><br><span class="line">              <span class="comment">// the metaclass as appropriate.</span></span><br><span class="line">              <span class="keyword">if</span> (cat-&gt;instanceMethods ||</span><br><span class="line">                  cat-&gt;protocols ||</span><br><span class="line">                  cat-&gt;instanceProperties ||</span><br><span class="line">                  cat-&gt;classMethods ||</span><br><span class="line">                  cat-&gt;protocols ||</span><br><span class="line">                  (hasClassProperties &amp;&amp; cat-&gt;_classProperties))</span><br><span class="line">              &#123;</span><br><span class="line">                  objc::unattachedCategories.addForClass(lc, cls);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// First, register the category with its target class.</span></span><br><span class="line">              <span class="comment">// Then, rebuild the class&#x27;s method lists (etc) if</span></span><br><span class="line">              <span class="comment">// the class is realized.</span></span><br><span class="line">              <span class="keyword">if</span> (cat-&gt;instanceMethods ||  cat-&gt;protocols</span><br><span class="line">                  ||  cat-&gt;instanceProperties)</span><br><span class="line">              &#123;</span><br><span class="line">                  <span class="keyword">if</span> (cls-&gt;isRealized()) &#123; <span class="comment">// ç±»å¯¹è±¡å·²ç»åˆå§‹åŒ–å®Œæ¯• è¿›è¡Œåˆå¹¶</span></span><br><span class="line">                      attachCategories(cls, &amp;lc, <span class="number">1</span>, ATTACH_EXISTING);</span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                      objc::unattachedCategories.addForClass(lc, cls);</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">if</span> (cat-&gt;classMethods  ||  cat-&gt;protocols</span><br><span class="line">                  ||  (hasClassProperties &amp;&amp; cat-&gt;_classProperties))</span><br><span class="line">              &#123;</span><br><span class="line">                  <span class="keyword">if</span> (cls-&gt;ISA()-&gt;isRealized()) &#123; <span class="comment">// å…ƒç±»å¯¹è±¡å·²ç»åˆå§‹åŒ–å®Œæ¯• è¿›è¡Œåˆå¹¶</span></span><br><span class="line">                      attachCategories(cls-&gt;ISA(), &amp;lc, <span class="number">1</span>, ATTACH_EXISTING | ATTACH_METACLASS);</span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                      objc::unattachedCategories.addForClass(lc, cls-&gt;ISA());</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  processCatlist(hi-&gt;catlist(&amp;count));</span><br><span class="line">  processCatlist(hi-&gt;catlist2(&amp;count));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="attachCategories">attachCategories</h3>
<p>è¯¥æ–¹æ³•æŒ‡çš„æ˜¯ï¼šåˆå¹¶åˆ†ç±»çš„æ–¹æ³•åˆ—è¡¨ã€å±æ€§åˆ—è¡¨ã€åè®®åˆ—è¡¨ç­‰åˆ°æœ¬ç±»é‡Œé¢ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">void</span></span><br><span class="line">attachCategories(Class cls, <span class="keyword">const</span> locstamped_category_t *cats_list, uint32_t cats_count,</span><br><span class="line">                 <span class="type">int</span> flags) &#123;</span><br><span class="line">  <span class="keyword">if</span> (slowpath(PrintReplacedMethods)) &#123;</span><br><span class="line">      printReplacements(cls, cats_list, cats_count);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (slowpath(PrintConnecting)) &#123;</span><br><span class="line">      _objc_inform(<span class="string">&quot;CLASS: attaching %d categories to%s class &#x27;%s&#x27;%s&quot;</span>,</span><br><span class="line">                   cats_count, (flags &amp; ATTACH_EXISTING) ? <span class="string">&quot; existing&quot;</span> : <span class="string">&quot;&quot;</span>,</span><br><span class="line">                   cls-&gt;nameForLogging(), (flags &amp; ATTACH_METACLASS) ? <span class="string">&quot; (meta)&quot;</span> : <span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * Only a few classes have more than 64 categories during launch.</span></span><br><span class="line"><span class="comment">   * This uses a little stack, and avoids malloc.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * Categories must be added in the proper order, which is back</span></span><br><span class="line"><span class="comment">   * to front. To do that with the chunking, we iterate cats_list</span></span><br><span class="line"><span class="comment">   * from front to back, build up the local buffers backwards,</span></span><br><span class="line"><span class="comment">   * and call attachLists on the chunks. attachLists prepends the</span></span><br><span class="line"><span class="comment">   * lists, so the final result is in the expected order.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  constexpr uint32_t ATTACH_BUFSIZ = <span class="number">64</span>;</span><br><span class="line">  method_list_t   *mlists[ATTACH_BUFSIZ];</span><br><span class="line">  property_list_t *proplists[ATTACH_BUFSIZ];</span><br><span class="line">  protocol_list_t *protolists[ATTACH_BUFSIZ];</span><br><span class="line"></span><br><span class="line">  uint32_t mcount = <span class="number">0</span>;</span><br><span class="line">  uint32_t propcount = <span class="number">0</span>;</span><br><span class="line">  uint32_t protocount = <span class="number">0</span>;</span><br><span class="line">  <span class="type">bool</span> fromBundle = <span class="literal">NO</span>;</span><br><span class="line">  <span class="type">bool</span> isMeta = (flags &amp; ATTACH_METACLASS);</span><br><span class="line">  auto rwe = cls-&gt;data()-&gt;extAllocIfNeeded();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éå†æŸä¸ªç±»çš„åˆ†ç±»åˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">for</span> (uint32_t i = <span class="number">0</span>; i &lt; cats_count; i++) &#123;</span><br><span class="line">      auto&amp; entry = cats_list[i];</span><br><span class="line">      <span class="comment">// å–å‡ºåˆ†ç±»é‡Œé¢çš„æ–¹æ³•åˆ—è¡¨</span></span><br><span class="line">      method_list_t *mlist = entry.cat-&gt;methodsForMeta(isMeta);</span><br><span class="line">      <span class="keyword">if</span> (mlist) &#123;</span><br><span class="line">          <span class="keyword">if</span> (mcount == ATTACH_BUFSIZ) &#123;</span><br><span class="line">              prepareMethodLists(cls, mlists, mcount, <span class="literal">NO</span>, fromBundle, __func__);</span><br><span class="line">              rwe-&gt;methods.attachLists(mlists, mcount);</span><br><span class="line">              mcount = <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// å°†åˆ†ç±»çš„æ–¹æ³•åˆ—è¡¨æ”¾åœ¨åˆ›å»ºå¥½çš„å®¹å™¨é‡Œé¢</span></span><br><span class="line">          mlists[ATTACH_BUFSIZ - ++mcount] = mlist;</span><br><span class="line">          fromBundle |= entry.hi-&gt;isBundle();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å–å‡ºåˆ†ç±»é‡Œé¢çš„å±æ€§åˆ—è¡¨</span></span><br><span class="line">      property_list_t *proplist =</span><br><span class="line">          entry.cat-&gt;propertiesForMeta(isMeta, entry.hi);</span><br><span class="line">      <span class="keyword">if</span> (proplist) &#123;</span><br><span class="line">          <span class="keyword">if</span> (propcount == ATTACH_BUFSIZ) &#123;</span><br><span class="line">              rwe-&gt;properties.attachLists(proplists, propcount);</span><br><span class="line">              propcount = <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          proplists[ATTACH_BUFSIZ - ++propcount] = proplist;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å–å‡ºåˆ†ç±»é‡Œé¢çš„åè®®åˆ—è¡¨</span></span><br><span class="line">      protocol_list_t *protolist = entry.cat-&gt;protocolsForMeta(isMeta);</span><br><span class="line">      <span class="keyword">if</span> (protolist) &#123;</span><br><span class="line">          <span class="keyword">if</span> (protocount == ATTACH_BUFSIZ) &#123;</span><br><span class="line">              rwe-&gt;protocols.attachLists(protolists, protocount);</span><br><span class="line">              protocount = <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          protolists[ATTACH_BUFSIZ - ++protocount] = protolist;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (mcount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæœ‰å‰©ä¸‹çš„æ–¹æ³•åˆ—è¡¨</span></span><br><span class="line">      prepareMethodLists(cls, mlists + ATTACH_BUFSIZ - mcount, mcount,</span><br><span class="line">                         <span class="literal">NO</span>, fromBundle, __func__);</span><br><span class="line">      <span class="comment">// å°†å‰©ä¸‹çš„æ–¹æ³•åˆ—è¡¨é™„ç€åœ¨æœ¬ç±»çš„æ–¹æ³•åˆ—è¡¨</span></span><br><span class="line">      rwe-&gt;methods.attachLists(mlists + ATTACH_BUFSIZ - mcount, mcount);</span><br><span class="line">      <span class="keyword">if</span> (flags &amp; ATTACH_EXISTING) &#123;</span><br><span class="line">          flushCaches(cls, __func__, [](Class c)&#123;</span><br><span class="line">              <span class="comment">// constant caches have been dealt with in prepareMethodLists</span></span><br><span class="line">              <span class="comment">// if the class still is constant here, it&#x27;s fine to keep</span></span><br><span class="line">              <span class="keyword">return</span> !c-&gt;cache.isConstantOptimizedCache();</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  rwe-&gt;properties.attachLists(proplists + ATTACH_BUFSIZ - propcount, propcount);</span><br><span class="line"></span><br><span class="line">  rwe-&gt;protocols.attachLists(protolists + ATTACH_BUFSIZ - protocount, protocount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="attachLists">attachLists</h3>
<p>è¯¥æ–¹æ³•æŒ‡çš„æ˜¯ï¼šæŠŠåˆ†ç±»æ–¹æ³•çœŸæ­£åˆå¹¶åœ¨ä¸»ç±»çš„æ–¹æ³•åˆ—è¡¨é‡Œé¢ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> attachLists(List* <span class="keyword">const</span> * addedLists, uint32_t addedCount) &#123;</span><br><span class="line">  		<span class="comment">// å¦‚æœæ·»åŠ çš„æ–¹æ³•åˆ—è¡¨countä¸º0 ç›´æ¥è¿”å›</span></span><br><span class="line">      <span class="keyword">if</span> (addedCount == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (hasArray()) &#123;</span><br><span class="line">          <span class="comment">// many lists -&gt; many lists</span></span><br><span class="line">        	<span class="comment">// æœ¬ç±»é‡Œé¢æœ‰å¤šä¸ªæ–¹æ³•åˆ—è¡¨</span></span><br><span class="line">          uint32_t oldCount = array()-&gt;count;</span><br><span class="line">          uint32_t newCount = oldCount + addedCount;</span><br><span class="line">          array_t *newArray = (array_t *)malloc(array_t::byteSize(newCount));</span><br><span class="line">          newArray-&gt;count = newCount;</span><br><span class="line">          array()-&gt;count = newCount;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">for</span> (<span class="type">int</span> i = oldCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">              newArray-&gt;lists[i + addedCount] = array()-&gt;lists[i]; <span class="comment">// è¿™ä¸ªå…¶å®æ˜¯åœ¨æŠŠä¹‹å‰çš„æ–¹æ³•åˆ—è¡¨æŒªåˆ°æ–°æ•°ç»„åé¢ã€‚</span></span><br><span class="line">          <span class="keyword">for</span> (<span class="type">unsigned</span> i = <span class="number">0</span>; i &lt; addedCount; i++)</span><br><span class="line">              newArray-&gt;lists[i] = addedLists[i]; <span class="comment">// æŠŠåˆ†ç±»çš„æ–¹æ³•åˆ—è¡¨æ·»åŠ åˆ°æ–°æ•°ç»„é‡Œé¢ã€‚</span></span><br><span class="line">          free(array());</span><br><span class="line">          setArray(newArray);</span><br><span class="line">          validate();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (!list  &amp;&amp;  addedCount == <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="comment">// æœ¬ç±»åŸæœ¬æ²¡æœ‰æ–¹æ³•åˆ—è¡¨ åˆ†ç±»æ–¹æ³•åˆ—è¡¨Count == 1</span></span><br><span class="line">          list = addedLists[<span class="number">0</span>];</span><br><span class="line">          validate();</span><br><span class="line">      &#125; </span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// æœ¬ç±»åŸæœ¬åªæœ‰ä¸€ä¸ªæ–¹æ³•åˆ—è¡¨ </span></span><br><span class="line">          Ptr&lt;List&gt; oldList = list;</span><br><span class="line">          uint32_t oldCount = oldList ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">          uint32_t newCount = oldCount + addedCount;</span><br><span class="line">          setArray((array_t *)malloc(array_t::byteSize(newCount)));</span><br><span class="line">          array()-&gt;count = newCount;</span><br><span class="line">          <span class="keyword">if</span> (oldList) array()-&gt;lists[addedCount] = oldList;</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">unsigned</span> i = <span class="number">0</span>; i &lt; addedCount; i++)</span><br><span class="line">              array()-&gt;lists[i] = addedLists[i];</span><br><span class="line">          validate();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">void</span> tryFree() &#123;</span><br><span class="line">      <span class="keyword">if</span> (hasArray()) &#123;</span><br><span class="line">          <span class="keyword">for</span> (uint32_t i = <span class="number">0</span>; i &lt; array()-&gt;count; i++) &#123;</span><br><span class="line">              try_free(array()-&gt;lists[i]);</span><br><span class="line">          &#125;</span><br><span class="line">          try_free(array());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (list) &#123;</span><br><span class="line">          try_free(list);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  template&lt;<span class="keyword">typename</span> Other&gt;</span><br><span class="line">  <span class="type">void</span> duplicateInto(Other &amp;other) &#123;</span><br><span class="line">      <span class="keyword">if</span> (hasArray()) &#123;</span><br><span class="line">          array_t *a = array();</span><br><span class="line">          other.setArray((array_t *)memdup(a, a-&gt;byteSize()));</span><br><span class="line">          <span class="keyword">for</span> (uint32_t i = <span class="number">0</span>; i &lt; a-&gt;count; i++) &#123;</span><br><span class="line">              other.array()-&gt;lists[i] = a-&gt;lists[i]-&gt;duplicate();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (list) &#123;</span><br><span class="line">          other.list = list-&gt;duplicate();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          other.list = <span class="literal">nil</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>attachLists</code>æ–¹æ³•æ˜¯åˆ†ç±»åŸç†å®ç°æœ€æ ¸å¿ƒçš„æ–¹æ³•ï¼Œæˆ‘è¿™é‡Œç”¨ä¸€å¼ å›¾æ¥æ¨¡æ‹Ÿåˆ†ç±»çš„åº•å±‚åŸç†å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1124/10.png" alt="10"></p>
<h3 id="æ¨¡æ‹Ÿåœºæ™¯">æ¨¡æ‹Ÿåœºæ™¯</h3>
<p>æ¨¡æ‹Ÿåœºæ™¯ï¼š<code>Person</code>ç±»æœ‰ä¸¤ä¸ªåˆ†ç±»ï¼š<code>Person+Eat.h</code>å’Œ<code>Person+Run.h</code>ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Person ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)testï¼›</span><br><span class="line">- (<span class="type">void</span>)test1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// Person + Eat ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> (<span class="title">Eat</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)eat;</span><br><span class="line">- (<span class="type">void</span>)test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// Person + Run ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> (<span class="title">Run</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)run;</span><br><span class="line">- (<span class="type">void</span>)test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§ä¸Šå›¾çš„åˆ†æç»“æœï¼Œ<code>Person</code>ç±»ä¸­<code>class_rw_ext_t</code>ä¸­<code>methods</code>ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="note red no-icon flat"><p><strong>è§£é‡Š</strong>ï¼š</p>
<p>1.æŠŠPersonçš„æ–¹æ³•åˆ—è¡¨æŒªåŠ¨åˆ°æ•°ç»„æœ€å</p>
<p>2.æŠŠPersonçš„åˆ†ç±»æ–¹æ³•åˆ—è¡¨æ·»åŠ åˆ°å‰</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1124/11.png" alt="11"></p>
</div>
<div class="note orange no-icon flat"><p><strong>æç¤º</strong>ï¼š</p>
<p>1ã€å¦‚æœä¸»ç±»å’Œåˆ†ç±»éƒ½ä¼šæœ‰<code>-(void)test</code>æ–¹æ³•ï¼Œä¼šä¼˜å…ˆè°ƒç”¨åˆ†ç±»çš„æ–¹æ³•ï¼ŒåŸå› æ˜¯åˆ†ç±»çš„æ–¹æ³•åˆ—è¡¨åœ¨å‰é¢ï¼Œæ³¨æ„è¿™é‡Œä¸æ˜¯è¦†ç›–äº†åŸæ¥çš„æ–¹æ³•ã€‚</p>
<p>2ã€<code>Person</code>ä¸¤ä¸ªåˆ†ç±»éƒ½æœ‰<code>-(void)test</code>æ–¹æ³•ï¼Œè°ƒç”¨å“ªä¸ªæ–¹æ³•æ˜¯æ ¹æ®<strong>ç¼–è¯‘é¡ºåº</strong>æ¥å†³å®šçš„ï¼Œåå‚ä¸ç¼–è¯‘çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œæ¯”å¦‚ä¸Šä¾‹ä¸­è°ƒç”¨çš„æ˜¯<code>Person+Eat</code>ä¸­çš„<code>test</code>æ–¹æ³•ã€‚</p>
</div>
<h2 id="å†™åœ¨æœ€å-8">å†™åœ¨æœ€å</h2>
<p>å•¦å•¦å•¦ï¼Œå…³äº<code>Category</code>çš„åº•å±‚åŸç†çª¥æ¢å°±åˆ°è¿™é‡Œç»“æŸäº†ï¼Œå¦‚æœ‰é”™è¯¯çš„åœ°æ–¹è¿˜æœ›å„ä½å¤§ä½¬å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
        <tag>Runtime</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘KVCè¯¦è§£</title>
    <url>/posts/8583d944/</url>
    <content><![CDATA[<h2 id="KCVçš„åŸºæœ¬ä½¿ç”¨">KCVçš„åŸºæœ¬ä½¿ç”¨</h2>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾å€¼</span></span><br><span class="line">- (<span class="type">void</span>)setValue:(<span class="type">id</span>)value forKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line">- (<span class="type">void</span>)setValue:(<span class="type">id</span>)value forKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å–å€¼</span></span><br><span class="line">- (<span class="type">id</span>)valueForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line">- (<span class="type">id</span>)valueForKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Studentç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Personç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="type">int</span> age;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Student *student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“ä½¿ç”¨</span></span><br><span class="line">Person *person = [[Person alloc] init];</span><br><span class="line">person.student = [[Student alloc] init];</span><br><span class="line">[person setValue:@(<span class="number">10</span>) forKey:<span class="string">@&quot;age&quot;</span>];</span><br><span class="line">[person setValue:<span class="string">@&quot;Sunny&quot;</span> forKeyPath:<span class="string">@&quot;student.name&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;age:%@ name:%@&quot;</span>, [person valueForKey:<span class="string">@&quot;age&quot;</span>], [person valueForKeyPath:<span class="string">@&quot;student.name&quot;</span>]);</span><br></pre></td></tr></table></figure>
<h2 id="KVCçš„è®¾å€¼åŸç†">KVCçš„è®¾å€¼åŸç†</h2>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Personç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">@public</span></span><br><span class="line">  <span class="type">int</span> _age;</span><br><span class="line">  <span class="type">int</span> _isAge;</span><br><span class="line">  <span class="type">int</span> age;</span><br><span class="line">  <span class="type">int</span> isAge;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤è¿”å›YES å¦‚æœæ²¡æœ‰æ‰¾åˆ°Setter ä¼šæ ¹æ®_setKeyã€_keyã€_isKeyã€keyã€isKeyé¡ºåºå»æŸ¥æ‰¾ å¦‚æœè¿”å›NOä¸ä¼šæŒ‰ç…§å‰é¢é¡ºåºæŸ¥æ‰¾ã€‚</span></span><br><span class="line">+ (<span class="type">BOOL</span>)accessInstanceVariablesDirectly &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setAge:(<span class="type">int</span>)age &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)_setAge:(<span class="type">int</span>)age &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setValue:(<span class="type">id</span>)value forUndefinedKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ViewControllerç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">  [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">  Person *person = [[Person alloc] init];</span><br><span class="line">  [person setValue:@(<span class="number">10</span>) forKey:<span class="string">@&quot;age&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<div class="note green no-icon flat"><p><strong>è§£é‡Š</strong>ï¼š</p>
<p>1ã€å½“å­˜åœ¨<code>setKey</code>æ–¹æ³•æ—¶ï¼Œè°ƒç”¨<code>setKey</code>ã€‚</p>
<p>2ã€å½“<code>setKey</code>æ–¹æ³•ä¸å­˜åœ¨ï¼Œå­˜åœ¨<code>_setKey</code>æ–¹æ³•æ—¶ï¼Œè°ƒç”¨<code>_setKey</code>ã€‚</p>
<p>3ã€å½“<code>setKey</code>å’Œ<code>_setKey</code>éƒ½ä¸å­˜åœ¨æ—¶ï¼Œæ£€æŸ¥<code>+(BOOL)accessInstanceVariablesDirectly</code>è¿”å›å€¼ã€‚</p>
<p>4ã€å¦‚æœ<code>+(BOOL)accessInstanceVariablesDirectly</code>è¿”å›NOï¼Œè°ƒç”¨<code>-(void)setValue:(id)value forUndefinedKey:(NSString *)key</code>ï¼Œç¨‹åºç»“æŸã€‚</p>
<p>5ã€å¦‚æœ<code>+(BOOL)accessInstanceVariablesDirectly</code>è¿”å›YESï¼ŒæŒ‰ç…§<code>_key</code>ã€<code>_isKey</code>ã€<code>key</code>ã€<code>isKey</code>çš„é¡ºåºæŸ¥æ‰¾æˆå‘˜å˜é‡èµ‹å€¼ã€‚</p>
<p>6ã€å¦‚æœæŒ‰ç…§ä¸Šé¢çš„æµç¨‹éƒ½æ²¡æ‰¾åˆ°ï¼Œè°ƒç”¨<code>-(void)setValue:(id)value forUndefinedKey:(NSString *)key</code>ï¼Œç¨‹åºç»“æŸã€‚</p>
</div>
<p>ç”¨ä¸€å¼ å›¾æ¥æ€»ç»“KVCè®¾å€¼çš„æŸ¥æ‰¾é¡ºåºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1121/1.png" alt="1"></p>
<p><strong>æ€»ç»“</strong>ï¼š</p>
<p>æŒ‰ç…§ä¸Šé¢æµç¨‹éƒ½æ²¡æœ‰æŸ¥æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•æˆ–æˆå‘˜å˜é‡å¯ä»¥èµ‹å€¼å°±æ˜¯è°ƒç”¨æˆ‘ä»¬å¸¸è§çš„ä¸€ä¸ªæ–¹æ³•:<code>- (void)setValue:(id)value forUndefinedKey:(NSString *)key</code>æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<p>é’ˆå¯¹KVCèµ‹å€¼ï¼Œå³ä½¿æ²¡æœ‰æ‰¾åˆ°<code>setKey</code>æˆ–<code>_setKey</code>ï¼Œåªè¦æ‰¾åˆ°ä¸€ä¸ªæˆå‘˜å˜é‡ä¹Ÿæ˜¯ä¼šè§¦å‘KVOçš„ï¼ŒKVCæœ¬èº«è‡ªå·±åœ¨å†…éƒ¨ä¼šå»é€šçŸ¥ç›¸åº”çš„observerè§‚å¯Ÿè€…æŸä¸ªå±æ€§å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<p>å…¶å®å°±æ˜¯åœ¨å†…éƒ¨è°ƒç”¨äº†:</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="type">void</span>)willChangeValueForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line">- (<span class="type">void</span>)didChangeValueForKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure>
<h2 id="KVCçš„å–å€¼åŸç†">KVCçš„å–å€¼åŸç†</h2>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Personç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">@public</span></span><br><span class="line">  <span class="type">int</span> _age;</span><br><span class="line">  <span class="type">int</span> _isAge;</span><br><span class="line">  <span class="type">int</span> age;</span><br><span class="line">  <span class="type">int</span> isAge;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">BOOL</span>)accessInstanceVariablesDirectly &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="type">void</span>)getAge &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)age &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)isAge &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)_age &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">id</span>)valueForUndefinedKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// ViewController ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">  [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">  Person *person = [[Person alloc] init];</span><br><span class="line">  [person valueForKey:<span class="string">@&quot;age&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<div class="note green no-icon flat"><p><strong>è§£é‡Š</strong>ï¼š</p>
<p>1ã€å½“å­˜åœ¨<code>getKey</code>æ–¹æ³•æ—¶ï¼Œè°ƒç”¨<code>getKey</code>ã€‚</p>
<p>2ã€å½“<code>getKey</code>æ–¹æ³•ä¸å­˜åœ¨ï¼Œå­˜åœ¨<code>key</code>æ–¹æ³•æ—¶ï¼Œè°ƒç”¨<code>key</code>ã€‚</p>
<p>3ã€å½“<code>getKey</code>ã€<code>key</code>æ–¹æ³•ä¸å­˜åœ¨ï¼Œå­˜åœ¨<code>isKey</code>æ–¹æ³•æ—¶ï¼Œè°ƒç”¨<code>isKey</code>ã€‚</p>
<p>4ã€å½“<code>getKey</code>ã€<code>key</code>ã€<code>isKey</code> æ–¹æ³•ä¸å­˜åœ¨ï¼Œå­˜åœ¨<code>_key</code>æ–¹æ³•æ—¶ï¼Œè°ƒç”¨<code>_key</code>ã€‚</p>
<p>5ã€å½“<code>getKey</code>ã€<code>key</code>ã€<code>isKey</code> ã€<code>_key</code>éƒ½ä¸å­˜åœ¨æ—¶ï¼Œæ£€æŸ¥<code>+(BOOL)accessInstanceVariablesDirectly</code>è¿”å›å€¼ã€‚</p>
<p>6ã€å¦‚æœ<code>+(BOOL)accessInstanceVariablesDirectly</code>è¿”å›NOï¼Œè°ƒç”¨<code>- (id)valueForUndefinedKey:(NSString *)key</code>ï¼Œç¨‹åºç»“æŸã€‚</p>
<p>7ã€å¦‚æœ<code>+(BOOL)accessInstanceVariablesDirectly</code>è¿”å›YESï¼ŒæŒ‰ç…§<code>_key</code>ã€<code>_isKey</code>ã€<code>key</code>ã€<code>isKey</code>çš„é¡ºåºæŸ¥æ‰¾æˆå‘˜å˜é‡èµ‹å€¼ã€‚</p>
<p>8ã€å¦‚æœæŒ‰ç…§ä¸Šé¢çš„æµç¨‹éƒ½æ²¡æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•æˆ–æˆå‘˜å˜é‡ï¼Œè°ƒç”¨<code>- (id)valueForUndefinedKey:(NSString *)key</code>ï¼Œç¨‹åºç»“æŸã€‚</p>
</div>
<p>ç”¨ä¸€å¼ å›¾æ¥æ€»ç»“KVCå–å€¼çš„æŸ¥æ‰¾é¡ºåºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1121/2.png" alt="2"></p>
<p><strong>æ€»ç»“</strong>ï¼š</p>
<p>æŒ‰ç…§ä¸Šé¢æµç¨‹éƒ½æ²¡æœ‰æŸ¥æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•æˆ–æˆå‘˜å˜é‡å¯ä»¥èµ‹å€¼å°±æ˜¯è°ƒç”¨æˆ‘ä»¬å¸¸è§çš„ä¸€ä¸ªæ–¹æ³•:<code>- (id)valueForUndefinedKey:(NSString *)key</code>æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<h2 id="å†™åœ¨æœ€å-9">å†™åœ¨æœ€å</h2>
<p>å…³äºiOSé‡Œé¢çš„KVCè®¾å€¼ã€å–å€¼çš„ç›¸å…³é¡ºåºå°±å†™åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœ‰é”™è¯¯è¯·æŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘KVOè¯¦è§£</title>
    <url>/posts/4223b330/</url>
    <content><![CDATA[<h2 id="KVOçš„åŸºæœ¬ä½¿ç”¨">KVOçš„åŸºæœ¬ä½¿ç”¨</h2>
<h3 id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</h3>
<p>KVOï¼šKey Value Observingï¼ˆé”®å€¼ç›‘å¬ï¼‰ï¼Œç”¨æ¥ç›‘å¬æŸä¸ªå¯¹è±¡å±æ€§å€¼çš„æ”¹å˜ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Personç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// KVOViewController</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">KVOViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Person *person1;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Person *person2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">KVOViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">self</span>.person1 = [[Person alloc] init];</span><br><span class="line">    <span class="keyword">self</span>.person1.age = <span class="number">10</span>;</span><br><span class="line">  </span><br><span class="line">  	<span class="keyword">self</span>.person2 = [[Person alloc] init];</span><br><span class="line">    <span class="keyword">self</span>.person2.age = <span class="number">20</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSKeyValueObservingOptions</span> options = <span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionOld</span>;</span><br><span class="line">    [<span class="keyword">self</span>.person1 addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@&quot;age&quot;</span> options:options context:<span class="literal">NULL</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="keyword">self</span>.person1.age = <span class="number">11</span>;</span><br><span class="line">  	<span class="keyword">self</span>.person2.age = <span class="number">21</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="type">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSKeyValueChangeKey</span>,<span class="type">id</span>&gt; *)change context:(<span class="type">void</span> *)context &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%@å¯¹è±¡çš„%@å±æ€§å‘ç”Ÿäº†æ”¹å˜ï¼š\n%@&quot;</span>,object, keyPath,change);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼š</span></span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-15</span> <span class="number">20</span>:<span class="number">08</span>:<span class="number">33.563589</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">81675</span>:<span class="number">15955895</span>] &lt;Person: <span class="number">0x6000007519c0</span>&gt;å¯¹è±¡çš„ageå±æ€§å‘ç”Ÿäº†æ”¹å˜ï¼š</span><br><span class="line">&#123;</span><br><span class="line">    kind = <span class="number">1</span>;</span><br><span class="line">    new = <span class="number">11</span>;</span><br><span class="line">    old = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„</strong>ï¼šåœ¨ä¸éœ€è¦ç›‘å¬çš„æ—¶å€™éœ€è¦ç§»é™¤ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="type">void</span>)dealloc &#123;</span><br><span class="line">    [<span class="keyword">self</span>.person1 removeObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@&quot;age&quot;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="note green no-icon flat"><p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1115/3.png" alt="3"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1115/4.png" alt="4"></p>
<p><strong>è§£é‡Š</strong>ï¼š</p>
<p>1ã€KVOæ˜¯å»ºç«‹åœ¨KVCçš„åŸºç¡€ä¹‹ä¸Šçš„ï¼Œå³æ˜¯è¯´ç»™æˆå‘˜å˜é‡èµ‹å€¼KVOæ˜¯æ— æ³•ç›‘å¬å…¶å˜åŒ–çš„ã€‚</p>
<p>2ã€contextæ„ä¸ºä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæˆ‘ä»¬å¹³æ—¶ç”¨çš„æ—¶å€™ä¸€èˆ¬ä¼ çš„<code>NULL</code>ï¼Œä½†æ˜¯è‹¹æœå®˜æ–¹å»ºè®®çš„æ˜¯æŠŠè¿™ä¸ªå‚æ•°ç”¨èµ·æ¥ä¼šæ›´å®‰å…¨ã€æ‰©å±•æ€§æ›´å¼ºã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1115/5.png" alt="5"></p>
<p><strong>æ³¨æ„</strong>ï¼šå¯¹äºKVCèµ‹å€¼çš„ï¼Œä¸å…³æ˜¯å¦æ ¹æ®KVCæ‰¾åˆ°å¯¹åº”çš„Setteræ–¹æ³• éƒ½å¯ä»¥å®ç°KVOç›‘å¬ã€‚</p>
</div>
<h3 id="KVOå…¶ä»–ç»†èŠ‚">KVOå…¶ä»–ç»†èŠ‚</h3>
<h4 id="1ã€æ˜¯å¦æ‰“å¼€è‡ªåŠ¨è§‚å¯Ÿçš„å¼€å…³">1ã€æ˜¯å¦æ‰“å¼€è‡ªåŠ¨è§‚å¯Ÿçš„å¼€å…³</h4>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">+ (<span class="type">BOOL</span>) automaticallyNotifiesObserversForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>; <span class="comment">// é»˜è®¤æ˜¯YES</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2ã€è¿”å›å¯èƒ½å½±å“ç›‘å¬å€¼çš„NSSet">2ã€è¿”å›å¯èƒ½å½±å“ç›‘å¬å€¼çš„NSSet</h4>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å½“writtenDataå‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼ŒdownloadProgresså°±ä¼šå‘ç”Ÿæ”¹å˜</span></span><br><span class="line"><span class="operator">+</span> (<span class="type">NSSet</span>&lt;<span class="type">NSString</span> *&gt; <span class="operator">*</span>)keyPathsForValuesAffectingValueForKey:(<span class="type">NSString</span> <span class="operator">*</span>)key &#123;</span><br><span class="line">    <span class="type">NSSet</span> <span class="operator">*</span>keyPaths <span class="operator">=</span> [<span class="keyword">super</span> keyPathsForValuesAffectingValueForKey:key];</span><br><span class="line">    <span class="keyword">if</span> ([key isEqualToString:@<span class="string">&quot;downloadProgress&quot;</span>]) &#123;</span><br><span class="line">        <span class="type">NSArray</span> <span class="operator">*</span>affectingKeys <span class="operator">=</span> @[@<span class="string">&quot;writtenData&quot;</span>];  <span class="comment">// åªè¦affectingKeysæ•°ç»„é‡Œé¢çš„å±æ€§å‘ç”Ÿå˜åŒ– éƒ½ä¼šè§¦å‘downloadProgressçš„KVO</span></span><br><span class="line">        keyPaths <span class="operator">=</span> [keyPaths setByAddingObjectsFromArray:affectingKeys];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> keyPaths;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3ã€å¯¹å¯å˜æ•°ç»„çš„ç›‘å¬">3ã€å¯¹å¯å˜æ•°ç»„çš„ç›‘å¬</h4>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="keyword">self</span>.person1.booksArr = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">[<span class="keyword">self</span>.person1 addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@&quot;booksArr&quot;</span> options:<span class="built_in">NSKeyValueObservingOptionNew</span> context:<span class="literal">NULL</span>];</span><br><span class="line">[[<span class="keyword">self</span>.person1 mutableArrayValueForKey:<span class="string">@&quot;booksArr&quot;</span>] addObjectsFromArray:@[<span class="string">@&quot;Hello&quot;</span>, <span class="string">@&quot;World&quot;</span>]];</span><br></pre></td></tr></table></figure>
<p>// æ‰“å°ç»“æœï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1115/6.png" alt="6"></p>
<h2 id="KVOçš„æœ¬è´¨åˆ†æ">KVOçš„æœ¬è´¨åˆ†æ</h2>
<p>ä»ä¸Šé¢çš„ä¾‹å­å’±ä»¬å‘ç°ï¼šä¸¤ä¸ªä¸åŒçš„å¯¹è±¡<code>person1</code>å’Œ<code>person2</code>ï¼Œä¸ºä»€ä¹ˆ<code>person1</code>æ·»åŠ äº†KVOå¯ä»¥ç›‘å¬åˆ°å±æ€§å€¼çš„æ”¹å˜ï¼Ÿ</p>
<p>çœ‹èµ·æ¥<code>self.person1.age = 11</code> å’Œ <code>self.person2.age = 21</code>éƒ½æ˜¯è°ƒç”¨çš„<code>setAge:</code>æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆ<code>person1</code>å°±å¯ä»¥ç›‘å¬åˆ°å±æ€§å€¼çš„æ”¹å˜äº†å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å¤§èƒ†çŒœæµ‹ä¸€ä¸‹<code>person1</code> å’Œ<code>person2</code>çš„<code>setAge:</code>çš„å…·ä½“å®ç°è‚¯å®šä¸ä¸€æ ·äº†ï¼Œä¹Ÿå°±æ˜¯è¯´<code>person1</code>çš„<code>isa</code>å’Œ<code>person2</code>çš„<code>isa</code>æŒ‡å‘å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸‹é¢æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹æˆ‘ä»¬çš„çŒœæƒ³ã€‚</p>
<div class="note green no-icon flat"><p><strong>éªŒè¯ä¸€</strong>ï¼š</p>
<p>åœ¨<code>person1</code>æ·»åŠ KVOå‰ååˆ†åˆ«æ‰“å°<code>person1</code>å’Œ<code>person2</code>çš„<strong>classå¯¹è±¡</strong>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;person1æ·»åŠ ç›‘å¬ä¹‹å‰ï¼šperson1:%@ person2:%@&quot;</span>,object_getClass(<span class="keyword">self</span>.person1),object_getClass(<span class="keyword">self</span>.person2));</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSKeyValueObservingOptions</span> options = <span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionOld</span>;</span><br><span class="line">[<span class="keyword">self</span>.person1 addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@&quot;age&quot;</span> options:options context:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;person1æ·»åŠ ç›‘å¬ä¹‹åï¼šperson1:%@ person2:%@&quot;</span>,object_getClass(<span class="keyword">self</span>.person1),object_getClass(<span class="keyword">self</span>.person2));</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-15</span> <span class="number">20</span>:<span class="number">21</span>:<span class="number">21.161924</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">81836</span>:<span class="number">15966659</span>] person1æ·»åŠ ç›‘å¬ä¹‹å‰ï¼šperson1:Person person2:Person</span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-15</span> <span class="number">20</span>:<span class="number">21</span>:<span class="number">21.162217</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">81836</span>:<span class="number">15966659</span>] person1æ·»åŠ ç›‘å¬ä¹‹åï¼šperson1:<span class="built_in">NSKVONotifying_Person</span> person2:Person</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼šæˆ‘ä»¬å‘ç°åœ¨<code>person1</code>æ·»åŠ äº†KVOä¹‹åï¼Œ<code>person1</code>çš„<code>isa</code>æŒ‡å‘çš„æ˜¯<code>NSKVONotifying_Person</code>ç±»ï¼Œ<code>person2</code>çš„<code>isa</code>æŒ‡å‘çš„è¿˜æ˜¯<code>Person</code>ç±»ã€‚</p>
</div>
<div class="note orange no-icon flat"><p><strong>éªŒè¯äºŒ</strong>ï¼š</p>
<p>åœ¨<code>person1</code>æ·»åŠ KVOå‰ååˆ†åˆ«æ‰“å°<code>person1</code>å’Œ<code>person2</code>çš„<code>setAge:</code>æ–¹æ³•çš„å‡½æ•°åœ°å€ï¼ˆIMPï¼‰ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;person1æ·»åŠ ç›‘å¬ä¹‹å‰ï¼šperson1:%p person1:%p&quot;</span>,[<span class="keyword">self</span>.person1 methodForSelector:<span class="keyword">@selector</span>(setAge:)], [<span class="keyword">self</span>.person2 methodForSelector:<span class="keyword">@selector</span>(setAge:)]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSKeyValueObservingOptions</span> options = <span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionOld</span>;</span><br><span class="line">[<span class="keyword">self</span>.person1 addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@&quot;age&quot;</span> options:options context:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;person1æ·»åŠ ç›‘å¬ä¹‹åï¼šperson1:%p person1:%p&quot;</span>,[<span class="keyword">self</span>.person1 methodForSelector:<span class="keyword">@selector</span>(setAge:)], [<span class="keyword">self</span>.person2 methodForSelector:<span class="keyword">@selector</span>(setAge:)]);</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-15</span> <span class="number">20</span>:<span class="number">32</span>:<span class="number">28.980113</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">81977</span>:<span class="number">15975768</span>] person1æ·»åŠ ç›‘å¬ä¹‹å‰ï¼šperson1:<span class="number">0x102539e70</span> person1:<span class="number">0x102539e70</span></span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-15</span> <span class="number">20</span>:<span class="number">32</span>:<span class="number">28.980454</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">81977</span>:<span class="number">15975768</span>] person1æ·»åŠ ç›‘å¬ä¹‹åï¼šperson1:<span class="number">0x7fff207b1cfb</span> person1:<span class="number">0x102539e70</span></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼šæˆ‘ä»¬å‘ç°åœ¨<code>person1</code>æ·»åŠ äº†KVOä¹‹åï¼Œ<code>person1</code>çš„<code>IMP</code>è·Ÿ<code>person2</code>çš„<code>IMP</code>ä¸ä¸€æ ·ã€‚</p>
<p>é€šè¿‡LLDBæŒ‡ä»¤ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// person1</span></span><br><span class="line">p (IMP) <span class="number">0x7fff207b1cfb</span></span><br><span class="line">(IMP) $<span class="number">0</span> = <span class="number">0x00007fff207b1cfb</span> (Foundation`_NSSetIntValueAndNotify)</span><br><span class="line"></span><br><span class="line"><span class="comment">// person2</span></span><br><span class="line">p (IMP) <span class="number">0x102539e70</span></span><br><span class="line">(IMP) $<span class="number">1</span> = <span class="number">0x0000000102539e70</span> (OCå¯¹è±¡çš„æœ¬è´¨`-[Person setAge:] at Person.h:<span class="number">12</span>)</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼šæˆ‘ä»¬å‘ç°<code>person1</code>çš„<code>setAge:</code>æ–¹æ³•å…¶å®æ˜¯è°ƒç”¨åˆ°äº†ä¸€ä¸ªCå‡½æ•°ï¼š<code>_NSSetIntValueAndNotify</code>ã€‚</p>
</div>
<p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼š</p>
<p>1ã€æˆ‘ä»¬çœ‹åˆ°<code>person1</code>æ·»åŠ äº†KVOä¹‹åï¼Œå…¶<code>isa</code>Â æŒ‡é’ˆæŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ´¾ç”Ÿç±»<code>NSKVONotifying_Person</code>ï¼Œè¿™ä¸ªç±»æ˜¯Runtimeåœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­åŠ¨æ€åˆ›å»ºçš„ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»ç»§æ‰¿è‡ª<code>Person</code>ã€‚</p>
<p>2ã€åœ¨è¿™ä¸ªæ´¾ç”Ÿç±»é‡Œé¢è°ƒç”¨äº†Cå‡½æ•°ï¼š<code>_NSSetIntValueAndNotify</code>ã€‚</p>
<p>3ã€åœ¨<code>_NSSetIntValueAndNotify</code>é‡Œé¢å®ç°å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¼ªä»£ç </span></span><br><span class="line">[<span class="keyword">self</span> willChangeValueForKey:<span class="string">@&quot;age&quot;</span>];</span><br><span class="line">[<span class="variable language_">super</span> setAge:age];</span><br><span class="line">[<span class="keyword">self</span> didChangeValueForKey:<span class="string">@&quot;age&quot;</span>];</span><br></pre></td></tr></table></figure>
<p>4ã€åœ¨<code>didChangeValueForKey</code>æ–¹æ³•é‡Œé¢å»é€šçŸ¥ç›‘å¬å™¨æŸä¸ªå±æ€§å€¼å‘ç”Ÿäº†æ”¹å˜ã€‚</p>
<p><strong>ç”¨ä¸€å¼ å›¾æ¥åšä¸€ä¸ªæ€»ç»“</strong>ï¼š</p>
<p>æœªæ·»åŠ KVOç›‘å¬çš„å¯¹è±¡ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1115/1.png" alt="1"></p>
<p>ä½¿ç”¨KVOæ·»åŠ ç›‘å¬çš„å¯¹è±¡ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1115/2.png" alt="2"></p>
<div class="note green no-icon flat"><p><strong>æ³¨æ„</strong>ï¼š</p>
<p>é€šè¿‡<code>Runtime</code>ä¸­çš„<code>object_class</code>æ‹¿åˆ°çš„classå¯¹è±¡æ‰æ˜¯çœŸæ­£çš„classå¯¹è±¡ï¼Œé€šè¿‡<code>class</code>æ‹¿åˆ°çš„ä¸ä¸€å®šæ˜¯çœŸæ­£çš„classå¯¹è±¡ï¼Œæ¯”å¦‚ä½¿ç”¨äº†KVOç›‘å¬çš„å¯¹è±¡ã€‚</p>
</div>
<p>å¦‚ä½•éªŒè¯æ´¾ç”Ÿç±»<code>NSKVONotifing_Person</code>é‡å†™äº†å“ªäº›æ–¹æ³•ï¼Ÿ</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSKeyValueObservingOptions</span> options = <span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionOld</span>;</span><br><span class="line">[<span class="keyword">self</span>.person1 addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@&quot;age&quot;</span> options:options context:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">Class cls = object_getClass(<span class="keyword">self</span>.person1);</span><br><span class="line">[<span class="keyword">self</span> printMethodNameOfClass:cls];</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)printMethodNameOfClass:(Class)cls &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> count;</span><br><span class="line">    Method *methodList = class_copyMethodList(cls, &amp;count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        Method method = methodList[i];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,<span class="built_in">NSStringFromSelector</span>(method_getName(method)));</span><br><span class="line">    &#125;</span><br><span class="line">    free(methodList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-16</span> <span class="number">13</span>:<span class="number">36</span>:<span class="number">32.484809</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">26389</span>:<span class="number">16561796</span>] setAge:</span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-16</span> <span class="number">13</span>:<span class="number">36</span>:<span class="number">32.484965</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">26389</span>:<span class="number">16561796</span>] <span class="keyword">class</span></span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-16</span> <span class="number">13</span>:<span class="number">36</span>:<span class="number">32.485084</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">26389</span>:<span class="number">16561796</span>] dealloc</span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-16</span> <span class="number">13</span>:<span class="number">36</span>:<span class="number">32.485195</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">26389</span>:<span class="number">16561796</span>] _isKVOA</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢æ‰“å°å¯ä»¥çœ‹åˆ°ï¼š<code>NSKVONotifinh_Person</code>ç±»é‡å†™äº†<code>setAge:</code>ã€<code>class</code>ã€<code>dealloc</code>ã€<code>_isKVOA</code>æ–¹æ³•ã€‚</p>
<h2 id="KVOçš„è§¦å‘åœºæ™¯">KVOçš„è§¦å‘åœºæ™¯</h2>
<p>ä»ä¸Šé¢KVOçš„æœ¬è´¨åˆ†æå¯ä»¥çœ‹åˆ°ï¼šåªè¦æœ‰<code>setter</code>æ–¹æ³•å°±å¯ä»¥é€šè¿‡KVOæ¥ç›‘å¬å€¼çš„æ”¹å˜ï¼Œæ¯”å¦‚ï¼šå±æ€§å€¼å‘ç”Ÿæ”¹å˜ã€é€šè¿‡KVCèµ‹å€¼ã€‚</p>
<p>è¯·çœ‹ä¸‹é¢åœºæ™¯ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Personç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">@public</span></span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// KVOController</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">KVOViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Person *person;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">KVOViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">  [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line">  <span class="keyword">self</span>.person = [[Person alloc] init];</span><br><span class="line">  <span class="keyword">self</span>.person-&gt;age = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">NSKeyValueObservingOptions</span> options = <span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionOld</span>;</span><br><span class="line">  [<span class="keyword">self</span>.person addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@&quot;age&quot;</span> options:options context:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">  <span class="comment">// ä¸ä¼šè§¦å‘KVO</span></span><br><span class="line">  <span class="comment">// [self.person willChangeValueForKey:@&quot;age&quot;];</span></span><br><span class="line">  <span class="keyword">self</span>.person-&gt;age = <span class="number">11</span>;</span><br><span class="line">  <span class="comment">// [self.person didChangeValueForKey:@&quot;age&quot;];</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="type">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSKeyValueChangeKey</span>,<span class="type">id</span>&gt; *)change context:(<span class="type">void</span> *)context &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;%@å¯¹è±¡çš„%@å±æ€§å‘ç”Ÿäº†æ”¹å˜ï¼š\n%@&quot;</span>,object, keyPath,change);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)dealloc &#123;</span><br><span class="line">  [<span class="keyword">self</span>.person removeObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@&quot;age&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼š</p>
<p>é€šè¿‡<code>self.person-&gt;age = 11</code>ä¸ä¼šè§¦å‘KVOï¼ŒåŸå› ç›¸ä¿¡å¤§å®¶éƒ½å¾ˆæ¸…æ¥šäº†ï¼Œæ²¡æœ‰è°ƒç”¨<code>setter</code>ï¼Œå¯ä»¥åœ¨<code>self.person-&gt;age = 11</code>å‰ååˆ†åˆ«æ·»åŠ <code>[self.person willChangeValueForKey:@&quot;age&quot;]</code>å’Œ<code>[self.person didChangeValueForKey:@&quot;age&quot;]</code>æ¥æ‰‹åŠ¨è§¦å‘KVOã€‚</p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡KVCèµ‹å€¼<code>[self.person setValue:@11 forKey:@&quot;age&quot;]</code>ï¼Œè¿™æ ·å°±å¯ä»¥è‡ªåŠ¨è§¦å‘KVOã€‚</p>
<h2 id="å…¶ä»–è¡¥å……">å…¶ä»–è¡¥å……</h2>
<p>å¦‚ä½•æŸ¥çœ‹æŸä¸ªæ–¹æ³•çš„å‡½æ•°åœ°å€ï¼ˆIMPï¼‰ï¼Ÿ</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (IMP)methodForSelector:(SEL)aSelector;</span><br><span class="line">+ (IMP)instanceMethodForSelector:(SEL)aSelector;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘On-Demand Resourceçš„ç®€å•ä»‹ç»å’Œä½¿ç”¨</title>
    <url>/posts/132ad7d9/</url>
    <content><![CDATA[<h2 id="å…³äºOn-Demand-Resource">å…³äºOn-Demand Resource</h2>
<p>åœ¨ä¹‹å‰çš„æ–‡ç« <a href="https://codersunny.com/posts/94e6df10/">æµ…è°ˆiOSçš„åŒ…ä½“ç§¯ä¼˜åŒ–ï¼ˆä¸€ï¼‰</a>ä¸­æˆ‘ä»¬æåˆ°è¿‡On-Demand Resourceï¼Œæœ¬æ–‡ä¸»è¦æ¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹On-Demand Resourceã€‚</p>
<p>iOS9å¼•å…¥äº†ä¸€ä¸ªæ–°çš„åŠŸèƒ½ - On-Demand Resourceï¼ˆODRï¼‰ï¼Œå®ƒæ˜¯App Thinningçš„ä¸€éƒ¨åˆ†ï¼Œè¿™ä¸ªåŠŸèƒ½ç®€å•çš„è¯´å°±æ˜¯ï¼šåœ¨APPä¸‹è½½çš„æ—¶å€™ï¼ŒAPPä¸­åŒ…å«çš„ä¸é‡è¦çš„èµ„æºå¯ä»¥å…ˆä¸ä¸‹è½½ï¼Œç­‰çœŸæ­£éœ€è¦ç”¨åˆ°çš„æ—¶å€™å†å»ä¸‹è½½ï¼Œå†ç”±ç³»ç»Ÿå‘è‹¹æœçš„serverå‘é€è¯·æ±‚ï¼Œä¸‹è½½è¿™äº›èµ„æºåŒ…ã€‚</p>
<p>å…·ä½“è§<a href="https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/On_Demand_Resources_Guide/index.html#//apple_ref/doc/uid/TP40015083-CH2-SW1">è‹¹æœå®˜æ–¹æ–‡æ¡£</a></p>
<div class="note green no-icon flat"><p><strong>æ³¨æ„</strong>ï¼š</p>
<p>1ã€ ODRä¸­çš„èµ„æºæ˜¯åœ¨APPæ‰“åŒ…çš„æ—¶å€™ç¡®å®šçš„ï¼Œä¸è¿›è¡Œç‰ˆæœ¬æ›´æ–°å°±æ— æ³•æ›´æ–°è¿™äº›èµ„æºã€‚</p>
<p>2ã€ODRçš„èµ„æºæ˜¯å­˜æ”¾åœ¨è‹¹æœServerçš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†ç”¨è‡ªå·±çš„æœåŠ¡å™¨ã€‚</p>
</div>
<h2 id="On-Demand-Resourceä½¿ç”¨å‰åå®‰è£…åŒ…å˜åŒ–">On-Demand Resourceä½¿ç”¨å‰åå®‰è£…åŒ…å˜åŒ–</h2>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1108/1.png" alt="1"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1108/2.png" alt="2"></p>
<h2 id="ä½¿ç”¨ODRçš„ä¼˜ç‚¹">ä½¿ç”¨ODRçš„ä¼˜ç‚¹</h2>
<p>1ã€å¯ä»¥å‡å°åº”ç”¨çš„å¤§å°ï¼Œä½¿å¾—ä¸‹è½½æ›´å¿«ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p>
<p>2ã€ä¸€äº›å›ºå®šçš„åº”ç”¨èµ„æºæ‡’åŠ è½½</p>
<p>3ã€æ“ä½œç³»ç»Ÿä¼šåœ¨ç£ç›˜ä¸å¤Ÿçš„æ—¶å€™æ¸…ç†ODR</p>
<h2 id="æŒ‰éœ€åŠ è½½çš„èµ„æºç±»å‹">æŒ‰éœ€åŠ è½½çš„èµ„æºç±»å‹</h2>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1108/3.png" alt="3"></p>
<h2 id="ODRçš„ä½¿ç”¨">ODRçš„ä½¿ç”¨</h2>
<h3 id="ODRçš„ä¸‰ç§ç±»å‹">ODRçš„ä¸‰ç§ç±»å‹</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1108/6.png" alt="6"></p>
<p><code>initial install Tags</code>ï¼šæ­¤ç§ç±»å‹çš„èµ„æºä¼šéšç€APPä»App Storeçš„ä¸‹è½½è€Œä¸‹è½½ï¼Œä¼šå½±å“ipaçš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯´èµ„æºä¼šåŒ…å«åœ¨ipaåŒ…å†…ã€‚</p>
<p><code>Prefetched Tag Order</code>ï¼šæ­¤ç§ç±»å‹çš„èµ„æºä¼šåœ¨APPä¸‹è½½åå¼€å§‹ä¸‹è½½ä¸‹è½½ç›¸åº”çš„èµ„æºï¼Œä¸‹è½½ä¼šæœ‰å…ˆåé¡ºåºï¼Œè¿™ç§ä¸ä¼šå½±å“ipaåŒ…çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯´èµ„æºä¸åœ¨ipaåŒ…å†…ã€‚</p>
<p><code>Download Only On Demand</code>ï¼šæ­¤ç§ç±»å‹çš„èµ„æºä¼šåœ¨å¿…é¡»çš„æ—¶å€™ä¸»åŠ¨è§¦å‘ä¸‹è½½ï¼Œè¿™æ˜¯å¼€å‘è€…è‡ªå·±æ§åˆ¶ä¸‹è½½æ—¶æœºçš„ã€‚</p>
<h3 id="å¦‚ä½•è®¾ç½®ODR">å¦‚ä½•è®¾ç½®ODR</h3>
<h4 id="Build-Settings-Enable-On-Demand-Resources-è®¾ç½®ä¸ºYESï¼ˆé»˜è®¤ï¼‰">Build Settings - Enable On Demand Resources - è®¾ç½®ä¸ºYESï¼ˆé»˜è®¤ï¼‰</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1108/7.png" alt="7"></p>
<h4 id="ä¸ºèµ„æºæ·»åŠ æ ‡ç­¾">ä¸ºèµ„æºæ·»åŠ æ ‡ç­¾</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1108/8.png" alt="8"></p>
<div class="note green no-icon flat"><p><strong>è¯´æ˜</strong>ï¼š</p>
<p>1ã€æ ‡ç­¾åæ˜¯å¯ä»¥ä»»æ„å–çš„</p>
<p>2ã€ä¸€ä¸ªèµ„æºå¯ä»¥æ‰“å¤šä¸ªæ ‡ç­¾ï¼šæ¯”å¦‚level1ã€level2ç­‰</p>
</div>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1108/9.png" alt="9"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šæ‰“å®Œæ ‡ç­¾å åœ¨<code>Resource Tags</code>ä¸­ä¼šçœ‹åˆ°æ‰€æœ‰æˆ‘ä»¬åˆšæ‰“çš„æ ‡ç­¾ï¼Œæ¯”å¦‚ï¼šlevel1ã€level2ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1108/10.png" alt="10"></p>
<div class="note green no-icon flat"><p><strong>è¯´æ˜</strong>ï¼š</p>
<p>é»˜è®¤éƒ½æ˜¯åœ¨<code>Download Only On Demand</code>ç±»å‹ä¸‹ï¼Œå¯ä»¥è‡ªå·±æ‰‹åŠ¨ç§»åˆ°æƒ³è¦çš„ç±»å‹ä¸‹é¢ã€‚</p>
</div>
<h3 id="ODRçš„å…·ä½“ä½¿ç”¨">ODRçš„å…·ä½“ä½¿ç”¨</h3>
<h4 id="ç›¸å…³APIä½¿ç”¨">ç›¸å…³APIä½¿ç”¨</h4>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line">// <span class="number">1</span>.æ£€æŸ¥èµ„æºæ˜¯å¦è¢«ä¸‹è½½</span><br><span class="line">conditionallyBeginAccessingResourceWithCompletionHandler</span><br><span class="line"></span><br><span class="line">// <span class="number">2</span>.ä»APP Serverå¼€å§‹ä¸‹è½½èµ„æº</span><br><span class="line">beginAccessingResourceWithCompletionHandler</span><br></pre></td></tr></table></figure>
<h4 id="å…·ä½“ä»£ç ç‰‡æ®µ">å…·ä½“ä»£ç ç‰‡æ®µ</h4>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line">- (instancetype)init &#123;</span><br><span class="line">    <span class="keyword">if</span> (self = [super init]) &#123;</span><br><span class="line">        NSSet *tags = [NSSet setWithObjects:@<span class="string">&quot;level1&quot;</span>, nil];</span><br><span class="line">        self.resourceRequest = [[NSBundleResourceRequest alloc] initWithTags:tags bundle:[NSBundle mainBundle]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ£€æŸ¥å›¾ç‰‡èµ„æºâ€œhome_function_broadcastâ€æ˜¯å¦è¢«ä¸‹è½½ å¦‚æœå·²ç»ä¸‹è½½å°±å¯ä»¥ç›´æ¥ä½¿ç”¨</span><br><span class="line">__weak typeof(self) weakSelf = self;</span><br><span class="line">[self.resourceRequest conditionallyBeginAccessingResourcesWithCompletionHandler:^(BOOL resourcesAvailable) &#123;</span><br><span class="line">  <span class="keyword">if</span> (resourcesAvailable) &#123;</span><br><span class="line">      weakSelf.resourcesAvailable = resourcesAvailable;</span><br><span class="line">      dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">          weakSelf.imageView.image = [UIImage imageNamed:@<span class="string">&quot;home_function_broadcast&quot;</span>];</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">// å¼€å§‹ä¸‹è½½å›¾ç‰‡èµ„æº</span><br><span class="line">[self.resourceRequest beginAccessingResourcesWithCompletionHandler:^(NSError * _Nullable <span class="keyword">error</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">error</span>) &#123;</span><br><span class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            [self showAlertViewVcWithTitle:@<span class="string">&quot;å›¾ç‰‡èµ„æºä¸‹è½½å¤±è´¥...&quot;</span>];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            [self showAlertViewVcWithTitle:@<span class="string">&quot;å›¾ç‰‡èµ„æºä¸‹è½½æˆåŠŸ...&quot;</span>];</span><br><span class="line">            self.imageView.image = [UIImage imageNamed:@<span class="string">&quot;home_function_broadcast&quot;</span>];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h2 id="å†™åœ¨æœ€å-10">å†™åœ¨æœ€å</h2>
<p>å…³äºOn-Demand Resourceçš„ç®€å•ä»‹ç»å°±åˆ°è¿™é‡Œäº†ï¼Œå¸Œæœ›æœ¬æ–‡èƒ½å¯¹æ‰“å¼€æœ‰æ‰€å¸®åŠ©ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘Runtimeä¸­å¸¸ç”¨çš„ä¸€äº›APIæ±‡æ€»</title>
    <url>/posts/b38791c9/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-15">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡ä¸»è¦æ˜¯æ€»ç»“ä¸€ä¸‹åœ¨æˆ‘ä»¬æ—¥å¸¸é¡¹ç›®ä¸­ä¼šç”¨åˆ°çš„ä¸€äº›å…³äº<code>Runtime</code>çš„ç›¸å…³APIï¼Œä¾¿äºä»¥åæŸ¥é˜…ã€‚</p>
<h2 id="isMemberOfClass-å’Œ-isKindOfClass-åŒºåˆ«">isMemberOfClass å’Œ isKindOfClass åŒºåˆ«</h2>
<p>åœ¨æ­£å¼æ€»ç»“<code>Runtime</code>ä¸‹ç›¸å…³APIä¹‹å‰ï¼Œå…ˆçœ‹çœ‹<code>isMemberOfClass</code> å’Œ <code>isKindOfClass</code>çš„åŒºåˆ«ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="type">BOOL</span>)isMemberOfClass:(Class)cls;</span><br><span class="line">+ (<span class="type">BOOL</span>)isMemberOfClass:(Class)cls;</span><br><span class="line"></span><br><span class="line">- (<span class="type">BOOL</span>)isKindOfClass:(Class)cls;</span><br><span class="line">+ (<span class="type">BOOL</span>)isKindOfClass:(Class)cls;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™å‡ ä¸ªæ–¹æ³•çš„åº•å±‚å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="type">BOOL</span>)isMemberOfClass:(Class)cls &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> <span class="keyword">class</span>] == cls;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="type">BOOL</span>)isMemberOfClass:(Class)cls &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>-&gt;ISA() == cls;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">BOOL</span>)isKindOfClass:(Class)cls &#123;</span><br><span class="line">    <span class="keyword">for</span> (Class tcls = [<span class="keyword">self</span> <span class="keyword">class</span>]; tcls; tcls = tcls-&gt;getSuperclass()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tcls == cls) <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="type">BOOL</span>)isKindOfClass:(Class)cls &#123;</span><br><span class="line">    <span class="keyword">for</span> (Class tcls = <span class="keyword">self</span>-&gt;ISA(); tcls; tcls = tcls-&gt;getSuperclass()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tcls == cls) <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¾‹1ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Person ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Student ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> : <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Student</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> main(<span class="type">int</span> argc, <span class="keyword">const</span> <span class="type">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        Student *student = [[Student alloc] init];</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;1 - %d&quot;</span>,[student isMemberOfClass:[Student <span class="keyword">class</span>]]);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;2 - %d&quot;</span>,[student isKindOfClass:[Student <span class="keyword">class</span>]]);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;3 - %d&quot;</span>,[student isMemberOfClass:[Person <span class="keyword">class</span>]]);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;4 - %d&quot;</span>,[student isKindOfClass:[Person <span class="keyword">class</span>]]);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-31</span> <span class="number">16</span>:<span class="number">21</span>:<span class="number">04.801267</span>+<span class="number">0800</span> SuperDemo[<span class="number">32839</span>:<span class="number">16964367</span>] <span class="number">1</span> - <span class="number">1</span></span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-31</span> <span class="number">16</span>:<span class="number">21</span>:<span class="number">04.801310</span>+<span class="number">0800</span> SuperDemo[<span class="number">32839</span>:<span class="number">16964367</span>] <span class="number">2</span> - <span class="number">1</span></span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-31</span> <span class="number">16</span>:<span class="number">21</span>:<span class="number">04.801347</span>+<span class="number">0800</span> SuperDemo[<span class="number">32839</span>:<span class="number">16964367</span>] <span class="number">3</span> - <span class="number">0</span></span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-31</span> <span class="number">16</span>:<span class="number">21</span>:<span class="number">04.801382</span>+<span class="number">0800</span> SuperDemo[<span class="number">32839</span>:<span class="number">16964367</span>] <span class="number">4</span> - <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>ä¾‹2:</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Person ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Student ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> : <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Student</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> main(<span class="type">int</span> argc, <span class="keyword">const</span> <span class="type">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        Student *student = [[Student alloc] init];</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;1 - %d&quot;</span>,[Student isMemberOfClass:object_getClass([Student <span class="keyword">class</span>])]);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;2 - %d&quot;</span>,[Student isKindOfClass:object_getClass([Student <span class="keyword">class</span>])]);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;3 - %d&quot;</span>,[Student isMemberOfClass:object_getClass([Person <span class="keyword">class</span>])]);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;4 - %d&quot;</span>,[Student isKindOfClass:object_getClass([Person <span class="keyword">class</span>])]);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-31</span> <span class="number">16</span>:<span class="number">54</span>:<span class="number">18.561752</span>+<span class="number">0800</span> SuperDemo[<span class="number">33188</span>:<span class="number">16979322</span>] <span class="number">1</span> - <span class="number">1</span></span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-31</span> <span class="number">16</span>:<span class="number">54</span>:<span class="number">18.562298</span>+<span class="number">0800</span> SuperDemo[<span class="number">33188</span>:<span class="number">16979322</span>] <span class="number">2</span> - <span class="number">1</span></span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-31</span> <span class="number">16</span>:<span class="number">54</span>:<span class="number">18.562390</span>+<span class="number">0800</span> SuperDemo[<span class="number">33188</span>:<span class="number">16979322</span>] <span class="number">3</span> - <span class="number">0</span></span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-31</span> <span class="number">16</span>:<span class="number">54</span>:<span class="number">18.562430</span>+<span class="number">0800</span> SuperDemo[<span class="number">33188</span>:<span class="number">16979322</span>] <span class="number">4</span> - <span class="number">1</span></span><br></pre></td></tr></table></figure>
<div class="note green no-icon flat"><p><strong>æ³¨æ„</strong>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">[Student isKindOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</span><br></pre></td></tr></table></figure>
<p>ç»“æœè¿”å›çš„æ˜¯ï¼šYES å› ä¸ºNSObjectçš„isaæŒ‡å‘çš„æ˜¯è‡ªå·±ã€‚</p>
</div>
<h2 id="Runtimeä¸‹çš„ä¸€äº›å¸¸ç”¨API">Runtimeä¸‹çš„ä¸€äº›å¸¸ç”¨API</h2>
<h3 id="ç±»">ç±»</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€åˆ›å»ºä¸€ä¸ªç±»ï¼ˆå‚æ•°ï¼šçˆ¶ç±»ï¼Œç±»åï¼Œé¢å¤–çš„å†…å­˜ç©ºé—´ï¼‰</span></span><br><span class="line">Class objc_allocateClassPair(Class  _Nullable __<span class="keyword">unsafe_unretained</span> superclass, <span class="keyword">const</span> <span class="type">char</span> * _Nonnull name, size_t extraBytes)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œä¸€ä¸ªç±»ï¼ˆè¦åœ¨ç±»æ³¨å†Œä¹‹å‰æ·»åŠ æˆå‘˜å˜é‡ï¼‰</span></span><br><span class="line"><span class="type">void</span>  objc_registerClassPair(Class  _Nonnull __<span class="keyword">unsafe_unretained</span> cls)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// é”€æ¯ä¸€ä¸ªç±»</span></span><br><span class="line"><span class="type">void</span> objc_disposeClassPair(Class  _Nonnull __<span class="keyword">unsafe_unretained</span> cls)</span><br><span class="line">  </span><br><span class="line"><span class="comment">// è·å–isaæŒ‡å‘çš„Class</span></span><br><span class="line">Class object_getClass(<span class="type">id</span>  _Nullable obj)</span><br><span class="line">  </span><br><span class="line"><span class="comment">// è®¾ç½®isaæŒ‡å‘çš„Class</span></span><br><span class="line">Class object_setClass(<span class="type">id</span>  _Nullable obj, Class  _Nonnull __<span class="keyword">unsafe_unretained</span> cls)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºClass</span></span><br><span class="line">object_isClass(<span class="type">id</span>  _Nullable obj)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯å¦ä¸ºå…ƒç±»</span></span><br><span class="line">class_isMetaClass(Class  _Nullable __<span class="keyword">unsafe_unretained</span> cls)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–çˆ¶ç±»</span></span><br><span class="line">class_getSuperclass(Class  _Nullable __<span class="keyword">unsafe_unretained</span> cls)</span><br></pre></td></tr></table></figure>
<h3 id="æˆå‘˜å˜é‡">æˆå‘˜å˜é‡</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–ä¸€ä¸ªå®ä¾‹å˜é‡</span></span><br><span class="line">Ivar class_getInstanceVariable(Class  _Nullable __<span class="keyword">unsafe_unretained</span> cls, <span class="keyword">const</span> <span class="type">char</span> * _Nonnull name)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// æ‹·è´å®ä¾‹å˜é‡åˆ—è¡¨ï¼ˆæœ€åéœ€è¦è°ƒç”¨freeé‡Šæ”¾ï¼‰</span></span><br><span class="line">Ivar *class_copyIvarList(Class  _Nullable __<span class="keyword">unsafe_unretained</span> cls, <span class="type">unsigned</span> <span class="type">int</span> * _Nullable outCount)</span><br><span class="line">  </span><br><span class="line"><span class="comment">// è®¾ç½®å’Œè·å–æˆå‘˜å˜é‡çš„å€¼</span></span><br><span class="line"><span class="type">void</span> object_setIvar(<span class="type">id</span>  _Nullable obj, Ivar  _Nonnull ivar, <span class="type">id</span>  _Nullable value)</span><br><span class="line"><span class="type">id</span> object_getIvar(<span class="type">id</span>  _Nullable obj, Ivar  _Nonnull ivar)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€æ·»åŠ æˆå‘˜å˜é‡ï¼ˆå·²ç»æ³¨å†Œçš„ç±»æ˜¯ä¸èƒ½æ·»åŠ æˆå‘˜å˜é‡çš„ï¼‰</span></span><br><span class="line"><span class="type">BOOL</span>  class_addIvar(Class  _Nullable __<span class="keyword">unsafe_unretained</span> cls, <span class="keyword">const</span> <span class="type">char</span> * _Nonnull name, size_t size, uint8_t alignment, <span class="keyword">const</span> <span class="type">char</span> * _Nullable types)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æˆå‘˜å˜é‡çš„ç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">const</span> <span class="type">char</span> *ivar_getName(Ivar  _Nonnull v)</span><br><span class="line"><span class="keyword">const</span> <span class="type">char</span> *ivar_getTypeEncoding(Ivar  _Nonnull v)</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•">æ–¹æ³•</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–ä¸€ä¸ªå®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•</span></span><br><span class="line">Method class_getInstanceMethod(Class  _Nullable __<span class="keyword">unsafe_unretained</span> cls, SEL  _Nonnull name)</span><br><span class="line">Method class_getClassMethod(Class  _Nullable __<span class="keyword">unsafe_unretained</span> cls, SEL  _Nonnull name)</span><br><span class="line">  </span><br><span class="line"><span class="comment">// æ–¹æ³•å®ç°ç›¸å…³æ“ä½œ</span></span><br><span class="line">IMP class_getMethodImplementation(Class  _Nullable __<span class="keyword">unsafe_unretained</span> cls, SEL  _Nonnull name)</span><br><span class="line">IMP method_setImplementation(Method  _Nonnull m, IMP  _Nonnull imp)</span><br><span class="line"><span class="type">void</span> method_exchangeImplementations(Method  _Nonnull m1, Method  _Nonnull m2)</span><br><span class="line">  </span><br><span class="line"><span class="comment">// æ‹·è´æ–¹æ³•åˆ—è¡¨ï¼ˆæœ€åéœ€è¦é€šè¿‡freeæ¥é‡Šæ”¾ï¼‰</span></span><br><span class="line">Method *class_copyMethodList(Class  _Nullable __<span class="keyword">unsafe_unretained</span> cls, <span class="type">unsigned</span> <span class="type">int</span> * _Nullable outCount)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€æ·»åŠ æ–¹æ³•</span></span><br><span class="line"><span class="type">BOOL</span> class_addMethod(Class  _Nullable __<span class="keyword">unsafe_unretained</span> cls, SEL  _Nonnull name, IMP  _Nonnull imp, <span class="keyword">const</span> <span class="type">char</span> * _Nullable types)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€æ›¿æ¢æ–¹æ³•</span></span><br><span class="line">IMP class_replaceMethod(Class  _Nullable __<span class="keyword">unsafe_unretained</span> cls, SEL  _Nonnull name, IMP  _Nonnull imp, <span class="keyword">const</span> <span class="type">char</span> * _Nullable types)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ–¹æ³•çš„ç›¸å…³ä¿¡æ¯ï¼ˆå¸¦copyçš„éœ€è¦è°ƒç”¨freeå»é‡Šæ”¾ï¼‰</span></span><br><span class="line">SEL method_getName(Method  _Nonnull m)</span><br><span class="line">IMP method_getImplementation(Method  _Nonnull m)</span><br><span class="line"><span class="keyword">const</span> <span class="type">char</span> *method_getTypeEncoding(Method  _Nonnull m)</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> method_getNumberOfArguments(Method  _Nonnull m)</span><br><span class="line"><span class="type">char</span> *method_copyReturnType(Method  _Nonnull m)</span><br><span class="line"><span class="type">char</span> *method_copyArgumentType(Method  _Nonnull m, <span class="type">unsigned</span> <span class="type">int</span> index)</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€‰æ‹©å™¨ç›¸å…³</span></span><br><span class="line"><span class="keyword">const</span> <span class="type">char</span> *sel_getName(SEL  _Nonnull sel)</span><br><span class="line">SEL sel_registerName(<span class="keyword">const</span> <span class="type">char</span> * _Nonnull str)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨blockä½œä¸ºæ–¹æ³•å®ç°</span></span><br><span class="line">IMP imp_implementationWithBlock(<span class="type">id</span>  _Nonnull block)</span><br><span class="line"><span class="type">id</span> imp_getBlock(IMP  _Nonnull anImp)</span><br><span class="line"><span class="type">BOOL</span> imp_removeBlock(IMP  _Nonnull anImp)</span><br></pre></td></tr></table></figure>
<h2 id="å¦‚ä½•æ‹¦æˆªæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶">å¦‚ä½•æ‹¦æˆªæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶</h2>
<p>hookï¼šå¯ä»¥ç†è§£ä¸ºå°±æ˜¯æ–¹æ³•äº¤æ¢ã€‚</p>
<p>æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ ä¼šè°ƒç”¨åˆ°UIControlçš„<code>- (void)sendAction:(SEL)action to:(nullable id)target forEvent:(nullable UIEvent *)event</code>è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>æ‹¦æˆªæŒ‰é’®çš„ç‚¹å‡»æˆ‘ä»¬åªéœ€è¦æ‹¦æˆª<code>sendAction</code>å³å¯ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">+ (<span class="type">void</span>)load &#123;</span><br><span class="line">    Method method1 = class_getInstanceMethod(<span class="keyword">self</span>, <span class="keyword">@selector</span>(sendAction:to:forEvent:));</span><br><span class="line">    Method method2 = class_getInstanceMethod(<span class="keyword">self</span>, <span class="keyword">@selector</span>(ww_sendAction:to:forEvent:));</span><br><span class="line">    method_exchangeImplementations(method1, method2); <span class="comment">// è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¹‹åä¼šå»æ¸…ç©ºä¹‹å‰çš„ç¼“å­˜</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)ww_sendAction:(SEL)action to:(<span class="type">id</span>)target forEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span> isKindOfClass:<span class="built_in">UIButton</span>.class]) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;æˆ‘æˆåŠŸhookäº†æŒ‰é’®...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="keyword">self</span> ww_sendAction:action to:target forEvent:event]; <span class="comment">// è°ƒç”¨åŸæ¥çš„sendAction</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Runtimeæ€»ç»“">Runtimeæ€»ç»“</h2>
<p>Runtimeåœ¨å®é™…å¼€å‘ä¸­å¯èƒ½ç”¨åˆ°çš„åœºæ™¯ï¼š</p>
<ul>
<li>
<p>åˆ©ç”¨å…³è”å¯¹è±¡ç»™åˆ†ç±»æ·»åŠ å±æ€§</p>
</li>
<li>
<p>éå†æŸä¸ªç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼ˆå¯ä»¥è®¿é—®ç§æœ‰çš„æˆå‘˜å˜é‡ æ¯”å¦‚ä¿®æ”¹UITextFieldçš„å ä½label/ å­—å…¸è½¬æ¨¡å‹/ å½’æ¡£è§£æ¡£ï¼‰</p>
</li>
<li>
<p>äº¤æ¢æ–¹æ³•å®ç°ï¼ˆä¸»è¦æ˜¯äº¤æ¢ç³»ç»Ÿçš„æ–¹æ³• åˆ©ç”¨æ–¹æ³•äº¤æ¢åšæ–¹æ³•æ‰¾ä¸åˆ°å¯¼è‡´çš„å´©æºƒï¼‰</p>
<p>â€¦</p>
</li>
</ul>
<h2 id="å†™åœ¨æœ€å-11">å†™åœ¨æœ€å</h2>
<p>å…³äºRuntimeä¸­å¸¸ç”¨çš„ä¸€äº›å¸¸ç”¨çš„APIå°±æ€»ç»“åˆ°è¿™é‡Œï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ iOSé‡å­¦ã€‘class_rw_ext_tç»“æ„è¯¦è§£</title>
    <url>/posts/8948fead/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-16">å†™åœ¨å‰é¢</h2>
<p>åœ¨<a href="https://codersunny.com/posts/b55a18a8/">iOSé‡å­¦ä¹‹çª¥æ¢Classçš„ç»“æ„</a>è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åˆ†æClassçš„ç»“æ„æ—¶æåˆ°äº†ä¸€ä¸ªç»“æ„<code>class_rw_ext_t</code>ï¼Œæœ¬æ–‡ä¸»è¦å°±è¿™ä¸ªç»“æ„æ¥å±•å¼€åšä¸ªè¯¦ç»†çš„åˆ†æï¼Œä»¥åŠè‹¹æœä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšã€‚</p>
<h2 id="class-rw-ext-tç»“æ„">class_rw_ext_tç»“æ„</h2>
<h3 id="ç®€å•ä»‹ç»-2">ç®€å•ä»‹ç»</h3>
<p>åœ¨WWDC2020ä¸­è‹¹æœä»‹ç»å¯¹ç±»çš„ä¿®æ”¹æ—¶å‡ºç°äº†ä¸€ä¸ªæ–°çš„ç»“æ„ï¼š<code>class_rw_ext_t</code>ï¼Œè¿™ä¸ªç»“æ„ä¸»è¦æ˜¯Runtimeåœ¨å†…å­˜ä¸Šåšçš„ä¸€äº›ä¼˜åŒ–è€Œå‡ºç°çš„ï¼Œåœ¨è‹¹æœæºç objc4_781ç‰ˆæœ¬å¼€å§‹å‡ºç°<code>class_rw_ext_t</code>ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥å¯¹ç…§æºç æ¥é˜…è¯»æœ¬æ–‡ã€‚</p>
<h3 id="clean-memory-å’Œ-dirty-memory">clean memory å’Œ dirty memory</h3>
<p>clean memoryï¼šåŠ è½½åä¸ä¼šå†å‘ç”Ÿå˜åŒ–çš„å†…å­˜ã€‚</p>
<p>dirty memoryï¼šæŒ‡çš„æ˜¯åœ¨è¿›ç¨‹è¿è¡Œæ—¶ä¼šå‘ç”Ÿæ›´æ”¹çš„å†…å­˜ã€‚</p>
<div class="note red no-icon flat"><p><strong>æç¤º</strong>ï¼š</p>
<p>dirty memoryä¼šæ¯”clean memoryæ›´åŠ æ¶ˆè€—æ€§èƒ½å’Œå†…å­˜ï¼Œdirty memoryæ˜¯åªè¦è¿›ç¨‹åœ¨è¿è¡Œï¼Œå®ƒå°±å¿…é¡»ä¸€ç›´å­˜åœ¨ï¼Œè€Œclean memoryå¯ä»¥åœ¨å†…å­˜åƒç´§çš„æ—¶å€™ç§»é™¤æ¥èŠ‚çœæ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œåœ¨éœ€è¦çš„æ—¶å€™å†æ¬¡ä»ç£ç›˜ä¸­è¿›è¡ŒåŠ è½½ã€‚</p>
</div>
<h3 id="class-rw-t-å’Œ-class-ro-t">class_rw_t å’Œ class_ro_t</h3>
<p>åœ¨<code>class_rw_ext_t</code>ç»“æ„ä¹‹å‰ï¼Œæ•´ä½“Class ç»“æ„æ˜¯ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1124/1.png" alt="1"></p>
<p>ä»ä¸Šé¢çš„ç»“æ„æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Classç»“æ„è¢«æ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š<code>class_rw_t</code> å’Œ <code>class_ro_t</code>ï¼Œè¿™ä¹ˆæ‹†åˆ†çš„åŸå› å°±æ˜¯ä¸ºäº†ä¿æŒæ›´å¤šçš„clean memoryï¼Œä»è€ŒèŠ‚çœå†…å­˜ç©ºé—´ï¼Œå…¶ä¸­<code>class_rw_t</code>æ˜¯dirty memoryï¼Œè€Œ<code>class_ro_t</code>å°±æ˜¯clean memoryã€‚</p>
<div class="note red no-icon flat"><p><strong>è§£é‡Š</strong>ï¼š</p>
<p>åœ¨æ²¡æœ‰<code>class_rw_ext_t</code>ç»“æ„ä¹‹å‰ï¼Œå½“ä¸€ä¸ªç±»è¢«è£…è½½åˆ°å†…å­˜ä¸­æ—¶å°±ä¼šåˆå§‹åŒ–ä¸€ä¸ª<code>class_rw_t</code>ç»“æ„ï¼Œå¹¶å°†<code>class_ro_t</code>ç»“æ„ä¸­<code>Methods</code>ã€<code>Properties</code>ã€<code>Protocols</code>æ•°æ®å¤åˆ¶åˆ°<code>class_rw_t</code>ä¸­ï¼Œæˆ‘ä»¬ä¸Šé¢æåˆ°è¿‡<code>class_rw_t</code>å±äºdirty memoryï¼Œåœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™è¿™å—å†…å­˜å°±å¿…é¡»ä¸€ç›´å­˜åœ¨ï¼Œä½†æ˜¯å¤§æ¦‚90%çš„ç±»å¹¶ä¸éœ€è¦å¯¹å…¶ä¸­çš„<code>Methods</code>è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†çš„å†…å­˜å…¶å®å°±æ˜¯å±äºæµªè´¹ï¼Œäºæ˜¯è‹¹æœæ‹†åˆ†å‡ºæ¥ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ï¼š<code>class_rw_ext_t</code>ã€‚</p>
</div>
<p>åœ¨<code>class_rw_ext_t</code>ç»“æ„ä¹‹åï¼Œæ•´ä½“Classç»“æ„æ˜¯ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1124/2.png" alt="2"></p>
<p>ä»ä¸Šé¢çš„ç»“æ„å›¾çœ‹åˆ°ï¼šè‹¹æœå°½å¯èƒ½çš„å‡å°‘dirty memoryçš„å¤§å°æ¥é™ä½å†…å­˜å¼€é”€ã€‚ä»–æŠŠ<code>Methods</code>ã€<code>Properties</code>ã€<code>Protocols</code>ã€<code>Demangled Name</code>æ‹†åˆ†åˆ°æ–°çš„ç»“æ„<code>class_rw_ext_t</code>ä¸­ï¼Œè¿™é‡Œçš„<code>ext</code>å¯ä»¥ç†è§£ä¸ºextensionï¼ˆæ‰©å±•ï¼‰ã€‚</p>
<div class="note red no-icon flat"><p><strong>è§£é‡Š</strong>ï¼š</p>
<p>åœ¨æœ‰äº†<code>class_rw_ext_t</code>ç»“æ„ä¹‹åï¼Œå½“ä¸€ä¸ªç±»è¢«è£…è½½åˆ°å†…å­˜ä¸­æ—¶å°±ä¼šåˆå§‹åŒ–ä¸€ä¸ª<code>class_rw_t</code>ç»“æ„ï¼Œä½†æ˜¯å¹¶ä¸ä¼šæŠŠ<code>class_ro_t</code>ä¸­çš„ç›¸å…³æ•°æ®å®Œå…¨å¤åˆ¶åˆ°å…¶ä¸­ï¼Œè¿™æ ·å°±å‡å°‘äº†<code>class_rw_t</code>çš„å¤§å°ï¼Œåˆ©ç”¨æ‡’åŠ è½½çš„æœºåˆ¶åœ¨ç¡®å®éœ€è¦é¢å¤–çš„ç±»çš„ä¿¡æ¯çš„æ—¶å€™å†å»åˆå§‹åŒ–<code>class_rw_ext_t</code>ç»“æ„æ¥å­˜æ”¾è¿™äº›ä¿¡æ¯ã€‚</p>
</div>
<h3 id="éªŒè¯å†…å­˜å˜åŒ–">éªŒè¯å†…å­˜å˜åŒ–</h3>
<p>ä½¿ç”¨å‘½ä»¤<code>heap xxx | egrep 'class_rw|COUNT'</code>æ¥æŸ¥çœ‹ä¸€äº›è¿›ç¨‹ä¸­<code>class_rw</code>ç±»çš„å†…å­˜æƒ…å†µï¼Œåšä¸»è¿™é‡Œä»¥å¾®ä¿¡å’ŒXcodeä¸ºä¾‹æ¥çœ‹çœ‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1124/3.png" alt="3"></p>
<p>ä»ä¸Šå›¾çœ‹åˆ°ï¼š</p>
<p>WeChatä¸­ä¸€å…±æœ‰6418ä¸ª<code>class_rw_t</code>ç±»ï¼Œä½†æ˜¯çœŸçš„éœ€è¦é¢å¤–æ‰©å±•<code>class_rw_ext_t</code>çš„åªæœ‰474ä¸ªï¼Œè¿™ä¸ªæ¯”ä¾‹å¤§æ¦‚æ˜¯7%ï¼Œæˆ‘ä»¬å¤§æ¦‚è®¡ç®—ä¸€ä¸‹èŠ‚çœçš„å†…å­˜ï¼š(6418 - 474) * 48 = 285312(B)ã€‚</p>
<p>Xcodeä¸­ä¸€å…±æœ‰15674ä¸ª<code>class_rw_t</code>ç±»ï¼Œä½†æ˜¯çœŸçš„éœ€è¦é¢å¤–æ‰©å±•<code>class_rw_ext_t</code>çš„åªæœ‰2375ä¸ª,è¿™ä¸ªæ¯”ä¾‹å¤§æ¦‚æ˜¯15%ï¼ŒèŠ‚çœçš„å†…å­˜ï¼šï¼ˆ15674 - 2375ï¼‰ * 48 = 638352(B)ã€‚</p>
<p>å¯¹dirty memoryè€Œè¨€ï¼Œè¿™æ˜¯çœŸæ­£èŠ‚çœçš„å†…å­˜ï¼Œæ‰€ä»¥è¿™ä¸ªä¼˜åŒ–è¿˜æ˜¯å¾ˆå¯è§‚çš„ã€‚</p>
<h3 id="æŸ¥æ‰¾æ–¹æ³•çš„å˜åŒ–">æŸ¥æ‰¾æ–¹æ³•çš„å˜åŒ–</h3>
<p>åœ¨<code>class_rw_ext_t</code>ç»“æ„ä¹‹å‰ï¼Œruntimeæ˜¯ç›´æ¥éå†<code>class_rw_t</code>ä¸­çš„æ–¹æ³•åˆ—è¡¨æ¥æŸ¥æ‰¾æ–¹æ³•ï¼Œå…·ä½“å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1124/4.png" alt="4"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1124/5.png" alt="5"></p>
<p>åœ¨<code>class_rw_ext_t</code>ç»“æ„ä¹‹åï¼ŒruntimeæŸ¥æ‰¾æ–¹æ³•çš„æ–¹å¼å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1124/6.png" alt="6"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1124/7.png" alt="7"></p>
<h2 id="å†™åœ¨æœ€å-12">å†™åœ¨æœ€å</h2>
<p>å…³äº<code>class_rw_ext_t</code>ç»“æ„çš„åˆ†æå’Œå¥½å¤„æˆ‘ä»¬å°±åˆ†æåˆ°è¿™é‡Œäº†ï¼Œå¦‚æœæœ‰ä»€ä¹ˆä¸å¯¹çš„åœ°æ–¹æœ›æŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
        <tag>Runtime</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘ä¸€ç¯‡æ–‡ç« è®²æ¸…æ¥š+loadå’Œ+initialize</title>
    <url>/posts/8f7262c3/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-17">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡ä¸»è¦ä»åº•å±‚æºç ä¸Šæ¥åˆ†æä¸€ä¸‹<code>+load</code>å’Œ<code>+initialize</code>æ–¹æ³•çš„è°ƒç”¨é¡ºåºä»¥åŠå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚</p>
<h2 id="load">+load</h2>
<p><code>+load</code>æ–¹æ³•ä¼šåœ¨<code>Runtime</code>åŠ è½½ç±»ã€åˆ†ç±»çš„æ—¶å€™è°ƒç”¨ï¼Œæ¯ä¸ªç±»ã€åˆ†ç±»çš„<code>+load</code>æ–¹æ³•åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åªä¼šè°ƒç”¨ä¸€æ¬¡ã€‚</p>
<h3 id="loadçš„åŸºæœ¬ä½¿ç”¨">+loadçš„åŸºæœ¬ä½¿ç”¨</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Person ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// Person + Test1 ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> (<span class="title">Test1</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">Test1</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Person + Test2 ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> (<span class="title">Test2</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">Test2</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Student ç±» ç»§æ‰¿è‡ªPerson</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> : <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Student</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Student + Test1 ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> (<span class="title">Test1</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Student</span> (<span class="title">Test1</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Student + Test2 ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> (<span class="title">Test2</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Student</span> (<span class="title">Test2</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢åœºæ™¯ï¼Œ<code>+load</code>æ–¹æ³•çš„æ‰“å°é¡ºåºä¸ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-28</span> <span class="number">09</span>:<span class="number">50</span>:<span class="number">34.392232</span>+<span class="number">0800</span> CategoryDemo[<span class="number">88835</span>:<span class="number">2251283</span>] +[Person load]</span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-28</span> <span class="number">09</span>:<span class="number">50</span>:<span class="number">34.392867</span>+<span class="number">0800</span> CategoryDemo[<span class="number">88835</span>:<span class="number">2251283</span>] +[Student load]</span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-28</span> <span class="number">09</span>:<span class="number">50</span>:<span class="number">34.392964</span>+<span class="number">0800</span> CategoryDemo[<span class="number">88835</span>:<span class="number">2251283</span>] +[Animal load]</span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-28</span> <span class="number">09</span>:<span class="number">50</span>:<span class="number">34.393013</span>+<span class="number">0800</span> CategoryDemo[<span class="number">88835</span>:<span class="number">2251283</span>] +[Student(Test1) load]</span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-28</span> <span class="number">09</span>:<span class="number">50</span>:<span class="number">34.393056</span>+<span class="number">0800</span> CategoryDemo[<span class="number">88835</span>:<span class="number">2251283</span>] +[Person(Test1) load]</span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-28</span> <span class="number">09</span>:<span class="number">50</span>:<span class="number">34.393107</span>+<span class="number">0800</span> CategoryDemo[<span class="number">88835</span>:<span class="number">2251283</span>] +[Student(Test2) load]</span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-28</span> <span class="number">09</span>:<span class="number">50</span>:<span class="number">34.393151</span>+<span class="number">0800</span> CategoryDemo[<span class="number">88835</span>:<span class="number">2251283</span>] +[Person(Test2) load]</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼Œå®ƒä»¬ä¹‹é—´ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ ·çš„ä¸€ä¸ªåŠ è½½é¡ºåºå‘¢ï¼Ÿ</p>
<h3 id="loadçš„åº•å±‚æºç ">+loadçš„åº•å±‚æºç </h3>
<p><code>+load</code>æ–¹æ³•çš„æºç æŸ¥çœ‹é¡ºåºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// objc-osæ–‡ä»¶</span></span><br><span class="line"><span class="number">1.</span> _objc_init</span><br><span class="line"><span class="number">2.</span> load_images</span><br><span class="line"></span><br><span class="line"><span class="comment">// objc-runtime-newæ–‡ä»¶</span></span><br><span class="line"><span class="number">3.</span> prepare_load_methods</span><br><span class="line">  <span class="number">3.1</span> schedule_class_load</span><br><span class="line">  <span class="number">3.2</span> add_category_to_loadable_list</span><br><span class="line"><span class="number">4.</span> call_load_methods</span><br><span class="line">  <span class="number">4.1</span> call_class_loads - (*load_method)(cls, <span class="keyword">@selector</span>(load))</span><br><span class="line">  <span class="number">4.2</span> call_category_loads</span><br></pre></td></tr></table></figure>
<p>åœ¨<a href="https://codersunny.com/posts/dfd029e5/">ã€iOSé‡å­¦ã€‘Categoryçš„åº•å±‚åŸç†</a>ä¸­åšä¸»æåˆ°<code>Runtime</code>å…¥å£å°±æ˜¯ï¼š<code>objc-os</code>æ–‡ä»¶ä¸­çš„<code>_objc_init</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å°±ä»è¿™é‡Œå…¥æ‰‹åˆ†æä¸€ä¸‹åº•å±‚æºç ã€‚</p>
<p><code>prepare_load_methods</code>æ–¹æ³•æºç å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1128/1.png" alt="1"></p>
<div class="note green no-icon flat"><p><strong>è§£é‡Š</strong>ï¼š</p>
<p>1ã€å…ˆæŒ‰ç…§ç¼–è¯‘é¡ºåºå°†æ‰€æœ‰çš„ç±»<code>add_class_to_loadable_list</code>è£…è½½åˆ°<code>loadable_classes</code>çš„æ•°ç»„ä¸­ã€‚</p>
<p>2ã€å†æŒ‰ç…§ç¼–è¯‘é¡ºåºå°†æ‰€æœ‰çš„åˆ†ç±»<code>add_class_to_loadable_list</code>è£…è½½åˆ°<code>loadable_classes</code>çš„æ•°ç»„ä¸­ã€‚</p>
</div>
<p><code>schedule_class_load</code>æ–¹æ³•æºç å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1128/2.png" alt="2"></p>
<div class="note green no-icon flat"><p><strong>è§£é‡Š</strong>ï¼š</p>
<p>åœ¨è£…è½½ç±»åˆ°<code>loadable_classes</code>æ•°ç»„ä¸­æ—¶ï¼Œå¦‚æœå­˜åœ¨çˆ¶ç±»ï¼Œå…ˆå°†çˆ¶ç±»è£…è½½åˆ°<code>loadable_classes</code>ä¸­ï¼Œå†å°†ç±»åŠ è½½åˆ°æ•°ç»„ä¸­ã€‚</p>
</div>
<p><code>call_load_methods</code>æ–¹æ³•æºç å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1128/3.png" alt="3"></p>
<div class="note green no-icon flat"><p><strong>è§£é‡Š</strong>ï¼š</p>
<p>åœ¨è°ƒç”¨<code>+load</code>æ–¹æ³•æ—¶ï¼Œå…ˆè°ƒç”¨ç±»çš„<code>+load</code>æ–¹æ³•å†è°ƒç”¨åˆ†ç±»çš„<code>+load</code>æ–¹æ³•ã€‚</p>
</div>
<h3 id="loadçš„è°ƒç”¨é¡ºåºæ€»ç»“">+loadçš„è°ƒç”¨é¡ºåºæ€»ç»“</h3>
<div class="note green no-icon flat"><p>1ã€å…ˆè°ƒç”¨ç±»çš„<code>+load</code></p>
<p>â€‹	1.1 æŒ‰ç…§ç¼–è¯‘é¡ºåºè¿›è¡Œè°ƒç”¨ï¼ˆå…ˆç¼–è¯‘ -&gt; å…ˆè°ƒç”¨ï¼‰</p>
<p>â€‹	1.2 è°ƒç”¨å­ç±»<code>+load</code>ä¹‹å‰ä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„<code>+load</code></p>
<p>2ã€å†è°ƒç”¨åˆ†ç±»çš„<code>+load</code></p>
<p>â€‹	2.1 æŒ‰ç…§ç¼–è¯‘é¡ºåºè¿›è¡Œè°ƒç”¨ï¼ˆå…ˆç¼–è¯‘ -&gt; å…ˆè°ƒç”¨ï¼‰</p>
<p><strong>æ³¨æ„</strong>ï¼š<code>+load</code>åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œæ¯”å¦‚<code>Student</code>åœ¨<code>Person</code>ä¹‹å‰ç¼–è¯‘ï¼Œä¼šå…ˆè°ƒç”¨<code>Person</code>çš„<code>+load</code>æ–¹æ³•ï¼Œè¡¨ç¤º<code>Person</code>å·²ç»è¢«è£…è½½è¿›å†…å­˜äº†ï¼Œæ‰€ä»¥<code>+load</code>ä¸ä¼šè¢«è°ƒç”¨å¤šæ¬¡ã€‚</p>
</div>
<h3 id="loadçš„è°ƒç”¨æ–¹å¼">+loadçš„è°ƒç”¨æ–¹å¼</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1128/4.png" alt="4"></p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> loadable_class &#123;</span><br><span class="line">    Class cls;  <span class="comment">// may be nil</span></span><br><span class="line">    IMP method; <span class="comment">// è¿™ä¸ªmethod å°±æ˜¯+loadçš„IMP è¿™ä¸ªloadable_classå°±æ˜¯ç”¨æ¥åŠ è½½ç±»çš„ç»“æ„ä½“</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šå›¾<code>call_class_loads</code>æ–¹æ³•æ‰€ç¤ºï¼Œ<code>+load</code>æ–¹æ³•çš„è°ƒç”¨æ–¹å¼æ˜¯ï¼šç›´æ¥æ ¹æ®<code>+load</code>æ–¹æ³•çš„å‡½æ•°åœ°å€ç›´æ¥å»è°ƒç”¨ã€‚</p>
<h2 id="initialize">+initialize</h2>
<p><code>+initialize</code>æ–¹æ³•ä¼šåœ¨ç±»ç¬¬ä¸€æ¬¡æ¥æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™è°ƒç”¨ã€‚</p>
<h3 id="initializeçš„åŸºæœ¬ä½¿ç”¨">+initializeçš„åŸºæœ¬ä½¿ç”¨</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Person ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// Person + Test1 ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> (<span class="title">Test1</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">Test1</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Person + Test2 ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> (<span class="title">Test2</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">Test2</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Student ç±» ç»§æ‰¿è‡ªPerson</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> : <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Student</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Student + Test1 ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> (<span class="title">Test1</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Student</span> (<span class="title">Test1</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Student + Test2 ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> (<span class="title">Test2</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Student</span> (<span class="title">Test2</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢åœºæ™¯ï¼Œ<code>+initialize</code>æ–¹æ³•çš„æ‰“å°é¡ºåºä¸ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-28</span> <span class="number">18</span>:<span class="number">00</span>:<span class="number">10.526685</span>+<span class="number">0800</span> CategoryDemo[<span class="number">57742</span>:<span class="number">2613672</span>] +[Person(Test2) initialize]</span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-28</span> <span class="number">18</span>:<span class="number">00</span>:<span class="number">10.527249</span>+<span class="number">0800</span> CategoryDemo[<span class="number">57742</span>:<span class="number">2613672</span>] +[Student(Test2) initialize]</span><br></pre></td></tr></table></figure>
<h3 id="initializeçš„åº•å±‚æºç ">+initializeçš„åº•å±‚æºç </h3>
<p><code>+initialize</code>æ–¹æ³•æºç çš„æŸ¥çœ‹é¡ºåºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// objc-runtime-new.mmæ–‡ä»¶</span></span><br><span class="line"><span class="number">1.</span> class_getInstanceMethod</span><br><span class="line"><span class="number">2.</span> lookUpImpOrForward</span><br><span class="line"><span class="number">3.</span> realizeAndInitializeIfNeeded_locked</span><br><span class="line"><span class="number">4.</span> initializeAndLeaveLocked</span><br><span class="line"><span class="number">5.</span> initializeAndMaybeRelock</span><br><span class="line"><span class="number">6.</span> initializeNonMetaClass</span><br><span class="line"><span class="number">7.</span> callInitialize</span><br></pre></td></tr></table></figure>
<p><code>initializeNonMetaClass</code>æ–¹æ³•æºç å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1128/5.png" alt="5"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1128/6.png" alt="6"></p>
<div class="note green no-icon flat"><p><strong>è§£é‡Š</strong>ï¼š</p>
<p>ä»ä¸Šé¢çš„æºç æˆ‘ä»¬å¤§æ¦‚å¯ä»¥çœ‹åˆ°ï¼šåœ¨è°ƒç”¨<code>callInitialize</code>æ–¹æ³•ä¹‹å‰ä¼šå»æ£€æŸ¥æ˜¯å¦å­˜åœ¨çˆ¶ç±»å’Œçˆ¶ç±»æ˜¯å¦è¢«åˆå§‹åŒ–ï¼Œä¼šå…ˆå»è°ƒç”¨çˆ¶ç±»çš„<code>+initialize</code>æ–¹æ³•ã€‚</p>
</div>
<h3 id="initializeçš„è°ƒç”¨é¡ºåºæ€»ç»“">+initializeçš„è°ƒç”¨é¡ºåºæ€»ç»“</h3>
<div class="note green no-icon flat"><p>å…ˆè°ƒç”¨çˆ¶ç±»çš„<code>+initialize</code>ï¼Œå†è°ƒç”¨å­ç±»çš„<code>+initialize</code>ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<p>1ã€å…ˆåˆå§‹åŒ–çˆ¶ç±»å†åˆå§‹åŒ–å­ç±»ï¼Œæ¯ä¸ªç±»åªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä½†æ˜¯å¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢åœºæ™¯ï¼š</p>
<p>1.<code>Student</code>æ²¡æœ‰å®ç°<code>+initialize</code>æ–¹æ³•ï¼Œè°ƒç”¨<code> [Person alloc]</code> <code> [Student alloc]</code>ä¼šè°ƒç”¨ä¸¤æ¬¡<code>Person</code> çš„<code>+initialize</code>æ–¹æ³•ã€‚</p>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-28</span> <span class="number">18</span>:<span class="number">01</span>:<span class="number">47.579047</span>+<span class="number">0800</span> CategoryDemo[<span class="number">57804</span>:<span class="number">2615728</span>] +[Person(Test2) initialize]</span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-28</span> <span class="number">18</span>:<span class="number">01</span>:<span class="number">47.579702</span>+<span class="number">0800</span> CategoryDemo[<span class="number">57804</span>:<span class="number">2615728</span>] +[Person(Test2) initialize]</span><br></pre></td></tr></table></figure>
<p>2.<code>Student</code>å®ç°äº†<code>+initialize</code>æ–¹æ³•ï¼Œ<code>Person</code>è°ƒç”¨è¿‡äº†<code>+initialize</code>ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå†è°ƒç”¨äº†ã€‚</p>
</div>
<h3 id="initializeè°ƒç”¨æ–¹å¼">+initializeè°ƒç”¨æ–¹å¼</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> callInitialize(Class cls)</span><br><span class="line">&#123;</span><br><span class="line">    ((<span class="type">void</span>(*)(Class, SEL))objc_msgSend)(cls, <span class="keyword">@selector</span>(initialize));</span><br><span class="line">    <span class="keyword">asm</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šå›¾<code>callInitialize</code>æ–¹æ³•æ‰€ç¤ºï¼Œ<code>+initialize</code>æ–¹æ³•çš„è°ƒç”¨æ–¹å¼æ˜¯ï¼š<code>obj_msgSend</code>ã€‚</p>
<h2 id="loadå’Œ-initializeå¯¹æ¯”">+loadå’Œ+initializeå¯¹æ¯”</h2>
<p>1ã€è°ƒç”¨æ—¶æœºï¼š</p>
<p><code>+load</code>æ˜¯åœ¨<code>Runtime</code>åŠ è½½ç±»ã€åˆ†ç±»çš„æ—¶å€™è°ƒç”¨ï¼ˆåªä¼šè°ƒç”¨ä¸€æ¬¡ï¼‰ï¼Œåœ¨<code>main</code>å‡½æ•°ä¹‹å‰ã€‚</p>
<p><code>+initialize</code>æ˜¯åœ¨ç±»ç¬¬ä¸€æ¬¡æ¥æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™è°ƒç”¨ï¼Œåªä¼šåˆå§‹åŒ–ä¸€æ¬¡ï¼ˆçˆ¶ç±»çš„<code>+initialize</code>å¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼‰ï¼Œåœ¨<code>main</code>å‡½æ•°ä¹‹åã€‚</p>
<p>2ã€è°ƒç”¨æ–¹å¼ï¼š</p>
<p><code>+load</code>æ˜¯æ ¹æ®å‡½æ•°åœ°å€ç›´æ¥è°ƒç”¨ã€‚</p>
<p><code>+initialize</code>æ˜¯é€šè¿‡<code>objc_msgSend</code>è°ƒç”¨ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘ä¸€ç¯‡æ–‡ç« è®²æ¸…æ¥šsuper</title>
    <url>/posts/d1a1e187/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-18">å†™åœ¨å‰é¢</h2>
<p>ç»å¸¸åœ¨ç½‘ä¸Šçœ‹åˆ°<code>[super xxx]</code>è¿™ç§è¾“å‡ºä»€ä¹ˆå†…å®¹ç­‰ç±»ä¼¼çš„é¢è¯•é¢˜ï¼Œæœ¬æ–‡å°±ä¸»è¦æ¥è¯¦ç»†å‰–æä¸€ä¸‹è¿™ç§<code>[super xxx]</code>ä¸­<code>super</code>è°ƒç”¨çš„åº•å±‚åŸç†ã€‚</p>
<h2 id="åœºæ™¯">åœºæ™¯</h2>
<p>åšä¸»è¿™é‡Œç”¨ä¸€ä¸ªå¸¸çœ‹åˆ°çš„é¢è¯•é¢˜æ¥å¼•å‡ºæœ¬æ–‡çš„ä¸»é¢˜ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Personç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Studentç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> : <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Student</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="variable language_">super</span> init]) &#123;</span><br><span class="line">        [<span class="variable language_">super</span> <span class="keyword">class</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;1 - %@&quot;</span>,[<span class="keyword">self</span> <span class="keyword">class</span>]);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;2 - %@&quot;</span>,[<span class="variable language_">super</span> <span class="keyword">class</span>]);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;3 - %@&quot;</span>,[<span class="keyword">self</span> superclass]);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;4 - %@&quot;</span>,[<span class="variable language_">super</span> superclass]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-30</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">51.753257</span>+<span class="number">0800</span> SuperDemo[<span class="number">27224</span>:<span class="number">16387952</span>] <span class="number">1</span> - Student</span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-30</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">51.754489</span>+<span class="number">0800</span> SuperDemo[<span class="number">27224</span>:<span class="number">16387952</span>] <span class="number">2</span> - Student</span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-30</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">51.754682</span>+<span class="number">0800</span> SuperDemo[<span class="number">27224</span>:<span class="number">16387952</span>] <span class="number">3</span> - Person</span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-30</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">51.754821</span>+<span class="number">0800</span> SuperDemo[<span class="number">27224</span>:<span class="number">16387952</span>] <span class="number">4</span> - Person</span><br></pre></td></tr></table></figure>
<p>ç»“æœåˆ†æï¼š</p>
<div class="note green no-icon flat"><p><code>[super class]</code> å’Œ <code>[self superclass]</code>æ‰“å°ç»“æœåˆ†åˆ«ä¸º<code>Student</code> å’Œ <code>Person</code>æ¯«æ— ç–‘é—®ã€‚</p>
<p>å¯èƒ½å¤§å®¶æ¯”è¾ƒå¥½å¥‡ä¸ºä»€ä¹ˆ<code>[super class]</code> å’Œ <code>[super superclass]</code> çš„æ‰“å°ç»“æœä¾ç„¶æ˜¯<code>Student</code> å’Œ <code>Person</code>ã€‚</p>
</div>
<p>æˆ‘ä»¬è¿™é‡Œä»¥<code>[super class]</code>ä¸ºä¾‹æ¥çœ‹å…¶åº•å±‚ç»“æ„ï¼š</p>
<p>ç”¨å‘½ä»¤<code> xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc -fobjc-arc -fobjc-runtime=ios-10.0.0 Student.m</code>å°†Student.mæ–‡ä»¶è½¬åŒ–ä¸ºc++æ–‡ä»¶ï¼Œ<code>[super class]</code>åº•å±‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">((<span class="built_in">Class</span> (*)(__rw_objc_super *, SEL))(<span class="type">void</span> *)objc_msgSendSuper)((__rw_objc_super)&#123;(id)self, (id)<span class="built_in">class_getSuperclass</span>(<span class="built_in">objc_getClass</span>(<span class="string">&quot;Student&quot;</span>))&#125;, <span class="built_in">sel_registerName</span>(<span class="string">&quot;class&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>ç®€åŒ–ä¹‹åä¸ºï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">objc_msgSendSuper</span>(__rw_objc_super&#123;</span><br><span class="line">			self,</span><br><span class="line">			<span class="built_in">class_getSuperclass</span>(<span class="built_in">objc_getClass</span>(<span class="string">&quot;Student&quot;</span>))</span><br><span class="line">&#125;,<span class="built_in">sel_registerName</span>(<span class="string">&quot;class&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†è®©å¤§å®¶æ›´æ–¹ä¾¿ç†è§£ï¼Œæœ€ç»ˆç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">__rw_objc_super</span> arg = &#123;</span><br><span class="line">			self,</span><br><span class="line">			<span class="built_in">class_getSuperclass</span>(<span class="built_in">objc_getClass</span>(<span class="string">&quot;Student&quot;</span>))</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">objc_msgSendSuper</span>(arg,<span class="built_in">sel_registerName</span>(<span class="string">&quot;class&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>åœ¨æºç ä¸­æˆ‘ä»¬æœç´¢ä¸€ä¸‹<code>objc_super</code>ç»“æ„ä½“ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/01/30/1.png" alt="1"></p>
<p>ä»ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š<code>[super class]</code>ä¸­æ¶ˆæ¯æ¥æ”¶è€…è¿˜æ˜¯<code>self</code>ä¹Ÿå°±æ˜¯è¯´è¿˜æ˜¯<code>Student</code>ï¼ŒåŒç†<code>[super superclas]</code>æ‰“å°ç»“æœè¿˜æ˜¯<code>Person</code>ã€‚</p>
<h2 id="å†™åœ¨æœ€å-13">å†™åœ¨æœ€å</h2>
<p>å…³äº<code>super</code>è°ƒç”¨æœ¬è´¨çš„åŸç†æˆ‘ä»¬åœ¨è¿™ç‰‡æ–‡ç« å°±åˆ†ææ¸…æ¥šäº†ï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘ä»LCSåˆ°IGListKitæ¡†æ¶ä¸­çš„Diffç®—æ³•ï¼ˆä¸Šï¼‰</title>
    <url>/posts/da46549b/</url>
    <content><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯LCS">ä»€ä¹ˆæ˜¯LCS</h2>
<h3 id="å­åºåˆ—">å­åºåˆ—</h3>
<p>å‡è®¾æœ‰ä¸¤ä¸ªåºåˆ— <em>X, Z</em>ï¼š</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mo>&lt;</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>3</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>x</mi><mi>m</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">X = &lt;x_1,x_2,x_3,......x_m&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">......</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mo>&lt;</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>3</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>y</mi><mi>n</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">Y = &lt;y_1,y_2,y_3,......y_n&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">......</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p>è‹¥ <em>Z</em> åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½èƒ½åœ¨ <em>X</em> ä¸­æ‰¾åˆ°ï¼Œå¹¶ä¸”æ˜¯<strong>ä¸¥æ ¼é€’å¢</strong>çš„ï¼Œé‚£ä¹ˆå°±ç§° <em>Z</em> æ˜¯ <em>X</em> çš„å­åºåˆ—ã€‚</p>
<h3 id="å…¬å…±å­åºåˆ—">å…¬å…±å­åºåˆ—</h3>
<p><em>Z</em> æ—¢æ˜¯ <em>X</em> çš„å­åºåˆ—ï¼Œ ä¹Ÿæ˜¯ <em>Y</em> çš„å­åºåˆ—ï¼Œåˆ™ç§° <em>Xï¼ŒY</em> çš„<strong>å…¬å…±å­åºåˆ—</strong>æ˜¯ <em>Z</em>ï¼Œå…¬å…±å­åºåˆ—é•¿åº¦ä¸ºå…ƒç´ çš„ä¸ªæ•°ã€‚</p>
<h3 id="æœ€é•¿å…¬å…±å­åºåˆ—">æœ€é•¿å…¬å…±å­åºåˆ—</h3>
<p>æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆ<em>Longest Common SubSequence</em>ï¼‰ï¼Œç®€ç§° <em>LCS</em>ï¼ŒæŒ‡çš„æ˜¯ä¸¤ä¸ªåºåˆ—ä¸­å…ƒç´ ä¸ªæ•°<strong>æœ€å¤š</strong>çš„å…¬å…±å­åºåˆ—ã€‚</p>
<h2 id="LCSçš„å¹¿æ³›åº”ç”¨"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span>çš„å¹¿æ³›åº”ç”¨</h2>
<p><em>LCS</em> æ˜¯ä¸€ä¸ªç»å…¸çš„è®¡ç®—æœºç§‘å­¦é—®é¢˜ï¼Œä¹Ÿæ˜¯æ•°æ®æ¯”è¾ƒç¨‹åºï¼ŒLCSä¸»è¦åº”ç”¨åœ¨ï¼š</p>
<ul>
<li>Gitç­‰ç‰ˆæœ¬æ§åˆ¶ä¸­æ–‡ä»¶çš„å¯¹æ¯”</li>
<li>ä¸€äº›åšå›¾ç‰‡ã€æ–‡ä»¶ã€æ–‡æœ¬ç­‰å¯¹æ¯”çš„è½¯ä»¶</li>
<li>IGListKitæ¡†æ¶ä¸­çš„Diffç®—æ³•æ¥åšUICollectionViewçš„åˆ·æ–°</li>
</ul>
<h2 id="å¦‚ä½•æ±‚ä¸¤ä¸ªåºåˆ—çš„LCS">å¦‚ä½•æ±‚ä¸¤ä¸ªåºåˆ—çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span></h2>
<p>ç»™å®šä¸¤ä¸ªåºåˆ—ï¼š</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mo>&lt;</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>3</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>x</mi><mi>m</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">X = &lt;x_1,x_2,x_3,......x_m&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">......</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mo>&lt;</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>3</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>y</mi><mi>n</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">Y = &lt;y_1,y_2,y_3,......y_n&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">......</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p>æ±‚ <em>Xï¼ŒY</em> çš„æœ€é•¿å…¬å…±å­åºåˆ—ã€‚</p>
<h3 id="è›®åŠ›ç®—æ³•">è›®åŠ›ç®—æ³•</h3>
<p>ä¾æ¬¡æ£€æŸ¥ <em>X</em> ä¸­çš„æ¯ä¸ªå­åºåˆ—åœ¨ <em>Y</em> ä¸­æ˜¯å¦å‡ºç°ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><msup><mn>2</mn><mi>m</mi></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n2^m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<blockquote>
<p><strong>åˆ†æ</strong>ï¼šè¿™ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯ä¸€ä¸ªæŒ‡æ•°çº§ï¼Œå¾ˆæ˜æ˜¾è¿™ä¸ªç®—æ³•æ˜¯ä¸åˆé€‚çš„ã€‚</p>
</blockquote>
<h3 id="åŠ¨æ€è§„åˆ’ç®—æ³•">åŠ¨æ€è§„åˆ’ç®—æ³•</h3>
<p><strong>ä¸€</strong>ã€å­é—®é¢˜ç•Œå®š</p>
<p>å‡è®¾ <em>X</em> åºåˆ—ç»ˆæ­¢ä½ç½®ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> ï¼Œ<em>Y</em> åºåˆ—ç»ˆæ­¢ä½ç½®ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> ï¼š</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mo>&lt;</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>3</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>x</mi><mi>i</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">X = &lt;x_1,x_2,x_3,......x_i&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">......</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mo>&lt;</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>3</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>y</mi><mi>j</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">Y = &lt;y_1,y_2,y_3,......y_j&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8252em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">......</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220609/2022060901.png" alt="2022060901"></p>
<p><strong>äºŒ</strong>ã€å­é—®é¢˜ä¹‹é—´çš„ä¾èµ–å…³ç³»</p>
<p>è®¾<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mo>&lt;</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>3</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>x</mi><mi>m</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">X = &lt;x_1,x_2,x_3,......x_m&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">......</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mo>&lt;</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>3</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>y</mi><mi>n</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">Y = &lt;y_1,y_2,y_3,......y_n&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">......</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>=</mo><mo>&lt;</mo><msub><mi>z</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>z</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>z</mi><mn>3</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>z</mi><mi>k</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">Z = &lt;z_1,z_2,z_3,......z_k&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">......</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span> ä¸º <em>X</em> å’Œ <em>Y</em> çš„ <em>LCS</em>ï¼Œé‚£ä¹ˆï¼š</p>
<p>ï¼ˆä¸€ï¼‰å¦‚æœ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>m</mi></msub><mo>=</mo><msub><mi>y</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_m = y_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> =&gt; <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>k</mi></msub><mo>=</mo><msub><mi>x</mi><mi>m</mi></msub><mo>=</mo><msub><mi>y</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">z_k = x_m = y_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œåˆ™<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">Z_{k-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mi>m</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">X_{m-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">Y_{n-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>çš„ <em>LCS</em>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220609/2022060902.png" alt="2022060902"></p>
<p>ï¼ˆäºŒï¼‰å¦‚æœ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>m</mi></msub><mo mathvariant="normal">â‰ </mo><msub><mi>y</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_m \neq y_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel">î€ </span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>k</mi></msub><mo mathvariant="normal">â‰ </mo><msub><mi>x</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">z_k \neq x_m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel">î€ </span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> =&gt; <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span></span></span></span> æ˜¯ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mi>m</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">X_{m-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">Y_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220609/2022060903.png" alt="2022060903"></p>
<p>ï¼ˆä¸‰ï¼‰å¦‚æœ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>m</mi></msub><mo mathvariant="normal">â‰ </mo><msub><mi>y</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_m \neq y_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel">î€ </span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>k</mi></msub><mo mathvariant="normal">â‰ </mo><msub><mi>y</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">z_k \neq y_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel">î€ </span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> =&gt; <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span></span></span></span> æ˜¯ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">X_m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">Y_{n-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220609/2022060904.png" alt="2022060904"></p>
<p><strong>ä¸‰</strong>ã€é€’æ¨æ–¹ç¨‹</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> ä¸ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> çš„å­åºåˆ—ï¼š</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>i</mi></msub><mo>=</mo><mo>&lt;</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>3</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>x</mi><mi>i</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">X_i = &lt;x_1,x_2,x_3,......x_i&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">......</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>j</mi></msub><mo>=</mo><mo>&lt;</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>3</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>y</mi><mi>j</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">Y_j = &lt;y_1,y_2,y_3,......y_j&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8252em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">......</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>P</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">DP[i,j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span>æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">X_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">Y_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span> çš„é•¿åº¦ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥å¾—åˆ°é€’æ¨æ–¹ç¨‹ä¸ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>D</mi><mi>P</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>è‹¥</mtext><mi>i</mi><mo>=</mo><mn>0</mn><mtext>æˆ–</mtext><mi>j</mi><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>D</mi><mi>P</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mn>1</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>è‹¥</mtext><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>&gt;</mo><mn>0</mn><mo separator="true">,</mo><msub><mi>x</mi><mi>i</mi></msub><mo>=</mo><msub><mi>y</mi><mi>j</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">{</mo><mi>D</mi><mi>P</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo separator="true">,</mo><mi>D</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">}</mo><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>è‹¥</mtext><mi>x</mi><mo separator="true">,</mo><mi>j</mi><mo>=</mo><mn>0</mn><mo separator="true">,</mo><msub><mi>x</mi><mi>i</mi></msub><mo mathvariant="normal">â‰ </mo><msub><mi>y</mi><mi>j</mi></msub></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">DP[i,j] =
\begin{cases}
0,&amp;è‹¥i = 0 æˆ– j = 0\\
DP[i-1,j-1]+1, &amp;è‹¥i,j &gt; 0,x_i = y_j\\
max\{DP[i,j-1],Dp[i-1,j]\}, &amp;è‹¥ x,j = 0, x_i \ne y_j
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:4.32em;vertical-align:-1.91em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35em;"><span style="top:-2.2em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â©</span></span></span><span style="top:-2.192em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.316em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.316em' style='width:0.8889em' viewBox='0 0 888.89 316' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V316 H384z M384 0 H504 V316 H384z'/></svg></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â¨</span></span></span><span style="top:-4.292em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.316em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.316em' style='width:0.8889em' viewBox='0 0 888.89 316' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V316 H384z M384 0 H504 V316 H384z'/></svg></span></span><span style="top:-4.6em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â§</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.85em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mpunct">,</span></span></span><span style="top:-1.53em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]}</span><span class="mpunct">,</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.91em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord cjk_fallback">è‹¥</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span><span class="mord cjk_fallback">æˆ–</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord cjk_fallback">è‹¥</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.53em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord cjk_fallback">è‹¥</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel">î€ </span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.91em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<h2 id="æ±‚è§£LCSçš„å…·ä½“å®ä¾‹">æ±‚è§£<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span>çš„å…·ä½“å®ä¾‹</h2>
<p><strong>ä¾‹1</strong>ï¼šä¸¤ä¸ªåºåˆ—</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mo>&lt;</mo><mi>A</mi><mo separator="true">,</mo><mi>D</mi><mo separator="true">,</mo><mi>F</mi><mo separator="true">,</mo><mi>G</mi><mo separator="true">,</mo><mi>T</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">X = &lt;A,D,F,G,T&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">G</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mo>&lt;</mo><mi>A</mi><mo separator="true">,</mo><mi>F</mi><mo separator="true">,</mo><mi>O</mi><mo separator="true">,</mo><mi>X</mi><mo separator="true">,</mo><mi>T</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">Y = &lt;A,F,O,X,T&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p>æ±‚ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220609/2022060905.png" alt="2022060905"></p>
<p>å¯ä»¥å¾—åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span> ä¸ºï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>A</mi><mo separator="true">,</mo><mi>F</mi><mo separator="true">,</mo><mi>T</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&lt;A,F,T&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span>ï¼Œ é•¿åº¦ä¸º3ã€‚</p>
<p>å…·ä½“æ±‚è§£ç®—æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestCommonSubsequence</span><span class="params">(String text1, String text2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> text1.length(), n = text2.length();</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m + <span class="number">1</span>][n + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (text1.charAt(i - <span class="number">1</span>) == text2.charAt(j - <span class="number">1</span>)) &#123;</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                dp[i][j] = Math.max(dp[i - <span class="number">1</span>][j], dp[i][j]);</span><br><span class="line">                dp[i][j] = Math.max(dp[i][j - <span class="number">1</span>], dp[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m][n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ—¶é—´å¤æ‚åº¦ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p>å¤§å®¶è¦æœ‰å…´è¶£ï¼Œä¹Ÿå¯ä»¥ä¸Š<a href="https://leetcode.cn/">LeetCode</a>ä¸Šæ‰¾åˆ°è¿™ä¸ªæ±‚è§£ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span> çš„ç®—æ³•é¢˜ç»ƒä¹ å¤§å®¶çš„ç®—æ³•ã€‚</p>
<h2 id="ä»LCS-åˆ°Diff">ä»<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span> åˆ°Diff</h2>
<p>å¦‚æœæˆ‘ä»¬ä»”ç»†è§‚å¯Ÿä¼šä»ä¸Šå›¾ä¸­å¾—åˆ°ä¸€ä¸ªç‰¹åˆ«æœ‰æ„æ€çš„åœ°æ–¹ï¼Œç°åœ¨æˆ‘ä»¬å‡è®¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mo>&lt;</mo><mi>A</mi><mo separator="true">,</mo><mi>D</mi><mo separator="true">,</mo><mi>F</mi><mo separator="true">,</mo><mi>G</mi><mo separator="true">,</mo><mi>T</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">X = &lt;A,D,F,G,T&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">G</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span> ä¸ºæ—§æ•°æ®ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mo>&lt;</mo><mi>A</mi><mo separator="true">,</mo><mi>F</mi><mo separator="true">,</mo><mi>O</mi><mo separator="true">,</mo><mi>X</mi><mo separator="true">,</mo><mi>T</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">Y = &lt;A,F,O,X,T&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span> ä¸ºæ–°æ•°æ®ï¼Œå†ç»“åˆä¸Šå›¾ç”¨<strong>è“è‰²ç®­å¤´</strong>æ ‡è®°å‡ºæ¥çš„è·¯çº¿å›¾ä»<strong>å³ä¸‹è§’</strong>å¼€å§‹è§‚å¯Ÿä¼šå‘ç°ï¼š</p>
<ul>
<li>ä»<label style="color:green">å·¦ä¸Šè§’</label>èµ°çš„å•å…ƒé‡Œçš„å…ƒç´ æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> éƒ½å­˜åœ¨çš„å…ƒç´ ï¼Œé‚£ä¹ˆæ—§æ•°æ®é‡Œçš„è¿™ä¸ªå…ƒç´ ä¼šé€šè¿‡Moveæˆ–Reloadå˜æˆæ–°æ•°æ®çš„å…ƒç´ ã€‚</li>
<li>ä»<label style="color:green">å·¦è¾¹</label>èµ°çš„å•å…ƒé‡Œçš„å…ƒç´ è¡¨ç¤º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> é‡Œé¢æ²¡æœ‰ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>é‡Œé¢æœ‰çš„å…ƒç´ ï¼Œé‚£ä¹ˆå°±ä¼šé€šè¿‡Insertæ“ä½œå°†å…ƒç´ æ’å…¥æ–°æ•°æ®é‡Œé¢ã€‚</li>
<li>ä»<label style="color:green">ä¸Šè¾¹</label>èµ°çš„å•å…ƒé‡Œçš„å…ƒç´ è¡¨ç¤º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>é‡Œé¢æœ‰ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>é‡Œé¢æ²¡æœ‰çš„å…ƒç´ ï¼Œé‚£ä¹ˆå°±ä¼šé€šè¿‡Deleteæ“ä½œå°†å…ƒç´ ä»æ—§æ•°æ®é‡Œé¢åˆ é™¤ã€‚</li>
</ul>
<p>æœ€åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°æ—§æ•°æ®<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> å˜æˆæ–°æ•°æ® <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> çš„æ‰€æœ‰å…ƒç´ çš„æ“ä½œå¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>Reload</strong>ï¼šAã€T</li>
<li><strong>Insert</strong>ï¼šOã€X</li>
<li><strong>Delete</strong>ï¼šDã€G</li>
<li><strong>Move</strong>ï¼šF</li>
</ul>
<h2 id="LCS-å­˜åœ¨çš„é—®é¢˜"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span> å­˜åœ¨çš„é—®é¢˜</h2>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥å†æ¥ç®€å•çš„çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mo>&lt;</mo><mi>A</mi><mo separator="true">,</mo><mi>D</mi><mo separator="true">,</mo><mi>F</mi><mo separator="true">,</mo><mi>G</mi><mo separator="true">,</mo><mi>T</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">X = &lt;A,D,F,G,T&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">G</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mo>&lt;</mo><mi>A</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi>O</mi><mo separator="true">,</mo><mi>X</mi><mo separator="true">,</mo><mi>F</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">Y = &lt;A,T,O,X,F&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p>æ±‚ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220609/2022060906.png" alt="2022060906"></p>
<p>å¯ä»¥å¾—åˆ° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span> ä¸ºï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>A</mi><mo separator="true">,</mo><mi>F</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&lt;A,F&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span> æˆ– <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>A</mi><mo separator="true">,</mo><mi>T</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&lt;A,T&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span> ï¼Œé•¿åº¦ä¸º2ã€‚</p>
<p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å‘ç°å…ƒç´ çš„æ“ä½œå¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>Reload</strong>ï¼šA</li>
<li><strong>Insert</strong>ï¼šTã€Oã€X</li>
<li><strong>Delete</strong>ï¼šDã€Gã€T</li>
<li><strong>Move</strong>ï¼šF</li>
</ul>
<p>æˆ‘ä»¬ä¼šå‘ç°<strong>å…ƒç´ T</strong>æ—¢è¿›è¡Œäº†Deleteæ“ä½œä¹Ÿè¿›è¡Œäº†Insertæ“ä½œï¼Œä½†æ˜¯å´æ²¡æœ‰Moveæ“ä½œï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼šå½“ä¸¤ä¸ªåºåˆ—å­˜åœ¨å¤šä¸ª<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span> çš„æ—¶å€™ï¼Œåªä¼šå–å…¶ä¸­çš„ä¸€ç»„ï¼Œå…¶ä»–çš„åªèƒ½è¿›è¡ŒDeleteæˆ–Insertæ“ä½œã€‚</p>
<p><strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span> å­˜åœ¨çš„é—®é¢˜ï¼š</strong></p>
<ul>
<li>è™½ç„¶é€šè¿‡åŠ¨æ€è§„åˆ’çš„ç®—æ³•å°†æ—¶é—´å¤æ‚åº¦é™ä½åˆ°äº†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> ï¼Œä½†æ˜¯å½“<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶é—´å¤æ‚åº¦ä¾ç„¶æ¯”è¾ƒå¯æ€•ã€‚</li>
<li>å¸Œæœ›å¯¹æ–°ã€æ—§æ•°æ®éƒ½å­˜åœ¨çš„å…ƒç´ çš„Moveè¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œè€Œä¸æ˜¯ç®€å•çš„Deleteã€Insertæ“ä½œã€‚</li>
</ul>
<h2 id="æœ€å-7">æœ€å</h2>
<p>é—®é¢˜æˆ‘ä»¬å·²ç»æŠ›å‡ºæ¥äº†ï¼Œæˆ‘ä»¬å¦‚ä½•è§£å†³ä¸Šé¢çš„ä¸¤ä¸ªé—®é¢˜ï¼Œåœ¨é™ä½æ—¶é—´å¤æ‚åº¦çš„åŒæ—¶å¯¹Moveæ“ä½œè¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†è°ˆåˆ°iOSä¸­IGListKitæ¡†æ¶ä¸­çš„Diffæ˜¯å¦‚ä½•å·§å¦™è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜çš„ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>LCS</tag>
        <tag>IGListKit</tag>
        <tag>Diff</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘ä»LCSåˆ°IGListKitæ¡†æ¶ä¸­çš„Diffç®—æ³•ï¼ˆä¸‹ï¼‰</title>
    <url>/posts/62fa33fe/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-19">å†™åœ¨å‰é¢</h2>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://codersunny.com/%E4%BB%8ELCS%E5%88%B0IGListKit%E6%A1%86%E6%9E%B6%E4%B8%AD%E7%9A%84Diff%E7%AE%97%E6%B3%95%EF%BC%88%E4%B8%8A%EF%BC%89/">ä»LCSåˆ°IGListKitæ¡†æ¶ä¸­çš„Diffç®—æ³•ï¼ˆä¸Šï¼‰</a>ä¸­æˆ‘ä»¬è¯¦ç»†è®²äº† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span> æ˜¯ä»€ä¹ˆã€æ€ä¹ˆä½¿ç”¨åŠ¨æ€è§„åˆ’æ¥æ±‚è§£ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span> ï¼Œæœ€åæˆ‘ä»¬ä¹ŸæŠ›å‡ºäº† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span> è¿˜å­˜åœ¨çš„ä¸¤ä¸ªé—®é¢˜ï¼Œæœ¬ç¯‡æ–‡ç« æˆ‘ä»¬å°±ä¸»è¦æ¥åˆ†æIGListKitæ¡†æ¶ä¸­çš„Diffæ˜¯å¦‚ä½•æ¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜çš„ã€‚</p>
<blockquote>
<p><strong>æ¸©é¦¨æç¤º</strong>ï¼šæœ¬æ–‡ä¸»è¦å‰–æIGListKitæ¡†æ¶ä¸­çš„Diffç®—æ³•ï¼Œä¸ä¼šè®²IGListKitæ¡†æ¶çš„å…·ä½“ä½¿ç”¨ã€‚</p>
</blockquote>
<h2 id="LCS-å­˜åœ¨çš„é—®é¢˜å¸¦æ¥çš„æ€è€ƒ"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span> å­˜åœ¨çš„é—®é¢˜å¸¦æ¥çš„æ€è€ƒ</h2>
<p>ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬æå‡ºäº† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span> å­˜åœ¨çš„ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ä½†æ˜¯å½“nç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> è¿™ä¸ªæ—¶é—´å¤æ‚åº¦ä¾ç„¶æ¯”è¾ƒå¯æ€•ã€‚</li>
<li>å¸Œæœ›å¯¹æ–°ã€æ—§æ•°æ®éƒ½å­˜åœ¨çš„å…ƒç´ çš„Moveè¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œè€Œä¸æ˜¯ç®€å•çš„Deleteã€Insertæ“ä½œã€‚</li>
</ul>
<p>Instagramå›¢é˜Ÿçš„IGListKitæ¡†æ¶ç»“åˆPaul Heckelâ€™s Diffï¼ˆ1978å¹´ï¼‰çš„<a href="https://dl.acm.org/doi/10.1145/359460.359467">ä¸€ç¯‡è®ºæ–‡</a>åšäº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œä½¿ç”¨ä¸€äº›é¢å¤–çš„å†…å­˜ç©ºé—´ï¼ŒæŠŠæ—¶é—´å¤æ‚åº¦é™ä½åˆ°äº†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> ï¼Œå¹¶ä¸”èƒ½å¤Ÿå‡†ç¡®è·å–æ•°æ®å…ƒç´ çš„Move/Insertç­‰æ“ä½œã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜ä»¥ä¸Šä¸€ç¯‡æ–‡ç« çš„ä¸¤ä¸ªåºåˆ—ä¸ºä¾‹ï¼š</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mo>&lt;</mo><mi>A</mi><mo separator="true">,</mo><mi>D</mi><mo separator="true">,</mo><mi>F</mi><mo separator="true">,</mo><mi>G</mi><mo separator="true">,</mo><mi>T</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">X = &lt;A,D,F,G,T&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">G</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mo>&lt;</mo><mi>A</mi><mo separator="true">,</mo><mi>T</mi><mo separator="true">,</mo><mi>O</mi><mo separator="true">,</mo><mi>X</mi><mo separator="true">,</mo><mi>F</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">Y = &lt;A,T,O,X,F&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p>
<p>æ±‚ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">LCS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span></span></span></span></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/2022060906.png" alt="2022060906"></p>
<p>æˆ‘ä»¬é¦–å…ˆéœ€è¦å¤„ç†çš„æ˜¯é¿å…ä½¿ç”¨äºŒç»´æ•°ç»„ï¼Œæˆ‘ä»¬ç»“åˆä¸Šå›¾ä¼šå‘ç°é‡è¦çš„åªæ˜¯æˆ‘ä»¬æ ‡è®°çš„è¿™æ¡çº¿è·¯ï¼Œå…¶ä»–ä½ç½®æˆ‘ä»¬å¹¶æ²¡æœ‰ç”¨åˆ°ï¼Œé‚£ä¹ˆéœ€è¦èµ°ä¸€éçš„è·ç¦»å°±æ˜¯ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>+</mo><mi>n</mi><mo>âˆ’</mo><mi>L</mi><mi>C</mi><mi>S</mi><mtext>çš„é•¿åº¦</mtext></mrow><annotation encoding="application/x-tex">m + n - LCSçš„é•¿åº¦</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span><span class="mord cjk_fallback">çš„é•¿åº¦</span></span></span></span></p>
<p>æ‰€ä»¥ï¼Œè‚¯å®šè¦èµ°è¿‡æ‰€æœ‰å»é‡ä¹‹åçš„å…ƒç´ ï¼Œä»”ç»†æ€è€ƒä¸€ä¸‹ï¼Œå¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p><label style="color:green">æˆ‘ä»¬éœ€è¦çš„æ˜¯å…ƒç´ åœ¨æ–°æ•°æ®å’Œæ—§æ•°æ®é‡Œé¢çš„ä½ç½®ã€‚</label></p>
<h2 id="IGListKitæ¡†æ¶çš„åˆ·æ–°æµç¨‹">IGListKitæ¡†æ¶çš„åˆ·æ–°æµç¨‹</h2>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220610/2022061001.png" alt="2022061001"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220610/2022061002.png" alt="2022061002"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220610/2022061003.png" alt="2022061003"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220610/2022061004.png" alt="2022061004"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220610/2022061005.png" alt="2022061005"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220610/2022061006.png" alt="2022061006"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220610/2022061007.png" alt="2022061007"></p>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»è·Ÿè¸ªåˆ°IGListKitæ¡†æ¶åˆ·æ–°æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ï¼š<strong>IGListDiffç±»ä¸­çš„IGListDiffingå‡½æ•°</strong>ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æœ¬æ–‡çš„é‡ç‚¹äº†ï¼šIGListDiffæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p>
<h2 id="IGListDiffç®—æ³•è¯¦è§£">IGListDiffç®—æ³•è¯¦è§£</h2>
<p>åœ¨ç†è§£Diffç®—æ³•ä¹‹å‰æˆ‘ä»¬å…ˆæ¥ç†Ÿæ‚‰å‡ ä¸ªæ•°æ®ç»“æ„ã€å‡½æ•°ä½“ï¼š<code>IGListIndexSetResult</code>ã€<code>IGListEntry</code>ã€<code>IGListRecord</code>ã€<code>IGListDiffable</code>ã€<code>IGListMoveIndex</code>ã€‚</p>
<h3 id="IGListMoveIndex">IGListMoveIndex</h3>
<p><code>IGListMoveIndex</code> å°è£…çš„æ˜¯ä¸€ä¸ªç§»åŠ¨çš„æ“ä½œï¼Œ<code>from</code>æ˜¯æ—§æ•°ç»„çš„ç´¢å¼•ï¼Œ<code>to</code>æ˜¯æ–°æ•°ç»„çš„ç´¢å¼•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">IGListMoveIndex</span> : <span class="title">NSObject</span></span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// æ—§æ•°ç»„çš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>, <span class="keyword">readonly</span>) <span class="built_in">NSInteger</span> from;</span><br><span class="line"><span class="comment">// æ–°æ•°ç»„çš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>, <span class="keyword">readonly</span>) <span class="built_in">NSInteger</span> to;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="IGListIndexSetResult">IGListIndexSetResult</h3>
<p><code>IGListIndexSetResult</code>å°è£…çš„æ˜¯ä¸€ä¸ªå…³äºæ’å…¥ã€åˆ é™¤ç­‰æ“ä½œçš„é›†åˆï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">IGListIndexSetResult</span> : <span class="title">NSObject</span></span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// æ’å…¥ç´¢å¼•çš„é›†åˆï¼ˆæ–°æ•°ç»„çš„ç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSIndexSet</span> *inserts;</span><br><span class="line"><span class="comment">// åˆ é™¤ç´¢å¼•çš„é›†åˆï¼ˆæ—§æ•°ç»„çš„ç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSIndexSet</span> *deletes;</span><br><span class="line"><span class="comment">// æ›´æ–°ç´¢å¼•çš„é›†åˆï¼ˆæ—§æ•°ç»„çš„ç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSIndexSet</span> *updates;</span><br><span class="line"><span class="comment">// ç§»åŠ¨ç´¢å¼•çš„é›†åˆ</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSArray</span>&lt;IGListMoveIndex *&gt; *moves;</span><br><span class="line"><span class="comment">// æ˜¯å¦å‘ç”Ÿæ”¹å˜</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>, <span class="keyword">readonly</span>) <span class="type">BOOL</span> hasChanges;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="IGListDiffable">IGListDiffable</h3>
<p><code>IGListDiffable</code>æ˜¯ä¸€ä¸ªåè®®ï¼Œè¦æ±‚æ•°ç»„é‡Œçš„å¯¹è±¡éƒ½éœ€è¦éµå¾ªè¿™ä¸ªåè®®æ‰èƒ½æœ‰æ•ˆåœ°ä½¿ç”¨<code>diff</code>å‡½æ•°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">IGListDiffable</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// è¿”å›å¯¹è±¡å”¯ä¸€idï¼Œåœ¨diffç®—æ³•ä¸­ä»¥å®ƒä½œä¸ºå…ƒç´ å­˜å…¥å“ˆå¸Œè¡¨çš„key</span></span><br><span class="line">- (<span class="keyword">nonnull</span> <span class="type">id</span>&lt;<span class="built_in">NSObject</span>&gt;)diffIdentifier;</span><br><span class="line"><span class="comment">// åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œåœ¨diffç®—æ³•ç”¨è¿™ä¸ªæ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">- (<span class="type">BOOL</span>)isEqualToDiffableObject:(<span class="keyword">nullable</span> <span class="type">id</span>&lt;IGListDiffable&gt;)object;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="IGListEntry">IGListEntry</h3>
<p><code>IGListEntry</code>æ˜¯ç”¨äºæ ‡è®°å…ƒç´ çŠ¶æ€çš„ç»“æ„ä½“ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> IGListEntry &#123;</span><br><span class="line">    <span class="comment">// è¯¥å…ƒç´ åœ¨æ—§æ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="built_in">NSInteger</span> oldCounter = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// è¯¥å…ƒç´ åœ¨æ–°æ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="built_in">NSInteger</span> newCounter = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// å­˜æ”¾å…ƒç´ åœ¨æ—§æ•°ç»„ä¸­çš„ç´¢å¼•ï¼Œåœ¨ç®—æ³•ä¸­ï¼Œå¯ä»¥ä¿è¯æ ˆé¡¶æ˜¯è¾ƒå°çš„ç´¢å¼•</span></span><br><span class="line">    stack&lt;<span class="built_in">NSInteger</span>&gt; oldIndexes;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªå…ƒç´ æ˜¯å¦éœ€è¦æ›´æ–°</span></span><br><span class="line">    <span class="type">BOOL</span> updated = <span class="literal">NO</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="IGListRecord">IGListRecord</h3>
<p><code>ICListRecord</code>æ˜¯å°è£…<code>entry</code>ç»“æ„ä½“å’Œå®ƒæ‰€åœ¨çš„ç´¢å¼•ï¼Œä¸»è¦ç”¨äºæ’å…¥å’Œåˆ é™¤ï¼ˆå¦‚æœ<code>index</code>æœ‰å€¼ï¼Œåˆ™ä»£è¡¨è¯¥å…ƒç´ éœ€è¦æ’å…¥æˆ–è€…æ›´æ–°ï¼Œå¦åˆ™ä¸º<code>NSNotFound</code>ï¼Œåˆ™æ˜¯éœ€è¦åˆ é™¤ï¼‰</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> IGListRecord &#123;</span><br><span class="line">    IGListEntry *entry;</span><br><span class="line">    <span class="keyword">mutable</span> <span class="built_in">NSInteger</span> index;</span><br><span class="line">    IGListRecord() &#123;</span><br><span class="line">        entry = <span class="literal">NULL</span>;</span><br><span class="line">        index = <span class="built_in">NSNotFound</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="IGListDiffingå‡½æ•°çš„ç®—æ³•æµç¨‹">IGListDiffingå‡½æ•°çš„ç®—æ³•æµç¨‹</h3>
<p><strong>å˜é‡çš„å£°æ˜</strong>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">NSInteger</span> newCount = newArray.count;</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">NSInteger</span> oldCount = oldArray.count;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMapTable</span> *oldMap = [<span class="built_in">NSMapTable</span> strongToStrongObjectsMapTable];</span><br><span class="line"><span class="built_in">NSMapTable</span> *newMap = [<span class="built_in">NSMapTable</span> strongToStrongObjectsMapTable];</span><br></pre></td></tr></table></figure>
<p><strong>å¤„ç†ç‰¹æ®Šæƒ…å†µ</strong>:</p>
<p>å¦‚æœ<code>newcount == 0</code> æˆ– <code>oldcount == 0</code>ï¼Œå³æ˜¯åˆ é™¤æ‰€æœ‰æ—§å…ƒç´ æˆ–æ–°å¢æ‰€æœ‰æ–°å…ƒç´ ï¼Œç›´æ¥è¿”å›<code>IGListIndexSetResult</code>é›†åˆï¼Œä¸éœ€è¦èµ°ä¸‹é¢çš„<code>diff</code>ç®—æ³•æµç¨‹ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (newCount == <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> [[IGListIndexSetResult alloc] initWithInserts:[<span class="built_in">NSIndexSet</span> new]</span><br><span class="line">                                               deletes:[<span class="built_in">NSIndexSet</span> indexSetWithIndexesInRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, oldCount)]</span><br><span class="line">                                               updates:[<span class="built_in">NSIndexSet</span> new]</span><br><span class="line">                                                           moves:[<span class="built_in">NSArray</span> new]</span><br><span class="line">                                           oldIndexMap:oldMap</span><br><span class="line">                                           newIndexMap:newMap];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (oldCount == <span class="number">0</span>) &#123;</span><br><span class="line">  [newArray enumerateObjectsUsingBlock:^(<span class="type">id</span>&lt;IGListDiffable&gt; obj, <span class="built_in">NSUInteger</span> idx, <span class="type">BOOL</span> *stop) &#123;</span><br><span class="line">        addIndexToMap(returnIndexPaths, toSection, idx, obj, newMap);</span><br><span class="line">  &#125;];</span><br><span class="line">  <span class="keyword">return</span> [[IGListIndexSetResult alloc] initWithInserts:[<span class="built_in">NSIndexSet</span> indexSetWithIndexesInRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, newCount)]</span><br><span class="line">                                               deletes:[<span class="built_in">NSIndexSet</span> new]</span><br><span class="line">                                               updates:[<span class="built_in">NSIndexSet</span> new]</span><br><span class="line">                                                 moves:[<span class="built_in">NSArray</span> new]</span><br><span class="line">                                           oldIndexMap:oldMap</span><br><span class="line">                                           newIndexMap:newMap];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Diffç®—æ³•ç¬¬ä¸€æ­¥</strong>ï¼š</p>
<p>å…ˆå®šä¹‰ä¸€ä¸ªæ— åºå»é‡<code>unordered_map</code>çš„<code>table</code>ï¼Œä»¥<code>diffIdentifier</code>ä¸ºKeyï¼Œ<code>entry</code>ä¸ºValueï¼Œå…¶æŸ¥æ‰¾å¤æ‚åº¦ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">unordered_map&lt;<span class="type">id</span>&lt;<span class="built_in">NSObject</span>&gt;, IGListEntry, IGListHashID, IGListEqualID&gt; table;</span><br></pre></td></tr></table></figure>
<p>æ­£åºéå†æ–°æ•°ç»„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">vector&lt;IGListRecord&gt; newResultsArray(newCount);</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; newCount; i++) &#123;</span><br><span class="line">  <span class="comment">// 1.å–æ¯ä¸ªå…ƒç´ çš„identifier</span></span><br><span class="line">  <span class="type">id</span>&lt;<span class="built_in">NSObject</span>&gt; key = IGListTableKey(newArray[i]);</span><br><span class="line">  <span class="comment">// 2.ä¸ºæ¯ä¸ªå…ƒç´ åˆ›å»ºä¸€ä¸ªentry,å¦‚æœtableé‡Œé¢ä¸å«è¿™ä¸ªkeyå°±åˆ›å»º</span></span><br><span class="line">  IGListEntry &amp;entry = table[key];</span><br><span class="line">  <span class="comment">// 3.entryçš„newCounterå€¼ +1</span></span><br><span class="line">  entry.newCounter++;</span><br><span class="line">  <span class="comment">// 4.NSNotFoundå…¥æ ˆï¼šç›®çš„æ˜¯é˜²æ­¢oldIndexesä¸ºç©ºï¼ŒNSNotFoundç›¸å½“äºæ ˆåº•çš„æ ‡å¿—ä½</span></span><br><span class="line">  entry.oldIndexes.push(<span class="built_in">NSNotFound</span>);</span><br><span class="line">  newResultsArray[i].entry = &amp;entry;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Diffç®—æ³•ç¬¬äºŒæ­¥</strong>ï¼š</p>
<p>å€’åºéå†æ—§æ•°ç»„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">vector&lt;IGListRecord&gt; oldResultsArray(oldCount);</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = oldCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">  <span class="comment">// 1.å–æ¯ä¸ªå…ƒç´ çš„identifier</span></span><br><span class="line">  <span class="type">id</span>&lt;<span class="built_in">NSObject</span>&gt; key = IGListTableKey(oldArray[i]);</span><br><span class="line">  IGListEntry &amp;entry = table[key];</span><br><span class="line">  <span class="comment">// 2.entryçš„olderCounterå€¼ + 1</span></span><br><span class="line">  entry.oldCounter++;</span><br><span class="line">  <span class="comment">// 4.å°†ç´¢å¼•iå…¥æ ˆ</span></span><br><span class="line">  entry.oldIndexes.push(i);</span><br><span class="line">  oldResultsArray[i].entry = &amp;entry;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ¸©é¦¨æç¤º</strong>ï¼šè¿™é‡Œé‡‡ç”¨å€’åºéå†æ˜¯ä¸ºäº†ä¿è¯ï¼Œå½“å­˜åœ¨å¤šä¸ªkeyç›¸åŒçš„æ—¶å€™ï¼ŒoldIndexesä¼šæœ‰ä¸€ç³»åˆ—çš„ç´¢å¼•å…¥æ ˆï¼Œä¿è¯æ ˆé¡¶çš„ç´¢å¼•æ˜¯æœ€å°çš„ã€‚</p>
</blockquote>
<blockquote>
<p><strong>åˆ†æ</strong>ï¼š</p>
<p>åœ¨ä¸Šé¢ä¸¤éƒ¨ä¹‹åï¼Œä¼šå»ºç«‹ä¸€ä¸ªç”¨äºå­˜æ”¾<code>IGListRecord</code>çš„<code>oldResultsArray</code>ï¼Œæ­¤æ—¶æ¯ä¸ª<code>IGListRecord</code>ä»ä¸º<code>NSNotFound</code>ï¼Œå¯¹äº<code>oldResultsArray</code>å’Œ <code>newResultsArray</code>ä¸­çš„<code>entry</code>ï¼Œä¼šæœ‰ä¸‰ç§æƒ…å†µï¼š</p>
<ul>
<li>è¯¥å…ƒç´ åªæœ‰æ–°æ•°ç»„æœ‰ï¼Œåˆ™<code>entry</code>çš„<code>newCounter</code>&gt;0ï¼Œ<code>oldCounter</code>=0,<code>oldIndexes</code>æ ˆé¡¶ä¸º<code>NSNotFound</code>ã€‚</li>
<li>è¯¥å…ƒç´ åªæœ‰æ—§æ•°ç»„æœ‰ï¼Œåˆ™<code>entry</code>çš„<code>newCounter</code>=0ï¼Œ<code>oldCounter</code>&gt;0,<code>oldIndexes</code>æ ˆé¡¶ä¸ä¸º<code>NSNotFound</code>ï¼Œè€Œæ˜¯å…ƒç´ åœ¨æ—§æ•°ç»„ä¸­çš„æœ€å°ç´¢å¼•ã€‚</li>
<li>è¯¥å…ƒç´ æ–°æ—§æ•°ç»„éƒ½æœ‰ï¼Œåˆ™<code>entry</code>çš„<code>newCounter</code>&gt;0ï¼Œ<code>oldCounter</code>&gt;0,<code>oldIndexes</code>æ ˆé¡¶ä¸ä¸º<code>NSNotFound</code>ï¼Œè€Œæ˜¯å…ƒç´ åœ¨æ—§æ•°ç»„ä¸­çš„æœ€å°ç´¢å¼•,è€Œ<code>oldResultsArray</code>å’Œ<code>newResultsArray</code>éƒ½æŒ‡å‘åŒä¸€ä¸ª<code>entry</code>ã€‚</li>
</ul>
</blockquote>
<p><strong>Diffç®—æ³•ç¬¬ä¸‰æ­¥</strong>ï¼š</p>
<p>å¤„ç†åŒæ—¶å‡ºç°åœ¨æ–°ã€æ—§æ•°ç»„é‡Œé¢çš„éƒ½å­˜åœ¨çš„å…ƒç´ (<strong>æ³¨æ„</strong>ï¼šè¿™é‡Œæ‰€è¯´çš„å­˜åœ¨çš„å…ƒç´ ä¸æ˜¯æŒ‡ä¸¤ä¸ªå…ƒç´ çš„å€¼ç›¸ï¼Œè€Œæ˜¯æˆ‘ä»¬æŒ‡å®šçš„identifierç›¸ç­‰ï¼Œè¿™ä¸€ç‚¹å¤§å®¶è¦æ³¨æ„ä¸€ä¸‹)ï¼Œå…¶IGListRecordçš„indexä¼šèµ‹ä¸Šæ–°ã€æ—§æ•°æ®çš„ç´¢å¼•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; newCount; i++) &#123;</span><br><span class="line">    <span class="comment">// 1. å–å‡ºæ–°æ•°ç»„ä¸­å…ƒç´ å¯¹åº”çš„entry</span></span><br><span class="line">    IGListEntry *entry = newResultsArray[i].entry;</span><br><span class="line">    <span class="built_in">NSCAssert</span>(!entry-&gt;oldIndexes.empty(), <span class="string">@&quot;Old indexes is empty while iterating new item %li. Should have NSNotFound&quot;</span>, (<span class="type">long</span>)i);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 2.æ‹¿åˆ°oldIndexesçš„æ ˆé¡¶ï¼Œä¹Ÿå°±æ˜¯æ‹¿åˆ°è¯¥å…ƒç´ åœ¨oldArrayçš„ç¬¬ä¸€ä¸ªç´¢å¼•ï¼Œç„¶åpopå‡ºæ¥</span></span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">NSInteger</span> originalIndex = entry-&gt;oldIndexes.top();</span><br><span class="line">    entry-&gt;oldIndexes.pop();</span><br><span class="line">    <span class="keyword">if</span> (originalIndex &lt; oldCount) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="type">id</span>&lt;IGListDiffable&gt; n = newArray[i];</span><br><span class="line">        <span class="keyword">const</span> <span class="type">id</span>&lt;IGListDiffable&gt; o = oldArray[originalIndex];</span><br><span class="line">        <span class="keyword">switch</span> (option) &#123;</span><br><span class="line">            <span class="keyword">case</span> IGListDiffPointerPersonality:</span><br><span class="line">            <span class="keyword">if</span> (n != o) &#123;</span><br><span class="line">                entry-&gt;updated = <span class="literal">YES</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> IGListDiffEquality:</span><br><span class="line">            <span class="keyword">if</span> (n != o &amp;&amp; ![n isEqualToDiffableObject:o]) &#123;</span><br><span class="line">                <span class="comment">// 3.æ ‡è®°éœ€è¦æ›´æ–°</span></span><br><span class="line">                entry-&gt;updated = <span class="literal">YES</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (originalIndex != <span class="built_in">NSNotFound</span> &amp;&amp; entry-&gt;newCounter &gt; <span class="number">0</span> &amp;&amp; entry-&gt;oldCounter &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 4.å¦‚æœç”¨identifieræ ‡è®°çš„å…ƒç´ åœ¨æ–°æ—§æ•°æ®ä¸­éƒ½å­˜åœ¨ é‚£ä¹ˆæ–°æ•°ç»„å¯¹åº”å…ƒç´ çš„indexä¼šæŒ‡å‘è¿™ä¸ªå…ƒç´ åœ¨è€æ•°æ®ä¸­çš„ç´¢å¼•</span></span><br><span class="line">        newResultsArray[i].index = originalIndex;</span><br><span class="line">        oldResultsArray[originalIndex].index = i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p><strong>Diffç®—æ³•ç¬¬å››æ­¥</strong>ï¼š</p>
<p>éå†è€æ•°æ®ï¼Œå¤„ç†éœ€è¦åˆ é™¤çš„å…ƒç´ ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="type">id</span> mInserts, mMoves, mUpdates, mDeletes;</span><br><span class="line"><span class="keyword">if</span> (returnIndexPaths) &#123;</span><br><span class="line">    mInserts = [<span class="built_in">NSMutableArray</span>&lt;<span class="built_in">NSIndexPath</span> *&gt; new];</span><br><span class="line">    mMoves = [<span class="built_in">NSMutableArray</span>&lt;IGListMoveIndexPath *&gt; new];</span><br><span class="line">    mUpdates = [<span class="built_in">NSMutableArray</span>&lt;<span class="built_in">NSIndexPath</span> *&gt; new];</span><br><span class="line">    mDeletes = [<span class="built_in">NSMutableArray</span>&lt;<span class="built_in">NSIndexPath</span> *&gt; new];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mInserts = [<span class="built_in">NSMutableIndexSet</span> new];</span><br><span class="line">    mMoves = [<span class="built_in">NSMutableArray</span>&lt;IGListMoveIndex *&gt; new];</span><br><span class="line">    mUpdates = [<span class="built_in">NSMutableIndexSet</span> new];</span><br><span class="line">    mDeletes = [<span class="built_in">NSMutableIndexSet</span> new];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="built_in">NSInteger</span>&gt; deleteOffsets(oldCount), insertOffsets(newCount);</span><br><span class="line"><span class="built_in">NSInteger</span> runningOffset = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; oldCount; i++) &#123;</span><br><span class="line">      deleteOffsets[i] = runningOffset;</span><br><span class="line">      <span class="keyword">const</span> IGListRecord record = oldResultsArray[i];</span><br><span class="line">  		<span class="comment">// 1.å¦‚æœè®°å½•æ¯ä¸ªå…ƒç´ çš„enteyè®°å½•recordé‡Œé¢indexçš„å€¼ä¸å­˜åœ¨ï¼Œåˆ™æŠŠè¯¥å…ƒç´ æ ‡è®°ä¸ºåˆ é™¤</span></span><br><span class="line">      <span class="keyword">if</span> (record.index == <span class="built_in">NSNotFound</span>) &#123;</span><br><span class="line">          addIndexToCollection(returnIndexPaths, mDeletes, fromSection, i);</span><br><span class="line">          runningOffset++;</span><br><span class="line">      &#125;</span><br><span class="line">      addIndexToMap(returnIndexPaths, fromSection, i, oldArray[i], oldMap);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><strong>Diffç®—æ³•ç¬¬äº”æ­¥</strong>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">runningOffset = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; newCount; i++) &#123;</span><br><span class="line">  insertOffsets[i] = runningOffset;</span><br><span class="line">  <span class="keyword">const</span> IGListRecord record = newResultsArray[i];</span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">NSInteger</span> oldIndex = record.index;</span><br><span class="line">  <span class="comment">// 1.å¦‚æœè®°å½•æ¯ä¸ªå…ƒç´ çš„enteyè®°å½•recordé‡Œé¢indexçš„å€¼ä¸å­˜åœ¨ï¼Œåˆ™æŠŠè¯¥å…ƒç´ æ ‡è®°ä¸ºæ’å…¥</span></span><br><span class="line">  <span class="keyword">if</span> (record.index == <span class="built_in">NSNotFound</span>) &#123;</span><br><span class="line">      addIndexToCollection(returnIndexPaths, mInserts, toSection, i);</span><br><span class="line">      runningOffset++;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 2.å¦‚æœè®°å½•æ¯ä¸ªå…ƒç´ çš„enteyé‡Œé¢updatedæ ‡è®°ä¸ºYESï¼Œåˆ™æ ‡è®°è¯¥å…ƒç´ ä¸ºæ›´æ–°</span></span><br><span class="line">      <span class="keyword">if</span> (record.entry-&gt;updated) &#123;</span><br><span class="line">          addIndexToCollection(returnIndexPaths, mUpdates, fromSection, oldIndex);</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="comment">// 3.æ ‡è®°è¯¥å…ƒç´ ä¸ºç§»åŠ¨</span></span><br><span class="line">      <span class="keyword">const</span> <span class="built_in">NSInteger</span> insertOffset = insertOffsets[i];</span><br><span class="line">      <span class="keyword">const</span> <span class="built_in">NSInteger</span> deleteOffset = deleteOffsets[oldIndex];</span><br><span class="line">      <span class="keyword">if</span> ((oldIndex - deleteOffset + insertOffset) != i) &#123;</span><br><span class="line">          <span class="type">id</span> move;</span><br><span class="line">          <span class="keyword">if</span> (returnIndexPaths) &#123;</span><br><span class="line">              <span class="built_in">NSIndexPath</span> *from = [<span class="built_in">NSIndexPath</span> indexPathForItem:oldIndex inSection:fromSection];</span><br><span class="line">              <span class="built_in">NSIndexPath</span> *to = [<span class="built_in">NSIndexPath</span> indexPathForItem:i inSection:toSection];</span><br><span class="line">              move = [[IGListMoveIndexPath alloc] initWithFrom:from to:to];</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              move = [[IGListMoveIndex alloc] initWithFrom:oldIndex to:i];</span><br><span class="line">          &#125;</span><br><span class="line">          [mMoves addObject:move];</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Diffç®—æ³•ç¬¬å…­æ­¥</strong>ï¼š</p>
<p>å¤„ç†å®Œ<code>æ’å…¥</code>ã€<code>åˆ é™¤</code>ã€<code>æ›´æ–°</code>ã€<code>ç§»åŠ¨</code>ä¹‹åï¼Œè¿”å›<code>IGListIndexSetResult</code>ç±»å‹çš„å€¼ï¼Œåˆ°è¿™é‡Œï¼ŒIGListKitæ¡†æ¶ä¸­æ•´ä¸ª<code>Diff</code> æ ¸å¿ƒéƒ¨åˆ†å°±ç»“æŸäº†ï¼Œåªè®²åŸç†è‚¯å®šå¾ˆç©ºæ´ï¼Œæˆ‘ä»¬è¿™é‡Œä¸¾ä¸€ä¸ªå®é™…çš„ä¾‹å­æ¥èµ°ä¸€éè¿™ä¸ª<code>Diff</code>çš„æµç¨‹ï¼ŒåŠ æ·±å°è±¡å’Œç†è§£ã€‚</p>
<h2 id="å®é™…åˆ·æ–°ä¸¾ä¾‹è¯´æ˜">å®é™…åˆ·æ–°ä¸¾ä¾‹è¯´æ˜</h2>
<p><strong>ä¸€</strong>ã€ç°åœ¨æ¯”å¦‚ä¸€ä¸ªUICollectionViewåˆ—è¡¨ä¸­çš„åˆå§‹æ•°æ®ä¸º<code>oldDatasource</code>ï¼Œæ•°æ®å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">BasicModel *model0 = [[BasicModel alloc] init];</span><br><span class="line">model0.modelId = <span class="string">@&quot;123&quot;</span>;</span><br><span class="line">model0.title = <span class="string">@&quot;A&quot;</span>;</span><br><span class="line">BasicModel *model1 = [[BasicModel alloc] init];</span><br><span class="line">model1.modelId = <span class="string">@&quot;234&quot;</span>;</span><br><span class="line">model1.title = <span class="string">@&quot;B&quot;</span>;</span><br><span class="line">BasicModel *model2 = [[BasicModel alloc] init];</span><br><span class="line">model2.modelId = <span class="string">@&quot;345&quot;</span>;</span><br><span class="line">model2.title = <span class="string">@&quot;C&quot;</span>;</span><br><span class="line">[<span class="keyword">self</span>.oldDatasource addObjectsFromArray:@[model0,model1,model2]];</span><br></pre></td></tr></table></figure>
<p><strong>äºŒ</strong>ã€åˆ·æ–°åçš„æ•°æ®ä¸º<code>freshDatasource</code>ï¼Œæ•°æ®å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">BasicModel *model3 = [[BasicModel alloc] init];</span><br><span class="line">model3.modelId = <span class="string">@&quot;123&quot;</span>;</span><br><span class="line">model3.title = <span class="string">@&quot;D&quot;</span>;</span><br><span class="line">BasicModel *model4 = [[BasicModel alloc] init];</span><br><span class="line">model4.modelId = <span class="string">@&quot;345&quot;</span>;</span><br><span class="line">model4.title = <span class="string">@&quot;C&quot;</span>;</span><br><span class="line">BasicModel *model5 = [[BasicModel alloc] init];</span><br><span class="line">model5.modelId = <span class="string">@&quot;456&quot;</span>;</span><br><span class="line">model5.title = <span class="string">@&quot;E&quot;</span>;</span><br><span class="line">[<span class="keyword">self</span>.freshDatasource addObjectsFromArray:@[model3,model4,model5]];</span><br></pre></td></tr></table></figure>
<p><strong>ä¸‰</strong>ã€åœ¨<code>BasicModel</code>ä¸­éµå®ˆ<code>&lt;IGListDiffable&gt;</code>åè®®ï¼Œå®ç°ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BasicModel</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›å¯¹è±¡å”¯ä¸€idï¼Œåœ¨diffç®—æ³•ä¸­ä»¥å®ƒä½œä¸ºå…ƒç´ å­˜å…¥å“ˆå¸Œè¡¨çš„key</span></span><br><span class="line">- (<span class="type">id</span>&lt;<span class="built_in">NSObject</span>&gt;)diffIdentifier &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.modelId) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.modelId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œåœ¨diffç®—æ³•ç”¨è¿™ä¸ªæ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">- (<span class="type">BOOL</span>)isEqualToDiffableObject:(BasicModel &lt;IGListDiffable&gt;*)object &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> isEqual:object];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>å››</strong>ã€ç»è¿‡<code>Diffæ ¸å¿ƒç®—æ³•ç¬¬ä¸€æ­¥</code>ä¹‹åçš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">newResultsArrayé‡Œé¢æœ‰ä¸‰ä¸ª IGListRecord ç±»å‹çš„å…ƒç´ ï¼Œå…ƒç´ é‡Œé¢çš„entryæƒ…å†µå¦‚ä¸‹ï¼š</span><br><span class="line">  </span><br><span class="line">entry[D].newCounter = <span class="number">1</span>;</span><br><span class="line">entry[D].oldIndexes.pop() = <span class="built_in">NSNotFound</span>;</span><br><span class="line">entry[D].updated = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line">entry[C].newCounter = <span class="number">1</span>;</span><br><span class="line">entry[C].oldIndexes.pop() = <span class="built_in">NSNotFound</span>;</span><br><span class="line">entry[C].updated = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line">entry[E].newCounter = <span class="number">1</span>;</span><br><span class="line">entry[E].oldIndexes.pop() = <span class="built_in">NSNotFound</span>;</span><br><span class="line">entry[E].updated = <span class="literal">NO</span>;</span><br></pre></td></tr></table></figure>
<p><strong>äº”</strong>ã€ç»è¿‡<code>Diffæ ¸å¿ƒç®—æ³•ç¬¬äºŒæ­¥</code>ä¹‹åçš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">oldResultsArrayé‡Œé¢æœ‰ä¸‰ä¸ª IGListRecord ç±»å‹çš„å…ƒç´ ï¼Œå…ƒç´ é‡Œé¢çš„entryæƒ…å†µå¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">entry[C].oldCounter = <span class="number">1</span>;</span><br><span class="line">entry[C].oldIndexes.pop() = <span class="number">2</span>;</span><br><span class="line">entry[C].updated = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line">entry[B].oldCounter = <span class="number">1</span>;</span><br><span class="line">entry[B].oldIndexes.pop() = <span class="number">1</span>;</span><br><span class="line">entry[B].updated = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line">entry[A].oldCounter = <span class="number">1</span>;</span><br><span class="line">entry[A].oldIndexes.pop() = <span class="number">0</span>;</span><br><span class="line">entry[A].updated = <span class="literal">NO</span>;</span><br></pre></td></tr></table></figure>
<p><strong>å…­</strong>ã€ç»è¿‡<code>Diffæ ¸å¿ƒç®—æ³•ç¬¬ä¸‰æ­¥</code>ä¹‹åçš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">entry[D].updated = <span class="literal">YES</span>; <span class="comment">// å› ä¸ºAå…ƒç´  å’Œ Då…ƒç´ çš„ modelIDä¸€æ · æ ‡è®°ä¸ºåˆ·æ–°</span></span><br><span class="line">entry[C].updated = <span class="literal">YES</span>; <span class="comment">// æ–°è€æ•°æ®é‡Œé¢éƒ½æœ‰Cå…ƒç´  å¹¶ä¸”modelIDä¸€æ · æ ‡è®°ä¸ºåˆ·æ–°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// A å’Œ D çš„record</span></span><br><span class="line">newResultsArray[<span class="number">0</span>].index = <span class="number">0</span>;</span><br><span class="line">oldResultsArray[<span class="number">0</span>].index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C åœ¨æ–°è€æ•°æ®ä¸­çš„record</span></span><br><span class="line">newResultsArray[<span class="number">1</span>].index = <span class="number">2</span>;</span><br><span class="line">oldResultsArray[<span class="number">2</span>].index = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p><strong>ä¸ƒ</strong>ã€ç»è¿‡<code>Diffæ ¸å¿ƒç®—æ³•ç¬¬å››æ­¥</code>ä¹‹åçš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">å› ä¸º oldResultsArray[<span class="number">1</span>].index = <span class="built_in">NSNotFound</span>ï¼Œæ‰€ä»¥è€æ•°æ®ä¸­è¿™ä¸ªä½ç½®å…ƒç´ éœ€è¦è¢«åˆ é™¤ï¼Œå³æ˜¯æ•°æ®Bã€‚</span><br></pre></td></tr></table></figure>
<p><strong>å…«</strong>ã€ç»è¿‡<code>Diffæ ¸å¿ƒç®—æ³•ç¬¬äº”æ­¥</code>ä¹‹åçš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">å› ä¸º newResultsArray[<span class="number">2</span>].index = <span class="built_in">NSNotFound</span>ï¼Œæ‰€ä»¥æ–°æ•°æ®ä¸­è¿™ä¸ªä½ç½®å…ƒç´ éœ€è¦æ’å…¥ï¼Œå³æ˜¯æ•°æ®Eã€‚</span><br><span class="line"></span><br><span class="line">Då…ƒç´ æ˜¯æ›´æ–°ï¼ŒCå…ƒç´ æ˜¯ç§»åŠ¨ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ä¹</strong>ã€æœ€åçš„ç»“è®ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">Insert: E</span><br><span class="line">Update: D(A -&gt; D)</span><br><span class="line">Move: C</span><br><span class="line">Delete: B</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>çœ‹åˆ°è¿™é‡Œï¼Œç›¸ä¿¡å¤§å®¶å¯¹IGListKitæ¡†æ¶ä¸­Diffç®—æ³•å®ç°åŸç†æœ‰äº†ä¸€ä¸ªæ›´åŠ æ¸…æ™°çš„äº†è§£ï¼Œè¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å°±å˜æˆäº†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ï¼ŒICListKitæ¡†æ¶å°±æ˜¯é€šè¿‡è¿™ç§åˆ·æ–°æœºåˆ¶æ¥æå‡äº†APPçš„æ•´ä½“æ€§èƒ½ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>IGListKit</tag>
        <tag>Diff</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘å…³äºRunLoopçš„ç®€å•ä»‹ç»</title>
    <url>/posts/a5190dfd/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-20">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•å…³äºRunLoopçš„ä¸€äº›ç®€å•ä»‹ç»ã€‚</p>
<h2 id="RunLoop">RunLoop</h2>
<h3 id="åŸºæœ¬è®¤è¯†">åŸºæœ¬è®¤è¯†</h3>
<p>RunLoopï¼šç¿»è¯‘è¿‡æ¥å«è¿è¡Œæ—¶å¾ªç¯ï¼ŒæŒ‡çš„æ˜¯åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å¾ªç¯çš„åšä¸€äº›äº‹æƒ…ã€‚</p>
<p>ä¸»è¦åº”ç”¨åœ¨ï¼š</p>
<ul>
<li>å®šæ—¶å™¨ï¼ˆTimerï¼‰ã€PerformSelector</li>
<li>GCD</li>
<li>äº‹ä»¶å“åº”ã€æ‰‹åŠ¿è¯†åˆ«ã€ç•Œé¢åˆ·æ–°</li>
<li>ç½‘ç»œè¯·æ±‚</li>
<li>AutoReleasePool</li>
</ul>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/02/13/1.png" alt="1"></p>
<p>ä¸Šé¢æ˜¯æˆ‘ä»¬ä¸€ä¸ªiOSç¨‹åºçš„å…¥å£<code>main</code>å‡½æ•°ï¼Œåœ¨<code>UIApplicationMain</code>å‡½æ•°ä¸­ä¼šå»åˆ›å»ºä¸»çº¿ç¨‹çš„RunLoopå¯¹è±¡ï¼Œå®ƒç”¨æ¥ä¿è¯ç¨‹åºä¸é€€å‡ºä»è€Œä¿è¯ç¨‹åºçš„æŒç»­æ‰§è¡Œã€‚<br>
æˆ‘ä»¬å¯ä»¥æŠŠRunLoopè¿è¡Œæ—¶å¾ªç¯ç†è§£æˆä¸€ä¸ª<code>do - while</code>å¾ªç¯ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> main(<span class="type">int</span> argc, <span class="type">char</span> * argv[]) &#123;</span><br><span class="line">  <span class="built_in">NSString</span> * appDelegateClassName;</span><br><span class="line">  <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">    <span class="type">int</span> retVal = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="comment">// 1.åœ¨ä¼‘çœ ä¸­ç­‰å¾…æ¶ˆæ¯</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 2.å¦‚æœæœ‰æ¶ˆæ¯ å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">      </span><br><span class="line">    &#125;<span class="keyword">while</span>(retVal = <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>RunLoopçš„åŸºæœ¬ä½œç”¨ï¼š</p>
<ul>
<li>ä¿è¯ç¨‹åºçš„æŒç»­è¿è¡Œ</li>
<li>å¤„ç†Appä¸­çš„å„ç§äº‹ä»¶ï¼ˆæ¯”å¦‚è§¦æ‘¸äº‹ä»¶ã€å®šæ—¶å™¨ç­‰ï¼‰</li>
<li>èŠ‚çœCPUèµ„æºï¼Œæé«˜ç¨‹åºçš„æ€§èƒ½ï¼šåœ¨æœ‰æ¶ˆæ¯çš„æ—¶å€™å¤„ç†æ¶ˆæ¯ æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ä¼‘çœ ã€‚</li>
</ul>
<h3 id="RunLoopå¯¹è±¡">RunLoopå¯¹è±¡</h3>
<p>iOSä¸­æœ‰ä¸¤å¥—APIæ¥è®¿é—®å’Œä½¿ç”¨RunLoopï¼š</p>
<ul>
<li>Foundationæ¡†æ¶ï¼š<code>NSRunLoop</code></li>
<li>Core Foundationæ¡†æ¶ï¼š<code>CFRunLoopRef</code>ï¼ˆå¼€æºä»£ç ï¼š<a href="https://opensource.apple.com/tarballs/CF/">https://opensource.apple.com/tarballs/CF/</a>ï¼‰</li>
</ul>
<h3 id="RunLoopä¸çº¿ç¨‹çš„å…³ç³»">RunLoopä¸çº¿ç¨‹çš„å…³ç³»</h3>
<ul>
<li>æ¯æ¡çº¿ç¨‹éƒ½æœ‰å”¯ä¸€çš„ä¸ä¹‹ç›¸å¯¹åº”çš„RunLoopå¯¹è±¡</li>
<li>RunLoopä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„å­—å…¸é‡Œé¢ï¼Œçº¿ç¨‹ä¸º<code>key</code>ï¼ŒRunLoopä¸º<code>value</code></li>
<li>çº¿ç¨‹åˆšåˆ›å»ºçš„æ—¶å€™å¹¶æ²¡æœ‰RunLoopå¯¹è±¡ï¼Œè€Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡è·å–RunLoopå¯¹è±¡æ—¶å»åˆ›å»º</li>
<li>RunLoopä¼šåœ¨çº¿ç¨‹ç»“æŸæ—¶é”€æ¯</li>
<li>ä¸»çº¿ç¨‹çš„RunLoopå·²ç»è‡ªåŠ¨è·å–ï¼ˆåˆ›å»ºï¼‰ï¼Œå­çº¿ç¨‹çš„RunLoopé»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯çš„</li>
</ul>
<h3 id="è·å–RunLoopå¯¹è±¡">è·å–RunLoopå¯¹è±¡</h3>
<p>Foundationæ¡†æ¶ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">[<span class="built_in">NSRunLoop</span> currentRunLoop]; <span class="comment">// è·å–å½“å‰çº¿ç¨‹çš„RunLoopå¯¹è±¡</span></span><br><span class="line">[<span class="built_in">NSRunLoop</span> mainRunLoop]; <span class="comment">// è·å–ä¸»çº¿ç¨‹çš„RunLoopå¯¹è±¡</span></span><br></pre></td></tr></table></figure>
<p>Core Foundationæ¡†æ¶ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">CFRunLoopGetCurrent</span>(); <span class="comment">// è·å–å½“å‰çº¿ç¨‹çš„RunLoopå¯¹è±¡</span></span><br><span class="line"><span class="built_in">CFRunLoopGetMain</span>();<span class="comment">// è·å–ä¸»çº¿ç¨‹çš„RunLoopå¯¹è±¡</span></span><br></pre></td></tr></table></figure>
<h3 id="RunLoopç›¸å…³çš„ç±»">RunLoopç›¸å…³çš„ç±»</h3>
<p>Core Foundationæ¡†æ¶ä¸­å…³äºRunLoopçš„äº”ä¸ªç±»ï¼š</p>
<ul>
<li><code>CFRunLoopRef</code></li>
<li><code>CFRunLoopModeRef</code></li>
<li><code>CFRunLoopSourceRef</code></li>
<li><code>CFRunLoopTimerRef</code></li>
<li><code>CFRunLoopObserverRef</code></li>
</ul>
<div class="note green no-icon flat"><p><code>RunLoop</code>å¯¹è±¡ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">__CFRunLoop</span> &#123;</span><br><span class="line">	<span class="type">pthread_t</span> _pthread;</span><br><span class="line">	CFMutableSetRef _commonModes;</span><br><span class="line">	CFMutableSetRef _commonModeItems;</span><br><span class="line">	CFRunLoopModeRef _currentMode;</span><br><span class="line">	CFMutableSetRef _modes;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>RunLoopMode</code>ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">struct __CFRunLoopMode &#123;</span><br><span class="line">	CFStringRef _name<span class="comment">;</span></span><br><span class="line">	CFMutableSetRef _sources0<span class="comment">;</span></span><br><span class="line">	CFMutableSetRef _sources1<span class="comment">;</span></span><br><span class="line">	CFMutableArrayRef _observers<span class="comment">;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br></pre></td></tr></table></figure>
</div>
<p>å„ä¸ªç±»ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/02/13/2.png" alt="2"></p>
<h3 id="RunLoopçš„è¿è¡Œæ¨¡å¼">RunLoopçš„è¿è¡Œæ¨¡å¼</h3>
<p><code>CFRunLoopModeRef</code>è¡¨ç¤ºæ˜¯RunLoopçš„è¿è¡Œæ¨¡å¼ï¼Œä¸€ä¸ªRunLoopå¯ä»¥æœ‰è‹¥å¹²ä¸ªModeï¼Œæ¯ä¸ªModeé‡Œé¢åˆåŒ…å«Source0ã€Source1ã€Timerã€Observerã€‚<br>
RunLoopåœ¨å¯åŠ¨æ—¶åªèƒ½é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªModeä½œä¸ºCurrentModeã€‚<br>
å¦‚æœéœ€è¦åˆ‡æ¢Modeéœ€è¦é€€å‡ºå½“å‰RunLoopé‡æ–°é€‰æ‹©ä¸€ä¸ªModeè¿›å…¥ã€‚<br>
ä¸åŒæ¨¡å¼ä¸‹çš„Source0/Source1/Timer/Observerèƒ½åˆ†éš”å¼€æ¥ï¼Œäº’ä¸å½±å“ã€‚<br>
å¦‚æœä¸€ä¸ªModeä¸­æ²¡æœ‰ä»»ä½•Source0/Source1/Timer/Observerï¼Œè¿™ä¸ªRunLoopä¼šç«‹é©¬é€€å‡ºã€‚</p>
<div class="note green no-icon flat"><p>å¸¸è§çš„Modeæœ‰ä¸¤ç§ï¼š</p>
<p><code>NSDefaultRunLoopMode(kCFRunLoopDefaultMode)</code>ï¼šAppçš„é»˜è®¤Modeï¼Œé€šå¸¸ä¸»çº¿ç¨‹åœ¨è¿™ä¸ªModeä¸‹è¿è¡Œã€‚<br>
<code>UITrackingRunLoopMode</code>ï¼šç•Œé¢è·Ÿè¸ªModeï¼ŒScrollViewçš„æ»‘åŠ¨ï¼Œä¿è¯ç•Œé¢æ»‘åŠ¨æ—¶ä¸å—å…¶ä»–çš„å½±å“ã€‚</p>
</div>
<h3 id="RunLoopçš„å‡ ç§çŠ¶æ€">RunLoopçš„å‡ ç§çŠ¶æ€</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Run Loop Observer Activities */</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">CF_OPTIONS</span><span class="params">(CFOptionFlags, CFRunLoopActivity)</span> </span>&#123;</span><br><span class="line">    kCFRunLoopEntry = (<span class="number">1UL</span> &lt;&lt; <span class="number">0</span>), <span class="comment">// å³å°†è¿›å…¥RunLoop</span></span><br><span class="line">    kCFRunLoopBeforeTimers = (<span class="number">1UL</span> &lt;&lt; <span class="number">1</span>), <span class="comment">// å³å°†å¤„ç†Timer</span></span><br><span class="line">    kCFRunLoopBeforeSources = (<span class="number">1UL</span> &lt;&lt; <span class="number">2</span>), <span class="comment">// å³å°†å¤„ç†Source</span></span><br><span class="line">    kCFRunLoopBeforeWaiting = (<span class="number">1UL</span> &lt;&lt; <span class="number">5</span>), <span class="comment">// å³å°†è¿›å…¥ä¼‘çœ </span></span><br><span class="line">    kCFRunLoopAfterWaiting = (<span class="number">1UL</span> &lt;&lt; <span class="number">6</span>), <span class="comment">// åˆšä»ä¼‘çœ ä¸­è¢«å”¤é†’</span></span><br><span class="line">    kCFRunLoopExit = (<span class="number">1UL</span> &lt;&lt; <span class="number">7</span>), <span class="comment">// å³å°†é€€å‡ºRunLoop</span></span><br><span class="line">    kCFRunLoopAllActivities = <span class="number">0x0FFFFFFF</span>U</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸‹å¯ä»¥ç›‘å¬RunLoopçš„æ‰€æœ‰çŠ¶æ€ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">CFRunLoopObserverRef observer = <span class="built_in">CFRunLoopObserverCreateWithHandler</span>(kCFAllocatorDefault, kCFRunLoopAllActivities, YES, <span class="number">0</span>, ^(CFRunLoopObserverRef observer, CFRunLoopActivity activity) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (activity) &#123;</span><br><span class="line">        <span class="keyword">case</span> kCFRunLoopEntry:</span><br><span class="line">            <span class="built_in">NSLog</span>(@<span class="string">&quot;kCFRunLoopEntry...&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> kCFRunLoopBeforeTimers:</span><br><span class="line">            <span class="built_in">NSLog</span>(@<span class="string">&quot;kCFRunLoopBeforeTimers...&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> kCFRunLoopBeforeSources:</span><br><span class="line">            <span class="built_in">NSLog</span>(@<span class="string">&quot;kCFRunLoopBeforeSources...&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> kCFRunLoopBeforeWaiting:</span><br><span class="line">            <span class="built_in">NSLog</span>(@<span class="string">&quot;kCFRunLoopBeforeWaiting...&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> kCFRunLoopAfterWaiting:</span><br><span class="line">            <span class="built_in">NSLog</span>(@<span class="string">&quot;kCFRunLoopAfterWaiting...&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> kCFRunLoopExit:</span><br><span class="line">            <span class="built_in">NSLog</span>(@<span class="string">&quot;kCFRunLoopExit...&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">CFRunLoopAddObserver</span>(<span class="built_in">CFRunLoopGetCurrent</span>(), observer, kCFRunLoopCommonModes);</span><br><span class="line"><span class="built_in">CFRelease</span>(observer);</span><br></pre></td></tr></table></figure>
<h3 id="RunLoopçš„è¿è¡Œé€»è¾‘">RunLoopçš„è¿è¡Œé€»è¾‘</h3>
<p>1ã€ Source0</p>
<ul>
<li>è§¦æ‘¸äº‹ä»¶å¤„ç†</li>
<li>performSelector:onThread:</li>
</ul>
<p>2ã€Source1</p>
<ul>
<li>åŸºäºPortçš„çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡</li>
<li>ç³»ç»Ÿäº‹ä»¶çš„æ•æ‰</li>
</ul>
<p>3ã€Timers</p>
<ul>
<li>NSTimer</li>
<li>performSelectorï¼šwithObjectï¼šafterDelayï¼š</li>
</ul>
<p>4ã€Observers</p>
<ul>
<li>ç”¨äºç›‘å¬RunLoopçš„çŠ¶æ€</li>
<li>UIåˆ·æ–°ï¼ˆBeforeWaitingï¼‰</li>
<li>AutoReleasePoolï¼ˆBeforeWaitingï¼‰</li>
</ul>
<p>RunLoopçš„è¿è¡Œé€»è¾‘å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/02/13/3.png" alt="3"></p>
<h3 id="RunLoopåœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨">RunLoopåœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨</h3>
<ul>
<li>æ§åˆ¶çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼ˆçº¿ç¨‹ä¿æ´»ï¼‰</li>
<li>è§£å†³NSTimeråœ¨æ»‘åŠ¨æ—¶åœæ­¢å·¥ä½œçš„é—®é¢˜</li>
<li>ç›‘æ§åº”ç”¨å¡é¡¿</li>
<li>æ€§èƒ½ä¼˜åŒ–</li>
</ul>
<h3 id="RunLoopçš„æºç æŸ¥çœ‹">RunLoopçš„æºç æŸ¥çœ‹</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/02/13/4.png" alt="4"></p>
<p>ä»ä¸Šé¢çœ‹åˆ°ï¼šRunLoopçš„æºç å…¥å£åœ¨<code>CFRunLoopRunSpecific</code>ã€‚</p>
<div class="note green no-icon flat"><p><strong>æ³¨æ„</strong>ï¼š</p>
<p>1ã€ä½¿ç”¨Foundationæ¡†æ¶æ‰“å°å‡ºæ¥çš„ä¸»çº¿ç¨‹RunLoopå’ŒCore Foundationæ¡†æ¶æ‰“å°å‡ºæ¥çš„ä¸»çº¿ç¨‹RunLoopåœ°å€å€¼ä¸ä¸€æ ·ï¼ŒåŸå› åœ¨äºFoundationæ¡†æ¶çš„RunLoopæ˜¯å¯¹Core Foundationæ¡†æ¶RunLoopçš„ä¸€å±‚å°è£…ã€‚<br>
2ã€ç³»ç»Ÿäº‹ä»¶æ˜¯é€šè¿‡Source1æ¥æ•æ‰ï¼Œä¹‹ååˆ†å‘åˆ°Source0å»å¤„ç†çš„ã€‚<br>
3ã€RunLoopåœ¨ä¼‘çœ ä¹‹å‰ä¼šå»é‡Šæ”¾è‡ªåŠ¨é‡Šæ”¾æ± å’Œåˆ·æ–°UIç­‰ã€‚<br>
4ã€çº¿ç¨‹é˜»å¡å’ŒRunLoopä¼‘çœ ä¸ä¸€æ ·ï¼šçº¿ç¨‹é˜»å¡è¿˜æ˜¯åœ¨æ‰§è¡Œä»£ç  å½“å‰çº¿ç¨‹æ ¹æœ¬æ²¡æœ‰çœŸçš„ä¼‘çœ  RunLoopä¼‘çœ çœŸçš„æ˜¯ä¼‘çœ  æ²¡æœ‰æ‰§è¡Œä»£ç  CPUä¸ä¼šä¸ºæ­¤åˆ†é…èµ„æº å°±ä¼šçœç”µã€‚</p>
</div>
<h2 id="å†™åœ¨æœ€å-14">å†™åœ¨æœ€å</h2>
<p>å…³äºRunLoopçš„ä¸€äº›åŸºæœ¬ä»‹ç»ã€å„ç§æ¨¡å¼ä»¥åŠå®ƒæ•´ä¸ªå®Œæ•´çš„è¿è¡Œé€»è¾‘å°±ä»‹ç»åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘å…³è”å¯¹è±¡çš„åº•å±‚åŸç†</title>
    <url>/posts/baafbb5e/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-21">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡ä¸»è¦æ¢ç©¶ä¸€ä¸‹iOSä¸­å¦‚ä½•ç»™åˆ†ç±»æ·»åŠ å±æ€§ä»¥åŠå…³è”å¯¹è±¡çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Œå»ºè®®å¤§å®¶çœ‹æœ¬ç¯‡æ–‡ç« çš„æ—¶å€™å‚è€ƒobjc4æºç ä¸€èµ·çœ‹ä¼šæ›´å¥½ã€‚</p>
<h2 id="å¦‚ä½•ç»™åˆ†ç±»æ·»åŠ å±æ€§">å¦‚ä½•ç»™åˆ†ç±»æ·»åŠ å±æ€§</h2>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Person + Test ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> (<span class="title">Test</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">Test</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setName:(<span class="built_in">NSString</span> *)name &#123;</span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(name), name, OBJC_ASSOCIATION_COPY_NONATOMIC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)name &#123;</span><br><span class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(name));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<div class="note red no-icon flat"><p><strong>è§£é‡Š</strong>ï¼š</p>
<p><code>objc_setAssociatedObject(id object, const void *key, id value, objc_AssociationPolicy policy)</code>å‚æ•°è§£é‡Šï¼š</p>
<p>1ã€<code>object</code>ï¼šéœ€è¦å…³è”çš„å¯¹è±¡</p>
<p>2ã€<code>key</code>ï¼šå…³è”key</p>
<p>3ã€<code>value</code>ï¼šå…³è”å€¼</p>
<p>4ã€<code>policy</code>ï¼šå…³è”ç­–ç•¥</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> OBJC_ENUM(uintptr_t, objc_AssociationPolicy) &#123;</span><br><span class="line">    OBJC_ASSOCIATION_ASSIGN = <span class="number">0</span>, <span class="comment">// å¯¹åº” assign       </span></span><br><span class="line">    OBJC_ASSOCIATION_RETAIN_NONATOMIC = <span class="number">1</span>, <span class="comment">//  å¯¹åº” strongï¼Œnonatomic</span></span><br><span class="line">    OBJC_ASSOCIATION_COPY_NONATOMIC = <span class="number">3</span>, <span class="comment">// å¯¹åº” copyï¼Œnonatomic </span></span><br><span class="line">    OBJC_ASSOCIATION_RETAIN = <span class="number">01401</span>, <span class="comment">// å¯¹åº” strongï¼Œatomic                                     </span></span><br><span class="line">    OBJC_ASSOCIATION_COPY = <span class="number">01403</span> <span class="comment">// å¯¹åº” copyï¼Œatomic</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</div>
<h2 id="å…³è”å¯¹è±¡çš„åº•å±‚åŸç†">å…³è”å¯¹è±¡çš„åº•å±‚åŸç†</h2>
<div class="note red no-icon flat"><p>åšä¸»è¿™é‡Œçš„æºç æ˜¯ objc4 - 838 ç‰ˆæœ¬ï¼Œä¸åŒçš„ç‰ˆæœ¬æœ‰çš„æ–¹æ³•å®ç°å¯èƒ½ä¼šæœ‰ä¸€äº›å·®å¼‚ä½†æ˜¯åŸç†éƒ½æ˜¯åŸºæœ¬ä¸å˜çš„ï¼Œå»ºè®®å¤§å®¶ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„æºç é˜…è¯»ã€‚</p>
</div>
<h3 id="è®¾å€¼åŸç†">è®¾å€¼åŸç†</h3>
<p>è®¾å€¼è°ƒç”¨çš„æ˜¯<code>objc_setAssociatedObject</code>ï¼Œé‡Œé¢è°ƒç”¨çš„æ˜¯<code>_objc_set_associative_reference</code>ï¼Œè®¾å€¼çš„æ ¸å¿ƒæ–¹æ³•å°±åœ¨<code>_objc_set_associative_reference</code>é‡Œé¢ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1130/1.png" alt="1"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1130/2.png" alt="2"></p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">_object_set_associative_reference(<span class="type">id</span> object, <span class="keyword">const</span> <span class="type">void</span> *key, <span class="type">id</span> value, uintptr_t policy)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// This code used to work when nil was passed for object and key. Some code</span></span><br><span class="line">    <span class="comment">// probably relies on that to not crash. Check and handle it explicitly.</span></span><br><span class="line">    <span class="comment">// rdar://problem/44094390</span></span><br><span class="line">    <span class="keyword">if</span> (!object &amp;&amp; !value) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (object-&gt;getIsa()-&gt;forbidsAssociatedObjects())</span><br><span class="line">        _objc_fatal(<span class="string">&quot;objc_setAssociatedObject called on instance (%p) of class %s which does not allow associated objects&quot;</span>, object, object_getClassName(object));</span><br><span class="line">    <span class="comment">// æŠŠå…³è”å¯¹è±¡objectåŒ…è£…æˆä¸€ä¸ªDisguisedPtrç±»å‹çš„æ•°æ®ç»“æ„</span></span><br><span class="line">    DisguisedPtr&lt;objc_object&gt; disguised&#123;(objc_object *)object&#125;;</span><br><span class="line">    <span class="comment">// æŠŠå…³è”ç­–ç•¥policyå’Œå…·ä½“å…³è”çš„å€¼valueåŒ…è£…æˆä¸€ä¸ªObjcAssociationçš„æ•°æ®ç»“æ„</span></span><br><span class="line">    ObjcAssociation association&#123;policy, value&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// retain the new value (if any) outside the lock.</span></span><br><span class="line">    <span class="comment">// æ ¹æ®ä¸åŒçš„ç­–ç•¥ç±»å‹åšç›¸åº”çš„å¤„ç†</span></span><br><span class="line">    association.acquireValue();</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> isFirstAssociation = <span class="literal">false</span>;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// AssociationsManager æ˜¯å…³è”å¯¹è±¡ç®¡ç†ç±»ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªé™æ€å˜é‡_mapStorageï¼Œè¦æ³¨æ„çš„æ˜¯managerå¹¶ä¸æ˜¯å”¯ä¸€çš„ã€‚</span></span><br><span class="line">        AssociationsManager manager;</span><br><span class="line">        <span class="comment">// é€šè¿‡ manager.get()æ¥è·å–æ‰€æœ‰çš„å…³è”è¡¨associations ç±»å‹æ˜¯ AssociationsHashMap</span></span><br><span class="line">        AssociationsHashMap &amp;associations(manager.get());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (value) &#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®å…³è”çš„å¯¹è±¡disguisedå»å…³è”è¡¨associationsä¸­æŸ¥æ‰¾å¯¹åº”çš„ObjectAssociationMapç±»å‹çš„valueï¼Œå¦‚æœæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªæ’å…¥åˆ°associationsé‡Œé¢</span></span><br><span class="line">            auto refs_result = associations.try_emplace(disguised, ObjectAssociationMap&#123;&#125;);</span><br><span class="line">            <span class="keyword">if</span> (refs_result.second) &#123;</span><br><span class="line">                <span class="comment">/* it&#x27;s the first association we make */</span></span><br><span class="line">                isFirstAssociation = <span class="literal">true</span>; <span class="comment">// è®¾ç½®ä¸ºtrue</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* establish or replace the association */</span></span><br><span class="line">            auto &amp;refs = refs_result.first-&gt;second;</span><br><span class="line">            auto result = refs.try_emplace(key, std::move(association)); <span class="comment">// æ ¹æ®ä¼ å…¥çš„keyæ‰¾åˆ°å¯¹åº”çš„bucketï¼Œæ›¿æ¢æ‰åŸæ¥çš„æˆ–è€…æ’å…¥æ–°çš„associationï¼Œå¹¶ä¸”è®¾ç½®å…³è”ç­–ç•¥ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (!result.second) &#123;</span><br><span class="line">                association.swap(result.first-&gt;second);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœvalueå€¼ä¸ºnil é€šè¿‡ä¼ å…¥çš„å…³è”å¯¹è±¡disguisedæ‰¾åˆ°ç›¸åº”çš„AssociationsHashMap</span></span><br><span class="line">            auto refs_it = associations.find(disguised);</span><br><span class="line">            <span class="keyword">if</span> (refs_it != associations.end()) &#123;</span><br><span class="line">                auto &amp;refs = refs_it-&gt;second;</span><br><span class="line">                auto it = refs.find(key); <span class="comment">// é€šè¿‡ä¼ å…¥çš„keyå»æ‰¾åˆ°ObjectAssociation</span></span><br><span class="line">                <span class="keyword">if</span> (it != refs.end()) &#123;</span><br><span class="line">                    association.swap(it-&gt;second); <span class="comment">// è¿›è¡Œæ“¦é™¤æ“ä½œ</span></span><br><span class="line">                    refs.erase(it);</span><br><span class="line">                    <span class="keyword">if</span> (refs.size() == <span class="number">0</span>) &#123;</span><br><span class="line">                        associations.erase(refs_it);</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Call setHasAssociatedObjects outside the lock, since this</span></span><br><span class="line">    <span class="comment">// will call the object&#x27;s _noteAssociatedObjects method if it</span></span><br><span class="line">    <span class="comment">// has one, and this may trigger +initialize which might do</span></span><br><span class="line">    <span class="comment">// arbitrary stuff, including setting more associated objects.</span></span><br><span class="line">    <span class="keyword">if</span> (isFirstAssociation)</span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰å…³è”å¯¹è±¡</span></span><br><span class="line">        object-&gt;setHasAssociatedObjects();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// release the old value (outside of the lock).</span></span><br><span class="line">    <span class="comment">// å¯¹associationè¿›è¡Œä¸€æ¬¡releaseæ“ä½œ</span></span><br><span class="line">    association.releaseHeldValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è®¾ç½®å…³è”çš„å››ä¸ªä¸»è¦å¯¹è±¡ï¼š</p>
<p><code>AssociationsManager</code></p>
<p><code>AssociationsHashMap</code></p>
<p><code>ObjectAssociationMap</code></p>
<p><code>ObjcAssociation</code></p>
<p>å…¶ä¸­ï¼Œ<code>AssociationsManager</code>çš„ç»“æ„ä¸ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> AssociationsManager &#123;</span><br><span class="line">  using Storage = ExplicitInitDenseMap&lt;DisguisedPtr&lt;objc_object&gt;, ObjectAssociationMap&gt;;</span><br><span class="line">  <span class="keyword">static</span> Storage _mapStorage;</span><br><span class="line">  </span><br><span class="line">   AssociationsHashMap &amp;get() &#123;</span><br><span class="line">      <span class="keyword">return</span> _mapStorage.get();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="type">void</span> init() &#123;</span><br><span class="line">      _mapStorage.init();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>AssociationsHashMap</code>çš„ç»“æ„ä¸ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">DenseMap&lt;DisguisedPtr&lt;objc_object&gt;, ObjectAssociationMap&gt; </span><br></pre></td></tr></table></figure>
<p><code>ObjectAssociationMap</code>çš„ç»“æ„ä¸ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> DenseMap&lt;<span class="keyword">const</span> <span class="type">void</span> *, ObjcAssociation&gt; ObjectAssociationMap;</span><br></pre></td></tr></table></figure>
<p><code>ObjcAssociation</code>çš„ç»“æ„ä¸ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> ObjcAssociation &#123;</span><br><span class="line">  uintptr_t _policy; <span class="comment">// å…³è”ç­–ç•¥</span></span><br><span class="line">  <span class="type">id</span> _value; <span class="comment">// å…³è”å€¼value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å››ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1130/3.png" alt="3"></p>
<p>å¯¹ç…§<code>objc_setAssociatedObject(id object, cons void *key, id value, objc_AssociationPolicy policy)</code>æ–¹æ³•ï¼š</p>
<ol>
<li>é€šè¿‡<code>AssociationsManager</code>çš„<code>manager.get()</code>è·å¾—<code>AssociationsHashMap</code>ã€‚</li>
<li><code>AssociationsHashMap</code>ä¸­çš„<code>key</code>æ˜¯å…³è”å¯¹è±¡<code>object</code>ï¼Œ<code>value</code>æ˜¯<code>ObjectAssociationMap</code>ã€‚</li>
<li><code>ObjectAssociationMap</code>ä¸­çš„<code>key</code>æ˜¯æ–¹æ³•ä¸­çš„<code>key</code>ï¼Œ<code>value</code>æ˜¯<code>ObjectAssociation</code>ã€‚</li>
<li><code>ObjectAssociation</code>ä¸­å­˜æ”¾çš„å°±æ˜¯æ–¹æ³•ä¸­çš„<code>value</code>å’Œå…³è”ç­–ç•¥<code>policy</code>ã€‚</li>
</ol>
<p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œè®¾ç½®å…³è”å¯¹è±¡çš„åº•å±‚åŸç†ç°åœ¨å°±å¾ˆæ¸…æ™°äº†ã€‚</p>
<h3 id="å–å€¼åŸç†">å–å€¼åŸç†</h3>
<p>å–å¾—è°ƒç”¨çš„æ˜¯<code>objc_getAssociatedObject</code>ï¼Œé‡Œé¢è°ƒç”¨çš„æ˜¯<code>_object_get_associative_reference</code>ï¼Œå–å€¼çš„æ ¸å¿ƒæ–¹æ³•å°±åœ¨<code>_object_get_associative_reference</code>é‡Œé¢ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1130/4.png" alt="4"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1130/5.png" alt="5"></p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="type">id</span></span><br><span class="line">_object_get_associative_reference(<span class="type">id</span> object, <span class="keyword">const</span> <span class="type">void</span> *key)</span><br><span class="line">&#123;</span><br><span class="line">    ObjcAssociation association&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        AssociationsManager manager;</span><br><span class="line">        AssociationsHashMap &amp;associations(manager.get());</span><br><span class="line">        AssociationsHashMap::iterator i = associations.find((objc_object *)object); <span class="comment">// é€šè¿‡objectå¯ä»¥è·å–ObjectAssociationMap</span></span><br><span class="line">        <span class="keyword">if</span> (i != associations.end()) &#123;</span><br><span class="line">            <span class="comment">// éå†AssociationsHashMap</span></span><br><span class="line">            ObjectAssociationMap &amp;refs = i-&gt;second;</span><br><span class="line">            ObjectAssociationMap::iterator j = refs.find(key); <span class="comment">// é€šè¿‡keyå¯ä»¥è·å¾—ObjcAssociation</span></span><br><span class="line">            <span class="keyword">if</span> (j != refs.end()) &#123;</span><br><span class="line">                <span class="comment">// éå†ObjectAssociationMap</span></span><br><span class="line">                association = j-&gt;second;</span><br><span class="line">                association.retainReturnedValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> association.autoreleaseReturnedValue(); <span class="comment">// è¿”å›å–åˆ°çš„å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“-2">æ€»ç»“</h3>
<p>é€šè¿‡ä¸Šé¢åˆ†æï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼š</p>
<ol>
<li>å…³è”å¯¹è±¡å¹¶ä¸æ˜¯å­˜å‚¨åœ¨è¢«å…³è”å¯¹è±¡æœ¬èº«çš„å†…å­˜é‡Œé¢ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªå…¨å±€çš„<code>AssociationsHashMap</code>é‡Œé¢ã€‚</li>
<li>è®¾ç½®å…³è”å¯¹è±¡ä¸º<code>nil</code>å°±ç›¸å½“äºæ˜¯ç§»é™¤å…³è”å¯¹è±¡ã€‚</li>
<li>ç§»é™¤æ‰€æœ‰çš„å…³è”å¯¹è±¡ï¼š<code>objc_removeAssoociatedObjects</code>ã€‚</li>
<li>å…³è”å¯¹è±¡çš„ç­–ç•¥é‡Œé¢æ²¡æœ‰ <code>weak</code>å±æ€§ã€‚</li>
<li>å…³è”å¯¹è±¡è¢«ç§»é™¤çš„æ—¶å€™ï¼Œç›¸åº”çš„å…³è”å±æ€§ä¹Ÿä¼šè¢«ç§»é™¤ã€‚</li>
</ol>
<h2 id="å†™åœ¨æœ€å-15">å†™åœ¨æœ€å</h2>
<p>å…³äºå…³è”å¯¹è±¡çš„åº•å±‚åŸç†æˆ‘ä»¬å°±ç®€å•åˆ†æåˆ°è¿™é‡Œï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
        <tag>Runtime</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘åˆ¶ä½œ.aé™æ€åº“å’Œ.frameworké™æ€åº“æœ€å…¨æµç¨‹</title>
    <url>/posts/38437bd9/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-22">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡è®°å½•çš„ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š</p>
<ul>
<li><code>.a</code>é™æ€åº“çš„åˆ¶ä½œæµç¨‹ä»¥åŠä½¿ç”¨</li>
<li><code>.framework</code>é™æ€åº“çš„åˆ¶ä½œæµç¨‹ä»¥åŠä½¿ç”¨</li>
</ul>
<h2 id="åˆ¶ä½œ-aé™æ€åº“">åˆ¶ä½œ.aé™æ€åº“</h2>
<p>ç¬¬ä¸€æ­¥ï¼šXcodeæ–°å»ºé¡¹ç›® - Frame &amp; Library - Static Libraryã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/1.png" alt="1"></p>
<p>ç¬¬äºŒæ­¥ï¼šåšä¸»è¿™é‡Œå–åä¸ºï¼šStaticLibraryï¼Œè¿™é‡Œå‡ºç°çš„ä¸¤ä¸ªæ–‡ä»¶æ²¡æœ‰ç”¨å¯ä»¥åˆ æ‰ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/2.png" alt="2"></p>
<p>ç¬¬ä¸‰æ­¥ï¼šæŠŠæƒ³è¦æ‰“æˆé™æ€åº“çš„æ–‡ä»¶æ”¾åœ¨<code>StaticLibrary</code>æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œåšä¸»è¿™é‡Œä»¥<code>WWPerson</code>æ–‡ä»¶ä¸ºä¾‹ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/3.png" alt="3"></p>
<p>ç¬¬å››æ­¥ï¼šä¿®æ”¹<code>BuildSetting</code>é…ç½®ï¼Œå°†<code>Build Active Architeture Only</code> è®¾ç½®ä¸º<code>NO</code>ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/4.png" alt="4"></p>
<p>ç¬¬äº”æ­¥ï¼šæ·»åŠ éœ€è¦æš´éœ²åœ¨å¤–é¢çš„<code>.h</code>æ–‡ä»¶ï¼Œ<code>.m</code>æ–‡ä»¶ä¼šè‡ªåŠ¨ç¼–è¯‘åˆ°<code>.a</code>æ–‡ä»¶ä¸­ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/5.png" alt="5"></p>
<p>åœ¨æœªæ·»åŠ ä¹‹å‰æ˜¯ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/6.png" alt="6"></p>
<p>ç‚¹å‡»+æ·»åŠ ï¼Œæ·»åŠ ä¹‹åï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/7.png" alt="7"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/8.png" alt="8"></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿™é‡Œéœ€è¦æš´éœ²çš„<code>.h</code>æ–‡ä»¶éœ€è¦æ”¾åœ¨<code>Public</code>åˆ—è¡¨æ é‡Œé¢ã€‚</p>
<p>ç¬¬å…­æ­¥ï¼š<code>Edit Scheme</code> - æ¨¡å¼æ”¹ä¸º<code>release</code>æ¨¡å¼ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/9.png" alt="9"></p>
<p>ç¬¬å…«æ­¥ï¼šåˆ†åˆ«åœ¨çœŸæœºå’Œæ¨¡æ‹Ÿå™¨ä¸Šéƒ½è¦<code>Command+B</code>ç¼–è¯‘ï¼Œç¼–è¯‘ä¹‹åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/10.png" alt="10"></p>
<p>å…¶ä¸­ï¼Œ<code>Release-iphoneos</code>ä»£è¡¨çš„æ˜¯çœŸæœºä¸‹çš„é™æ€åº“æ–‡ä»¶ï¼Œ<code>Release-iphonesimulator</code>è¡¨ç¤ºçš„æ˜¯æ¨¡æ‹Ÿå™¨ä¸‹çš„é™æ€æ–‡åº“æ–‡ä»¶ã€‚</p>
<div class="note pink no-icon flat"><p><strong>æ¸©é¦¨æç¤º</strong>ï¼š</p>
<ol>
<li>åœ¨æ¨¡æ‹Ÿå™¨ä¸Šç¼–è¯‘é™æ€åº“æ—¶æœ€å¥½é€‰æ‹©é«˜ç«¯ä¸€ç‚¹çš„è®¾å¤‡ï¼Œè¿™æ ·ä½ç«¯è®¾å¤‡ä¹Ÿå¯ä»¥ç”¨ï¼Œå¦‚æœé€‰æ‹©ä½ç«¯è®¾å¤‡å¯èƒ½ä¼šå‡ºç°åœ¨é«˜ç«¯æ¨¡æ‹Ÿå™¨ä¸Šå‡ºç°é”™è¯¯ç­‰é—®é¢˜ã€‚</li>
<li>é€šè¿‡<code>Xcode</code> -<code>Preferences</code>- <code>Location</code> å¯ä»¥æ‰¾åˆ°ä¸Šé¢çš„é™æ€åº“å†…å®¹ã€‚</li>
</ol>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/11.png" alt="11"></p>
</div>
<p>åˆ°è¿™é‡Œé™æ€åº“çš„åˆ¶ä½œæ–¹æ³•å°±åŸºæœ¬å®Œæˆäº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„é—®é¢˜æˆ‘ä»¬è¿˜æ²¡æœ‰è§£å†³ï¼Œé‚£å°±æ˜¯æ¨¡æ‹Ÿå™¨å’ŒçœŸæœºä¸‹çš„é™æ€åº“éœ€è¦åˆå¹¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•åˆå¹¶é™æ€åº“ã€‚</p>
<h2 id="åˆå¹¶é™æ€åº“">åˆå¹¶é™æ€åº“</h2>
<ul>
<li>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾çœŸæœºå’Œæ¨¡æ‹Ÿå™¨ä¸‹æ‰“åŒ…å‡ºæ¥çš„é™æ€åº“ï¼Œåšä¸»è¿™é‡Œæ–°å»ºä¸€ä¸ªâ€œåˆå¹¶é™æ€åº“â€çš„æ–‡ä»¶å¤¹</li>
</ul>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/12.png" alt="12"></p>
<ul>
<li>æ‰“å¼€ç»ˆç«¯ï¼Œåœ¨ç»ˆç«¯è¾“å…¥<code>lipo -create æ¨¡æ‹Ÿå™¨ä¸‹çš„.a çœŸæœºä¸‹çš„.a -output æ–°åˆå¹¶çš„é™æ€åº“çš„å­˜æ”¾è·¯å¾„</code>ï¼Œå¦‚ä¸‹ï¼š</li>
</ul>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/13.png" alt="13"></p>
<div class="note green no-icon flat"><p><strong>æ¸©é¦¨æç¤º</strong>ï¼š</p>
<p>å¦‚æœåœ¨åˆå¹¶çš„è¿‡ç¨‹ä¸­æœ‰äººç¢°åˆ°è·Ÿåšä¸»ä¸€æ ·çš„é”™è¯¯çš„è¯ï¼Œè¯·æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼ä¿®æ”¹Xcodeé…ç½®ï¼Œç„¶åé‡æ–°ç¼–è¯‘ç”Ÿæˆæ–°çš„.aé™æ€åº“ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/14.png" alt="14"></p>
<p>å‡ºç°é”™è¯¯çš„åŸå› åœ¨äºï¼šåœ¨Xcode12ä¹‹åç¼–è¯‘çš„æ¨¡æ‹Ÿå™¨é™æ€åº“ä¹Ÿæ”¯æŒarm64ï¼Œä¼šå¯¼è‡´çœŸæœºå’Œæ¨¡æ‹Ÿå™¨æœ‰ç›¸åŒçš„æ”¯æŒæ¶æ„arm64ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´æ¨¡æ‹Ÿå™¨å’ŒçœŸæœºä¸èƒ½åˆå¹¶çš„é—®é¢˜ã€‚</p>
<p>ä¸Šé¢Xcodeè®¾ç½®å°±æ˜¯å°†arm64æ¶æ„ç§»é™¤ã€‚</p>
</div>
<ul>
<li>åˆå¹¶ä¹‹åï¼Œå¯ä»¥åœ¨ç›®æ ‡æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ°æˆ‘ä»¬åˆšåˆå¹¶çš„é™æ€åº“ï¼š</li>
</ul>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/15.png" alt="15"></p>
<ul>
<li>å¯ä»¥ä½¿ç”¨<code>lipo -info</code>çœ‹ä¸€ä¸‹æˆ‘ä»¬æ‰“å‡ºæ¥çš„è¿™ä¸ªé™æ€åº“æ”¯æŒçš„æ¶æ„æ˜¯å“ªäº›ï¼š</li>
</ul>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/16.png" alt="16"></p>
<h2 id="aé™æ€åº“çš„ä½¿ç”¨">.aé™æ€åº“çš„ä½¿ç”¨</h2>
<p>é™æ€åº“çš„ä½¿ç”¨å¾ˆç®€å•ï¼Œåªéœ€è¦å°†æš´éœ²åœ¨å¤–é¢çš„<code>.h</code>æ–‡ä»¶å’Œ<code>.a</code>é™æ€åº“æ”¾åœ¨é¡¹ç›®ä¸­å³å¯ä½¿ç”¨ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/17.png" alt="17"></p>
<h2 id="frameworké™æ€åº“åˆ¶ä½œæµç¨‹">.frameworké™æ€åº“åˆ¶ä½œæµç¨‹</h2>
<p>ç¬¬ä¸€æ­¥ï¼šXcodeæ–°å»ºé¡¹ç›® - Frame &amp; Library - Frameworkã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/18.png" alt="18"></p>
<div class="note green no-icon flat"><p><strong>é…ç½®framwork</strong>:</p>
<ol>
<li>
<p><code>Build Settings</code>é…ç½®ï¼š</p>
<ul>
<li><code>Product Name</code> ï¼šå¯ä»¥ä¿®æ”¹åç§°ï¼Œè¿™é‡Œçš„åç§°æ˜¯æœ€ç»ˆæ‰“åŒ…å‡ºæ¥çš„<code>framework</code>çš„åç§°ï¼Œåšä¸»è¿™é‡Œå«<code>PrintFramework</code>ã€‚</li>
<li><code>Mac-O Type</code>ï¼šé€‰æ‹©<code>Static Library</code>ã€‚</li>
<li><code>Build Active Architeture Only</code>ï¼šè®¾ç½®ä¸º<code>NO</code>ã€‚</li>
<li><code>Base SDK</code>ï¼šé€‰æ‹©<code>iOS</code>ã€‚</li>
<li><code>iOS Deployment Target</code>ï¼šé€‰æ‹©æ‰“åŒ…å‡ºæ¥çš„<code>framework</code>æœ€ä½æ”¯æŒçš„iOSç‰ˆæœ¬ã€‚</li>
</ul>
</li>
<li>
<p><code>Build Phases</code>é…ç½®ï¼š</p>
<ul>
<li><code>Copy Bundle Resource</code>ï¼šåœ¨è¿™é‡Œé¢æ·»åŠ  <code>framework</code>é¡¹ç›®ä½¿ç”¨åˆ°çš„ä¸€äº›èµ„æºæ–‡ä»¶ï¼ŒåŒ…æ‹¬ï¼š<code>xib</code>ã€<code>plist</code>ã€å›¾ç‰‡ç­‰ã€‚</li>
<li><code>Link Binary With Libraries</code>ï¼šåœ¨è¿™é‡Œé¢æ·»åŠ  <code>framework</code>é¡¹ç›®çš„ä¾èµ–åº“ã€‚</li>
<li><code>Compile Sources </code>ï¼š<code>framework</code>é¡¹ç›®åŒ…å«çš„å®ç°æ–‡ä»¶ã€‚</li>
<li><code>Headers</code>ï¼šå°†è¦æš´éœ²å‡ºæ¥çš„å¤´æ–‡ä»¶æ”¾åœ¨<code>public</code> ä¸‹ï¼Œä¸éœ€è¦æš´éœ²åœ¨å¤–é¢çš„å¤´æ–‡ä»¶æ”¾åœ¨<code>project</code>ä¸‹ã€‚</li>
</ul>
</li>
</ol>
</div>
<p>ç¬¬äºŒæ­¥ï¼šå¦‚æœé¡¹ç›®ä¸­ç”¨åˆ°äº†å›¾ç‰‡ã€<code>Xib</code>ç­‰èµ„æºæ—¶éœ€è¦åˆ›å»ºä¸€ä¸ª<code>Bundle</code>ï¼šFile - New - Target - macOS - Bundleã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/19.png" alt="19"></p>
<div class="note red no-icon flat"><p><strong>æ³¨æ„</strong>ï¼š</p>
<p>åœ¨åˆ›å»º<code>Bundle</code>æ—¶çš„åç§°ä¸èƒ½å’Œ<code>framework</code>çš„åç§°ä¸€æ ·ï¼Œä¸€æ ·ä¼šå¯¼è‡´å¤±è´¥ã€‚</p>
<p><strong>é…ç½®Bundle</strong>ï¼š</p>
<ul>
<li>
<p>é€‰ä¸­<code>Bundle</code>Targetï¼Œ<code>Product Name</code> - ä¿®æ”¹<code>Bundle</code>åç§°ï¼Œåšä¸»è¿™é‡Œå«<code>PrintFramework</code>ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/22.png" alt="22"></p>
</li>
<li>
<p><code>Base SDK</code>ï¼šä¿®æ”¹ä¸º<code>iOS</code>ã€‚</p>
</li>
<li>
<p><code>Supported Platforms</code>ï¼šä¿®æ”¹ä¸º<code>iOS</code>ã€‚</p>
</li>
<li>
<p><code>Enable Bitcode</code>ï¼šè®¾ç½®ä¸º<code>NO</code>ã€‚</p>
</li>
<li>
<p><code>COMBILE_HIDPI_IMAGES</code>ï¼šè®¾ç½®ä¸º<code>NO</code>ã€‚ï¼ˆé¿å…<code>Bundle</code>ä¸­çš„å›¾ç‰‡å˜æˆ<code>tiff</code>æ ¼å¼è€Œæ— æ³•ä½¿ç”¨ï¼‰</p>
</li>
</ul>
</div>
<p>ç¬¬ä¸‰æ­¥ï¼šå°†åˆ›å»ºå¥½çš„<code>Bundle</code>æ·»åŠ åˆ°<code>framework</code>é¡¹ç›®çš„ä¾èµ–ä¸­å»ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/23.png" alt="23"></p>
<p>ç¬¬å››æ­¥ï¼š<code>Edit Scheme</code> - æ¨¡å¼æ”¹ä¸º<code>release</code>æ¨¡å¼ã€‚</p>
<p>ç¬¬äº”æ­¥ï¼šåˆ†åˆ«åœ¨çœŸæœºå’Œæ¨¡æ‹Ÿå™¨ä¸‹ç¼–è¯‘<code>framework</code>é¡¹ç›®ï¼Œå¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/24.png" alt="24"></p>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åˆ¶ä½œçš„<code>framework</code>é™æ€åº“å°±åŸºæœ¬å®Œæˆï¼Œæ¥ä¸‹æ¥å°±æ˜¯å’Œåˆ¶ä½œ<code>.a</code>é™æ€åº“ä¸€æ ·éœ€è¦åˆå¹¶é™æ€åº“ï¼Œåšä¸»è¿™é‡Œä¹…ä¸è¿‡å¤šé˜è¿°äº†ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ–¹å¼äº§ç”Ÿæ–°çš„<code>framework</code>é™æ€åº“ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/21.png" alt="21"></p>
<p>ç¬¬å…­æ­¥ï¼šå°†æ–°åˆå¹¶çš„<code>framework</code>æ–‡ä»¶æ›¿æ¢æ‰ä¹‹å‰çš„<code>xxx.framework</code>ä¸­çš„<code>framework</code>æ–‡ä»¶ã€‚</p>
<h2 id="frameworké™æ€åº“ä½¿ç”¨">.frameworké™æ€åº“ä½¿ç”¨</h2>
<p>å°†æ‰“åŒ…å‡ºæ¥çš„<code>xxx.framework</code>å’Œ<code>Bundle</code>å¯¼å…¥é¡¹ç›®ä¸­å³å¯ä½¿ç”¨ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/05/02/25.png" alt="25"></p>
<p>åˆ°è¿™é‡Œï¼Œå…³äº<code>.framework</code>é™æ€åº“çš„åˆ¶ä½œæ–¹æ³•å°±ç»“æŸäº†ã€‚</p>
<h2 id="å†™åœ¨æœ€å-16">å†™åœ¨æœ€å</h2>
<p>iOSä¸­å…³äºåˆ¶ä½œ<code>.a</code>å’Œ<code>.framework</code>é™æ€åº“çš„æµç¨‹åˆ°è¿™é‡Œå°±åŸºæœ¬ç»“æŸäº†ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« åšä¸»å°†æ¥è¯¦ç»†è®²ä¸€ä¸‹é™æ€åº“å’ŒåŠ¨æ€åº“çš„åŒºåˆ«ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘å¯åŠ¨ä¼˜åŒ–ï¼ˆä¸€ï¼‰</title>
    <url>/posts/a5b508b2/</url>
    <content><![CDATA[<h2 id="APPæ˜¯å¦‚ä½•å¯åŠ¨çš„">APPæ˜¯å¦‚ä½•å¯åŠ¨çš„</h2>
<h3 id="APPå¯åŠ¨">APPå¯åŠ¨</h3>
<p>çƒ­å¯åŠ¨ï¼šç³»ç»Ÿé‡Œé¢å­˜åœ¨APPçš„è¿›ç¨‹ç¼“å­˜ä¿¡æ¯ï¼Œæ¯”å¦‚æ€æ‰APPåçŸ­æ—¶é—´å†…é‡å¯APPã€‚</p>
<p>å†·å¯åŠ¨ï¼šç³»ç»Ÿé‡Œé¢æ²¡æœ‰APPçš„è¿›ç¨‹ç¼“å­˜ä¿¡æ¯ï¼Œä¾‹å¦‚é‡å¯æ‰‹æœºæ‰“å¼€åº”ç”¨ã€APPé•¿æ—¶é—´ä¸ç”¨ç³»ç»Ÿæ›¿æ¢æ‰å·²æœ‰çš„è¿›ç¨‹ç¼“å­˜ã€‚</p>
<p>APPçš„å¯åŠ¨æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_01.png" alt="20220525_01"></p>
<h4 id="mainå‡½æ•°ä¹‹å‰">mainå‡½æ•°ä¹‹å‰</h4>
<p>mainå‡½æ•°ä¹‹å‰æ‰€å¹²çš„äº‹å¤§æ¦‚å¯ä»¥æ€»ç»“ä¸ºï¼š</p>
<p><code>dyld</code>ï¼šåŠ¨æ€é“¾æ¥å™¨ï¼ŒæŠŠæ‰€æœ‰çš„å¯æ‰§è¡Œæ–‡ä»¶æ‰€ä¾èµ–çš„åŠ¨æ€åº“é€’å½’åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p>
<p><code>rebase/bindging</code>ï¼š<code>rebase</code> æ˜¯æŒ‡è°ƒæ•´é•œåƒå†…éƒ¨çš„æŒ‡é’ˆï¼Œ<code>binding</code>æ˜¯æŒ‡ç»‘å®šå¤–éƒ¨å‡½æ•°çš„æŒ‡é’ˆã€‚</p>
<p><code>objc setup</code>ï¼šRuntimeçš„åˆå§‹åŒ–ï¼Œå¯¹classå’Œcategoryæ³¨å†Œï¼Œå¯¹selectorçš„å”¯ä¸€æ€§åˆ¤æ–­ã€‚</p>
<p><code>load &amp; initialize &amp; constructor</code>ï¼šè°ƒç”¨æ‰€æœ‰ç±»çš„+loadæ–¹æ³•ï¼Œåˆå§‹åŒ–C&amp;C++é™æ€å¸¸é‡ï¼Œè°ƒç”¨<code>__attribute__((constructor))</code>ä¿®é¥°çš„å‡½æ•°ã€‚</p>
<p>æ€»ç»“ä¸ºå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_02.png" alt="20220525_02"></p>
<p>å…¶ä»–çš„éƒ½å¾ˆå¥½ç†è§£ï¼Œæˆ‘è¿™é‡Œé‡ç‚¹è§£é‡Šä¸€ä¸‹<code>rebase</code>å’Œ<code>binding</code>åˆ°åº•åœ¨å¹²ä»€ä¹ˆï¼Ÿ</p>
<p><strong>rebase &amp; binding</strong></p>
<p><strong>è™šæ‹Ÿå†…å­˜ &amp; ç‰©ç†å†…å­˜</strong></p>
<p>ç‰©ç†å†…å­˜ï¼šæŒ‡çš„æ˜¯é€šè¿‡ç‰©ç†å†…å­˜æ¡è·å–çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>è™šæ‹Ÿå†…å­˜ï¼šæŒ‡çš„æ˜¯å°†ç¡¬ç›˜çš„ä¸€å—åŒºåŸŸåˆ’åˆ†å‡ºæ¥ä½œä¸ºå†…å­˜ã€‚</p>
<p>åœ¨long long agoï¼Œæ²¡æœ‰è™šæ‹Ÿå†…å­˜çš„æ¦‚å¿µï¼Œé‚£æ—¶å€™æ¯ä¸ªè¿›ç¨‹è¿è¡Œçš„æ—¶å€™æ˜¯æ•´ä¸ªåº”ç”¨å…¨éƒ¨ä¸¢è¿›ç‰©ç†å†…å­˜ï¼Œæ¦‚è¿°å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_03.png" alt="20220525_03"></p>
<p>ç‰©ç†å†…å­˜å­˜åœ¨çš„é—®é¢˜ï¼š</p>
<ol>
<li>å†…å­˜é—®é¢˜ - æ¯æ¬¡ç›´æ¥æŠŠä¸€ä¸ªè¿›ç¨‹å…¨éƒ¨ä¸¢è¿›ç‰©ç†å†…å­˜ï¼Œå¾ˆå¯èƒ½å‡ºç°å†…å­˜ä¸å¤Ÿç”¨çš„æƒ…å†µã€‚</li>
<li>è¿›ç¨‹å®‰å…¨é—®é¢˜ - å¾ˆå®¹æ˜“æ‹¿åˆ°å…¶ä»–åº”ç”¨çš„å†…å­˜åœ°å€ï¼Œå°±ä¼šå‡ºç°è¿›ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ã€‚</li>
</ol>
<p>æ“ä½œç³»ç»Ÿå‡ºç°è™šæ‹Ÿå†…å­˜çš„æŠ€æœ¯ä¹‹åï¼Œè¿›ç¨‹è¿è¡Œæ—¶å¹¶ä¸æ˜¯æ•´ä¸ªè¢«è£…è½½è¿›ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯é€šè¿‡å†…å­˜åˆ†é¡µçš„æŠ€æœ¯æ¥è£…è½½è¿›ç‰©ç†å†…å­˜çš„ï¼Œæ¦‚è¿°å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_04.png" alt="20220525_04"></p>
<p>è™šæ‹Ÿå†…å­˜çš„æŠ€æœ¯å‡ºç°ä»¥åï¼Œå°±å‡ºç°ä¸€ä¸ªASLRï¼ˆåœ°å€ç©ºé—´å¸ƒå±€éšæœºï¼‰ï¼Œæ¯”å¦‚ä¸€ä¸ªåº”ç”¨æ¯æ¬¡è¿è¡Œçš„åœ°å€æ˜¯å˜åŒ–çš„ï¼Œæ¯”å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_05.png" alt="20220525_05"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_06.png" alt="20220525_06"></p>
<p><strong>ä¿®æ­£åç§»ï¼ˆrebaseï¼‰</strong></p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šæ—¢ç„¶æˆ‘ä»¬æ¯æ¬¡å¯åŠ¨åº”ç”¨åœ°å€éƒ½æ˜¯éšæœºçš„ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆæ‰¾åˆ°çœŸæ­£å­˜å‚¨æŸä¸ªå‡½æ•°çš„åœ°å€å‘¢ï¼Ÿ</p>
<p>Link Map Fileï¼šé“¾æ¥æ˜ å°„æ–‡ä»¶ï¼Œé‡Œé¢è®°å½•äº†æ¯ä¸ªç±»æ‰€ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ã€CPUæ¶æ„ã€ç›®æ ‡æ–‡ä»¶ã€ç¬¦å·ç­‰ä¿¡æ¯ã€‚</p>
<p>è¯·ç°åœ¨Xcode - Build Settings - è®¾ç½®Write Link Map Fileä¸ºYESï¼Œå°†Link Map Fileï¼ˆé“¾æ¥æ˜ å°„æ–‡ä»¶ï¼‰å†™å…¥åˆ°æœ¬åœ°ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_07.png" alt="20220525_07"></p>
<p>æŒ‰ç…§ä¸Šå›¾çš„Pathæ‰¾åˆ°æˆ‘ä»¬çš„Link Map Fileæ–‡ä»¶ï¼Œæ‰“å¼€å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_08.png" alt="20220525_08"></p>
<p>æ ¹æ®æˆ‘ä»¬å‰é¢çš„ASLR å’Œ Link Map Fileä¸­æŸä¸ªæ–¹æ³•çš„åç§»é‡æ¥ä¿®å¤æˆè¿™ä¸ªå‡½æ•°çš„çœŸå®å†…å­˜åœ°å€ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯rebaseã€‚</p>
<p>æ¯”å¦‚ï¼šASLRä¸º<code>0x000000010260f000</code>ï¼Œåç§»é‡ä¸º<code>0x1E80</code></p>
<p>rebaseç»“æœå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_09.png" alt="20220525_09"></p>
<p>ä»ä¸Šé¢çš„æ‰“å°å¯ä»¥çœ‹åˆ°ï¼šé€šè¿‡rebaseä¹‹åçš„åœ°å€å°±æ˜¯å­˜æ”¾<code>-[ViewController viewDidload]</code>çš„çœŸå®åœ°å€ã€‚</p>
<p><strong>ç»‘å®šç¬¦å·ï¼ˆbindingï¼‰</strong></p>
<p>bindingï¼ˆç¬¦å·ç»‘å®šï¼‰ä¸»è¦æ˜¯é’ˆå¯¹å¤–éƒ¨å‡½æ•°çš„ç»‘å®šï¼ŒæŒ‡çš„æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡å¤–éƒ¨ç¬¦å·å»æ‰¾åˆ°çœŸæ­£çš„å­˜æ”¾è¿™ä¸ªå¤–éƒ¨å‡½æ•°çš„åœ°å€ã€‚</p>
<p>ä¸¾ä¾‹ï¼šæˆ‘ä»¬å¦‚ä½•ç»‘å®š<code>Foundation</code>æ¡†æ¶ä¸­çš„<code>NSLog</code>å‡½æ•°ï¼Ÿ</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_10.png" alt="20220525_10"></p>
<p>ä¸Šå›¾æ˜¯é€šè¿‡æ±‡ç¼–çœ‹åˆ°çš„<code>NSLog</code>çš„åœ°å€å­˜æ”¾å†…å®¹ï¼šä¼šå‘ç°æ‰“å°çš„<code>NSLog</code> å…¶å®è¿˜æ˜¯é¡¹ç›®æœ¬èº«çš„ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬è¦æ‰¾çš„<code>Foundation</code>çš„<code>NSLog</code>ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_11.png" alt="20220525_11"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_12.png" alt="20220525_12"></p>
<p>ASLRä¸º<code>0x00000001017ab000</code>ï¼Œé€šè¿‡çƒ‚è‹¹æœå·¥å…·å¯ä»¥çœ‹åˆ°<code>NSLog</code>çš„ç¬¦å·ä¸º<code>0x4020</code>ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å†…å­˜åˆ†å¸ƒï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_13.png" alt="20220525_13"></p>
<p>é€šè¿‡ä¸Šå›¾å¯ä»¥æ¸…æ™°çš„å‘ç°ï¼šåŸæ¥æˆ‘ä»¬<code>Foundation</code>æ¡†æ¶çš„<code>NSLog</code>åœ°å€ä¸ºï¼š<code>0x7fff25762dfa</code>ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šå› ä¸º<code>binding</code>çš„éƒ½æ˜¯é’ˆå¯¹å¤–éƒ¨å‡½æ•°çš„ç»‘å®šï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‚¯å®šç¬¦å·å’Œè¿™ä¸ªå¤–éƒ¨å‡½æ•°çš„çœŸå®åœ°å€é’ˆå¯¹ä¸€ä¸ªå‡½æ•°æ˜¯ç›¸åŒçš„ã€‚</p>
<h4 id="mainå‡½æ•°">mainå‡½æ•°</h4>
<p>åœ¨ç»è¿‡äº†<code>main</code>å‡½æ•°ä¹‹å‰çš„è¿‡ç¨‹ä¹‹åï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šè°ƒç”¨ä¸€ä¸ªé¡¹ç›®çš„<code>main</code>å‡½æ•°ï¼Œåœ¨è¿™é‡Œé¢ä¸€èˆ¬æˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸ä¼šå¹²ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int main(int argc, char * argv[]) &#123;</span><br><span class="line">    NSString * appDelegateClassName;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        NSLog(@&quot;%s&quot;,__func__);</span><br><span class="line">        appDelegateClassName = NSStringFromClass([AppDelegate class]);</span><br><span class="line">    &#125;</span><br><span class="line">    return UIApplicationMain(argc, argv, nil, appDelegateClassName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="mainå‡½æ•°ä¹‹å">mainå‡½æ•°ä¹‹å</h4>
<p><code>main</code>å‡½æ•°ä¹‹åï¼Œæ¥ç€è°ƒç”¨çš„æ˜¯<code>didFinishLaunchingWithOptions</code>æ–¹æ³•ï¼Œä¸€èˆ¬æˆ‘ä»¬åœ¨è¿™é‡Œé¢åšä¸€äº›SDKçš„åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–RootVcç­‰æ“ä½œï¼Œå› ä¸ºè¿™é‡Œé¢çš„ä»£ç éƒ½æ˜¯æˆ‘ä»¬å¼€å‘è€…è‡ªå·±å†™çš„ï¼Œæ‰€ä»¥å¯æ“ä½œæ€§ä¹Ÿæ˜¯æœ€å¼ºçš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</span><br><span class="line">    NSLog(@&quot;%s&quot;,__func__);</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="è¡¡é‡APPçš„å¯åŠ¨æ—¶é•¿">è¡¡é‡APPçš„å¯åŠ¨æ—¶é•¿</h2>
<h3 id="mainå‡½æ•°ä¹‹å‰çš„æ—¶é•¿ç»Ÿè®¡">mainå‡½æ•°ä¹‹å‰çš„æ—¶é•¿ç»Ÿè®¡</h3>
<p>é¦–å…ˆåœ¨<code>Edit Scheme</code> - <code>Run</code> - <code>Arguments</code> - <code>DYLD_PRINT_STATISTICS</code>è®¾ç½®ä¸º1:</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_14.png" alt="20220525_14"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220525/20220525_15.png" alt="20220525_15"></p>
<h3 id="mainå‡½æ•°ä¹‹åçš„æ—¶é•¿ç»Ÿè®¡">mainå‡½æ•°ä¹‹åçš„æ—¶é•¿ç»Ÿè®¡</h3>
<p><code>main</code>å‡½æ•°ä¹‹åçš„æ—¶é•¿ç»Ÿè®¡æˆ‘ä»¬å¯ä»¥ä»<code>didFinishLaunchingWithOptions</code>è°ƒç”¨å¼€å§‹è®¡æ—¶åˆ°ç¬¬ä¸€ä¸ªé¡µé¢æ¸²æŸ“å‡ºæ¥ç»“æŸçš„æ—¶é•¿ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨è¿™ä¸¤ä¸ªåœ°æ–¹æ‰“ç‚¹ä¼°ç®—è¿™ä¸ªæ—¶é—´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</span><br><span class="line">    CFAbsoluteTime startTime = CFAbsoluteTimeGetCurrent();</span><br><span class="line">    sleep(2.0);//å‡è£…æˆ‘æ˜¯didFinishLaunchingWithOptionsé‡Œçš„è€—æ—¶æ–¹æ³•</span><br><span class="line">    CFAbsoluteTime endTime = CFAbsoluteTimeGetCurrent() - startTime;</span><br><span class="line">    NSLog(@&quot;mainå‡½æ•°ä¹‹åçš„æ—¶é•¿ç»Ÿè®¡1ï¼š%f ms&quot;,endTime * 1000);</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¯åŠ¨ä¼˜åŒ–çš„æ–¹æ¡ˆ">å¯åŠ¨ä¼˜åŒ–çš„æ–¹æ¡ˆ</h2>
<h3 id="Mainå‡½æ•°ä¹‹å‰çš„ä¼˜åŒ–">Mainå‡½æ•°ä¹‹å‰çš„ä¼˜åŒ–</h3>
<h4 id="dyldåŠ è½½">dyldåŠ è½½</h4>
<ul>
<li>ä¸¥æ ¼æ§åˆ¶åŠ¨æ€åº“çš„å¼•å…¥ï¼ŒAppleå®˜æ–¹å»ºè®®ä¸€ä¸ªé¡¹ç›®ä½¿ç”¨çš„åŠ¨æ€åº“ä¸è¦è¶…è¿‡6ä¸ªï¼Œå¦‚æœå¤§äº6ä¸ªå°±éœ€è¦è€ƒè™‘åˆå¹¶åŠ¨æ€åº“ã€‚</li>
</ul>
<h4 id="rebase-binding">rebase &amp; binding</h4>
<ul>
<li>
<p>å‡å°‘ç±»ã€åˆ†ç±»ã€æ–¹æ³•çš„æ•°é‡ï¼Œå®šæœŸæ£€æŸ¥é¡¹ç›®ä¸­ä¸ç”¨çš„ç±»æˆ–æ–¹æ³•åŠæ—¶æ¸…ç†ç­‰ã€‚</p>
</li>
<li>
<p>å‡å°‘C++è™šå‡½æ•°æ•°é‡ï¼ˆåˆ›å»ºè™šå‡½æ•°è¡¨ä¹Ÿæ˜¯æœ‰å¼€é”€ï¼‰</p>
</li>
</ul>
<h4 id="objc-setup">objc setup</h4>
<ul>
<li>å¦‚æœå‰é¢ä¸¤æ­¥åšäº†å¤„ç†ï¼Œè¿™ä¸€æ­¥å°±æ²¡æœ‰ä»€ä¹ˆå¯ä»¥ä¼˜åŒ–çš„ç©ºé—´äº†ã€‚</li>
</ul>
<h4 id="load-initialize-Constructor">load &amp; initialize &amp; Constructor</h4>
<ul>
<li>loadæ–¹æ³•å°½é‡ä¸è¦ä½¿ç”¨</li>
<li><code>__attribute__((constructor))</code> ä¿®é¥°çš„å‡½æ•°å°½é‡ä¸è¦ä½¿ç”¨</li>
</ul>
<h3 id="Mainå‡½æ•°ä¹‹åçš„ä¼˜åŒ–">Mainå‡½æ•°ä¹‹åçš„ä¼˜åŒ–</h3>
<ul>
<li>
<p>ä½¿ç”¨çº¯ä»£ç çš„æ–¹å¼è€Œä¸æ˜¯StoryboardåŠ è½½é¦–é¡µUIã€‚</p>
</li>
<li>
<p>å¯¹äºdidFinishLaunchingWithOptionsï¼šé‡Œçš„æ–¹æ³•æŒ–æ˜æ˜¯å¦æœ‰å¯èƒ½å»¶è¿ŸåŠ è½½ã€‚</p>
</li>
<li>
<p>è·Ÿå„ä¸ªä¸šåŠ¡æ–¹PMå’ŒRDå…±åŒcheckä¸€äº›å·²ç»ä¸‹çº¿çš„ä¸šåŠ¡ï¼Œåˆ é™¤å†—ä½™çš„ä»£ç </p>
<p>â€¦</p>
</li>
</ul>
<h2 id="ä¸€äº›æ£€æµ‹å·¥å…·æ¨è">ä¸€äº›æ£€æµ‹å·¥å…·æ¨è</h2>
<ul>
<li><a href="https://github.com/HSFGitHub/XcodeProjectArrangementTool">https://github.com/HSFGitHub/XcodeProjectArrangementTool</a></li>
<li><a href="https://github.com/dblock/fui">https://github.com/dblock/fui</a></li>
<li><a href="https://github.com/nst/objc_cover">https://github.com/nst/objc_cover</a></li>
<li><a href="https://www.jetbrains.com/objc">https://www.jetbrains.com/objc</a></li>
<li><a href="https://github.com/yan998/SelectorsUnrefs">https://github.com/yan998/SelectorsUnrefs</a></li>
</ul>
<h2 id="æœ€å-8">æœ€å</h2>
<p>ä¸‹ä¸€ç¯‡é¢„å‘Šï¼š<a href="https://codersunny.com/posts/23c5d0e7/">iOSé‡å­¦ä¹‹å¯åŠ¨ä¼˜åŒ–ï¼ˆäºŒï¼‰- äºŒè¿›åˆ¶é‡æ’</a></p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>å¯åŠ¨ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ iOSé‡å­¦ã€‘å¯åŠ¨ä¼˜åŒ–ï¼ˆä¸‰ï¼‰- Clangæ’æ¡©</title>
    <url>/posts/37cd28e5/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-23">å†™åœ¨å‰é¢</h2>
<p>åœ¨ ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://codersunny.com/posts/23c5d0e7/">iOSé‡å­¦ä¹‹å¯åŠ¨ä¼˜åŒ–ï¼ˆäºŒï¼‰- äºŒè¿›åˆ¶é‡æ’</a> æœ€åæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•ç²¾ç¡®è·å–åº”ç”¨å¯åŠ¨æ—¶åˆ»çš„ç¬¦å·è°ƒç”¨é¡ºåºï¼Œæœ¬ç¯‡æ–‡ç« æˆ‘ä»¬å°±æ¥è¯¦ç»†ä»‹ç»å¦‚ä½•é€šè¿‡Clangæ’æ¡©æ¥å¯¹æ‰€æœ‰çš„ç¬¦å·è¿›è¡Œ100%çš„Hookã€‚</p>
<h2 id="Clangæ’æ¡©">Clangæ’æ¡©</h2>
<p>LLVMå†…ç½®äº†ä¸€ä¸ªç®€å•çš„ä»£ç è¦†ç›–ç‡æ£€æµ‹(SanitizerCoverage)ã€‚å®ƒåœ¨å‡½æ•°çº§ã€åŸºæœ¬å—çº§å’Œè¾¹ç¼˜çº§æ’å…¥å¯¹ç”¨æˆ·å®šä¹‰å‡½æ•°çš„è°ƒç”¨ï¼Œå¹¶æä¾›äº†è¿™äº›å›è°ƒçš„é»˜è®¤å®ç°ã€‚åœ¨è®¤ä¸ºå¯åŠ¨ç»“æŸçš„ä½ç½®æ·»åŠ ä»£ç ï¼Œå°±èƒ½å¤Ÿæ‹¿åˆ°å¯åŠ¨åˆ°æŒ‡å®šä½ç½®è°ƒç”¨åˆ°çš„æ‰€æœ‰å‡½æ•°ç¬¦å·ã€‚</p>
<p><a href="https://clang.llvm.org/docs/SanitizerCoverage.html">LLVMå®˜æ–¹æ–‡æ¡£</a> ä¹Ÿå…·ä½“ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨<code>Tracing PCs with guards</code>æ¥åšåˆ°Hookæ‰€æœ‰çš„å‡½æ•°ç¬¦å·ã€‚</p>
<div class="note pink no-icon flat"><p><strong>Tracing PCs with guards:</strong></p>
<p>å¯ä»¥ç†è§£ä¸ºè·Ÿè¸ªä»£ç æ‰§è¡Œé€»è¾‘çš„ä¸€ä¸ªå·¥å…·ï¼ŒClangç¼–è¯‘å™¨å°±å¯ä»¥é€šè¿‡æ’æ¡©æ¥è·å–è°ƒç”¨çš„ç¬¦å·é¡ºåºã€‚</p>
</div>
<h3 id="Xcodeé…ç½®">Xcodeé…ç½®</h3>
<p>åœ¨é¡¹ç›®Buiding Settingä¸­<code>Other C Flags</code>é‡Œé¢æ·»åŠ  <code>-fsanitize-coverage=trace-pc-guard</code>æ ‡è¯†ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220626/2022061601.png" alt="2022061601"></p>
<h3 id="æ·»åŠ Hookä»£ç ">æ·»åŠ Hookä»£ç </h3>
<p>åœ¨é¡¹ç›®é‡Œé¢æ·»åŠ å¦‚ä¸‹ä¸¤ä¸ªå‡½æ•°ï¼š</p>
<p>é¦–å…ˆå¯¼å…¥å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sanitizer/coverage_interface.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> __sanitizer_cov_trace_pc_guard_init(<span class="type">uint32_t</span> *start, <span class="type">uint32_t</span> *stop) &#123;</span><br><span class="line">      <span class="type">static</span> <span class="type">uint64_t</span> N;</span><br><span class="line">      <span class="keyword">if</span> (start == stop || *start) <span class="keyword">return</span>;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;INIT: %p %p\n&quot;</span>, start, stop);</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">uint32_t</span> *x = start; x &lt; stop; x++)</span><br><span class="line">        *x = ++N;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> __sanitizer_cov_trace_pc_guard(<span class="type">uint32_t</span> *guard) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!*guard) <span class="keyword">return</span>;</span><br><span class="line">  <span class="type">void</span> *PC = __builtin_return_address(<span class="number">0</span>);</span><br><span class="line">  <span class="type">char</span> PcDescr[<span class="number">1024</span>];</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;guard: %p %x PC %s\n&quot;</span>, guard, *guard, PcDescr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å‡½æ•°åˆ†æ">å‡½æ•°åˆ†æ</h3>
<p><strong>ä¸€ã€</strong> void __sanitizer_cov_trace_pc_guard_init(uint32_t *start, uint32_t *stop)</p>
<p>è¿è¡Œé¡¹ç›®ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220626/2022062602.png" alt="2022062602"></p>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°ç›®å‰stopå­˜æ”¾çš„æ˜¯14</p>
</blockquote>
<p>å¦‚æœæˆ‘ä»¬åœ¨é¡¹ç›®é‡Œé¢æ·»åŠ ä¸€ä¸ªæ–¹æ³•æ¯”å¦‚ï¼š<code>- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event</code>ï¼Œè¿è¡Œé¡¹ç›®ä¹‹åå†çœ‹æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220626/2022062603.png" alt="2022062603"></p>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°ç›®å‰stopå­˜æ”¾çš„æ˜¯15</p>
</blockquote>
<p>å¤§å®¶å¦‚æœæœ‰å…´è¶£ï¼Œå¯ä»¥åœ¨é¡¹ç›®é‡Œé¢å†æ·»åŠ å‡ ä¸ªå‡½æ•°çœ‹çœ‹stopå­˜æ”¾çš„æ•°å­—çš„å˜åŒ–ï¼Œå˜åŒ–è§„å¾‹æ˜¯ï¼šæ¯æ·»åŠ ä¸€ä¸ªå‡½æ•°ã€æ–¹æ³•ã€blockç­‰ï¼Œstopå­˜æ”¾çš„æ•°å€¼å°±ä¼š+1ã€‚</p>
<div class="note pink no-icon flat"><p><strong>ç»“è®º:</strong></p>
<p><code>__sanitizer_cov_trace_pc_guard_init</code> å‡½æ•°ä½œç”¨æ˜¯ï¼šè·å–æ•´ä¸ªé¡¹ç›®ä¸­ç¬¦å·çš„ä¸ªæ•°ã€‚</p>
</div>
<p><strong>äºŒã€</strong> void __sanitizer_cov_trace_pc_guard(uint32_t *guard)</p>
<p>æˆ‘ä»¬çš„éœ€æ±‚æ˜¯ï¼šèƒ½å¤Ÿè·å–æ‰€æœ‰æ–¹æ³•ã€å‡½æ•°ã€blockçš„è°ƒç”¨é¡ºåºå¹¶ä¸”çŸ¥é“ç¬¦å·çš„åç§°ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æ’åˆ—orderæ–‡ä»¶ã€‚</p>
<p><strong>1</strong>ã€åœ¨é¡¹ç›®æ·»åŠ ä¸€ä¸ªOCæ–¹æ³•ï¼š<code>- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event</code></p>
<p>åœ¨åˆé€‚ä½ç½®ä¸‹æ–­ç‚¹ï¼Œè¿è¡Œé¡¹ç›®ï¼ŒæŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220626/2022062604.png" alt="2022062604"></p>
<p>é€šè¿‡æŸ¥çœ‹æ±‡ç¼–ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220626/2022062605.png" alt="2022062605"></p>
<p><label style="color:green">ä¼šå‘ç°ï¼šè°ƒç”¨ä¸€ä¸ªOCæ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨åˆ°<code>__sanitizer_cov_trace_pc_guard(uint32_t *guard)</code> æ–¹æ³•ã€‚</label></p>
<p><strong>2</strong>ã€åœ¨é¡¹ç›®é‡Œé¢æ·»åŠ ä¸€ä¸ªCå‡½æ•°ï¼š<code>void test()</code></p>
<p>åœ¨åˆé€‚ä½ç½®ä¸‹æ–­ç‚¹ï¼Œè¿è¡Œé¡¹ç›®ï¼ŒæŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220626/2022062606.png" alt="2022062606"></p>
<p>é€šè¿‡æŸ¥çœ‹æ±‡ç¼–ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220626/2022062607.png" alt="2022062607"></p>
<p><label style="color:green">ä¼šå‘ç°ï¼šè°ƒç”¨ä¸€ä¸ªCå‡½æ•°æ—¶ï¼Œä¼šè°ƒç”¨åˆ°<code>__sanitizer_cov_trace_pc_guard(uint32_t *guard)</code> æ–¹æ³•ã€‚</label></p>
<p>åŒç†ï¼Œä½ ä¹Ÿå¯ä»¥æ·»åŠ ä¸€ä¸ªblockç„¶åå»çœ‹å‡½æ•°è°ƒç”¨æ ˆå’Œæ±‡ç¼–å¯ä»¥å¾—å‡ºç›¸åŒçš„ç»“è®ºï¼š</p>
<div class="note pink no-icon flat"><p><strong>ç»“è®º:</strong></p>
<p><code>__sanitizer_cov_trace_pc_guard</code> å‡½æ•°ä½œç”¨æ˜¯ï¼šHookäº†é¡¹ç›®æ‰€æœ‰çš„æ–¹æ³•ã€å‡½æ•°ã€blockã€‚</p>
</div>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import &lt;dlfcn.h&gt;</span></span><br><span class="line"><span class="type">void</span> __sanitizer_cov_trace_pc_guard(uint32_t *guard) &#123;</span><br><span class="line">   <span class="keyword">if</span> (!*guard) <span class="keyword">return</span>; // æŠŠè¿™ä¸ªæ³¨é‡Šæ‰ +<span class="keyword">load</span>æ–¹æ³•ä¹Ÿä¼šhookåˆ°</span><br><span class="line">    Dl_info <span class="keyword">info</span>;</span><br><span class="line">    <span class="type">void</span> *PC = __builtin_return_address(<span class="number">0</span>);</span><br><span class="line">    dladdr(PC, &amp;<span class="keyword">info</span>);</span><br><span class="line">    NSLog(@&quot;name:%s\n&quot;,<span class="keyword">info</span>.dli_sname);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PCçš„å€¼æ˜¯æŒ‡è¿”å›åˆ°ä¸Šä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œæ¯”å¦‚æ˜¯test()å‡½æ•°è°ƒç”¨åˆ°è¯¥æ–¹æ³•é‡Œé¢ï¼Œé‚£ä¹ˆPCçš„å€¼å°±æ˜¯test()å‡½æ•°çš„å€¼ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬é€šè¿‡æ±‡ç¼–å¯ä»¥çœ‹åˆ°PCè¿”å›çš„å°±æ˜¯ä¸Šä¸€ä¸ªç¬¦å·çš„å‡½æ•°åœ°å€ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220626/2022062608.png" alt="2022062608"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220626/2022062609.png" alt="2022062609"></p>
<p>é€šè¿‡æ§åˆ¶å°æ‰“å°ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220626/2022062610.png" alt="2022062610"></p>
<div class="note green no-icon flat"><p><strong>åˆ†æ:</strong></p>
<p>è¿™ä¸ªç©ºé¡¹ç›®å¯åŠ¨æ—¶åˆ»è°ƒç”¨çš„æ–¹æ³•æœ‰ä¸Šé¢æ‰“å°çš„è¿™äº›ï¼Œä¸€å…±æ˜¯14ä¸ªï¼Œä¹Ÿå’Œæˆ‘ä»¬å‰é¢è®²<code>void __sanitizer_cov_trace_pc_guard_init(uint32_t *start, uint32_t *stop)</code>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ—¶çš„æ‰“å°æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>æˆ‘ä»¬å·²ç»é€šè¿‡ä¸Šé¢çš„å‡½æ•°è§£å†³äº†æˆ‘ä»¬çš„é—®é¢˜ï¼šæ‹¿åˆ°è°ƒç”¨é¡ºåºå’Œå‡½æ•°çš„åç§°ï¼ŒäºŒè¿›åˆ¶é‡æ’æœ€å¤§çš„é—®é¢˜æˆ‘ä»¬å·²ç»è§£å†³ã€‚</p>
</div>
<h3 id="Orderæ–‡ä»¶">Orderæ–‡ä»¶</h3>
<p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ª.orderæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶é‡Œé¢å¯¹ç¬¦å·è¿›è¡Œæ’åºï¼ŒæŠŠåº”ç”¨å¯åŠ¨æ—¶åˆ»è°ƒç”¨çš„æ–¹æ³•æ’åˆ°å‰é¢ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘PageFaultæ¬¡æ•°ä»è€Œå‡å°‘å¯åŠ¨æ—¶é•¿ï¼Œå…·ä½“å¦‚ä½•åˆ›å»ºOrderæ–‡ä»¶å¯ä»¥å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« ï¼š<a href="https://codersunny.com/posts/23c5d0e7/">iOSé‡å­¦ä¹‹å¯åŠ¨ä¼˜åŒ–ï¼ˆäºŒï¼‰- äºŒè¿›åˆ¶é‡æ’</a> ã€‚</p>
<h2 id="æ€»ç»“-3">æ€»ç»“</h2>
<p>å…³äºç”¨Clangæ’æ¡©çš„æ–¹æ³•å»è§£å†³äºŒè¿›åˆ¶é‡æ’å¦‚ä½•æ’åºçš„é—®é¢˜åˆ°è¿™é‡Œå°±åŸºæœ¬ç»“æŸäº†ï¼Œå½“ç„¶ä¹Ÿé—ç•™äº†ä¸€äº›é—®é¢˜ï¼šæ¯”å¦‚å¦‚æœé¡¹ç›®é‡Œé¢æœ‰Swiftã€å¾ªç¯ç­‰ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„Clangåº”è¯¥å¦‚ä½•å»åšè¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œå¤§å®¶æœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±å»ç ”ç©¶ä¸€ä¸‹ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>å¯åŠ¨ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘å¯åŠ¨ä¼˜åŒ–ï¼ˆäºŒï¼‰- äºŒè¿›åˆ¶é‡æ’</title>
    <url>/posts/23c5d0e7/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-24">å†™åœ¨å‰é¢</h2>
<p>åœ¨ç¬¬ä¸€éƒ¨åˆ†<a href="https://codersunny.com/posts/a5b508b2/">iOSé‡å­¦ä¹‹å¯åŠ¨ä¼˜åŒ–ï¼ˆä¸€ï¼‰</a>ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ä»<code>Pre-main</code>å’Œ<code>main</code>ä¹‹åä¸¤ä¸ªæ—¶é—´æ¥è¡¡é‡ä¸€ä¸ªiOSåº”ç”¨å¯åŠ¨çš„æ—¶é•¿ï¼Œä»¥åŠè¯¦ç»†åˆ†æäº†<code>Pre-main</code>çš„å››ä¸ªé˜¶æ®µï¼Œå…¶ä¸­ä¹Ÿæåˆ°äº†ä¸€äº›æ¦‚å¿µï¼šæ¯”å¦‚<strong>ç‰©ç†å†…å­˜</strong>ã€<strong>è™šæ‹Ÿå†…å­˜</strong>ã€<strong>ç¼ºé¡µä¸­æ–­</strong>ç­‰ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç§»æ­¥ä¸Šä¸€ç¯‡æ–‡ç« äº†è§£ä¸€ä¸‹ï¼Œæœ¬æ–‡ä¸»è¦è·Ÿå¤§å®¶è¯¦ç»†è®¨è®ºä¸€ä¸‹ä»€ä¹ˆæ˜¯<strong>äºŒè¿›åˆ¶é‡æ’</strong>ã€<strong>äºŒè¿›åˆ¶é‡æ’ä¸ºä»€ä¹ˆèƒ½å¤Ÿä¼˜åŒ–iOSåº”ç”¨å¯åŠ¨æ—¶é—´</strong>ç­‰é—®é¢˜ã€‚</p>
<h2 id="ç‰©ç†å†…å­˜-è™šæ‹Ÿå†…å­˜">ç‰©ç†å†…å­˜ &amp; è™šæ‹Ÿå†…å­˜</h2>
<p><strong>ç‰©ç†å†…å­˜</strong>ï¼šæŒ‡çš„æ˜¯é€šè¿‡ç‰©ç†å†…å­˜æ¡è·å¾—çš„å†…å­˜ç©ºé—´ã€‚</p>
<p><strong>è™šæ‹Ÿå†…å­˜</strong>ï¼šè·Ÿç‰©ç†å†…å­˜ç›¸åï¼Œè™šæ‹Ÿå†…å­˜æŒ‡çš„ä¸€ç§è®¡ç®—æœºç³»ç»Ÿå†…å­˜ç®¡ç†æŠ€æœ¯ï¼Œå®ƒä½¿å¾—åº”ç”¨ç¨‹åºè®¤ä¸ºå®ƒæ‹¥æœ‰è¿ç»­å¯ç”¨çš„å†…å­˜ï¼Œå®é™…ä¸Šå®ƒé€šå¸¸è¢«åˆ†éš”æˆå¤šä¸ªç‰©ç†å†…å­˜ç¢ç‰‡ã€‚</p>
<p>åªè°ˆæ¦‚å¿µå¤ªç©ºæ´ï¼Œä¸‹é¢æˆ‘ä»¬ç”¨å›¾æ¥è§£é‡Šä»€ä¹ˆæ˜¯ç‰©ç†å†…å­˜ã€ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜ã€‚</p>
<p>ç‰©ç†å†…å­˜çš„æ¦‚è¿°å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061501.png" alt="2022061501"></p>
<div class="note pink no-icon flat"><p><strong>åˆ†æ</strong>ï¼š</p>
<p>åœ¨æ²¡æœ‰è™šæ‹Ÿå†…å­˜çš„æ¦‚å¿µä¹‹å‰ï¼Œæ¯ä¸ªåº”ç”¨ä¸€å¯åŠ¨ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šæŠŠæ•´ä¸ªåº”ç”¨æ”¾è¿›ç‰©ç†å†…å­˜é‡Œé¢ã€‚</p>
</div>
<div class="note green no-icon flat"><p><strong>ç‰©ç†å†…å­˜å­˜åœ¨çš„é—®é¢˜</strong>ï¼š</p>
<ul>
<li>å†…å­˜ç´§å¼ çš„é—®é¢˜ - ç”±äºæ¯æ¬¡éƒ½æ˜¯ç›´æ¥æŠŠæ•´ä¸ªåº”ç”¨æ”¾è¿›ç‰©ç†å†…å­˜é‡Œé¢ï¼Œå¾ˆå¯èƒ½å‡ºç°å†…å­˜ä¸å¤Ÿç”¨çš„æƒ…å†µã€‚</li>
<li>è¿›ç¨‹çš„å®‰å…¨é—®é¢˜ - æ²¡ä¸ªè¿›ç¨‹ä¹‹é—´çš„ç‰©ç†åœ°å€æ˜¯è¿ç»­çš„ï¼Œå¯ä»¥æ‹¿åˆ°åˆ«çš„è¿›ç¨‹çš„åœ°å€ï¼Œå®¹æ˜“å‡ºç°è¿›ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ã€‚</li>
</ul>
</div>
<p>è™šæ‹Ÿå†…å­˜çš„æ¦‚è¿°å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061502.png" alt="2022061502"></p>
<div class="note pink no-icon flat"><p><strong>åˆ†æ</strong>ï¼š</p>
<p>è™šæ‹Ÿå†…å­˜çš„æŠ€æœ¯å‡ºç°ä¹‹åï¼Œæ¯ä¸ªè¿›ç¨‹å¹¶ä¸æ˜¯ç›´æ¥å…¨éƒ¨æ‰”è¿›ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯ç»™æ¯ä¸ªåº”ç”¨åˆ†é…ä¸€ä¸ªè™šæ‹Ÿçš„å†…å­˜ï¼Œè™šæ‹Ÿå†…å­˜é€šè¿‡<strong>è™šæ‹Ÿé¡µè¡¨</strong>æ¥æŠŠç›¸åº”æ•°æ®æ”¾è¿›ç‰©ç†å†…å­˜é‡Œé¢ã€‚</p>
<p><strong>è™šæ‹Ÿå†…å­˜</strong>çš„æŠ€æœ¯å‡ºç°ä¹‹åï¼Œä¹Ÿæœ‰äº†<strong>å†…å­˜åˆ†é¡µ</strong>çš„æ¦‚å¿µï¼Œ<strong>è™šæ‹Ÿé¡µè¡¨</strong>æŠŠä¸€ä¸ªè¿›ç¨‹åˆ†æˆè‹¥å¹²é¡µï¼Œæ¯”å¦‚ï¼š<code>Page1</code>ã€<code>Page2</code>ã€<code>Page3</code>â€¦ï¼Œå½“å¯åŠ¨è¿›ç¨‹1çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠ<code>Page1</code>è£…è½½è¿›ç‰©ç†å†…å­˜ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå¦‚ä¸Šå›¾ã€‚</p>
<p><strong>PS</strong>ï¼šå¤§å®¶æ³¨æ„ä¸Šå›¾çš„é¢œè‰²åŒºåˆ†èƒ½å¤Ÿå¾ˆå¥½çš„ç†è§£è™šæ‹Ÿå†…å­˜ç›¸å…³æ¦‚å¿µã€‚</p>
</div>
<div class="note green no-icon flat"><p><strong>è™šæ‹Ÿå†…å­˜</strong>è§£å†³äº†<strong>ç‰©ç†å†…å­˜</strong>å­˜åœ¨çš„ä¸¤ä¸ªé—®é¢˜ï¼Œç”±äºæ¯ä¸ªè¿›ç¨‹çš„æ•°æ®è¢«åˆ†æˆäº†å¾ˆå¤šé¡µè£…è½½è¿›å†…å­˜ï¼Œä¸ä¼šå†å‡ºç°å†…å­˜ç´§å¼ çš„é—®é¢˜ï¼Œè€Œä¸”ä¸€ä¸ªåº”ç”¨åœ¨ç‰©ç†å†…å­˜é‡Œé¢çš„åœ°å€æ˜¯ä¸è¿ç»­çš„ï¼Œæ‰€ä»¥æ— æ³•è®¿é—®åˆ°åˆ«çš„è¿›ç¨‹çš„åœ°å€ï¼Œä¹Ÿä¿è¯äº†çº¿ç¨‹å®‰å…¨ã€‚</p>
</div>
<p><strong>æ³¨æ„</strong>ï¼šè™½ç„¶ä¸€ä¸ªåº”ç”¨åœ¨ç‰©ç†å†…å­˜ä¸­çš„å†…å­˜æ˜¯ä¸è¿ç»­çš„ï¼Œä½†æ˜¯è®¿é—®æ•°æ®çš„æ—¶å€™æ˜¯è¿ç»­çš„ï¼ŒåŸå› å°±åœ¨äºæˆ‘ä»¬è®¿é—®æ•°æ®è®¿é—®çš„æ˜¯å¯¹åº”çš„è™šæ‹Ÿæ˜ å°„è¡¨ï¼Œè¿™ä¸ªè™šæ‹Ÿæ˜ å°„è¡¨è®°å½•çš„æŸä¸ªæ–¹æ³•ã€å‡½æ•°å¯¹åº”åœ¨ç‰©ç†å†…å­˜çš„çœŸå®åœ°å€ã€‚</p>
<h2 id="ç¼ºé¡µä¸­æ–­ï¼ˆPageFaultï¼‰">ç¼ºé¡µä¸­æ–­ï¼ˆPageFaultï¼‰</h2>
<p>åœ¨ä¸Šé¢æˆ‘ä»¬è¯´è¿‡åœ¨æœ‰äº†<strong>è™šæ‹Ÿå†…å­˜</strong>æŠ€æœ¯ä¹‹åï¼Œå†…å­˜ä»¥åˆ†é¡µçš„å½¢å¼è£…è½½è¿›ç‰©ç†å†…å­˜é‡Œé¢ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨å¯åŠ¨ä¸€ä¸ªåº”ç”¨åªéœ€è¦å…ˆæŠŠå¯åŠ¨ç›¸å…³çš„å†…å­˜<code>Page1</code>åˆ°<code>Page10</code>è£…è½½è¿›ç‰©ç†å†…å­˜ï¼Œå½“ç”¨åˆ°AåŠŸèƒ½çš„æ—¶å€™å‘ç°æ•°æ®æ²¡æœ‰åœ¨ç‰©ç†å†…å­˜é‡Œé¢ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿä¼šé˜»å¡APPè¿›ç¨‹è§¦å‘ä¸€æ¬¡<strong>PageFault</strong>ï¼Œæ“ä½œç³»ç»Ÿä¼šä»ç£ç›˜ä¸­è¯»å–ç›¸åº”çš„æ•°æ®åˆ°ç‰©ç†å†…å­˜ä¸Šï¼Œå†å°†å…¶æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜é¡µè¡¨ä¸Šé¢ã€‚<strong>PageFault</strong>è€—æ—¶éå¸¸çŸ­ï¼Œå¹³å‡åœ¨0.5mså·¦å³ï¼Œæ‰€ä»¥ç”¨æˆ·ä¸€èˆ¬æ„ŸçŸ¥ä¸åˆ°ï¼Œä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µå¯èƒ½ä¼šé€ æˆå¤§é‡çš„<strong>PageFault</strong>ï¼Œé‚£å°±æ˜¯å¯åŠ¨æ—¶åˆ»ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥æ€è€ƒå¦‚ä½•å‡å°‘å¯åŠ¨æ—¶çš„<strong>PageFault</strong>æ¬¡æ•°ï¼Œä»è€Œä¼˜åŒ–å¯åŠ¨æ—¶é•¿ã€‚</p>
<h2 id="äºŒè¿›åˆ¶é‡æ’">äºŒè¿›åˆ¶é‡æ’</h2>
<p>åœ¨åˆ†æäºŒè¿›åˆ¶é‡æ’ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹Link Map Fileæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ã€‚</p>
<h3 id="é“¾æ¥æ˜ å°„æ–‡ä»¶">é“¾æ¥æ˜ å°„æ–‡ä»¶</h3>
<p><strong>é“¾æ¥æ˜ å°„æ–‡ä»¶</strong>ï¼šLink Map Fileï¼Œé‡Œé¢è®°å½•çš„æ˜¯æ¯ä¸ªç±»æ‰€ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ã€CPUæ¶æ„ã€ç¬¦å·ç­‰ä¿¡æ¯ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºè¿™ä¸ªæ–‡ä»¶å‘Šè¯‰äº†æˆ‘ä»¬ä¸€ä¸ªåº”ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶çš„æ’åˆ—é¡ºåºã€‚</p>
<div class="note pink no-icon flat"><p>BuildSetting - Write Link Map Fileè®¾ç½®ä¸ºYESã€‚</p>
</div>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061504.png" alt="2022061504"></p>
<p>ç¼–è¯‘é¡¹ç›®ä¹‹åæ ¹æ®ä¸Šå›¾çš„åœ°å€æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„Link Map æ–‡ä»¶ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061505.png" alt="2022061505"></p>
<p>æ–‡ä»¶èµ„æºçš„ç¼–è¯‘é¡ºåºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061506.png" alt="2022061506"></p>
<div class="note green no-icon flat"><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºä¸€ä¸ªé¡¹ç›®å¯æ‰§è¡Œæ–‡ä»¶çš„æ’åˆ—é¡ºåºä¸ºï¼š</p>
<ul>
<li>å…ˆæŒ‰ç…§é¡¹ç›® - Build Phases - Compile Sourcesä¸­çš„é¡ºåºæ’åˆ—</li>
<li>å†æŒ‰æ¯ä¸ªæ–‡ä»¶é‡Œé¢ä»ä¸Šè‡³ä¸‹çš„æ–¹æ³•é¡ºåºæ’åˆ—</li>
</ul>
</div>
<h3 id="ä»€ä¹ˆæ˜¯äºŒè¿›åˆ¶é‡æ’">ä»€ä¹ˆæ˜¯äºŒè¿›åˆ¶é‡æ’</h3>
<p>é‡æ–°æ’åˆ—å‡½æ•°ç¬¦å·çš„ä½ç½®ï¼Œé™ä½Mach-oæ–‡ä»¶è½½å…¥ç‰©ç†å†…å­˜æ—¶è§¦å‘çš„<strong>PageFault</strong>æ¬¡æ•°ï¼Œè¿™ä¸ªå°±å«<strong>äºŒè¿›åˆ¶é‡æ’</strong>ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆäºŒè¿›åˆ¶é‡æ’èƒ½ä¼˜åŒ–å¯åŠ¨æ—¶é•¿">ä¸ºä»€ä¹ˆäºŒè¿›åˆ¶é‡æ’èƒ½ä¼˜åŒ–å¯åŠ¨æ—¶é•¿</h3>
<p>æˆ‘ä»¬å…ˆæ¥ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªåº”ç”¨å¯åŠ¨éœ€è¦è°ƒç”¨<code>æ–¹æ³•1</code>ã€<code>æ–¹æ³•3</code>ã€<code>æ–¹æ³•4</code>ã€<code>æ–¹æ³•6</code>ã€<code>æ–¹æ³•7</code>ï¼Œå…¶ä¸­<code>æ–¹æ³•1</code>åœ¨Page1é¡µä¸Šï¼Œ<code>æ–¹æ³•6</code>åœ¨Page2é¡µä¸Šï¼Œ<code>æ–¹æ³•3</code>ã€<code>æ–¹æ³•7</code>åœ¨Page3é¡µä¸Šï¼Œ<code>æ–¹æ³•4</code>åœ¨Page4é¡µä¸Šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061503-20220616141820096.png" alt="2022061503"></p>
<p>äºŒè¿›åˆ¶æ’åˆ—åï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061507.png" alt="2022061507"></p>
<div class="note green no-icon flat"><p>ç»è¿‡äºŒè¿›åˆ¶é‡æ’ä¹‹åï¼Œæˆ‘ä»¬æŠŠå¯åŠ¨éœ€è¦è°ƒç”¨çš„æ–¹æ³•å…¨éƒ¨é›†ä¸­åœ¨äº†Page1é‡Œé¢ï¼Œè¿™æ ·åœ¨å¯åŠ¨æ—¶åªéœ€è¦è£…è½½Page1å³å¯ï¼Œç›¸æ¯”ä¹‹å‰å‡å°‘äº†Page2ã€Page3ã€Page4çš„è£…è½½ï¼Œè¿™å°±å‡å°‘äº†<strong>PageFault</strong>çš„æ¬¡æ•°ï¼ŒèŠ‚çœçš„æ—¶é—´å¤§çº¦ä¸ºï¼š0.5ms * 3 = 1.5msã€‚</p>
<p>è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆäºŒè¿›åˆ¶é‡æ’èƒ½å¤Ÿä¼˜åŒ–å¯åŠ¨æ—¶é•¿ã€‚</p>
</div>
<h3 id="äºŒè¿›åˆ¶é‡æ’-2">äºŒè¿›åˆ¶é‡æ’</h3>
<p>iOS åº”ç”¨ä¹‹æ‰€ä»¥èƒ½å¤Ÿè¿›è¡ŒäºŒè¿›åˆ¶é‡æ’å…¶å®æ˜¯å› ä¸ºè‹¹æœçˆ¸çˆ¸æ—©å°±æœ‰äº†è¿™ä¸€å¥—æœºåˆ¶ï¼Œå…¶å®<code>libobjc.order</code>å°±æ˜¯åˆ©ç”¨äºŒè¿›åˆ¶é‡æ’è¿›è¡Œäº†ä¼˜åŒ–ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061508.png" alt="2022061508"></p>
<p>ç°åœ¨æˆ‘ä»¬æ¥ä¸¾ä¸ªç®€å•çš„ä¾‹å­åšäºŒè¿›åˆ¶é‡æ’ï¼š</p>
<p>ä»¥ä¸€ä¸ªæ–°çš„é¡¹ç›®<code>LaunchDemo</code>ä¸ºä¾‹ï¼Œæˆ‘åœ¨<code>ViewController.m</code>æ–‡ä»¶é‡Œé¢æ–°åŠ äº†å‡ ä¸ªæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061510.png" alt="2022061510"></p>
<p><strong>ä¸€</strong>ã€åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>.order</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿™é‡Œå«ï¼š<code>LaunchDemo.order</code>æ–‡ä»¶ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061509.png" alt="2022061509"></p>
<p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹é»˜è®¤çš„ä¸€ä¸ªæ’åˆ—é¡ºåºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061511.png" alt="2022061511"></p>
<p><strong>äºŒ</strong>ã€åœ¨<code>LaunchDemo.order</code>æ–‡ä»¶é‡Œé¢æŒ‡å®šæ¯ä¸ªç¬¦å·çš„æ’åˆ—é¡ºåºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061512.png" alt="2022061512"></p>
<p><strong>ä¸‰</strong>ã€åœ¨<code>Build Setting</code>é‡Œé¢æŒ‡å®š<code>Order File</code>åœ°å€ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061513.png" alt="2022061513"></p>
<p><strong>å››</strong>ã€ç¼–è¯‘é¡¹ç›®ï¼Œæ‰“å¼€Link Map Fileï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220615/2022061514.png" alt="2022061514"></p>
<div class="note orange no-icon flat"><p><strong>åˆ†æ</strong>ï¼š</p>
<p>ç»è¿‡äºŒè¿›åˆ¶é‡æ’ä¹‹åæˆ‘ä»¬å‘ç°<code>Link Map File</code>æ–‡ä»¶é‡Œé¢çš„ç¬¦å·æ’åˆ—é¡ºåºå·²ç»æŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„é¡ºåºæ’åˆ—ï¼Œå…¶ä¸­æˆ‘ä»¬åœ¨<code>LaunchDemo.order</code>æ–‡ä»¶é‡Œé¢æŒ‡å®šçš„<code>-[LaunchDemo test]</code>ç¬¦å·ï¼Œé¡¹ç›®é‡Œé¢æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥åªä¼šè¢«å¿½ç•¥ä¸ä¼šæŠ¥é”™ã€‚</p>
</div>
<p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼ŒäºŒè¿›åˆ¶é‡æ’çš„æ•´ä¸ªæ ¸å¿ƒæˆ‘ä»¬å°±åˆ†æå¾—å·®ä¸å¤šäº†ï¼Œä½†æ˜¯è¿™ä¸ªäºŒè¿›åˆ¶é‡æ’æœ‰ä¸ªæœ€å¤§çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ï¼šæˆ‘ä»¬å¦‚ä½•æ‰èƒ½å‡†ç¡®è·å–é¡¹ç›®å¯åŠ¨æ—¶åˆ»è°ƒç”¨çš„æ–¹æ³•é¡ºåºï¼Œæ¢å¥è¯è¯´æˆ‘æ€ä¹ˆçŸ¥é“æˆ‘è¿™ä¸ªé¡¹ç›®å¯åŠ¨éœ€è¦è°ƒç”¨åˆ°å“ªäº›æ–¹æ³•ã€‚</p>
<h2 id="å†™åœ¨æœ€å-17">å†™åœ¨æœ€å</h2>
<p>äºŒè¿›åˆ¶é‡æ’æœ€å¤§çš„é—®é¢˜æˆ‘ä»¬å·²ç»æŠ›å‡ºæ¥äº†ï¼Œæœ‰å…´è¶£çš„ä¹Ÿå¯ä»¥æƒ³æƒ³åº”è¯¥æ€ä¹ˆåŠï¼Œ<a href="https://codersunny.com/posts/37cd28e5/">ä¸‹ä¸€ç¯‡æ–‡ç« </a>æˆ‘ä»¬å°†é‡ç‚¹åˆ†æå¦‚ä½•ç²¾ç¡®è·å–é¡¹ç›®å¯åŠ¨æ—¶åˆ»è°ƒç”¨çš„æ–¹æ³•é¡ºåºã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>å¯åŠ¨ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ iOSé‡å­¦ã€‘æ¢ç©¶OCå¯¹è±¡çš„æœ¬è´¨</title>
    <url>/posts/431bd9b3/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-25">å†™åœ¨å‰é¢</h2>
<p>è‹¹æœå®˜æ–¹æºç ä¸‹è½½ï¼š<a href="http://opensource.apple.com/tarballs">opensource.apple.com/tarballs</a> -&gt; æœç´¢objc/4 -&gt; ä¸‹è½½æœ€æ–°æºç </p>
<h2 id="Objective-Cçš„æœ¬è´¨">Objective-Cçš„æœ¬è´¨</h2>
<p>åœ¨iOSå¼€å‘ä¸­å¦‚æœæˆ‘ä»¬ä½¿ç”¨OCç¼–å†™çš„ä»£ç ï¼Œå…¶åº•å±‚éƒ½æ˜¯C/C++ä»£ç ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202208/0810/2022081001.png" alt="2022081001"></p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼šObjective-Cä¸­é¢å‘å¯¹è±¡éƒ½æ˜¯åŸºäºC/C++çš„æ•°æ®ç»“æ„ã€<strong>ç»“æ„ä½“</strong>ã€‘å®ç°çš„ã€‚</p>
<p>åœ¨é¢è¯•çš„æ—¶å€™æœ‰çš„é¢è¯•å®˜ä¼šé—®åˆ°æˆ‘ä»¬OCå¯¹è±¡çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å¯ä»¥è¯´æ˜¯ã€<strong>ç»“æ„ä½“</strong>ã€‘ã€‚</p>
<div class="note green no-icon flat"><p>ç”ŸæˆC++æ–‡ä»¶çš„ä¸€äº›å‘½ä»¤ï¼š</p>
<p><code>clang -rewrite-objc main.m -o main.cpp</code>ï¼šæ— æ³•åŒºåˆ†å¹³å° ä¸å»ºè®®ä½¿ç”¨</p>
<p><code>xcrun -sdk iphonesimulator clang -rewrite-objc main.m  -o main.cpp</code>ï¼šæ¨¡æ‹Ÿå™¨</p>
<p><code>xcrun -sdk iphoneos clang -rewrite-objc main.m -o main.cpp</code>ï¼šçœŸæœº</p>
<p><code>xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc æºæ–‡ä»¶å -o è¾“å‡ºçš„cppæ–‡ä»¶å</code>ï¼šarm64æ¶æ„ è¿™ä¸ªå‘½ä»¤æˆ‘ç”¨å¾—æœ€å¤š</p>
</div>
<h2 id="OCå¯¹è±¡çš„æœ¬è´¨">OCå¯¹è±¡çš„æœ¬è´¨</h2>
<h3 id="NSObjectå¯¹è±¡çš„åº•å±‚å®ç°">NSObjectå¯¹è±¡çš„åº•å±‚å®ç°</h3>
<p>å…ˆä»ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­è¯´èµ·ï¼š</p>
<p>åœ¨mainå‡½æ•°é‡Œé¢åˆ›å»ºä¸€ä¸ª<code>NSObject</code>çš„å¯¹è±¡ï¼š<code> NSObject *objc = [[NSObject alloc] init];</code></p>
<p>ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ç”Ÿæˆç›¸åº”çš„C++ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202208/0810/2022081002.png" alt="2022081002"></p>
<p>åˆ†æC++æ–‡ä»¶ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// NSObject Implementation(NSObject åº•å±‚å®ç°)</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NSObject_IMPL</span> &#123;</span><br><span class="line">	Class isa;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">objc_class</span> *Class;</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSObject</span> *objc = [[<span class="built_in">NSObject</span> alloc] init];</span><br></pre></td></tr></table></figure>
<p>è¿™å¥ä»£ç çš„æ„æ€ï¼šåˆ›å»ºå®Œå¯¹è±¡ä¹‹åï¼Œç»™è¿™ä¸ªå¯¹è±¡åˆ†é…å®Œå­˜å‚¨ç©ºé—´ï¼ŒæŠŠè¿™ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€èµ‹å€¼ç»™objcè¿™ä¸ªæŒ‡é’ˆ è¿™æ ·æˆ‘ä»¬æ‰èƒ½é€šè¿‡objcè¿™ä¸ªæŒ‡é’ˆæ‰¾åˆ°è¿™ä¸ªå¯¹è±¡ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202208/0810/2022081003.png" alt="2022081003"></p>
<div class="note green no-icon flat"><p>å¦‚ä½•è®©é¡¹ç›®ä¸­çš„æŸä¸ªæ–‡ä»¶ä¸å‚ä¸ç¼–è¯‘ï¼Ÿ</p>
<p>é¡¹ç›®è®¾ç½® - Build Phases - Compile Sources - åˆ é™¤ä¸éœ€è¦å‚ä¸ç¼–è¯‘çš„æ–‡ä»¶</p>
</div>
<h3 id="class-getInstanceSize-å’Œ-malloc-size">class_getInstanceSize å’Œ malloc_size</h3>
<p>åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ è‡³å°‘éœ€è¦å¤šå°‘å†…å­˜ï¼Ÿ</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="built_in">NSObject</span> *objc = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line"><span class="comment">// è¾“å‡ºå€¼ï¼š8</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;class_getInstanceSize : %zu&quot;</span>,class_getInstanceSize(objc.class)); </span><br><span class="line"></span><br><span class="line"><span class="comment">// æºç </span></span><br><span class="line">size_t class_getInstanceSize(Class cls)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!cls) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> cls-&gt;alignedInstanceSize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ å®é™…åˆ†é…äº†å¤šå°‘å†…å­˜ï¼Ÿ</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&lt;malloc/malloc.h&gt;</span></span></span><br><span class="line"><span class="comment">// è¾“å‡ºå€¼ï¼š16</span></span><br><span class="line">malloc_size((__bridge <span class="keyword">const</span> <span class="type">void</span> *)obj); </span><br></pre></td></tr></table></figure>
<p>æºç ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202208/0810/2022081004.png" alt="2022081004"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202208/0810/2022081005.png" alt="2022081005"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202208/0810/2022081006.png" alt="2022081006"></p>
<p>æŒ‰ç…§ä¸Šé¢çš„æºç å¯ä»¥çœ‹åˆ°ï¼šå­˜åœ¨ã€å†…å­˜å¯¹é½ã€‘çš„æ¦‚å¿µ å½“size&lt;16æ—¶ ä¼šèµ‹å€¼ä¸º16ã€‚</p>
<h3 id="çª¥æ¢NSObjectçš„å†…å­˜">çª¥æ¢NSObjectçš„å†…å­˜</h3>
<p>æ‹¿åˆ°<code>NSObject</code>å¯¹è±¡çš„å†…å­˜åœ°å€ï¼š<code>0x6000021ac070</code></p>
<p>é€šè¿‡Debug - Debug Workflow - View Memory(shift + command + M) æŸ¥çœ‹å†…å­˜æƒ…å†µï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202208/0810/image-20220810161623329.png" alt="image-20220810161623329"></p>
<div class="note green no-icon flat"><p><strong>å†…å­˜åˆ†æ</strong>ï¼š</p>
<p>ä¸Šå›¾æ˜¯16è¿›åˆ¶çš„å†…å­˜åˆ†å¸ƒã€‚</p>
<p>ä¸€ä¸ª16è¿›åˆ¶ä½å¯¹åº”4ä¸ªäºŒè¿›åˆ¶ä½ æ¯”å¦‚äºŒè¿›åˆ¶çš„1001 ç­‰äº 16è¿›åˆ¶çš„9</p>
<p>ä¸Šå›¾ä¸­çš„ã€10ã€‘å¯¹åº”çš„å°±æ˜¯8ä¸ªäºŒè¿›åˆ¶ä½ ä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—èŠ‚</p>
<p>ä»80å¼€å§‹å°±æ˜¯æ–°çš„å¯¹è±¡çš„å†…å­˜ è¿™æ ·æˆ‘ä»¬å¯ä»¥çœ‹åˆ°NSObjectç¡®å®æ˜¯åˆ†é…äº†<label style="color:red">16ä¸ªå­—èŠ‚</label>ã€‚</p>
</div>
<p><label style="color:red">memory readï¼ˆxï¼‰</label>ï¼šè¯»å–å†…å­˜</p>
<p><label style="color:red">memory write</label>ï¼šæ”¹å†™å†…å­˜</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202208/0810/2022081008.png" alt="2022081008"></p>
<h3 id="æ›´å¤æ‚çš„å¯¹è±¡çš„åº•å±‚æ¢ç©¶">æ›´å¤æ‚çš„å¯¹è±¡çš„åº•å±‚æ¢ç©¶</h3>
<p>ğŸŒ° ç°åˆ›å»ºä¸€ä¸ª<strong>Person</strong>å¯¹è±¡ç»§æ‰¿è‡ª<strong>NSObject</strong>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> main(<span class="type">int</span> argc, <span class="type">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> * appDelegateClassName;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        Person *person = [[Person alloc] init];</span><br><span class="line">        person.name = <span class="string">@&quot;Sunny&quot;</span>;</span><br><span class="line">        person.age = <span class="number">12</span>;</span><br><span class="line">      	<span class="comment">// è¾“å‡ºå€¼ï¼š24</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;class_getInstanceSize: %zu&quot;</span>,class_getInstanceSize(person.class));</span><br><span class="line">      	<span class="comment">// è¾“å‡ºå€¼ï¼š32</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;malloc_size: %zu&quot;</span>,malloc_size((__bridge <span class="keyword">const</span> <span class="type">void</span> *)(person)));</span><br><span class="line">      </span><br><span class="line">        appDelegateClassName = <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, appDelegateClassName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è½¬åŒ–ä¸ºC++åº•å±‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="built_in">NSObject_IMPL</span> &#123;</span><br><span class="line">	Class isa;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Person_IMPL &#123;</span><br><span class="line">	<span class="keyword">struct</span> <span class="built_in">NSObject_IMPL</span> <span class="built_in">NSObject_IVARS</span>;</span><br><span class="line">	<span class="built_in">NSString</span> *_name;</span><br><span class="line">	<span class="type">int</span> _age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹<code>person</code>å¯¹è±¡çš„å†…å­˜åˆ†å¸ƒå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202208/0810/2022081009.png" alt="2022081009"></p>
<p><label style="color:red"><strong>åˆ†æ</strong>ï¼š</label></p>
<p><code>f8 d5 e1 07 01 00 00 00</code>æ®µå­˜å‚¨çš„æ˜¯<code>person</code>å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚</p>
<p><code>0c 00 00 00 00 00 00 00</code>æ®µå­˜å‚¨çš„æ˜¯ageçš„å€¼12ã€‚</p>
<p><code>a0 80 e1 07 01 00 00 00</code>æ®µå­˜å‚¨çš„æ˜¯nameçš„å€¼Sunnyã€‚</p>
<p>è®¡ç®—æœºé‡Œé¢åˆ†å¤§ç«¯æ¨¡å¼ã€å°ç«¯æ¨¡å¼ï¼Œä¸åŒçš„ç«¯è¯»å–æ•°æ®çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œåœ¨iOSé‡Œé¢ æ˜¯æŒ‰ç…§ã€å°ç«¯æ¨¡å¼ã€‘çš„æ–¹å¼è¯»å–æ•°æ®ï¼Œã€å°ç«¯æ¨¡å¼ã€‘å³æ˜¯ä»<label style="color:red"><strong>åœ°å€è¾ƒå¤§çš„ä½ç½®</strong></label>å¼€å§‹è¯»å– æ¯”å¦‚<code>0c 00 00 00 00 00 00 00</code>æ®µè¯»å–å°±æ˜¯ï¼š0x0000000c = 12ã€‚</p>
<p><label style="color:red"><strong>æ³¨æ„</strong>ï¼š</label>ç»“æ„ä½“çš„å¤§å°å¿…é¡»æ˜¯æœ€å¤§æˆå‘˜å¤§å°çš„ã€å€æ•°ã€‘ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­class_getInstanceSizeçš„å€¼ä¸º24è€Œä¸æ˜¯20ã€‚</p>
<div class="note green no-icon flat"><p>class_getInstanceSizeï¼šè‡³å°‘éœ€è¦çš„å†…å­˜å¤§å° å€¼å¤§äºç­‰äº16 å¹¶ä¸”æ˜¯8çš„å€æ•°</p>
<p>malloc_sizeï¼šå®é™…åˆ†é…çš„å†…å­˜å¤§å°  å¿…é¡»æ˜¯16çš„å€æ•°</p>
</div>
<div class="note pink no-icon flat"><p>ä¸€äº›åŸºæœ¬æ•°æ®ç±»å‹å ç”¨çš„å­—èŠ‚æ•°ï¼š</p>
<p>BOOLï¼š1ä½</p>
<p>intï¼š4ä½</p>
<p>floatï¼š4ä½</p>
<p>doubleï¼š8ä½</p>
<p>NSIntegerï¼š8ä½</p>
<p>NSUItegerï¼š8ä½</p>
<p>CGFloatï¼š8ä½</p>
</div>
<p><code>sizeof</code>å¯ä»¥å¾—å‡ºæŸç§æ•°æ®ç±»å‹æ‰€å çš„å­—èŠ‚æ•°:</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">size_t BOOL_ByteCount = <span class="keyword">sizeof</span>(<span class="type">BOOL</span>);</span><br><span class="line">size_t <span class="built_in">NSInteger_ByteCount</span> = <span class="keyword">sizeof</span>(<span class="built_in">NSInteger</span>);</span><br></pre></td></tr></table></figure>
<h3 id="å…¶ä»–æ€»ç»“">å…¶ä»–æ€»ç»“</h3>
<div class="note green no-icon flat"><p>1ã€ä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„å†…å­˜é‡Œé¢ä¸ºä»€ä¹ˆä¸å­˜å‚¨æ–¹æ³•è€Œæ˜¯åªå­˜å‚¨äº†æˆå‘˜å˜é‡ï¼Ÿ</p>
<p>æ–¹æ³•æ˜¯ç›¸åŒçš„ åªéœ€è¦å­˜å‚¨ä¸€ä»½å³å¯ï¼Œå­˜å‚¨åœ¨ã€ç±»å¯¹è±¡ã€‘çš„æ–¹æ³•åˆ—è¡¨é‡Œé¢ï¼Œæˆå‘˜å˜é‡å¯ä»¥æœ‰ä¸åŒçš„å€¼æ‰€ä»¥éœ€è¦å­˜å‚¨åœ¨å®ä¾‹å¯¹è±¡çš„å†…å­˜é‡Œé¢ã€‚</p>
<p>2ã€<code>sizeof</code>æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå°±éœ€è¦ç¡®è®¤çš„ æ˜¯ä¸ªè¿ç®—ç¬¦ã€‚</p>
<p>3ã€å†…å­˜å¯¹é½æ˜¯ä¸ºäº†æé«˜CPUçš„è®¿é—®é€Ÿåº¦ã€‚</p>
</div>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘æ–¹æ³•ç¼“å­˜cache_tçš„åˆ†æ</title>
    <url>/posts/39324100/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-26">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡æˆ‘ä»¬ä¸»è¦æ¥åˆ†æä¸€ä¸‹æ–¹æ³•ç¼“å­˜<code>cache_t</code>çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œè‹¹æœæ˜¯æ€ä¹ˆå®ç°æ–¹æ³•ç¼“å­˜çš„ã€‚</p>
<h2 id="Classçš„ç»“æ„">Classçš„ç»“æ„</h2>
<p>åœ¨<a href="!https://codersunny.com/posts/b55a18a8/">ã€iOSé‡å­¦ã€‘çª¥æ¢Classçš„ç»“æ„</a>æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦åˆ†æäº†<code>Class</code>çš„ç»“æ„ï¼Œç»“æ„ä¸»è¦å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_class : objc_object &#123;</span><br><span class="line">  Class isa; <span class="comment">// isa</span></span><br><span class="line">  Class superclass; <span class="comment">// superclass</span></span><br><span class="line">  cache_t cache; <span class="comment">// æ–¹æ³•ç¼“å­˜</span></span><br><span class="line">  class_data_bits_t bits; <span class="comment">// å…·ä½“çš„ç±»ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>isa</code>ã€<code>superclass</code>ã€<code>bits</code>æˆ‘ä»¬éƒ½å·²ç»è®²è¿‡äº†ï¼Œç›¸å…³çš„æ–‡ç« å¯ä»¥å‚è€ƒ<a href="!https://codersunny.com/posts/9efafc5a/">ã€iOSé‡å­¦ã€‘è¯¦ç»†åˆ†æisaå’Œsuperclass</a>å’Œ<a href="!https://codersunny.com/posts/8948fead/">ã€iOSé‡å­¦ã€‘class_rw_ext_tç»“æ„è¯¦è§£</a>ï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥ä¸»è¦åˆ†æä¸€ä¸‹æ–¹æ³•ç¼“å­˜<code>cache_t</code>ã€‚</p>
<h2 id="æ–¹æ³•ç¼“å­˜cache-t">æ–¹æ³•ç¼“å­˜cache_t</h2>
<p>æˆ‘ä»¬éƒ½çŸ¥é“æŸ¥æ‰¾ä¸€ä¸ªæ–¹æ³•çš„æµç¨‹å¤§æ¦‚æ˜¯ï¼šæ ¹æ®<code>isa</code>æŒ‡é’ˆæ‰¾åˆ°ç±»å¯¹è±¡ï¼Œåœ¨ç±»å¯¹è±¡ä¸Šæ‰¾æ˜¯å¦æœ‰å¯¹åº”çš„æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±æ ¹æ®<code>superclass</code>æŒ‡é’ˆæ‰¾åˆ°å…¶çˆ¶ç±»æŸ¥çœ‹æ˜¯å¦æœ‰æ–¹æ³•å®ç°ï¼Œä»¥æ­¤å¾€ä¸Šæ‰¾ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1221/2.png" alt="2"></p>
<p>ä½†æ˜¯å¦‚æœæ¯æ¬¡éƒ½è¿™ä¹ˆå¯»æ‰¾ï¼Œæ•ˆç‡è‚¯å®šä¼šå¾ˆä½ï¼Œæ‰€ä»¥è‹¹æœå°±æœ‰è‡ªå·±çš„ä¸€å¥—æ–¹æ³•ç¼“å­˜æœºåˆ¶ï¼Œè°ƒç”¨è¿‡çš„æ–¹æ³•æˆ‘ä»¬ä¼šç¼“å­˜èµ·æ¥æ–¹ä¾¿ä¸‹æ¬¡è°ƒç”¨æé«˜æ•ˆç‡ã€‚</p>
<h3 id="cache-tç»“æ„">cache_tç»“æ„</h3>
<p>æ–¹æ³•ç¼“å­˜<code>cache_t</code>ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1221/1.png" alt="1"></p>
<p>ä¸»è¦ç»“æ„æˆ‘ä»¬å¯ä»¥çœ‹æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// cache_t</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">cache_t</span> &#123;</span><br><span class="line">	explicit_atomic&lt;<span class="type">mask_t</span>&gt; _maybeMask; <span class="comment">// æ•£åˆ—è¡¨çš„é•¿åº¦</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> __LP64__</span></span><br><span class="line">  <span class="type">uint16_t</span>                _flags;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  <span class="type">uint16_t</span>                _occupied; <span class="comment">// å·²ç¼“å­˜çš„æ–¹æ³•æ•°é‡</span></span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">bucket_t</span> *<span class="built_in">buckets</span>() <span class="type">const</span>; <span class="comment">// æ•£åˆ—è¡¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bucket_t</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">bucket_t</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> __arm64__</span></span><br><span class="line">    explicit_atomic&lt;<span class="type">uintptr_t</span>&gt; _imp;</span><br><span class="line">    explicit_atomic&lt;SEL&gt; _sel;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    explicit_atomic&lt;SEL&gt; _sel;</span><br><span class="line">    explicit_atomic&lt;<span class="type">uintptr_t</span>&gt; _imp;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è‹¹æœå¦‚ä½•å®ç°æ–¹æ³•ç¼“å­˜">è‹¹æœå¦‚ä½•å®ç°æ–¹æ³•ç¼“å­˜</h3>
<p>è‹¹æœæ˜¯åˆ©ç”¨ã€æ•£åˆ—è¡¨ã€‘æ¥å­˜å‚¨æ›¾ç»è°ƒç”¨è¿‡çš„æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥æé«˜æ–¹æ³•çš„æŸ¥æ‰¾é€Ÿåº¦ã€‚</p>
<p>æ•£åˆ—è¡¨çš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1221/3.png" alt="3"></p>
<p>æ–¹æ³•ç¼“å­˜çš„åŸºæœ¬æ­¥éª¤ä¸ºï¼š</p>
<ul>
<li>é€šè¿‡<code>SEL &amp; _maybeMask</code>å¾—åˆ°æ–¹æ³•åœ¨æ•£åˆ—è¡¨é‡Œé¢å¯¹åº”çš„ç´¢å¼•å€¼<code>index</code>ã€‚</li>
<li>è°ƒç”¨æ–¹æ³•çš„æ—¶å€™é€šè¿‡<code>index</code>æ”¾åœ¨æ•£åˆ—è¡¨çš„å…·ä½“ä½ç½®ã€‚</li>
</ul>
<h3 id="å…·ä½“åœºæ™¯">å…·ä½“åœºæ™¯</h3>
<p>æˆ‘ä»¬è¿™é‡Œåˆ—ä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­å¹¶ç»“åˆæ–¹æ³•ç¼“å­˜çš„åº•å±‚ä»£ç æ¥è¯¦ç»†è¯´æ˜æ•´ä¸ªè¿‡ç¨‹ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬æ ¹æ®åº•å±‚æºç æ¥ä»¿ç…§å†™ä¸€ä¸ªæ–¹æ³•ç¼“å­˜çš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ww_bucket_t</span> &#123;<span class="comment">// ç›¸å½“äºbucket_t</span></span><br><span class="line">    SEL _sel;</span><br><span class="line">    IMP _imp;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ww_cache_t</span> &#123;<span class="comment">// ç›¸å½“äºcache_t</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">ww_bucket_t</span>  *buckets;</span><br><span class="line">    <span class="type">uint32_t</span>            _maybeMask;</span><br><span class="line">    <span class="type">uint16_t</span>            _flags;</span><br><span class="line">    <span class="type">uint16_t</span>            _occupied;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ww_class_data_bits_t</span> &#123;<span class="comment">// ç›¸å½“äºclass_data_bits_t</span></span><br><span class="line">    <span class="type">uintptr_t</span> bits;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ww_objc_class</span>&#123;<span class="comment">// ç›¸å½“äºobjc_class</span></span><br><span class="line">    Class ISA;</span><br><span class="line">    Class superclass;</span><br><span class="line">    <span class="type">ww_cache_t</span> cache;</span><br><span class="line">    <span class="type">ww_class_data_bits_t</span> bits;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å…·ä½“çš„åœºæ™¯ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">Person *person = [[Person alloc] init];</span><br><span class="line">Class personClass = [Person <span class="keyword">class</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> ww_objc_class *ww_class = (__bridge <span class="keyword">struct</span> ww_objc_class *)(personClass);</span><br><span class="line">uint32_t index1 = ((<span class="type">long</span> <span class="type">long</span>)<span class="keyword">@selector</span>(init) &amp; ww_class-&gt;cache._maybeMask);</span><br><span class="line"><span class="keyword">for</span> (uint32_t i = <span class="number">0</span>; i &lt; ww_class-&gt;cache._maybeMask; i++) &#123;</span><br><span class="line">    <span class="keyword">struct</span> ww_bucket_t bucket = ww_class-&gt;cache.buckets[i];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;ç´¢å¼•å€¼ï¼š%u - SELï¼š%@ - IMPï¼š%p&quot;</span>,i, <span class="built_in">NSStringFromSelector</span>(bucket._sel),bucket._imp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;å·²ç¼“å­˜çš„æ–¹æ³•ä¸ªæ•°ï¼š%hu - æ•£åˆ—è¡¨å®é™…é•¿åº¦ï¼š%u &quot;</span>,ww_class-&gt;cache._occupied,ww_class-&gt;cache._maybeMask);</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;----------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">[person personTest];</span><br><span class="line">uint32_t index2 = ((<span class="type">long</span> <span class="type">long</span>)<span class="keyword">@selector</span>(personTest) &amp; ww_class-&gt;cache._maybeMask);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (uint32_t i = <span class="number">0</span>; i &lt; ww_class-&gt;cache._maybeMask; i++) &#123;</span><br><span class="line">    <span class="keyword">struct</span> ww_bucket_t bucket = ww_class-&gt;cache.buckets[i];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;ç´¢å¼•å€¼ï¼š%u - SELï¼š%@ - IMPï¼š%p&quot;</span>,i, <span class="built_in">NSStringFromSelector</span>(bucket._sel),bucket._imp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;å·²ç¼“å­˜çš„æ–¹æ³•ä¸ªæ•°ï¼š%hu - æ•£åˆ—è¡¨å®é™…é•¿åº¦ï¼š%u &quot;</span>,ww_class-&gt;cache._occupied,ww_class-&gt;cache._maybeMask);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;--------------------------&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">17.814393</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79639</span>:<span class="number">8983291</span>] ç´¢å¼•å€¼ï¼š<span class="number">0</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">17.815222</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79639</span>:<span class="number">8983291</span>] ç´¢å¼•å€¼ï¼š<span class="number">1</span> - SELï¼šinit - IMPï¼š<span class="number">0x7fe150</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">17.815306</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79639</span>:<span class="number">8983291</span>] ç´¢å¼•å€¼ï¼š<span class="number">2</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">17.815359</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79639</span>:<span class="number">8983291</span>] å·²ç¼“å­˜çš„æ–¹æ³•ä¸ªæ•°ï¼š<span class="number">1</span> - æ•£åˆ—è¡¨å®é™…é•¿åº¦ï¼š<span class="number">3</span> </span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">17.815406</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79639</span>:<span class="number">8983291</span>] ----------------------</span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">17.815450</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79639</span>:<span class="number">8983291</span>] -[Person personTest]</span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">17.815493</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79639</span>:<span class="number">8983291</span>] ç´¢å¼•å€¼ï¼š<span class="number">0</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">17.815646</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79639</span>:<span class="number">8983291</span>] ç´¢å¼•å€¼ï¼š<span class="number">1</span> - SELï¼šinit - IMPï¼š<span class="number">0x7fe150</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">17.815704</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79639</span>:<span class="number">8983291</span>] ç´¢å¼•å€¼ï¼š<span class="number">2</span> - SELï¼špersonTest - IMPï¼š<span class="number">0xbbb0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">17.815753</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79639</span>:<span class="number">8983291</span>] å·²ç¼“å­˜çš„æ–¹æ³•ä¸ªæ•°ï¼š<span class="number">2</span> - æ•£åˆ—è¡¨å®é™…é•¿åº¦ï¼š<span class="number">3</span> </span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">17.815794</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79639</span>:<span class="number">8983291</span>] --------------------------</span><br></pre></td></tr></table></figure>
<p>å¯¹ç…§æºç æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªæ‰“å°ç»“æœï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cache_t::insert</span><span class="params">(SEL sel, IMP imp, id receiver)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ...... <span class="comment">// æ­¤å¤„çœç•¥äº†ä¸€äº›æ— å…³ä»£ç </span></span><br><span class="line">  <span class="type">mask_t</span> newOccupied = <span class="built_in">occupied</span>() + <span class="number">1</span>; <span class="comment">// è®°å½•æ–°çš„ç¼“å­˜æ–¹æ³•æ•°é‡</span></span><br><span class="line">  <span class="type">unsigned</span> oldCapacity = <span class="built_in">capacity</span>(), capacity = oldCapacity;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">slowpath</span>(<span class="built_in">isConstantEmptyCache</span>())) &#123; <span class="comment">// ç¬¬ä¸€æ¬¡è¿›æ¥ç¼“å­˜ä¸ºç©ºçš„</span></span><br><span class="line">      <span class="keyword">if</span> (!capacity) capacity = INIT_CACHE_SIZE; <span class="comment">// è®¡ç®—ç”³è¯·ç©ºé—´çš„å¤§å°</span></span><br><span class="line">      <span class="built_in">reallocate</span>(oldCapacity, capacity, <span class="comment">/* freeOld */</span><span class="literal">false</span>); <span class="comment">// ç”³è¯·ç©ºé—´</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">fastpath</span>(newOccupied + CACHE_END_MARKER &lt;= <span class="built_in">cache_fill_ratio</span>(capacity))) &#123; <span class="comment">// å·²ç»å¼€è¾Ÿçš„ç©ºé—´è¿˜æ²¡æœ‰ç¼“å­˜æ»¡ å¯ä»¥ç»§ç»­ç¼“å­˜</span></span><br><span class="line">      <span class="comment">// Cache is less than 3/4 or 7/8 full. Use it as-is.</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> CACHE_ALLOW_FULL_UTILIZATION</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (capacity &lt;= FULL_UTILIZATION_CACHE_SIZE &amp;&amp; newOccupied + CACHE_END_MARKER &lt;= capacity) &#123;</span><br><span class="line">      <span class="comment">// Allow 100% cache utilization for small buckets. Use it as-is.</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å·²ç»å¼€è¾Ÿçš„ç©ºé—´å·²ç»ç¼“å­˜æ»¡äº† è¿›è¡ŒåŒå€æ‰©å®¹</span></span><br><span class="line">      capacity = capacity ? capacity * <span class="number">2</span> : INIT_CACHE_SIZE;</span><br><span class="line">      <span class="keyword">if</span> (capacity &gt; MAX_CACHE_SIZE) &#123;</span><br><span class="line">          capacity = MAX_CACHE_SIZE;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">reallocate</span>(oldCapacity, capacity, <span class="literal">true</span>); <span class="comment">// å¼€è¾Ÿæ–°çš„ç¼“å­˜ç©ºé—´</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">bucket_t</span> *b = <span class="built_in">buckets</span>();<span class="comment">// å–å‡ºæ–¹æ³•ç¼“å­˜åˆ—è¡¨buckets</span></span><br><span class="line">  <span class="type">mask_t</span> m = capacity - <span class="number">1</span>; <span class="comment">// è®¡ç®—æ•£åˆ—è¡¨å®é™…çš„é•¿åº¦maybemask</span></span><br><span class="line">  <span class="type">mask_t</span> begin = <span class="built_in">cache_hash</span>(sel, m); <span class="comment">// ä½¿ç”¨æ•£åˆ—è¡¨è®¡ç®—æ’å…¥çš„ä½ç½®</span></span><br><span class="line">  <span class="type">mask_t</span> i = begin; <span class="comment">// iè¡¨ç¤ºæ’å…¥çš„ä½ç½®</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">fastpath</span>(b[i].<span class="built_in">sel</span>() == <span class="number">0</span>)) &#123; <span class="comment">// å¦‚æœæ’å…¥çš„ä½ç½®æ˜¯ç©ºçš„ è¡¨ç¤ºå¯ä»¥æ’å…¥ åœ¨å½“å‰ç´¢å¼•å€¼å¤„æ’å…¥è¯¥æ–¹æ³•</span></span><br><span class="line">          <span class="built_in">incrementOccupied</span>();</span><br><span class="line">          b[i].<span class="built_in">set</span>&lt;Atomic, Encoded&gt;(b, sel, imp, <span class="built_in">cls</span>());</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (b[i].<span class="built_in">sel</span>() == sel) &#123; <span class="comment">// åˆ¤æ–­å…¶ä»–çº¿ç¨‹æ˜¯å¦ç¼“å­˜è¿‡è¯¥æ–¹æ³•</span></span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125; <span class="keyword">while</span> (<span class="built_in">fastpath</span>((i = <span class="built_in">cache_next</span>(i, m)) != begin)); <span class="comment">// å¦‚æœiä½ç½®æ²¡æœ‰æ’å…¥æˆåŠŸ é€šè¿‡cache_nextæ‰¾ä¸‹ä¸€ä¸ªå¯ä»¥æ’å…¥çš„ä½ç½®</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">bad_cache</span>(receiver, (SEL)sel);<span class="comment">// å¦‚æœdo/whileå¾ªç¯èµ°å®Œäº†éƒ½æ²¡æœ‰æ‰¾åˆ°å¯ä»¥æ’å…¥çš„ä½ç½®å°±ç¼“å­˜å¤±è´¥</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä¾‹å­åˆ†æï¼š</p>
<ul>
<li>
<p>å½“è°ƒç”¨æ–¹æ³•<code>init</code>çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨åˆ°ä¸Šé¢çš„æºç <code>cache_t::insert</code>æ–¹æ³•ï¼Œæ­¤æ—¶æ–°çš„å·²ç¼“å­˜çš„æ–¹æ³•æ•°<code>newOccupied == 1</code> ï¼Œå®¹é‡<code>capacity == 0</code>ã€‚</p>
</li>
<li>
<p>å› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡è¿›æ¥æ‰€ä»¥ä¹‹å‰æ²¡æœ‰ç¼“å­˜ä¼šè°ƒç”¨åˆ°<code>slowpath(isConstantEmptyCache()</code>é‡Œé¢ã€‚</p>
</li>
<li>
<p>å»è®¡ç®—æ•£åˆ—è¡¨å®¹é‡<code>capacity</code>çš„å¤§å°ï¼š<code>capacity = INIT_CACHE_SIZE</code>ã€‚</p>
<div class="note green no-icon flat"><p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1221/4.png" alt="4"></p>
<p><code>INIT_CACHE_SIZE</code>æ˜¯1å‘å·¦ç§»åŠ¨<code>INIT_CACHE_SIZE_LOG2</code>ä½ï¼Œé‚£å°±æ˜¯4ï¼Œæ‰€ä»¥<code>capacity</code>çš„å€¼ä¸º4ã€‚</p>
</div>
</li>
<li>
<p>è°ƒç”¨<code>reallocate</code>æ–¹æ³•å»ç”³è¯·ç©ºé—´ã€‚</p>
</li>
<li>
<p>æ ¹æ®æˆ‘ä»¬ä¸Šé¢è®²åˆ°çš„æ•£åˆ—è¡¨çš„ç´¢å¼•å€¼è®¡ç®—æ–¹å¼<code>cache_hash(sel, m)</code>å»è·å–<code>init</code>æ–¹æ³•åœ¨æ•£åˆ—è¡¨é‡Œé¢çš„ç´¢å¼•å€¼<code>begin</code>ã€‚</p>
</li>
<li>
<p>å¦‚æœæ•£åˆ—è¡¨å½“å‰ä½ç½®æ˜¯ç©ºçš„å¯ä»¥æ’å…¥å°±æŠŠ<code>init</code>æ–¹æ³•æ’å…¥åˆ°å½“å‰ä½ç½®ã€‚</p>
</li>
</ul>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1221/5.png" alt="5"></p>
<p>è°ƒç”¨<code>init</code>æ—¶ï¼Œæˆ‘ä»¬æ ¹æ®æ–¹æ³•ç¼“å­˜æ•£åˆ—è¡¨ç´¢å¼•å€¼çš„è®¡ç®—æ–¹å¼çœ‹åˆ°<code>init</code>æ–¹æ³•çš„ç´¢å¼•å€¼ä¸ºï¼š1ï¼Œç„¶åçœ‹æ‰“å°ç»“æœ:</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1221/6.png" alt="6"></p>
<p>ç´¢å¼•å€¼ä¸º1çš„ä½ç½®ç¡®å®ç¼“å­˜çš„æ˜¯æˆ‘ä»¬åˆšè°ƒç”¨çš„<code>init</code>æ–¹æ³•ã€‚</p>
<p>åŒç†å½“è°ƒç”¨<code>personTest</code>æ—¶ï¼Œæˆ‘ä»¬æ ¹æ®æ–¹æ³•ç¼“å­˜æ•£åˆ—è¡¨è®¡ç®—ç´¢å¼•å€¼çš„è®¡ç®—æ–¹å¼çœ‹åˆ°<code>personTest</code>æ–¹æ³•çš„ç´¢å¼•å€¼ä¸ºï¼š2ï¼Œç„¶åå¯¹ç…§æ‰“å°ç»“æœç´¢å¼•å€¼ä¸º2çš„ä½ç½®ç¡®å®ç¼“å­˜çš„æ˜¯<code>personTest</code>æ–¹æ³•ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬ç»§ç»­è°ƒç”¨<code>personTest1</code>æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">[person personTest1];</span><br><span class="line">uint32_t index3 = ((<span class="type">long</span> <span class="type">long</span>)<span class="keyword">@selector</span>(personTest1) &amp; ww_class-&gt;cache._maybeMask);</span><br><span class="line"><span class="comment">//        [person personTest2];</span></span><br><span class="line"><span class="comment">//        [person personTest3];</span></span><br><span class="line"><span class="keyword">for</span> (uint32_t i = <span class="number">0</span>; i &lt; ww_class-&gt;cache._maybeMask; i++) &#123;</span><br><span class="line">    <span class="keyword">struct</span> ww_bucket_t bucket = ww_class-&gt;cache.buckets[i];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;ç´¢å¼•å€¼ï¼š%u - SELï¼š%@ - IMPï¼š%p&quot;</span>,i, <span class="built_in">NSStringFromSelector</span>(bucket._sel),bucket._imp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;å·²ç¼“å­˜çš„æ–¹æ³•ä¸ªæ•°ï¼š%hu - æ•£åˆ—è¡¨å®é™…é•¿åº¦ï¼š%u &quot;</span>,ww_class-&gt;cache._occupied,ww_class-&gt;cache._maybeMask);</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">15</span>:<span class="number">00.509028</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79672</span>:<span class="number">8987189</span>] -[Person personTest1]</span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">15</span>:<span class="number">00.515237</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79672</span>:<span class="number">8987189</span>] ç´¢å¼•å€¼ï¼š<span class="number">0</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">15</span>:<span class="number">00.515293</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79672</span>:<span class="number">8987189</span>] ç´¢å¼•å€¼ï¼š<span class="number">1</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">15</span>:<span class="number">00.515343</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79672</span>:<span class="number">8987189</span>] ç´¢å¼•å€¼ï¼š<span class="number">2</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">15</span>:<span class="number">00.515390</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79672</span>:<span class="number">8987189</span>] ç´¢å¼•å€¼ï¼š<span class="number">3</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">15</span>:<span class="number">00.515440</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79672</span>:<span class="number">8987189</span>] ç´¢å¼•å€¼ï¼š<span class="number">4</span> - SELï¼špersonTest1 - IMPï¼š<span class="number">0xba60</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">15</span>:<span class="number">00.515486</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79672</span>:<span class="number">8987189</span>] ç´¢å¼•å€¼ï¼š<span class="number">5</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">15</span>:<span class="number">00.515531</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79672</span>:<span class="number">8987189</span>] ç´¢å¼•å€¼ï¼š<span class="number">6</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">15</span>:<span class="number">00.515577</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">79672</span>:<span class="number">8987189</span>] å·²ç¼“å­˜çš„æ–¹æ³•ä¸ªæ•°ï¼š<span class="number">1</span> - æ•£åˆ—è¡¨å®é™…é•¿åº¦ï¼š<span class="number">7</span> </span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°ï¼šå·²ç¼“å­˜çš„æ–¹æ³•ä¸ªæ•°ä¸º1ï¼Œæ•£åˆ—è¡¨å®é™…é•¿åº¦å˜æˆäº†7ï¼Œæˆ‘ä»¬å‘ç°ä¹‹å‰ç¼“å­˜çš„æ–¹æ³•è¢«æ¸…ç©ºäº†å¹¶ä¸”æ‰©å®¹äº†ï¼Œæˆ‘ä»¬æ¥å¯¹ç…§æºç æ¥çœ‹ä¸€ä¸‹å®ƒæ˜¯ä¸æ˜¯è¯¥å»æ‰©å®¹å¹¶ä¸”æ¸…ç©ºä¹‹å‰çš„ç¼“å­˜äº†ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦é‡ç‚¹çœ‹ä¸€ä¸‹å·²ç»å¼€è¾Ÿçš„ç©ºé—´æ˜¯å¦ç¼“å­˜æ»¡çš„åˆ¤æ–­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">fastpath</span>(newOccupied + CACHE_END_MARKER &lt;= <span class="built_in">cache_fill_ratio</span>(capacity))</span><br></pre></td></tr></table></figure>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1221/7.png" alt="7"></p>
<p>å½“æˆ‘ä»¬è°ƒç”¨äº†<code>init</code>æ—¶å€™ï¼Œ<code>capacity</code>çš„å€¼ä¸º4ã€‚</p>
<ul>
<li>
<p>å½“è°ƒç”¨<code>personTest1</code>æ–¹æ³•æ—¶å€™ï¼Œæˆ‘ä»¬è¦å»æ ¹æ®<code>newOccupied + CACHE_END_MARKER &lt;= cache_fill_ratio(capacity)</code>æ¥åˆ¤æ–­ä¹‹å‰å¼€è¾Ÿçš„ç¼“å­˜ç©ºé—´æ˜¯å¦è¿˜è¶³å¤Ÿï¼Œ<code>newOccupied == 3</code>ï¼Œ<code>CACHE_END_MARKER == 1</code>ï¼Œæ˜¾ç„¶ç¼“å­˜ç©ºé—´ä¸å¤Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œæ‰©å®¹ï¼Œé‚£ä¹ˆ<code>capacity == 8</code>ã€‚</p>
</li>
<li>
<p>è°ƒç”¨<code>reallocate</code>å»é‡æ–°åˆ†é…æ–°çš„ç¼“å­˜ç©ºé—´ï¼Œå¹¶ä¸”æ¸…ç©ºä¹‹å‰çš„ç¼“å­˜ã€‚</p>
<div class="note green no-icon flat"><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cache_t::reallocate</span><span class="params">(<span class="type">mask_t</span> oldCapacity, <span class="type">mask_t</span> newCapacity, <span class="type">bool</span> freeOld)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">bucket_t</span> *oldBuckets = <span class="built_in">buckets</span>();</span><br><span class="line">    <span class="type">bucket_t</span> *newBuckets = <span class="built_in">allocateBuckets</span>(newCapacity);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ASSERT</span>(newCapacity &gt; <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">ASSERT</span>((<span class="type">uintptr_t</span>)(<span class="type">mask_t</span>)(newCapacity<span class="number">-1</span>) == newCapacity<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setBucketsAndMask</span>(newBuckets, newCapacity - <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (freeOld) &#123;</span><br><span class="line">        <span class="built_in">collect_free</span>(oldBuckets, oldCapacity); <span class="comment">// é‡Šæ”¾ä¹‹å‰çš„ç¼“å­˜ç©ºé—´</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div>
</li>
<li>
<p>è°ƒç”¨<code>personTest1</code>æ—¶ï¼Œæ ¹æ®æ–¹æ³•ç¼“å­˜æ•£åˆ—è¡¨è®¡ç®—ç´¢å¼•å€¼çš„è®¡ç®—æ–¹å¼çœ‹åˆ°<code>personTest1</code>æ–¹æ³•çš„ç´¢å¼•å€¼ä¸ºï¼š4,å¯¹ç…§æ‰“å°ç»“æœçœ‹åˆ°ç´¢å¼•å€¼ä¸º4çš„ä½ç½®ç¡®å®å­˜æ”¾äº†<code>personTest1</code>æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">22.334284</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80094</span>:<span class="number">9027062</span>] ç´¢å¼•å€¼ï¼š<span class="number">0</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">22.335782</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80094</span>:<span class="number">9027062</span>] ç´¢å¼•å€¼ï¼š<span class="number">1</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">22.335872</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80094</span>:<span class="number">9027062</span>] ç´¢å¼•å€¼ï¼š<span class="number">2</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">22.335940</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80094</span>:<span class="number">9027062</span>] ç´¢å¼•å€¼ï¼š<span class="number">3</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">22.336055</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80094</span>:<span class="number">9027062</span>] ç´¢å¼•å€¼ï¼š<span class="number">4</span> - SELï¼špersonTest1 - IMPï¼š<span class="number">0xb510</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">22.336156</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80094</span>:<span class="number">9027062</span>] ç´¢å¼•å€¼ï¼š<span class="number">5</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">22.336222</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80094</span>:<span class="number">9027062</span>] ç´¢å¼•å€¼ï¼š<span class="number">6</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">22.336292</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80094</span>:<span class="number">9027062</span>] å·²ç¼“å­˜çš„æ–¹æ³•ä¸ªæ•°ï¼š<span class="number">1</span> - æ•£åˆ—è¡¨å®é™…é•¿åº¦ï¼š<span class="number">7</span> </span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å†è°ƒç”¨<code>personTest2</code>ã€<code>personTest3</code>æ—¶ï¼Œæˆ‘ä»¬è®¡ç®—ç´¢å¼•å€¼åˆ†åˆ«ä¸º0ã€4ï¼Œä½†æ˜¯ç´¢å¼•å€¼ä¸º4çš„ä½ç½®å·²ç»æœ‰å†…å®¹äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šæ ¹æ®<code>cache_next</code>å»æ‰¾åˆ°åˆé€‚çš„ç´¢å¼•å€¼ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> CACHE_END_MARKER</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">mask_t</span> <span class="title">cache_next</span><span class="params">(<span class="type">mask_t</span> i, <span class="type">mask_t</span> mask)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (i+<span class="number">1</span>) &amp; mask;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> __arm64__</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">mask_t</span> <span class="title">cache_next</span><span class="params">(<span class="type">mask_t</span> i, <span class="type">mask_t</span> mask)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i ? i<span class="number">-1</span> : mask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®<code>(4+1) &amp; mask</code>å¾—åˆ°<code>personTest3</code>çš„ç´¢å¼•å€¼ä¸º5ï¼Œå¯¹ç…§æ‰“å°ç»“æœï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">24</span>:<span class="number">41.305299</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80143</span>:<span class="number">9031426</span>] ç´¢å¼•å€¼ï¼š<span class="number">0</span> - SELï¼špersonTest2 - IMPï¼š<span class="number">0xb540</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">24</span>:<span class="number">41.305390</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80143</span>:<span class="number">9031426</span>] ç´¢å¼•å€¼ï¼š<span class="number">1</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">24</span>:<span class="number">41.317936</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80143</span>:<span class="number">9031426</span>] ç´¢å¼•å€¼ï¼š<span class="number">2</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">24</span>:<span class="number">41.318011</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80143</span>:<span class="number">9031426</span>] ç´¢å¼•å€¼ï¼š<span class="number">3</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">24</span>:<span class="number">41.318081</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80143</span>:<span class="number">9031426</span>] ç´¢å¼•å€¼ï¼š<span class="number">4</span> - SELï¼špersonTest1 - IMPï¼š<span class="number">0xb5b0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">24</span>:<span class="number">41.318147</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80143</span>:<span class="number">9031426</span>] ç´¢å¼•å€¼ï¼š<span class="number">5</span> - SELï¼špersonTest3 - IMPï¼š<span class="number">0xb510</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">24</span>:<span class="number">41.318214</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80143</span>:<span class="number">9031426</span>] ç´¢å¼•å€¼ï¼š<span class="number">6</span> - SELï¼š(null) - IMPï¼š<span class="number">0x0</span></span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">15</span>:<span class="number">24</span>:<span class="number">41.318280</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">80143</span>:<span class="number">9031426</span>] å·²ç¼“å­˜çš„æ–¹æ³•ä¸ªæ•°ï¼š<span class="number">3</span> - æ•£åˆ—è¡¨å®é™…é•¿åº¦ï¼š<span class="number">7</span></span><br></pre></td></tr></table></figure>
<h3 id="cache-tæ€»ç»“">cache_tæ€»ç»“</h3>
<p>æ–¹æ³•ç¼“å­˜æ•£åˆ—è¡¨å…¶å®å°±æ˜¯åˆ©ç”¨ç©ºé—´æ¥æ¢æ—¶é—´ï¼Œæé«˜äº†æ–¹æ³•æŸ¥æ‰¾çš„æ•ˆç‡ã€‚</p>
<h2 id="å†™åœ¨æœ€å-18">å†™åœ¨æœ€å</h2>
<p>å…³äºæ–¹æ³•ç¼“å­˜çš„åº•å±‚å®ç°æˆ‘ä»¬å°±å†™åˆ°è¿™é‡Œäº†ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
</li>
</ul>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘æµ…è°ˆiOSçš„åŒ…ä½“ç§¯ä¼˜åŒ–ï¼ˆä¸€ï¼‰</title>
    <url>/posts/94e6df10/</url>
    <content><![CDATA[<h2 id="ä¸ºä»€ä¹ˆè¦åšåŒ…ä½“ç§¯ä¼˜åŒ–">ä¸ºä»€ä¹ˆè¦åšåŒ…ä½“ç§¯ä¼˜åŒ–</h2>
<p>éšç€åº”ç”¨çš„ä¸æ–­æ›´æ–°è¿­ä»£ï¼Œåº”ç”¨å®‰è£…åŒ…çš„ä½“ç§¯ä¼šè¶Šæ¥è¶Šå¤§ï¼Œç”¨æˆ·ä¸‹è½½åº”ç”¨æ¶ˆè€—æµé‡äº§ç”Ÿçš„èµ„è´¹å°±ä¼šè¿›ä¸€æ­¥å¢é•¿ï¼Œä¼šå¯¼è‡´ç”¨æˆ·ä¸‹è½½æ„æ„¿ä¼šç›¸å¯¹ä¸‹é™ã€‚</p>
<p>éšç€åŒ…ä½“ç§¯çš„ä¸æ–­å¢å¤§ï¼Œå®‰è£…åº”ç”¨çš„æ—¶é—´å˜é•¿ä¼šå½±å“ç”¨æˆ·çš„ä½¿ç”¨æ„Ÿå—ï¼Œå¯¹äºå†…å­˜æ¯”è¾ƒå°çš„ä½ç«¯æœºå‹æ¥è¯´ï¼Œåº”ç”¨è§£å‹åå†…å­˜å ç”¨æ›´å¤§ä¹Ÿä¼šå½±å“ç”¨æˆ·çš„ä½¿ç”¨ã€‚</p>
<p>è‹¹æœå¯¹iOS APP å¤§å°æœ‰ä¸¥æ ¼çš„é™åˆ¶ï¼Œè™½ç„¶è‹¹æœå®˜æ–¹ä¹Ÿä¸€ç›´åœ¨æé«˜å¯æ‰§è¡Œæ–‡ä»¶çš„ä¸Šé™ï¼Œåœ¨iOS13 è¿˜å–æ¶ˆäº†å¼ºåˆ¶çš„OTAé™åˆ¶ï¼Œä½†æ˜¯ä¸‹è½½å¤§å°è¶…è¿‡200MBçš„ä¼šé»˜è®¤è¯·æ±‚ç”¨æˆ·ä¸‹è½½è®¸å¯ï¼Œå¹¶ä¸”åœ¨iOS13ä»¥ä¸‹çš„è®¾å¤‡ä¾ç„¶ä¼šå—åˆ°OTAçš„é™åˆ¶ï¼Œå½±å“æ–°ç”¨æˆ·è½¬åŒ–å’Œè€ç”¨æˆ·çš„æ›´æ–°ã€‚</p>
<p>è‹¹æœå¯¹å¯æ‰§è¡Œæ–‡ä»¶å¤§å°æœ‰æ˜ç¡®çš„é™åˆ¶ï¼Œè¶…è¿‡è¯¥é™åˆ¶å¯èƒ½ä¼šAPPå®¡æ ¸è¢«æ‹’ã€‚</p>
<div class="note green no-icon flat"><p><strong>å…·ä½“çš„é™åˆ¶å¦‚ä¸‹ï¼š</strong></p>
<p>1ã€iOS7 ä¹‹å‰ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ‰€æœ‰çš„__TEXTæ®µæ€»å’Œä¸å¾—è¶…è¿‡80MB</p>
<p>2ã€iOS7.x - iOS 8.xï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªç‰¹å®šæ¶æ„ä¸­çš„__TEXTæ®µä¸å¾—è¶…è¿‡60MB</p>
<p>3ã€iOS9 ä¹‹åï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ‰€æœ‰çš„__TEXTæ®µæ€»å’Œä¸å¾—è¶…è¿‡500MB</p>
</div>
<p>æ‰€ä»¥ï¼Œä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œå‡å°‘ç”¨æˆ·ç­‰å¾…çš„æ—¶é—´ï¼ŒåŒ…ä½“ç§¯ä¼˜åŒ–éƒ½æ˜¯APPä¼˜åŒ–ä¸­éå¸¸é‡è¦çš„ä¸€ç¯ã€‚</p>
<h2 id="IPAå®‰è£…åŒ…åˆ†æ">IPAå®‰è£…åŒ…åˆ†æ</h2>
<h3 id="ç›¸å…³çŸ¥è¯†">ç›¸å…³çŸ¥è¯†</h3>
<p>ã€APPåŸå§‹åŒ…ä½“ç§¯ã€‘ï¼šä¸Šä¼ å‰ipaè§£åŒ…åï¼Œå®é™…Appçš„å¤§å°</p>
<p>ã€ä¸‹è½½å¤§å°ã€‘ï¼šAppå‹ç¼©åŒ…ï¼ˆ.ipaæ–‡ä»¶ï¼‰æ‰€å ç”¨çš„ç©ºé—´ï¼Œç”¨æˆ·åœ¨App Storeä¸‹è½½åº”ç”¨æ—¶ä¸‹è½½çš„æ˜¯å‹ç¼©åŒ…ï¼Œè¿™ä¹ˆåšå¯ä»¥èŠ‚çœæµé‡ã€‚</p>
<p>ã€å®‰è£…å¤§å°ã€‘ï¼šå½“å‹ç¼©åŒ…ä¸‹è½½å®Œæˆä¹‹åå°±ä¼šè‡ªåŠ¨è§£å‹ï¼ˆè¿™ä¸ªè§£å‹è¿‡ç¨‹ä¹Ÿå°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„å®‰è£…è¿‡ç¨‹ï¼‰ï¼Œå®‰è£…å¤§å°å°±æ˜¯æŒ‡å‹ç¼©åŒ…è§£å‹ä¹‹åæ‰€å ç”¨çš„ç©ºé—´ã€‚</p>
<p>ã€APPåŸå§‹åŒ…ä½“ç§¯ã€‘ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202208/0810/1.png" alt="1"></p>
<p>ã€ä¸‹è½½å¤§å°ã€‘ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/2.png" alt="2"></p>
<p>ã€å®‰è£…å¤§å°ã€‘ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/3.png" alt="3"></p>
<h3 id="å®‰è£…å¤§å°å’Œä¸‹è½½å¤§å°æ˜¯å¦‚ä½•ç”Ÿæˆçš„">å®‰è£…å¤§å°å’Œä¸‹è½½å¤§å°æ˜¯å¦‚ä½•ç”Ÿæˆçš„</h3>
<p>Appçš„ipaåŒ…ä¸Šä¼ åˆ°è‹¹æœåå°åï¼Œè‹¹æœä¼šå¯¹ä¸Šä¼ çš„ipaåŒ…è§£åŒ…åï¼Œå¯¹äºŒè¿›åˆ¶è¿›è¡Œäº†DRMåŠ å¯†ï¼ˆè¿™ä¸ªåŠ å¯†è¿‡ç¨‹ä¼šå¯¼è‡´åŒ…ä½“ç§¯å¢å¤§ï¼‰å’ŒApp Thinningï¼ŒApp Thinningä¼šæ ¹æ®ä¸åŒçš„æœºå‹å¯¹åŸå§‹åŒ…çš„èµ„æºå’Œä»£ç è¿›è¡Œä¸åŒç¨‹åº¦çš„è£å‰ªï¼Œä»è€Œç”Ÿæˆé€‚é…å…·ä½“æœºå‹çš„ç‰ˆæœ¬ï¼Œä¸‹å›¾æ˜¯å€Ÿç”¨ç½‘å‹æ•´ç†çš„ä¸€å¼ å›¾æ¥æè¿°iOS APPçš„åŒ…çš„ç”Ÿæˆè¿‡ç¨‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/4.png" alt="4"></p>
<h3 id="å®‰è£…åŒ…çš„æ„æˆ">å®‰è£…åŒ…çš„æ„æˆ</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/5.png" alt="5"></p>
<h3 id="æ¾æœå‡ºè¡Œå®‰è£…åŒ…ç°çŠ¶åˆ†æ">æ¾æœå‡ºè¡Œå®‰è£…åŒ…ç°çŠ¶åˆ†æ</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/6.png" alt="6"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/7.png" alt="7"></p>
<h2 id="åŒ…ä½“ç§¯çš„ä¼˜åŒ–æ–¹æ¡ˆ">åŒ…ä½“ç§¯çš„ä¼˜åŒ–æ–¹æ¡ˆ</h2>
<h3 id="Xcodeç¼–è¯‘è®¾ç½®">Xcodeç¼–è¯‘è®¾ç½®</h3>
<p>ä¸€èˆ¬è¿™ä¸€æ­¥æ¯”è¾ƒå®¹æ˜“è¢«å¿½ç•¥ï¼Œå› ä¸ºæåˆ°ä¼˜åŒ–å¤§å®¶æœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯èµ„æºä¼˜åŒ–ï¼Œæ¯”å¦‚ï¼šå›¾ç‰‡å‹ç¼©ã€æ— ç”¨ä»£ç åˆ é™¤ç­‰ï¼Œå¯¹Xcodeè‡ªèº«çš„ç¼–è¯‘ä¼˜åŒ–æåŠçš„åè€Œä¸å¤šï¼Œè€Œä¸”æœ‰çš„è®¾ç½®éœ€è¦é’ˆå¯¹ä¸å®é™…é¡¹ç›®ç»“åˆèµ·æ¥æ‰å¯ä»¥ï¼Œæ¯”å¦‚ï¼šå»æ‰æ–­ç‚¹è°ƒè¯•ã€å¼‚å¸¸æ”¯æŒç­‰ã€‚</p>
<h4 id="Build-Settingså»æ‰å¼‚å¸¸æ”¯æŒ">Build Settingså»æ‰å¼‚å¸¸æ”¯æŒ</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/8.png" alt="8"></p>
<h4 id="Build-Settings-Architecturesè®¾ç½®">Build Settings -&gt; Architecturesè®¾ç½®</h4>
<p>Architetures å¯ä»¥æŒ‡å®šå·¥ç¨‹è¢«ç¼–è¯‘æˆå¯æ”¯æŒå“ªäº›æŒ‡ä»¤é›†ç±»å‹ï¼Œæ”¯æŒçš„æŒ‡ä»¤é›†è¶Šå¤šå°±ä¼šç¼–è¯‘å‡ºè¶Šå¤šä¸ªæŒ‡ä»¤é›†çš„ä»£ç åŒ…ï¼Œä¹Ÿå°±ä¼šå¯¼è‡´ipaåŒ…å˜å¤§ï¼Œé»˜è®¤çš„standrad architeturesï¼ˆarmv7ï¼Œarm64ï¼‰å‚æ•°æ‰“çš„åŒ…é‡Œé¢æœ‰32ä½ã€64ä½ä¸¤ä»½æŒ‡ä»¤é›†ï¼Œæ ¹æ®æ˜¯å¦éœ€è¦32ä½æ¥é€‰æ‹©æ˜¯å¦æ›´æ”¹æŒ‡ä»¤é›†ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/9.png" alt="9"></p>
<p>ä¿®æ”¹è®¾ç½®åï¼ŒipaåŒ…ä½“ç§¯å¤§å°å˜åŒ–ï¼š<strong>78.1MB -&gt; 55.1MB</strong></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/10.png" alt="10"></p>
<h4 id="Build-Settingsä¸ç”Ÿæˆè°ƒè¯•ç¬¦å·">Build Settingsä¸ç”Ÿæˆè°ƒè¯•ç¬¦å·</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/11.png" alt="11"></p>
<h4 id="Build-Settings-Development-PostProcessingè®¾ç½®">Build Settings -&gt; Development PostProcessingè®¾ç½®</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/12.png" alt="12"></p>
<h4 id="Build-Settings-Make-Strings-Read-Onlyè®¾ç½®ä¸ºYESï¼ˆé»˜è®¤ï¼‰">Build Settings -&gt; Make Strings Read-Onlyè®¾ç½®ä¸ºYESï¼ˆé»˜è®¤ï¼‰</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/13.png" alt="13"></p>
<h4 id="Build-Settings-Dead-Code-Strippingè®¾ç½®ä¸ºYESï¼ˆé»˜è®¤ï¼‰">Build Settings -&gt; Dead Code Strippingè®¾ç½®ä¸ºYESï¼ˆé»˜è®¤ï¼‰</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/14.png" alt="14"></p>
<h4 id="Podä¼˜åŒ–">Podä¼˜åŒ–</h4>
<p>å¦‚æœé¡¹ç›®æ˜¯OCä½†æ˜¯ä½¿ç”¨äº†Swiftä¸‰æ–¹åº“ï¼Œå¯ä»¥é’ˆå¯¹å•ä¸ªSwiftåº“ä½¿ç”¨ use_frameworksï¼è€Œä¸æ˜¯å…¨éƒ¨ç¬¬ä¸‰æ–¹åº“éƒ½ä½¿ç”¨ã€‚</p>
<p>åœ¨OCé¡¹ç›®ä¸­ä½¿ç”¨Swiftåº“ ç›´æ¥ä½¿ç”¨use_frameworksï¼ä¼šå¯¼è‡´Podä¸­æ‰€æœ‰çš„åº“éƒ½ä¼šæ‰“æˆåŠ¨æ€åº“ï¼Œä»¥åŠSwiftå’ŒOCåº“çš„ä¾èµ–é—®é¢˜ä¼šå¯¼è‡´ä¾èµ–åº“å¢åŠ ä»è€Œé€ æˆipaåŒ…ä½“ç§¯å¢å¤§ã€‚</p>
<h4 id="Asset-Catalog-Compilerç¼–è¯‘è®¾ç½®ä¼˜åŒ–">Asset Catalog Compilerç¼–è¯‘è®¾ç½®ä¼˜åŒ–</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/15.png" alt="15"></p>
<p>Xcodeå†…ç½®çš„actoolä½¿ç”¨æ‰“å‹ç¼©ç®—æ³•åŒ…æ‹¬ï¼š lzfseã€ palette_imgã€ deepmap2ã€ deepmap_lzfseã€zipï¼Œå…·ä½“ä½¿ç”¨å“ªç§ç®—æ³•è·ŸiOSç³»ç»Ÿç‰ˆæœ¬ã€Asset Catalog Compiler ä¸­Optimizationé…ç½®æœ‰å…³ã€‚</p>
<p>iOS 11.xï¼šå¯¹åº”ç®—æ³•æ˜¯ lzfseã€zip</p>
<p>iOS 12.x - iOS 12.4.xï¼šå¯¹åº”ç®—æ³•æ˜¯ deepmap_lzfseã€palette_img</p>
<p>iOS 13.xï¼šå¯¹åº”ç®—æ³•æ˜¯ deepmap2</p>
<p><strong>æ³¨æ„</strong>ï¼šCocoaPodsç®¡ç†åº“ä¸­çš„Assets catalogçš„ç¼–è¯‘è¿‡ç¨‹åœ¨CocoaPodsç”Ÿæˆçš„Copy Pods Resourcesè¿™ä¸ªè„šæœ¬é‡Œé¢ï¼Œæ‰€ä»¥ä¸Šé¢çš„è®¾ç½®å¯¹Podåº“ç»„ä»¶æ— æ•ˆã€‚</p>
<h4 id="Build-Settings-Optimization-Level-æ”¹ä¸º-Oz">Build Settings -&gt; Optimization Level æ”¹ä¸º-Oz</h4>
<p>Optimization Levelé»˜è®¤ä¸º-Osï¼Œ-Ozæ˜¯Xcode 11ä¹‹åæ‰å‡ºç°çš„ç¼–è¯‘ä¼˜åŒ–é€‰é¡¹ï¼Œæ ¸å¿ƒåŸç†æ˜¯å¯¹é‡å¤çš„è¿ç»­æœºå™¨æŒ‡ä»¤å¤–è”æˆå‡½æ•°è¿›è¡Œå¤ç”¨ï¼Œå› æ­¤å¼€å¯Ozï¼Œèƒ½å‡å°‘äºŒè¿›åˆ¶çš„å¤§å°ï¼Œä½†åŒæ—¶ä¼šå¸¦æ¥æ‰§è¡Œæ•ˆç‡çš„é¢å¤–æ¶ˆè€—ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/16.png" alt="16"></p>
<h4 id="Build-Settings-Link-Time-Optimizationè®¾ç½®ä¸ºIncremental">Build Settings -&gt; Link-Time Optimizationè®¾ç½®ä¸ºIncremental</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/17.png" alt="17"></p>
<p>è‹¹æœåœ¨2016å¹´çš„WWDC Whatâ€™s new in LLVM ä¸­è¯¦ç»†ä»‹ç»äº†è¿™ä¸ªåŠŸèƒ½ï¼ŒLTOèƒ½å¸¦æ¥çš„ä¼˜åŒ–æœ‰ï¼š</p>
<div class="note green no-icon flat"><p>å°†ä¸€äº›å‡½æ•°å†…è”åŒ–ï¼šä¸ç”¨è¿›è¡Œè°ƒç”¨å‡½æ•°å‰çš„å‹æ ˆã€è°ƒç”¨å‡½æ•°åçš„å‡ºæ ˆæ“ä½œï¼Œæé«˜è¿è¡Œæ•ˆç‡å’Œæ ˆç©ºé—´çš„åˆ©ç”¨ç‡ã€‚</p>
<p>å»é™¤ä¸€äº›æ— ç”¨ä»£ç </p>
<p>å¯¹ç¨‹åºæœ‰å…¨å±€çš„ä¼˜åŒ–ä½œç”¨ï¼šæ¯”å¦‚ifæ–¹æ³•ä¸‹çš„æŸä¸ªåˆ†æ”¯æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼Œé‚£ä¹ˆåœ¨ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶é‡Œé¢å°±ä¸åº”è¯¥åŒ…å«è¿™éƒ¨åˆ†ä»£ç ã€‚</p>
</div>
<p>å¦å¤–è‹¹æœè¿˜ç§°LTOå¯¹appçš„è¿è¡Œé€Ÿåº¦ä¹Ÿæœ‰æ­£å‘çš„å¸®åŠ©ï¼Œä½†æ˜¯ä¼šé™ä½LTOçš„ç¼–è¯‘é“¾æ¥çš„é€Ÿåº¦ï¼Œå› æ­¤åªå»ºè®®åœ¨æ‰“æ­£å¼åŒ…æ—¶è®¾ç½®æ”¹é€‰é¡¹ï¼ŒåŒæ—¶ä¹Ÿä¼šå¯¼è‡´link mapçš„å¯è¯»æ€§æ˜æ˜¾é™ä½ã€‚</p>
<h4 id="Build-Settings-Enable-On-Demand-Resourcesè®¾ç½®ä¸ºYESï¼ˆé»˜è®¤ï¼‰">Build Settings -&gt; Enable On Demand Resourcesè®¾ç½®ä¸ºYESï¼ˆé»˜è®¤ï¼‰</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/18.png" alt="18"></p>
<h3 id="Xcodeç¼–è¯‘è®¾ç½®ä¼˜åŒ–æ€»ç»“">Xcodeç¼–è¯‘è®¾ç½®ä¼˜åŒ–æ€»ç»“</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/19.png" alt="19"></p>
<h3 id="èµ„æºæ–‡ä»¶ä¼˜åŒ–">èµ„æºæ–‡ä»¶ä¼˜åŒ–</h3>
<p>èµ„æºæ–‡ä»¶çš„ä¼˜åŒ–æ˜¯éœ€è¦æŒç»­è¿›è¡Œçš„ï¼Œåœ¨å‰é¢å’±ä»¬æåˆ°çš„Xcodeç¼–è¯‘ä¼˜åŒ–è®¾ç½®é…ç½®å¥½ä¹‹ååç»­çš„å¼€å‘åªè¦ä¸ä¿®æ”¹é…ç½®ä¸éœ€è¦è¿‡åˆ†å…³æ³¨ã€‚ä½†æ˜¯èµ„æºæ–‡ä»¶ä¼˜åŒ–ä¸åŒï¼Œéšç€é¡¹ç›®çš„ä¸æ–­æ›´æ–°è¿­ä»£ä¼šä¸æ–­å¼•å…¥æ–°çš„èµ„æºæ–‡ä»¶ï¼ŒåŒæ—¶ä¹Ÿä¼šä¸æ–­æœ‰åºŸå¼ƒèµ„æºçš„æ–‡ä»¶äº§ç”Ÿï¼Œå› æ­¤èµ„æºä¼˜åŒ–æ˜¯è¦æŒç»­è¿›è¡Œçš„ã€‚</p>
<p>èµ„æºæ–‡ä»¶çš„ä¼˜åŒ–åˆ†ä¸ºä¸¤æ­¥ï¼šæ— ç”¨èµ„æºçš„åˆ é™¤ å’Œ å·²ç”¨èµ„æºçš„å‹ç¼©ã€‚</p>
<h4 id="æ— ç”¨èµ„æºçš„åˆ é™¤">æ— ç”¨èµ„æºçš„åˆ é™¤</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/20.png" alt="20"></p>
<h4 id="å›¾ç‰‡èµ„æºçš„æ¸…ç†">å›¾ç‰‡èµ„æºçš„æ¸…ç†</h4>
<p>ä½¿ç”¨ã€LSUnusedResourcesã€‘å·¥å…·æ£€æµ‹æ²¡æœ‰ç”¨åˆ°çš„å›¾ç‰‡èµ„æºï¼Œç¡®è®¤åè¿›è¡Œåˆ é™¤ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/21.png" alt="21"></p>
<h4 id="é‡å¤èµ„æºçš„å¼•å…¥">é‡å¤èµ„æºçš„å¼•å…¥</h4>
<p>æ£€æŸ¥é¡¹ç›®ä¸­æ˜¯å¦æœ‰åŠŸèƒ½ç±»ä¼¼çš„SDKï¼Œå»ºè®®åªä¿ç•™ä¸€ä¸ªï¼Œå¦å¤–æœ‰äº›ä¸‰æ–¹åº“å¼•å…¥æ—¶å¯ä»¥åªå¼•å…¥å®é™…ä½¿ç”¨çš„éƒ¨åˆ†ä¸éœ€è¦å…¨é‡å¼•å…¥ã€‚</p>
<p>ä½¿ç”¨ã€fdupesã€‘å·¥å…·è¿›è¡Œé‡å¤æ–‡ä»¶çš„æ‰«æï¼Œä»…ä¿ç•™ä¸€ä»½å³å¯ã€‚</p>
<div class="note green no-icon flat"><p>fdupeså·¥å…·çš„å®‰è£…å’Œä½¿ç”¨ï¼š</p>
<p>brew install fdupes</p>
<p>fdupes -Sr /Users/sunny/Desktop/TTPinecone &gt; /Users/sunny/Desktop/fdupesResult.txt</p>
</div>
<h4 id="æœªç”¨åˆ°çš„ç±»ã€æ–¹æ³•çš„æ¸…ç†">æœªç”¨åˆ°çš„ç±»ã€æ–¹æ³•çš„æ¸…ç†</h4>
<h3 id="å·²ç”¨èµ„æºçš„å‹ç¼©">å·²ç”¨èµ„æºçš„å‹ç¼©</h3>
<p>é¡¹ç›®ä¸­å¼•å…¥çš„å›¾ç‰‡ã€ç½‘é¡µã€jsonã€éŸ³é¢‘ç­‰æ–‡ä»¶çš„å‹ç¼©ï¼Œè¿™é‡Œä¸»è¦äº†è§£ä¸€ä¸‹å›¾ç‰‡çš„å‹ç¼©ã€‚</p>
<p><strong>Build Settings -&gt; Compress PNG Files</strong> <strong>è®¾ç½®ä¸º</strong> <strong>YES</strong> <strong>ï¼ˆé»˜è®¤ï¼‰</strong></p>
<p>è¡¨ç¤ºæ‰“åŒ…çš„æ—¶å€™è‡ªåŠ¨å¯¹å›¾ç‰‡è¿›è¡Œæ— æŸå‹ç¼©ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šè¯¥é€‰é¡¹å¯¹Assetsä¸­çš„èµ„æºæ— æ•ˆ åªå¯¹é›¶æ•£çš„èµ„æºæ–‡ä»¶ã€‚</p>
<p><strong>Build Settings -&gt; Remove Text Metadata From PNG Files</strong> <strong>è®¾ç½®ä¸º****YES</strong> <strong>ï¼ˆé»˜è®¤ï¼‰</strong></p>
<p>è¡¨ç¤ºç§»é™¤PNGèµ„æºçš„æ–‡æœ¬å­—ç¬¦ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/22.png" alt="22"></p>
<p><strong>resources</strong></p>
<p>æŠŠèµ„æºæ–‡ä»¶éƒ½æ‰“åŒ…ç›´æ¥copyåˆ°frameworkçš„æ ¹ç›®å½•ä¸‹ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœPodé‡Œé¢æ²¡æœ‰ä½¿ç”¨use_frameworks!ä¸ä¼šç”Ÿæˆå¯¹åº”çš„Frameworkçš„ï¼Œåˆ™æ˜¯ç›´æ¥æŠŠèµ„æºæ–‡ä»¶copyåˆ°appçš„æ ¹ç›®å½•ä¸‹ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/23.png" alt="23"></p>
<p><strong>resource_bundles</strong></p>
<p>CocoaPods å®˜æ–¹å¼ºçƒˆå»ºè®®ä½¿ç”¨resource_bundlesï¼Œè¿™æ ·å¯ä»¥é¿å…ç›¸åŒåç§°èµ„æºçš„åç§°å†²çªï¼Œä½¿ç”¨resource_bundlesä¼šä¸ºæŒ‡å®šçš„èµ„æºæ‰“ä¸€ä¸ª.bundleèµ„æºåŒ…ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/24.png" alt="24"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/25.png" alt="25"></p>
<h4 id="å•è‰²å›¾æ ‡ã€åŠŸèƒ½ç®€å•çš„å›¾æ ‡å¯ä»¥ä½¿ç”¨IconFontçŸ¢é‡å›¾æ ‡åº“çš„æ–¹å¼">å•è‰²å›¾æ ‡ã€åŠŸèƒ½ç®€å•çš„å›¾æ ‡å¯ä»¥ä½¿ç”¨IconFontçŸ¢é‡å›¾æ ‡åº“çš„æ–¹å¼</h4>
<h4 id="æ™®é€šå›¾ç‰‡å¯ä»¥ä½¿ç”¨-tinypngæ¥è¿›è¡Œå‹ç¼©">æ™®é€šå›¾ç‰‡å¯ä»¥ä½¿ç”¨ <a href="https://tinypng.com/"><strong>tinypng</strong></a>æ¥è¿›è¡Œå‹ç¼©</h4>
<h4 id="å°½é‡ä½¿ç”¨xcassetsæ¥å­˜æ”¾å›¾ç‰‡èµ„æº">å°½é‡ä½¿ç”¨xcassetsæ¥å­˜æ”¾å›¾ç‰‡èµ„æº</h4>
<p>æ”¾å…¥xcassetsçš„2xå’Œ3xå›¾ç‰‡åœ¨ä¸Šä¼ æ—¶ä¼šæ ¹æ®å…·ä½“è®¾å¤‡åˆ†å¼€å¯¹åº”åˆ†è¾¨ç‡çš„å›¾ç‰‡ï¼Œä¸ä¼šåŒæ—¶åŒ…å«ã€‚è€Œæ”¾å…¥.bundleä¸­çš„éƒ½ä¼šåŒ…å«ï¼Œæ‰€ä»¥å»ºè®®æŠŠå›¾ç‰‡æ”¾åœ¨xcassetsé‡Œé¢ç®¡ç†ã€‚</p>
<div class="note green no-icon flat"><p><strong>æ³¨æ„</strong>ï¼š</p>
<ol>
<li>Assets.caråœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šé€‰æ‹©ä¸€äº›å°å›¾ç‰‡æ‹¼å‡‘æˆä¸€å¼ å¤§å›¾æ¥æé«˜å›¾ç‰‡çš„åŠ è½½æ•ˆç‡ï¼Œè¢«æ”¾è¿›è¿™å¼ å¤§å›¾çš„å°å›¾ä¼šé€šè¿‡åç§»é‡çš„å¼•ç”¨ã€‚å»ºè®®ä½¿ç”¨é¢‘ç‡é«˜ä¸”å°çš„å›¾ç‰‡æ”¾åˆ°Assets.caré‡Œé¢ï¼ŒAssets.carèƒ½ä¿è¯åŠ è½½å’Œæ¸²æŸ“é€Ÿåº¦æœ€ä¼˜ã€‚</li>
<li>å¤§å›¾ï¼ˆå¤§äº100KBçš„å›¾ç‰‡ï¼‰å°±ä¸è¦æ”¾åˆ°Assetsé‡Œé¢ï¼Œè€ƒè™‘ä½¿ç”¨WebPæ ¼å¼ï¼Œè¿™ä¸ªæ ¼å¼å¯ä»¥å°†å›¾ç‰‡å‹ç¼©åˆ°æœ€å°ã€‚ä½†æ˜¯WebPåœ¨CPUæ¶ˆè€—å’Œè§£ç ä¸Šæ˜¯PNGçš„2å€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æ€§èƒ½å’Œä½“ç§¯ä¸Šåšå–èˆã€‚</li>
</ol>
</div>
<h4 id="Xcodeä¸­å…³äºå›¾ç‰‡å‹ç¼©çš„è®¾ç½®">Xcodeä¸­å…³äºå›¾ç‰‡å‹ç¼©çš„è®¾ç½®</h4>
<p>æœ‰æ—¶å€™å‹ç¼©äº†å›¾ç‰‡å‘ç°ipaåŒ…å¹¶æ²¡æœ‰æ”¹å˜å¤ªå¤šï¼ŒåŸå› å¤§æ¦‚æ˜¯ï¼š</p>
<div class="note green no-icon flat"><p>å› ä¸ºXcodeçš„Compress PNG Filesé€‰é¡¹çš„åŸå› ï¼Œå»ºè®®å¦‚æœè‡ªå·±å‹ç¼©å›¾ç‰‡å°±æŠŠè¯¥é¡¹è®¾ç½®è®¾ç½®ä¸ºNOã€‚</p>
<p>Xcode åœ¨æ„å»ºè¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªæ­¥éª¤å«compile assets catalogï¼ŒXcodeä¼šç”¨è‡ªå·±çš„ç®—æ³•è‡ªè¡Œå¯¹pngåšå›¾ç‰‡å‹ç¼©ï¼Œå¹¶ä¸”ä¼šå‹ç¼©æˆèƒ½å¤Ÿå¿«é€Ÿè¯»å–æ¸²æŸ“çš„æ ¼å¼ã€‚</p>
</div>
<h3 id="èµ„æºæ–‡ä»¶ä¼˜åŒ–æ€»ç»“">èµ„æºæ–‡ä»¶ä¼˜åŒ–æ€»ç»“</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20221102/26.png" alt="26"></p>
<h2 id="ä¼˜åŒ–æ€»ç»“">ä¼˜åŒ–æ€»ç»“</h2>
<p>æ˜¯ä¸æ˜¯é¡¹ç›®å˜å¤§äº†åšåŒ…ä½“ç§¯ä¼˜åŒ–æ‰æœ‰æ„ä¹‰ï¼Ÿ</p>
<p>ç»å¯¹ä¸æ˜¯ï¼ŒåŒ…ä½“ç§¯ä¼˜åŒ–åº”è¯¥æ˜¯ä¸€ç§ä¹ æƒ¯è€Œä¸æ˜¯ç­‰åˆ°åŒ…ä½“ç§¯å˜å¾—å¾ˆå¤§äº†æ‰å»æ€è€ƒåšä¼˜åŒ–ï¼Œåº”è¯¥æ˜¯åªè¦è§‰å¾—æœ‰ä¼˜åŒ–çš„ç©ºé—´å°±å»åšä¼˜åŒ–ã€‚</p>
<p>å¦‚æœæ‰“å‡ºæ¥çš„ipaåŒ…æ¯”è¾ƒå°ï¼Œè¯´æ˜æˆ‘ä»¬çš„å†å²è´Ÿæ‹…ä¸ä¸¥é‡ï¼Œä¿—è¯è¯´èˆ¹å°å¥½æ‰å¤´è€Œä¸”ç¼–è¯‘çš„é€Ÿåº¦ä¹Ÿå¿«ï¼Œè¯•é”™æˆæœ¬ä¹Ÿä½ï¼Œæ°æ°æ‰æ˜¯è¯¥ä¼˜åŒ–çš„æ—¶å€™ï¼Œä¼˜åŒ–æ€»ç»“å‡ºæ¥çš„æ•™è®­è½åœ°åˆ°æ–‡æ¡£å½¢æˆä¸€ç§è§„èŒƒï¼Œåç»­å¼€å‘æ—¶ä¹Ÿèƒ½æ—¶åˆ»å¼•èµ·æ³¨æ„ï¼Œè¿™æ ·å¯¹äºå¼€å‘æ¥è¯´æ˜¯æœ€å¥½çš„ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘æµ…è°ˆiOSçš„åŒ…ä½“ç§¯ä¼˜åŒ–ï¼ˆäºŒï¼‰</title>
    <url>/posts/a2dbd15f/</url>
    <content><![CDATA[<h2 id="LinkMapåˆ†æå¯æ‰§è¡Œæ–‡ä»¶">LinkMapåˆ†æå¯æ‰§è¡Œæ–‡ä»¶</h2>
<h3 id="LinkMapç»“æ„åˆ†æ">LinkMapç»“æ„åˆ†æ</h3>
<h4 id="åŸºç¡€ä¿¡æ¯">åŸºç¡€ä¿¡æ¯</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1104/1.png" alt="1"></p>
<h4 id="ç±»è¡¨">ç±»è¡¨</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1104/2.png" alt="2"></p>
<div class="note green no-icon flat"><p>é‡Œé¢ä¿å­˜çš„æ˜¯æ‰€æœ‰ç”¨åˆ°çš„ç±»ç”Ÿæˆçš„.oæ–‡ä»¶ï¼Œä¹ŸåŒ…æ‹¬ç”¨åˆ°çš„dylibåº“ã€‚[num]æŒ‡çš„æ˜¯åºå·ï¼Œç±»æ˜¯æŒ‰ç…§é¡ºåºä¿å­˜çš„ï¼Œåç»­å¯ä»¥é€šè¿‡åºå·æŸ¥åˆ°å…·ä½“å¯¹åº”çš„å“ªä¸ªç±»ã€‚</p>
</div>
<h4 id="æ®µè¡¨">æ®µè¡¨</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1104/3.png" alt="3"></p>
<div class="note green no-icon flat"><p>æ®µè¡¨é‡Œé¢æè¿°äº†ä¸åŒåŠŸèƒ½çš„æ•°æ®ä¿å­˜åœ°å€ï¼Œé€šè¿‡è¿™ä¸ªåœ°å€å¯ä»¥æŸ¥åˆ°å¯¹åº”å†…å­˜é‡Œé¢å­˜å‚¨çš„æ˜¯ä»€ä¹ˆæ•°æ®ã€‚</p>
<p>ç¬¬ä¸€åˆ—ï¼šèµ·å§‹åœ°å€</p>
<p>ç¬¬äºŒåˆ—ï¼šæ®µå ç”¨çš„å¤§å°</p>
<p>ç¬¬ä¸‰åˆ—ï¼šæ®µç±»å‹</p>
<p>ç¬¬å››åˆ—ï¼šæ®µåç§°</p>
<p>æ¯ä¸€è¡Œåˆå§‹åœ°å€ = ä¸Šä¸€è¡Œå¤„å§‹åœ°å€ + å ç”¨å¤§å°</p>
</div>
<p>__TEXTï¼šä»£ç æ®µ</p>
<p>__DATAï¼šæ•°æ®æ®µ</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1104/4.png" alt="4"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1104/5.png" alt="5"></p>
<h4 id="åç»­ç¬¦å·è¡¨å†…å®¹">åç»­ç¬¦å·è¡¨å†…å®¹</h4>
<p><strong>ä»£ç èŠ‚</strong></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1104/6.png" alt="6"></p>
<div class="note green no-icon flat"><p>ç¬¬ä¸€åˆ—ï¼šèµ·å§‹åœ°å€ é€šè¿‡è¿™ä¸ªåœ°å€å¯ä»¥æŸ¥ä¸Šé¢çš„æ®µè¡¨</p>
<p>ç¬¬äºŒåˆ—ï¼šæ–¹æ³•å ç”¨çš„å¤§å° é€šè¿‡è¿™ä¸ªå¯ä»¥è®¡ç®—å‡ºæ–¹æ³•å ç”¨çš„å¤§å°</p>
<p>ç¬¬ä¸‰åˆ—ï¼šå½’å±çš„ç±»</p>
<p>é€šè¿‡è¿™éƒ¨åˆ†æˆ‘ä»¬å¯ä»¥åˆ†æå‡ºæ¯ä¸ªç±»å¯¹åº”çš„æ–¹æ³•çš„å¤§å°ã€‚</p>
</div>
<p><strong>æ–¹æ³•åèŠ‚</strong></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1104/7.png" alt="7"></p>
<div class="note green no-icon flat"><p>è¿™éƒ¨åˆ†ä¿å­˜çš„æ˜¯ï¼šç±»ä¸­æ–¹æ³•çš„å­—ç¬¦ä¸²ä¿¡æ¯</p>
</div>
<p><strong>å¦‚ä½•åˆ†æ</strong></p>
<p>æŸ¥çœ‹ç¬¬ä¸€åˆ—åˆå§‹ä½ç½® æ¯”å¦‚<code>0x1016FF830</code> ç„¶åçœ‹è¿™ä¸ªåœ°å€åœ¨ã€æ®µè¡¨ã€‘ä¸­çš„å“ªä¸ªèŠ‚é‡Œé¢ æˆ‘ä»¬è¿™é‡Œçœ‹åˆ°æ˜¯åœ¨<code>__objc_methodname</code>é‡Œé¢ã€‚</p>
<h3 id="åˆ†æLinkMapçš„å·¥å…·">åˆ†æLinkMapçš„å·¥å…·</h3>
<p><a href="https://github.com/jayden320/LinkMap">LinkMapåˆ†æå·¥å…·</a></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1104/8.png" alt="8"></p>
<h2 id="TEXTä»£ç æ®µè¿ç§»æ–¹æ¡ˆ">__TEXTä»£ç æ®µè¿ç§»æ–¹æ¡ˆ</h2>
<h3 id="Mach-Oæ–‡ä»¶æ ¼å¼ç®€ä»‹">Mach-Oæ–‡ä»¶æ ¼å¼ç®€ä»‹</h3>
<p>å¯æ‰§è¡Œæ–‡ä»¶ä¸­<code>Data</code>éƒ¨åˆ†ä¸»è¦æ˜¯ä»¥<code>Segmentï¼ˆæ®µï¼‰</code>å’Œ<code>Sectionï¼ˆèŠ‚ï¼‰</code>çš„æ–¹å¼æ¥ç»„ç»‡å†…å®¹ï¼Œä½¿ç”¨å‘½ä»¤<code>xcrun size -lm</code>å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ æ¥è¯¦ç»†æŸ¥çœ‹<code>Data</code>éƒ¨åˆ†çš„ç»“æ„å’Œ<code>Segment/Section</code>çš„å¤§å°ä¿¡æ¯ã€‚</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1104/9.png" alt="9"></p>
<p><code>Data</code>æœ‰å››ä¸ª<code>Segment</code>ï¼š<code>__PAGEZERO</code>ã€<code>__TEXT</code>ã€<code>__DATA</code>ã€<code>__LINKEDIT</code>ï¼Œé™¤äº†<code>__PAGEZERO</code>ã€<code>__LINKEDIT</code>ï¼Œæ¯ä¸ªæ®µä¸­æœ‰å¤šä¸ª<code>Section</code>ã€‚</p>
<p><code>__PAGEZERO</code>ï¼šå¤§å°æ˜¯4Gï¼ŒæŒ‡çš„æ˜¯å¯æ‰§è¡Œæ–‡ä»¶è£…è½½è¿›å†…å­˜åï¼Œ<code>__PAGEZERO</code>åœ¨å†…å­˜ä¸­çš„å¤§å°ï¼Œä¸»è¦æ˜¯ç”¨æ¥æ•æ‰<code>NULL</code>æŒ‡é’ˆçš„å¼•ç”¨ã€‚<code>__PAGEZERO</code>åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­å¹¶ä¸å ç”¨<code>Data</code>éƒ¨åˆ†çš„ç©ºé—´ã€‚</p>
<p><code>__TEXT</code>ã€<code>__DATA</code>ï¼šç”¨äºä¿å­˜ç¨‹åºçš„ä»£ç æŒ‡ä»¤å’Œæ•°æ®ã€‚</p>
<p><code>__LINKEDIT</code>ï¼šåŒ…å«Appå¯åŠ¨éœ€è¦çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä»£ç ç­¾åç¬¦å·è¡¨ç­‰ã€‚</p>
<h3 id="TEXTæ®µè¿ç§»çš„åŸç†">__TEXTæ®µè¿ç§»çš„åŸç†</h3>
<p>ç¨‹åºçš„è¿‡ç¨‹ä¸»è¦æœ‰ï¼šé¢„å¤„ç† - ç¼–è¯‘ - æ±‡ç¼– - é“¾æ¥ å››ä¸ªä¸»è¦é˜¶æ®µï¼Œå®Œæˆä¹‹åå°±å¯ä»¥å¾—åˆ°Mach-Oå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<div class="note green no-icon flat"><p>è‹¹æœè¦æ±‚ï¼š</p>
<p>iOS7 ä¹‹å‰ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ‰€æœ‰çš„__TEXTæ®µæ€»å’Œä¸å¾—è¶…è¿‡80MB</p>
<p>iOS7.x - iOS 8.xï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªç‰¹å®šæ¶æ„ä¸­çš„__TEXTæ®µä¸å¾—è¶…è¿‡60MB</p>
<p>iOS9 ä¹‹åï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ‰€æœ‰çš„__TEXTæ®µæ€»å’Œä¸å¾—è¶…è¿‡500MB</p>
</div>
<p>è‹¹æœåªä¼šæ‰«æ<code>__TEXT</code>æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æƒ³æ³•æ˜¯è¿ç§»<code>__TEXT</code>æ®µå°±å¯ä»¥é¿å…ä¸Šé¢çš„é—®é¢˜ï¼Œè¿™ä¸ªæ–¹æ¡ˆåœ¨å›½å†…å¾ˆå¤§å¤§å‹APPä¸Šå…¶å®ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ã€‚</p>
<h3 id="è¿ç§»-TEXTä¼šå‡å°‘ä¸‹è½½å¤§å°çš„åŸç†">è¿ç§»__TEXTä¼šå‡å°‘ä¸‹è½½å¤§å°çš„åŸç†</h3>
<p>è‹¹æœä¼šå¯¹APPä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡ŒDRMåŠ å¯†ï¼Œç„¶åå°†APPå‹ç¼©æˆipaæ–‡ä»¶å†å‘å¸ƒåˆ°App Storeï¼ŒåŠ å¯†å¯¹å¯æ‰§è¡Œæ–‡ä»¶å¤§å°æœ¬èº«å½±å“æ¯”è¾ƒå°ï¼Œå®ƒå½±å“çš„æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„å‹ç¼©æ•ˆç‡ï¼Œå¯¼è‡´å‹ç¼©åçš„ipaå¤§å°å¢åŠ ä¹Ÿå°±æ˜¯ä¸‹è½½å¤§å°å¢å¤§ã€‚</p>
<p>ä½¿ç”¨å‘½ä»¤ã€otool -l å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ã€‘æ¥æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¦è¢«åŠ å¯†è¿‡ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1104/10.png" alt="10"></p>
<p>è‹¹æœåªä¼šå¯¹å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„<code>__TEXT</code>æ®µåŠ å¯†ï¼Œè€Œä¸ä¼šå¯¹å…¶ä»–æ®µåŠ å¯†ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æƒ³åˆ°å¦‚æœå¯ä»¥æŠŠ<code>__TEXT</code>æ®µä¸­çš„èŠ‚ç§»åˆ°å…¶å®ƒæ®µï¼Œå°±èƒ½å‡å°‘è‹¹æœçš„åŠ å¯†èŒƒå›´ï¼Œä»è€Œä½¿å‹ç¼©æ•ˆç‡æå‡å‡å°‘ä¸‹è½½å¤§å°ã€‚</p>
<div class="note orange no-icon flat"><p><strong>ä¸€èˆ¬æ¥è¯´</strong>ï¼š</p>
<p>APPä¸­å¯æ‰§è¡Œæ–‡ä»¶å 80%çš„å¤§å°ï¼ŒåŠ å¯†å†…å®¹å å¯æ‰§è¡Œæ–‡ä»¶å¤§å°çš„70%ï¼ŒåŠ å¯†ä¼šå½±å“60%çš„å‹ç¼©ç‡ï¼Œå› æ­¤ç§»èµ°è¯¥åŠ å¯†éƒ¨åˆ†å¯ä»¥æå‡34%çš„ä¸‹è½½å¤§å°ã€‚</p>
<p><code>__TEXT</code>æ®µè¿ç§»æ–¹æ¡ˆåªé€‚ç”¨äºiOS13ä»¥ä¸‹çš„è®¾å¤‡ï¼Œè‹¹æœæœ¬èº«å·²ç»å¯¹iOS13ä»¥ä¸Šçš„è®¾å¤‡åšäº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–ã€‚</p>
</div>
<h3 id="è¿ç§»-TEXTæ®µå…·ä½“æ–¹æ¡ˆ">è¿ç§»__TEXTæ®µå…·ä½“æ–¹æ¡ˆ</h3>
<p>é€šè¿‡å‘½ä»¤<code>man ld</code>å¯ä»¥æŸ¥çœ‹é“¾æ¥å™¨å‚æ•°ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1104/11.png" alt="11"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1104/12.png" alt="12"></p>
<p><code>-rename _section</code>ï¼š<code>orgSegment/orgSection</code>çš„åç§°ä¿®æ”¹ä¸º<code>newSegment/newSection</code></p>
<p><code>-segprot</code>ï¼šä¸º<code>Segment</code>æ·»åŠ è¯»ã€å†™ã€å¯æ‰§è¡Œæƒé™ç­‰</p>
<p>åœ¨ <code>Xcode - Build Settings - Other Linker Flags</code>ä¸­æ·»åŠ å¦‚ä¸‹å‚æ•°ï¼š</p>
<div class="note green no-icon flat"><p><code>-Wl,-rename_section,__TEXT,__stubs,__TT_TEXT,__stubs</code></p>
<p><code>-Wl,-rename_section,__TEXT,__text,__TT_TEXT,__text</code></p>
<p><code>-Wl,-rename_section,__TEXT,__const,__RODATA,__const</code></p>
<p><code>-Wl,-rename_section,__TEXT,__gcc_except_tab,__RODATA,__gcc_except_tab</code></p>
<p><code>-Wl,-rename_section,__TEXT,__objc_methtype,__RODATA,__objc_methtype</code></p>
<p><code>-Wl,-rename_section,__TEXT,__objc_classname,__RODATA,__objc_classname</code></p>
<p><code>-Wl,-rename_section,__TEXT,__objc_methname,__RODATA,__objc_methname</code></p>
<p><code>-Wl,-rename_section,__TEXT,__cstring,__RODATA,__cstring</code></p>
<p><code>-Wl,-segprot,__TT_TEXT,rx,rx</code></p>
<p><strong>æ³¨æ„</strong>ï¼šä»¥ä¸Šæ·»åŠ çš„å‚æ•°æ˜¯åšä¸»é’ˆå¯¹è‡ªå·±çš„é¡¹ç›®åšçš„ä¸€äº›æ·»åŠ  å„ä½ä¸€å®šè¦æ ¹æ®è‡ªå·±é¡¹ç›®çš„å®é™…æƒ…å†µå»åšç›¸åº”çš„æ·»åŠ ã€‚</p>
</div>
<p><strong>è§£é‡Š</strong>ï¼š</p>
<p>-Wl æ˜¯å‘Šè¯‰Xcode åé¢çš„å‚æ•°æ˜¯æ·»åŠ ç»™é“¾æ¥å™¨ldçš„ï¼Œè¿™äº›å‚æ•°åœ¨é“¾æ¥é˜¶æ®µç”Ÿæ•ˆã€‚</p>
<p>ç¬¬ä¸€è¡Œå‚æ•°ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„<code>__TT_TEXT</code>æ®µï¼Œå¹¶æŠŠ<code>__TEXT</code>,<code>__text</code>ç§»åŠ¨åˆ°<code>__TT_TEXT</code>,<code>__text</code>ã€‚</p>
<p>ç¬¬ä¸€è¡Œå‚æ•°ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„<code>__TT_TEXT</code>æ®µï¼Œå¹¶æŠŠ<code>__TEXT</code>,<code>__text</code>ç§»åŠ¨åˆ°<code>__TT_TEXT</code>,<code>__text</code>ã€‚</p>
<p>ç¬¬äºŒè¡Œå‚æ•°ï¼šç»™<code>__TT_TEXT</code>æ®µæ·»åŠ å¯è¯»å’Œå¯æ‰§è¡Œæƒé™ã€‚</p>
<p>ä½¿ç”¨å‘½ä»¤<code>xcrun size -lm å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„</code>å¯ä»¥æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„Dataå†…å®¹ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1104/13.png" alt="13"></p>
<p>é€šè¿‡ä¸Šé¢çš„æˆªå›¾æˆ‘ä»¬ä¼šå‘ç°ï¼š<code>Data</code>é‡Œé¢ä¼šå¤šäº†æˆ‘ä»¬åˆ›å»ºçš„<code>__TT_TEXT</code>å’Œ<code>__RODATA</code>ä¸¤ä¸ª<code>Segment</code>,åŸæœ¬çš„<code>__TEXT</code>å’Œ<code>__DATA</code>çš„å¤§å°ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œè‡³æ­¤ï¼Œå…³äº<code>__TEXT</code>æ®µå…·ä½“å¦‚ä½•è¿ç§»æˆ‘ä»¬å°±ç®€å•çš„äº†è§£åˆ°è¿™é‡Œäº†ï¼Œæœ¬æ–‡ä¹Ÿåªæ˜¯åšä¸»çš„ä¸€ä¸ªå­¦ä¹ ç¬”è®°ï¼Œå¦‚å„ä½çœ‹å®˜å‘ç°æœ‰ä»»ä½•é—®é¢˜è¯·æŒ‡æ­£ åœ¨æ­¤æ„Ÿæ¿€ä¸å°½ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘æ¶ˆæ¯å‘é€çš„å®Œæ•´æµç¨‹</title>
    <url>/posts/4a47f2ea/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-27">å†™åœ¨å‰é¢</h2>
<p>â€‹	åœ¨OCé‡Œé¢ï¼Œè°ƒç”¨å¯¹è±¡çš„æŸä¸ªæ–¹æ³•å…¶å®å°±æ˜¯ç»™è¿™ä¸ªå¯¹è±¡å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬æŠŠå®ƒåˆ†ä¸ºä¸‰å¤§é˜¶æ®µï¼Œåˆ†åˆ«ä¸ºï¼šæ¶ˆæ¯å‘é€é˜¶æ®µã€åŠ¨æ€è§£æé˜¶æ®µã€æ¶ˆæ¯è½¬å‘é˜¶æ®µï¼Œæœ¬æ–‡å°†ç»†ç»†å‰–æè¿™ä¸‰ä¸ªé˜¶æ®µï¼Œä½†æ˜¯åœ¨å‰–æè¿™ä¸‰å¤§é˜¶æ®µä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆå›é¡¾ä¸€ä¸‹Classçš„ç»“æ„ã€‚</p>
<h2 id="Classç»“æ„">Classç»“æ„</h2>
<p>è‹¹æœæºç æœ€æ–°ä¸‹è½½åœ°å€è¯·ç‚¹å‡»ï¼š<a href="https://opensource.apple.com/tarballs/objc4/">è‹¹æœæºç </a><br>
åœ¨<code>objc-runtime-new.h</code>ä¸­å¯ä»¥çœ‹åˆ°<code>objc_class</code>ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_object &#123;</span><br><span class="line">    Class isa;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> objc_class : objc_object &#123;</span><br><span class="line">      Class superclass; </span><br><span class="line">      cache_t cache;  <span class="comment">// æ–¹æ³•ç¼“å­˜</span></span><br><span class="line">      class_data_bits_t bits; <span class="comment">// è·å–å…·ä½“ç±»ä¿¡æ¯</span></span><br><span class="line">    ...... </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ç»“æ„æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªç±»<code>cache_t</code>ï¼Œè¿™ä¸ªç±»å°±æ˜¯ä¸“é—¨æ‹¿æ¥åšæ–¹æ³•ç¼“å­˜ç›¸å…³çš„ç±»ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> cache_t &#123;</span><br><span class="line">    <span class="keyword">struct</span> bucket_t *buckets();</span><br><span class="line">    uint16_t _occupied();</span><br><span class="line">    mask_t _maybeMask;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> bucket_t &#123;</span><br><span class="line">    SEL _sel;</span><br><span class="line">    IMP _imp;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>class_data_bits_t</code>ç”¨äºè·å–å…·ä½“çš„ç±»ä¿¡æ¯ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> FAST_DATA_MASK          0x00007ffffffffff8UL</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">class_data_bits_t</span> &#123;</span><br><span class="line">    <span class="type">uintptr_t</span> bits;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">class_rw_t</span>* <span class="title">data</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">class_rw_t</span> *)(bits &amp; FAST_DATA_MASK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// readWriteï¼šå¯è¯»å¯å†™</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">class_rw_t</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> flags;</span><br><span class="line">    <span class="type">uint32_t</span> witness;</span><br><span class="line">  	Class firstSubclass;</span><br><span class="line">    Class nextSiblingClass;</span><br><span class="line">    <span class="type">class_rw_ext_t</span> *ext;</span><br><span class="line">    <span class="type">const</span> <span class="type">class_ro_t</span> *ro;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">class_rw_ext_t</span> &#123;</span><br><span class="line">  <span class="type">class_ro_t</span> *ro;</span><br><span class="line">  <span class="type">method_array_t</span> methods;<span class="comment">// æ–¹æ³•åˆ—è¡¨</span></span><br><span class="line">  <span class="type">property_array_t</span> properties; <span class="comment">// å±æ€§åˆ—è¡¨</span></span><br><span class="line">  <span class="type">protocol_array_t</span> protocols; <span class="comment">// åè®®åˆ—è¡¨</span></span><br><span class="line">  <span class="type">char</span> *demangledName;</span><br><span class="line">   <span class="type">uint32_t</span> version;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// readOnly:åªè¯»</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">class_ro_t</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> flags;</span><br><span class="line">    <span class="type">uint32_t</span> instanceStart;</span><br><span class="line">    <span class="type">uint32_t</span> instanceSize; </span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __LP64__</span></span><br><span class="line">    <span class="type">uint32_t</span> reserved;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="type">const</span> <span class="type">uint8_t</span> * ivarLayout;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> * name;  <span class="comment">// ç±»å</span></span><br><span class="line">    <span class="type">method_list_t</span> * baseMethodList;</span><br><span class="line">    <span class="type">protocol_list_t</span> * baseProtocols;</span><br><span class="line">    <span class="type">const</span> <span class="type">ivar_list_t</span> * ivars;  <span class="comment">// æˆå‘˜å˜é‡åˆ—è¡¨</span></span><br><span class="line">    <span class="type">const</span> <span class="type">uint8_t</span> * weakIvarLayout;</span><br><span class="line">    <span class="type">property_list_t</span> *baseProperties;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åˆ†æåˆ°è¿™é‡Œï¼ŒClassç»“æ„æˆ‘ä»¬å·²äº†è§£æ¸…æ¥šï¼Œæ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•æ¥ç ”ç©¶ä¸€ä¸‹æ¶ˆæ¯å‘é€çš„å®Œæ•´æµç¨‹ã€‚</p>
<h2 id="æ¶ˆæ¯å‘é€é˜¶æ®µ">æ¶ˆæ¯å‘é€é˜¶æ®µ</h2>
<p>åœ¨OCé‡Œé¢ï¼Œè°ƒç”¨å¯¹è±¡çš„æŸä¸ªæ–¹æ³•å°±æ˜¯ç»™è¿™ä¸ªå¯¹è±¡å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¿™é‡Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªPersonç±»ï¼Œä»¥[person personRun]ä¸ºä¾‹æ¥çœ‹çœ‹æ¶ˆæ¯å‘é€é˜¶æ®µçš„æµç¨‹ã€‚</p>
<p>åœ¨<a href="https://codersunny.com/posts/39324100/">ã€iOSé‡å­¦ã€‘æ–¹æ³•ç¼“å­˜cache_tçš„åˆ†æ</a>è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬ä¸»è¦åˆ†æäº†æ–¹æ³•ç¼“å­˜ï¼Œå»ºè®®å¤§å®¶å…ˆçœ‹ä¸€ä¸‹ç¼“å­˜å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£æ¥ä¸‹æ¥çš„æµç¨‹ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“OCä¸­çš„æ–¹æ³•è°ƒç”¨å…¶å®å°±æ˜¯è½¬æˆ<code>objc_msgSend()</code>å‡½æ•°çš„è°ƒç”¨ï¼ˆloadæ–¹æ³•é™¤å¤–ï¼‰ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220604/1.png" alt="1"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆæ¯å‘é€é˜¶æ®µæºç è·Ÿè¯»é¡ºåº</span></span><br><span class="line"><span class="number">1.</span> objc-msg-arm64 æ±‡ç¼–æ–‡ä»¶</span><br><span class="line">	ENTRY _objc_msgSend</span><br><span class="line">	b.le LNilOrTagged</span><br><span class="line">	CacheLookup NORMAL, _objc_msgSend, __objc_msgSend_uncached</span><br><span class="line">	.macro CacheLookup</span><br><span class="line">	CacheHit <span class="comment">// å‘½ä¸­ç¼“å­˜</span></span><br><span class="line">	MissLabelDynamic <span class="comment">// å…¶å®å°±æ˜¯__objc_msgSend_uncached</span></span><br><span class="line">	STATIC_ENTRY __objc_msgSend_uncached</span><br><span class="line">	MethodTableLookup</span><br><span class="line">	.macro MethodTableLookup</span><br><span class="line">	bl _lookupImpOrForward</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> objc-runtime-<span class="keyword">new</span>.mm æ–‡ä»¶</span><br><span class="line">	<span class="function">lookupImpOrForward</span></span><br><span class="line"><span class="function">	<span class="title">getMethodNoSuper_nolock</span><span class="params">(curClass, sel)</span></span></span><br><span class="line"><span class="function">	curClass </span>= curClass-&gt;<span class="built_in">getSuperclass</span>()</span><br><span class="line">	<span class="built_in">cache_getImp</span>(curClass, sel) <span class="comment">// ä»çˆ¶ç±»ç¼“å­˜é‡Œé¢æŸ¥æ‰¾</span></span><br><span class="line">	log_and_fill_cache <span class="comment">// ç¼“å­˜æ–¹æ³•åˆ°æ¶ˆæ¯æ¥æ”¶è€…è¿™ä¸ªç±»</span></span><br></pre></td></tr></table></figure>
<p>æ¶ˆæ¯å‘é€çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220604/2.png" alt="2"></p>
<blockquote>
<p><strong>æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹æ˜¯å¦çœŸçš„ç¼“å­˜äº†è°ƒç”¨çš„æ–¹æ³•ï¼š</strong></p>
<p>æœªè°ƒç”¨personRunæ—¶ï¼Œæˆ‘ä»¬æŸ¥ä¸€ä¸‹åœ¨Personç±»çš„cacheé‡Œé¢æ˜¯å¦èƒ½æ‰¾åˆ°personRunæ–¹æ³•ç¼“å­˜ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">Person *person = [[Person alloc] init];</span><br><span class="line">mj_objc_class *personClass = (__bridge  mj_objc_class *)[Person <span class="keyword">class</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%@ %p&quot;</span>,<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(personRun)), personClass-&gt;cache.imp(<span class="keyword">@selector</span>(personRun)));</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-04</span><span class="number">-10</span> <span class="number">13</span>:<span class="number">11</span>:<span class="number">30.367394</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">88049</span>:<span class="number">12459843</span>] personRun <span class="number">0x0</span></span><br></pre></td></tr></table></figure>
<p><strong>ç»“æœåˆ†æ</strong>ï¼šåœ¨cacheå¹¶æ²¡æœ‰æ‰¾åˆ°personRunçš„IMPã€‚</p>
<p>è°ƒç”¨personRunä¹‹åï¼Œæˆ‘ä»¬æŸ¥ä¸€ä¸‹Personç±»çš„cacheé‡Œé¢æ˜¯å¦èƒ½æ‰¾åˆ°personRunæ–¹æ³•ç¼“å­˜ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">Person *person = [[Person alloc] init];</span><br><span class="line">[person personRun];</span><br><span class="line">mj_objc_class *personClass = (__bridge  mj_objc_class *)[Person <span class="keyword">class</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%@ %p&quot;</span>,<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(personRun)), personClass-&gt;cache.imp(<span class="keyword">@selector</span>(personRun)));</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-04</span><span class="number">-10</span> <span class="number">13</span>:<span class="number">13</span>:<span class="number">30.294687</span>+<span class="number">0800</span> RuntimeDemo[<span class="number">88074</span>:<span class="number">12461806</span>] personRun <span class="number">0x78cc0</span></span><br></pre></td></tr></table></figure>
<p><strong>ç»“æœåˆ†æ</strong>ï¼šè°ƒç”¨personRunä¹‹åï¼Œä¼šæŠŠpersonRunç¼“å­˜åˆ°æ–¹æ³•ç¼“å­˜é‡Œé¢</p>
</blockquote>
<h2 id="åŠ¨æ€æ–¹æ³•è§£æé˜¶æ®µ">åŠ¨æ€æ–¹æ³•è§£æé˜¶æ®µ</h2>
<p>å½“ç¬¬ä¸€é˜¶æ®µã€æ¶ˆæ¯å‘é€é˜¶æ®µã€‘æ²¡æœ‰æ‰¾åˆ°æ–¹æ³•å®ç°å°±ä¼šè¿›å…¥ç¬¬äºŒé˜¶æ®µã€åŠ¨æ€æ–¹æ³•è§£æé˜¶æ®µã€‘ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€æ–¹æ³•è§£æé˜¶æ®µæºç è·Ÿè¯»é¡ºåº</span></span><br><span class="line"><span class="number">1.</span> objc-runtime-<span class="keyword">new</span>.mm æ–‡ä»¶</span><br><span class="line">  resolveMethod_locked</span><br><span class="line">  resolveInstanceMethod æˆ– resolveClassMethod</span><br><span class="line">  lookupImpOrNilTryCache</span><br><span class="line">  _lookupImpTryCache</span><br><span class="line">  lookupImpOrForward</span><br></pre></td></tr></table></figure>
<p>åŠ¨æ€æ–¹æ³•è§£æçš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220604/3.png" alt="3"></p>
<h3 id="åŠ¨æ€æ–¹æ³•è§£ææµç¨‹">åŠ¨æ€æ–¹æ³•è§£ææµç¨‹</h3>
<p>æ ¹æ®<code>+ (BOOL)resolveInstanceMethod:(SEL)sel ï¼ˆå®ä¾‹æ–¹æ³•è°ƒç”¨è¿™ä¸ªï¼‰</code> æˆ–<code>+ (BOOL)resolveClassMethod:(SEL)sel(ç±»æ–¹æ³•è°ƒç”¨è¿™ä¸ª)</code>æ¥åšåŠ¨æ€æ–¹æ³•è§£æï¼Œç„¶åé‡æ–°èµ°ä¸€éæ¶ˆæ¯å‘é€çš„æµç¨‹ï¼ˆä»æ¶ˆæ¯æ¥å—è€…çš„æ–¹æ³•ç¼“å­˜é‡Œé¢å¼€å§‹ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼‰ã€‚</p>
<h3 id="åŠ¨æ€æ–¹æ³•è§£æä»£ç ">åŠ¨æ€æ–¹æ³•è§£æä»£ç </h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="type">void</span>)otherRun &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="type">BOOL</span>)resolveInstanceMethod:(SEL)sel &#123;</span><br><span class="line">    <span class="keyword">if</span> (sel == <span class="keyword">@selector</span>(personRun)) &#123;</span><br><span class="line">        Method otherMethod = class_getInstanceMethod(<span class="keyword">self</span>, <span class="keyword">@selector</span>(otherRun));</span><br><span class="line">        IMP imp = class_getMethodImplementation(<span class="keyword">self</span>, <span class="keyword">@selector</span>(otherRun));</span><br><span class="line">        class_addMethod(<span class="keyword">self</span>, sel, method_getImplementation(otherMethod), method_getTypeEncoding(otherMethod));</span><br><span class="line">        <span class="keyword">return</span>  <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="variable language_">super</span> resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ¶ˆæ¯è½¬å‘é˜¶æ®µ">æ¶ˆæ¯è½¬å‘é˜¶æ®µ</h2>
<p>å¦‚æœå‰é¢çš„ä¸¤ä¸ªé˜¶æ®µéƒ½æ²¡æœ‰å®ç°ï¼Œå°±ä¼šç»§ç»­è¿›å…¥ã€æ¶ˆæ¯è½¬å‘ã€‘çš„æµç¨‹ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆæ¯è½¬å‘é˜¶æ®µçš„æºç è·Ÿè¯»é¡ºåº</span></span><br><span class="line"><span class="number">1.</span> objc-msg-arm64 æ±‡ç¼–æ–‡ä»¶</span><br><span class="line">  forward_imp = _objc_msgForward_impcache</span><br><span class="line">  STATIC_ENTRY __objc_msgForward_impcache</span><br><span class="line">  b __objc_msgForward</span><br><span class="line">  ENTRY __objc_msgForward</span><br><span class="line">  ENTRY __objc_msgForward_stret</span><br><span class="line">  __objc_forward_stret_handler</span><br><span class="line"><span class="number">2.</span> objc-runtime-<span class="keyword">new</span>.mm æ–‡ä»¶</span><br><span class="line">  <span class="type">void</span> *_objc_forward_stret_handler = (<span class="type">void</span> *)objc_defaultForwardStretHandler;</span><br><span class="line"><span class="number">3.</span> CoreFoundation æ¡†æ¶</span><br><span class="line">  __forwarding__ <span class="comment">// ä¸å¼€æº</span></span><br></pre></td></tr></table></figure>
<p>æ¶ˆæ¯è½¬å‘çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220604/4.png" alt="4"></p>
<h3 id="æ¶ˆæ¯è½¬å‘æµç¨‹">æ¶ˆæ¯è½¬å‘æµç¨‹</h3>
<p>æ¶ˆæ¯è½¬å‘æµç¨‹ä¹Ÿåˆ†ä¸ºäº†ä¸¤æ­¥:</p>
<p>ç¬¬ä¸€æ­¥ï¼š<code>forwardingTargetForSelectorï¼š</code>æ–¹æ³•æ˜¯æŒ‡æŠŠå“åº”è¿™ä¸ªæ–¹æ³•çš„å¯¹è±¡è½¬å‘ç»™å…¶ä»–çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ¶ˆæ¯æ¥å—è€…å°±å‘ç”Ÿäº†å˜åŒ–ï¼Œä¼šé‡æ–°è°ƒç”¨ä¸€é<code>objc_MsgSend(æ¶ˆæ¯æ¥å—è€…ï¼ŒSEL)</code>æµç¨‹ã€‚<br>
ç¬¬äºŒæ­¥ï¼š<code>forwardingTargetForSelector:</code> æ–¹æ³•è¿”å›ä¸º<code>nil</code>ï¼Œç»§ç»­æ£€æŸ¥<code>methodSignatureForSelectorï¼š</code>æ˜¯å¦è¿”å›äº†ä¸€ä¸ªæ–¹æ³•ç­¾åï¼Œç„¶åå»æ‰§è¡Œ<code>forwardInvocation:</code>æ–¹æ³•ã€‚</p>
<h3 id="æ¶ˆæ¯è½¬å‘æµç¨‹ç›¸å…³ä»£ç å®ç°">æ¶ˆæ¯è½¬å‘æµç¨‹ç›¸å…³ä»£ç å®ç°</h3>
<h4 id="1-å®ä¾‹æ–¹æ³•æµç¨‹">1. å®ä¾‹æ–¹æ³•æµç¨‹</h4>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€æ­¥</span></span><br><span class="line">- (<span class="type">id</span>)forwardingTargetForSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">if</span> (aSelector == <span class="keyword">@selector</span>(personRun)) &#123;</span><br><span class="line">        <span class="keyword">return</span> [[Student alloc] init]; <span class="comment">// è¿™é‡Œè¿”å›çš„æ˜¯ä½ æƒ³æŠŠè¿™ä¸ªæ¶ˆæ¯è½¬å‘ç»™å“ªä¸ªå¯¹è±¡</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="variable language_">super</span> forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒæ­¥</span></span><br><span class="line">- (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">if</span> (aSelector == <span class="keyword">@selector</span>(personRun)) &#123;</span><br><span class="line">        <span class="comment">// âš ï¸ï¼šè¿™é‡Œçš„æ–¹æ³•ç­¾åçš„typesä¸èƒ½éšä¾¿å†™ å› ä¸ºè¿™é‡Œçš„æ–¹æ³•ç­¾åå†³å®šäº†ä¸‹ä¸€æ­¥çš„NSInvocationçš„è¿”å›å€¼ã€å‚æ•°ç±»å‹ç­‰</span></span><br><span class="line">        <span class="keyword">return</span> [<span class="built_in">NSMethodSignature</span> signatureWithObjCTypes:<span class="string">&quot;i@:i&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="variable language_">super</span> methodSignatureForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="type">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)anInvocation &#123;</span><br><span class="line">     [anInvocation invokeWithTarget:[Student new]];</span><br><span class="line">  <span class="comment">// åœ¨è¿™ä¸ªæ–¹æ³•é‡Œå¯ä»¥åšä»»ä½•æˆ‘ä»¬æƒ³åšçš„äº‹æƒ…</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)doesNotRecognizeSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-ç±»æ–¹æ³•æµç¨‹">2. ç±»æ–¹æ³•æµç¨‹</h4>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€æ­¥</span></span><br><span class="line">+ (<span class="type">id</span>)forwardingTargetForSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">if</span> (aSelector == <span class="keyword">@selector</span>(personTest)) &#123;</span><br><span class="line">        <span class="keyword">return</span> [Student <span class="keyword">class</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="variable language_">super</span> forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒæ­¥</span></span><br><span class="line">+ (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">if</span> (aSelector == <span class="keyword">@selector</span>(personTest)) &#123;</span><br><span class="line">        <span class="keyword">return</span> [Student methodSignatureForSelector:aSelector];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="variable language_">super</span> methodSignatureForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="type">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)anInvocation &#123;</span><br><span class="line">    [anInvocation invokeWithTarget:[Student <span class="keyword">class</span>]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)doesNotRecognizeSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å…³äºNSInvocationç±»">å…³äº<code>NSInvocation</code>ç±»</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSInvocation</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSInvocation</span> *)invocationWithMethodSignature:(<span class="built_in">NSMethodSignature</span> *)sig;</span><br><span class="line"><span class="comment">// æ–¹æ³•ç­¾å</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">retain</span>) <span class="built_in">NSMethodSignature</span> *methodSignature;</span><br><span class="line"></span><br><span class="line"><span class="comment">// retainæ‰€æœ‰å‚æ•° é˜²æ­¢å‚æ•°è¢«dealloc</span></span><br><span class="line">- (<span class="type">void</span>)retainArguments;</span><br><span class="line"><span class="comment">// å‚æ•°æ˜¯å¦éƒ½è¢«retained</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="type">BOOL</span> argumentsRetained;</span><br><span class="line"><span class="comment">// æ¶ˆæ¯æ¥æ”¶è€…</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">assign</span>) <span class="type">id</span> target;</span><br><span class="line"><span class="comment">// æ–¹æ³•å</span></span><br><span class="line"><span class="keyword">@property</span> SEL selector;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–è¿”å›å€¼</span></span><br><span class="line">- (<span class="type">void</span>)getReturnValue:(<span class="type">void</span> *)retLoc;</span><br><span class="line"><span class="comment">// è®¾ç½®è¿”å›å€¼</span></span><br><span class="line">- (<span class="type">void</span>)setReturnValue:(<span class="type">void</span> *)retLoc;</span><br><span class="line"><span class="comment">// è·å–idxçš„å‚æ•°</span></span><br><span class="line">- (<span class="type">void</span>)getArgument:(<span class="type">void</span> *)argumentLocation atIndex:(<span class="built_in">NSInteger</span>)idx;</span><br><span class="line"><span class="comment">// è®¾ç½®idxçš„å‚æ•°</span></span><br><span class="line">- (<span class="type">void</span>)setArgument:(<span class="type">void</span> *)argumentLocation atIndex:(<span class="built_in">NSInteger</span>)idx;</span><br><span class="line"><span class="comment">// è°ƒç”¨</span></span><br><span class="line">- (<span class="type">void</span>)invoke;</span><br><span class="line">- (<span class="type">void</span>)invokeWithTarget:(<span class="type">id</span>)target;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>å¤§å®¶æœ‰å…´è¶£çš„è¯å¯ä»¥å»è¯•è¯•NSInvacationçš„ä½¿ç”¨ã€‚</p>
<h2 id="æœ€å-9">æœ€å</h2>
<p>å¦‚æœæŒ‰ç…§ä¸Šé¢çš„ä¸‰å¤§æµç¨‹éƒ½èµ°å®Œä¹‹åä¾ç„¶æ²¡æœ‰æ‰¾åˆ°ç›¸åº”çš„æ–¹æ³•å®ç°ï¼Œé‚£è¿™ä¸ªè°ƒç”¨æœ€åå°±ä¼šè°ƒç”¨<code>doesNotRecognizeSelecto:</code>æŠ›å‡ºå¼‚å¸¸ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘ç¦»å±æ¸²æŸ“</title>
    <url>/posts/62e3ee95/</url>
    <content><![CDATA[<h2 id="å±å¹•æ˜¾ç¤ºå®Œæ•´æµç¨‹">å±å¹•æ˜¾ç¤ºå®Œæ•´æµç¨‹</h2>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080801.jpg" alt="2022080801"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080802.jpg" alt="2022080802"></p>
<p>æ•´ä½“æ¸²æŸ“æµç¨‹å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>
<p><label style="color:red">1ã€CPUé˜¶æ®µ</label></p>
<p>CPUçš„è®¡ç®—ä¸»è¦æ˜¯é€šè¿‡CoreAnimationæ¥å¤„ç†ï¼Œé€šè¿‡OpenGL ES/Metalå°†æ•°æ®ä¼ é€’ç»™GPUã€‚</p>
<p><label style="color:red">2ã€GPUé˜¶æ®µ</label></p>
<p>GPUæ¸²æŸ“ä¸»è¦æ˜¯å°†æ¥æ”¶åˆ°çš„æ¸²æŸ“æ•°æ®è¿›è¡Œä¸€ç³»åˆ—æ¸²æŸ“ä¹‹åå°†å¸§æ•°æ®å­˜å‚¨åœ¨å¸§ç¼“å­˜ï¼ˆFrame Bufferï¼‰é‡Œé¢ï¼Œä¾›è§†é¢‘æ§åˆ¶å™¨è°ƒç”¨ã€‚</p>
<p><label style="color:red">3ã€å±å¹•æ˜¾ç¤º</label></p>
<p>è§†é¢‘æ§åˆ¶å™¨ä»å¸§ç¼“å­˜ä¸­è·å–åˆ°å¸§æ•°æ®æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</p>
<h2 id="å±å¹•æ˜¾ç¤ºå›¾åƒåŸç†">å±å¹•æ˜¾ç¤ºå›¾åƒåŸç†</h2>
<h3 id="CRTæ˜¾ç¤ºå™¨åŸç†">CRTæ˜¾ç¤ºå™¨åŸç†</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080803.jpg" alt="2022080803"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080804.jpg" alt="2022080804"></p>
<p>CRTæ˜¾ç¤ºå™¨åŸç†ä¸»è¦æ˜¯é€šè¿‡ã€ç”µå­æŸã€‘æ¿€å‘å±å¹•å†…è¡¨é¢çš„è§å…‰ç²‰æ¥æ˜¾ç¤ºå›¾åƒï¼Œç”±äºè§å…‰ç²‰ç‚¹äº®åå¾ˆå¿«å°±ä¼šç†„ç­ï¼Œæ‰€ä»¥ã€ç”µå­æªã€‘éœ€è¦ä¸æ–­çš„ã€ä»ä¸Šåˆ°ä¸‹ã€‘è¿›è¡Œæ‰«æï¼Œæ‰«æå®Œæˆåæ˜¾ç¤ºå™¨å°±å‘ˆç°ä¸€å¸§ç”»é¢ï¼Œç”µå­æªå›åˆ°ã€åˆå§‹ä½ç½®ã€‘å¼€å§‹ä¸‹ä¸€æ¬¡çš„æ‰«æã€‚</p>
<div class="note green no-icon flat"><p><strong>æ°´å¹³åŒæ­¥ä¿¡å·</strong>ï¼šå½“ç”µå­æªæ¢è¡Œæ‰«ææ—¶ä¼šå‘å‡ºä¸€ä¸ªæ°´å¹³åŒæ­¥ä¿¡å·ã€‚</p>
<p><strong>å‚ç›´åŒæ­¥ä¿¡å·</strong>ï¼šå½“ä¸€å¸§å®Œæˆç»˜åˆ¶åï¼Œç”µå­æªæ¢å¤åˆ°åŸæ¥çš„ä½ç½®å‡†å¤‡æ‰«æä¸‹ä¸€å¸§æ—¶æ˜¾ç¤ºå™¨ä¼šå‘å‡ºä¸€ä¸ªå‚ç›´åŒæ­¥ä¿¡å·ã€‚</p>
</div>
<p>GPUæ¸²æŸ“å®Œæˆåå°†æ¸²æŸ“ç»“æœå­˜å…¥å¸§ç¼“å­˜åŒºï¼Œè§†é¢‘æ§åˆ¶å™¨æ ¹æ®ã€å‚ç›´åŒæ­¥ä¿¡å·ã€‘é€å¸§è¯»å–å¸§ç¼“å†²åŒºçš„æ•°æ®ï¼Œç»è¿‡æ•°æ®è½¬æ¢ä¹‹åç”±æ˜¾ç¤ºå™¨è¿›è¡Œæ˜¾ç¤ºã€‚</p>
<h3 id="å¸§ç¼“å­˜ï¼ˆFrame-Bufferï¼‰">å¸§ç¼“å­˜ï¼ˆFrame Bufferï¼‰</h3>
<p><label style="color:red">1ã€å±å¹•åˆ·æ–°é¢‘ç‡</label></p>
<p>Refresh Rateï¼Œå•ä½hzï¼ŒæŒ‡çš„æ˜¯è®¾å¤‡åˆ·æ–°å±å¹•çš„é¢‘ç‡ï¼Œè¿™ä¸ªé¢‘ç‡ä¸€èˆ¬æ˜¯60hzï¼Œæ‰€ä»¥æ¯éš”16.67mså±å¹•ä¼šåˆ·æ–°ä¸€æ¬¡ã€‚</p>
<p><label style="color:red">2ã€å¸§ç‡</label></p>
<p>Frame Rateï¼Œå•ä½fpsï¼ŒæŒ‡çš„æ˜¯GPUç”Ÿæˆå¸§çš„é€Ÿç‡ã€‚</p>
<p><label style="color:red">3ã€å¸§ç¼“å­˜</label></p>
<p>ä¹Ÿå«æ˜¾å­˜ï¼Œå®ƒæ˜¯å±å¹•æ‰€æ˜¾ç¤ºç”»é¢çš„ä¸€ä¸ªç›´æ¥æ˜ åƒï¼Œä¹Ÿå«åšä½æ˜ å°„å›¾ï¼ˆbitmapï¼‰æˆ–å…‰æ …ï¼Œå¸§ç¼“å­˜çš„æ¯ä¸€å­˜å‚¨å•å…ƒå¯¹åº”å±å¹•ä¸Šä¸€ä¸ªåƒç´ ï¼Œæ•´ä¸ªå¸§ç¼“å­˜å¯¹åº”ä¸€å¸§å›¾åƒã€‚</p>
<div class="note green no-icon flat"><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œå±å¹•åˆ·æ–°é¢‘ç‡å’Œå¸§ç‡å®Œå…¨ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å±å¹•æ˜¾ç¤ºå®Œä¸€å¸§çš„æ—¶å€™åˆšå¥½ä¸‹ä¸€å¸§ç”»é¢ä¹Ÿç”Ÿæˆç›´æ¥æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œä½†å®é™…ä¸Šè¿™ä¸¤ä¸ªé¢‘ç‡å¹¶ä¸å®Œå…¨ä¸€è‡´ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥çš„ã€å¸§ç¼“å­˜ã€‘çš„æ¦‚å¿µã€‚</p>
</div>
<h3 id="å›¾åƒæ’•è£‚">å›¾åƒæ’•è£‚</h3>
<p><label style="color:red"><strong>å›¾åƒæ’•è£‚ç°è±¡ï¼š</strong></label></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080805.jpg" alt="2022080805"></p>
<p><label style="color:red"><strong>åŸå› åˆ†æï¼š</strong></label></p>
<p>å½“ã€å¸§ç‡ã€‘å¤§äºã€å±å¹•åˆ·æ–°é¢‘ç‡ã€‘æ—¶ï¼Œå½“è§†é¢‘æ§åˆ¶å™¨åˆšè¯»å®Œä¸€å¸§çš„ä¸ŠåŠéƒ¨åˆ†æ—¶ï¼ŒGPUå·²ç»æŠŠä¸‹ä¸€å¸§å‡†å¤‡å¥½å¹¶æäº¤åˆ°å¸§ç¼“å­˜ï¼Œè¿™æ ·è§†é¢‘æ§åˆ¶å™¨å°±ä¼šè¯»åˆ°ä¸‹ä¸€å¸§çš„ä¸‹åŠéƒ¨åˆ†åœ¨å±å¹•æ˜¾ç¤ºã€‚</p>
<p><label style="color:red"><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></label></p>
<p>è‹¹æœä½¿ç”¨çš„æ˜¯ã€åŒç¼“å­˜ã€‘å’Œã€å‚ç›´åŒæ­¥ä¿¡å·ã€‘ã€‚</p>
<div class="note green no-icon flat"><p><strong>å‚ç›´åŒæ­¥ä¿¡å·</strong>ä¿è¯GPUçš„æ¸²æŸ“åªæœ‰ç­‰åˆ°æ˜¾ç¤ºå™¨å‘å‡ºã€å‚ç›´åŒæ­¥ä¿¡å·ã€‘ä¹‹åæ‰ä¼šè¿›è¡Œä¸‹ä¸€å¸§çš„æ¸²æŸ“ã€‚</p>
<p><strong>åŒç¼“å­˜</strong>ä¿è¯æ˜¾ç¤ºå™¨ä¼šäº¤å‰è¯»å–ä¸¤ä¸ªç¼“å­˜åŒºçš„å†…å®¹ï¼Œç›¸å½“äºæ˜¯æ‹¿ç©ºé—´æ¢æ—¶é—´çš„ä¸€ç§ç­–ç•¥ã€‚</p>
<p>å¥½å¤„åœ¨äºï¼š</p>
<ol>
<li>
<p>ä¸æµªè´¹CPUã€GPUèµ„æºï¼Œä¿è¯æå‰æ¸²æŸ“å¥½çš„ä½å›¾æœ‰ä¸€ä¸ªç¼“å­˜åŒºæ¥ä¿å­˜ï¼Œè¿™æ ·GPUå¯ä»¥å°±å¯ä»¥è¿›è¡Œä¸‹ä¸€å¸§çš„å¤„ç†ã€‚</p>
</li>
<li>
<p>å‡å°‘æ‰å¸§çš„å‡ºç°ã€‚</p>
</li>
</ol>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080806.jpg" alt="2022080806"></p>
</div>
<h3 id="å¡é¡¿">å¡é¡¿</h3>
<p>å½“æ˜¾ç¤ºå™¨çš„ã€å‚ç›´åŒæ­¥ä¿¡å·ã€‘å‘å‡ºçš„æ—¶å€™ï¼ŒGPUæ²¡æœ‰å®Œæˆç›¸åº”çš„æ¸²æŸ“å°±ä¼šå‡ºç°ã€å¡é¡¿ã€‘çš„ç°è±¡ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºäº†è§£å†³ç”»é¢æ’•è£‚çš„é—®é¢˜å¸¦æ¥çš„å‰¯ä½œç”¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080807.jpg" alt="2022080807"></p>
<div class="note green no-icon flat"><p><strong>è¡¥å……</strong>ï¼š</p>
<ol>
<li>æ‰å¸§æŒ‡çš„æ˜¯é‡å¤æ¸²æŸ“åŒä¸€å¸§æ•°æ®è€Œä¸æ˜¯æŒ‡æŸä¸€å¸§ä¸¢æ‰äº†ä¸æ¸²æŸ“ã€‚</li>
<li>ä¸ºäº†å‡å°‘ã€æ‰å¸§ã€‘çš„æƒ…å†µï¼Œæœ‰çš„ä¼šå¼•å…¥ã€ä¸‰ç¼“å­˜ã€‘+ã€å‚ç›´åŒæ­¥ä¿¡å·ã€‘ï¼Œæ¯”å¦‚å®‰å“è®¾å¤‡ã€‚</li>
</ol>
</div>
<h2 id="ç¦»å±æ¸²æŸ“">ç¦»å±æ¸²æŸ“</h2>
<h3 id="ä»€ä¹ˆæ˜¯ç¦»å±æ¸²æŸ“ï¼Ÿ">ä»€ä¹ˆæ˜¯ç¦»å±æ¸²æŸ“ï¼Ÿ</h3>
<p>å½“GPUæ— æ³•ç›´æ¥æŠŠæ¸²æŸ“ç»“æœå­˜æ”¾åˆ°å¸§ç¼“å­˜ä¸­ï¼Œè€Œæ˜¯å…ˆæ˜¯æš‚æ—¶æŠŠä¸­é—´çš„ä¸€ä¸ªä¸´æ—¶çŠ¶æ€å­˜æ”¾åœ¨å¦å¤–çš„åŒºåŸŸã€‚ä¹‹åå†å­˜æ”¾åˆ°å¸§ç¼“å­˜ï¼Œè¿™ä¸ªè¿‡ç¨‹å«ç¦»å±æ¸²æŸ“ã€‚</p>
<p>å³æ˜¯è¯´ï¼šGPUéœ€è¦å†å½“å‰å±å¹•ç¼“å­˜åŒºä»¥å¤–å¼€è¾Ÿä¸€ä¸ªæ–°çš„ç¼“å†²åŒºè¿›è¡Œæ“ä½œã€‚</p>
<div class="note green no-icon flat"><p><strong>åŸå› </strong>ï¼š</p>
<p>GPUæ¸²æŸ“é‡‡ç”¨çš„æ˜¯ã€ç”»å®¶ç®—æ³•ã€‘ï¼Œåªèƒ½ä¸€å±‚ä¸€å±‚çš„è¾“å‡ºï¼Œæ‰€ä»¥å½“ä¸€å±‚ä¸èƒ½ç›´æ¥ç”Ÿæˆå›¾ç‰‡çš„è¯å°±éœ€è¦é¢å¤–å¼€è¾Ÿæ–°çš„ç¼“å†²åŒºæ¥å­˜æ”¾è¿™äº›ä¸´æ—¶å›¾å±‚ç›´åˆ°æœ€åç”Ÿæˆäº†ä¸€å¼ å®Œæ•´çš„å›¾ç‰‡ä¹‹åå†å†™å…¥å¸§ç¼“å­˜é‡Œé¢ã€‚</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080808.jpg" alt="2022080808"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080809.jpg" alt="2022080809"></p>
</div>
<h3 id="å½“å‰å±å¹•æ¸²æŸ“å’Œç¦»å±æ¸²æŸ“">å½“å‰å±å¹•æ¸²æŸ“å’Œç¦»å±æ¸²æŸ“</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080810.jpg" alt="2022080810"></p>
<h3 id="ç¦»å±æ¸²æŸ“çš„æ€§èƒ½æŸè€—">ç¦»å±æ¸²æŸ“çš„æ€§èƒ½æŸè€—</h3>
<p>ç¦»å±æ¸²æŸ“åœ¨å½“å‰å±å¹•ç¼“å†²åŒºå¤–æ–°å¼€è¾Ÿä¸€ä¸ªç¼“å†²åŒºè¿›è¡Œæ¸²æŸ“æ“ä½œï¼Œé€ æˆå…¶æ€§èƒ½æŸè€—çš„ä¸»è¦åŸå› åœ¨äºï¼šåˆ›å»ºç¦»å±æ¸²æŸ“å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p>
<p>åˆ‡æ¢ä¸Šä¸‹æ–‡ä¸»è¦æ˜¯å½“å‘ç”Ÿç¦»å±æ¸²æŸ“æ—¶ï¼Œæ¸²æŸ“ä¸Šä¸‹æ–‡éœ€ä»å½“å‰å±å¹•ç¼“å†²åŒºåˆ‡æ¢åˆ°å±å¹•å¤–ç¼“å†²åŒºç„¶åå†å®Œæˆæ¸²æŸ“ã€‚</p>
<p>å¦‚æœä¸€å±å…ƒç´ éƒ½å‘ç”Ÿç¦»å±æ¸²æŸ“ï¼Œè¿™ä¸ªä»å½“å‰å±å¹•ç¼“å†²åŒºåˆ‡æ¢åˆ°å±å¹•å¤–çš„ç¼“å†²åŒºå°±ä¼šå‘ç”Ÿå¤šæ¬¡ï¼Œè‡ªç„¶å°±ä¼šæœ‰ä¸€å®šçš„æ€§èƒ½æŸè€—ã€‚</p>
<h3 id="å¸¸è§çš„ç¦»å±æ¸²æŸ“åœºæ™¯">å¸¸è§çš„ç¦»å±æ¸²æŸ“åœºæ™¯</h3>
<h4 id="è®¾ç½®åœ†è§’">è®¾ç½®åœ†è§’</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080811.jpg" alt="2022080811"></p>
<p><label style="color:red"><strong>ç»“è®º</strong>ï¼š</label></p>
<p>æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„å°±ä¼šå‘ç”Ÿç¦»å±æ¸²æŸ“ï¼š</p>
<ol>
<li>clipsToBoundså¼€å¯ï¼Œåœ†è§’ &gt; 0ï¼Œcontentsä¸Šæœ‰å†…å®¹</li>
<li>åŒæ—¶ä¿®æ”¹äº†contents+backgroundColor æˆ– contents+borderï¼ˆiOS9ä¹‹åï¼‰</li>
</ol>
<p><label style="color:red"><strong>ä¼˜åŒ–</strong>ï¼š</label></p>
<ol>
<li>ç›´æ¥è®©UIæä¾›å¸¦åœ†è§’çš„å›¾ç‰‡</li>
<li>åˆ©ç”¨UIBezierPathå’ŒCAShapeLayer</li>
<li>åˆ©ç”¨UIBezierPathå’ŒCoreGraphics</li>
</ol>
<h4 id="è®¾ç½®é®ç½©">è®¾ç½®é®ç½©</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080812-20220808141811098.jpg" alt="2022080812"></p>
<p><label style="color:red"><strong>è®¾ç½®é®ç½©çš„æµç¨‹å¦‚ä¸‹</strong>ï¼š</label></p>
<ol>
<li>æ¸²æŸ“layerçš„maskçº¹ç†</li>
<li>æ¸²æŸ“layerçš„contentçº¹ç†</li>
<li>åˆå¹¶æ“ä½œï¼šåˆå¹¶mask å’Œ contentçº¹ç†</li>
</ol>
<p><label style="color:red"><strong>ç»“è®º</strong>ï¼š</label></p>
<p>æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„éƒ½ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ï¼š</p>
<ol>
<li>è®¾ç½®äº†mask + ä»»æ„contentsï¼ˆæ¯”å¦‚è®¾ç½®UILabelæ–‡å­—ã€èƒŒæ™¯é¢œè‰²ã€å›¾ç‰‡ç­‰ï¼‰</li>
</ol>
<h4 id="è®¾ç½®é˜´å½±ï¼ˆshadowï¼‰">è®¾ç½®é˜´å½±ï¼ˆshadowï¼‰</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080813.jpg" alt="2022080813"></p>
<p><label style="color:red"><strong>ç»“è®º</strong>ï¼š</label></p>
<p>é˜´å½±çš„æœ¬è´¨å’Œlayerç±»ä¼¼ï¼Œéƒ½æ˜¯åœ¨layerä¸‹ä¸€å±‚å¤šæ·»åŠ ä¸€å±‚ï¼Œæ ¹æ®å‰é¢æåˆ°çš„ã€ç”»å®¶ç®—æ³•ã€‘æ— æ³•ä¸€æ¬¡æ€§ç”Ÿæˆï¼Œæ‰€ä»¥ä¼šå‘ç”Ÿç¦»å±æ¸²æŸ“ã€‚</p>
<p><label style="color:red"><strong>ä¼˜åŒ–</strong>ï¼š</label></p>
<p>1.åˆ©ç”¨UIBezierPathç»™è§†å›¾æ·»åŠ ä¸€ä¸ªé˜´å½±è·¯å¾„ï¼Œç›¸å½“äºæå‰å‘Šè¯‰GPUè¿™ä¸ªé˜´å½±çš„å‡ ä½•å½¢çŠ¶ï¼Œè¿™æ ·é˜´å½±å°±å¯ä»¥ç‹¬ç«‹æ¸²æŸ“ã€‚</p>
<h4 id="å…‰æ …åŒ–ï¼ˆshouldRasterizeï¼‰">å…‰æ …åŒ–ï¼ˆshouldRasterizeï¼‰</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080814.jpg" alt="2022080814"></p>
<p><label style="color:red"><strong>å…‰æ …åŒ–</strong>ï¼š</label></p>
<p>å…‰æ …åŒ–æ˜¯ä¸€ç§ç¼“å­˜æœºåˆ¶ï¼Œå¼€å¯åä¼šç¼“å­˜è¿™ä¸ªå›¾ç‰‡çš„bitmapï¼Œå¦‚æœå¯¹åº”çš„layerå’Œsublayersæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å­˜è€Œä¸ç”¨GPUå†è¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<p>å…‰æ …åŒ–åªèƒ½ç¼“å­˜100msï¼Œè€Œä¸”åªèƒ½å­˜å‚¨å±å¹•å¤§å°2.5å€çš„æ•°æ®ï¼Œç¼“å­˜ç©ºé—´ååˆ†æœ‰é™ã€‚</p>
<h4 id="ç»„ä¸é€æ˜ï¼ˆallowsGroupOpacityï¼‰">ç»„ä¸é€æ˜ï¼ˆallowsGroupOpacityï¼‰</h4>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/20220808/2022080815.jpg" alt="2022080815"></p>
<p><label style="color:red"><strong>allowsGroupOpacity</strong>ï¼š</label></p>
<p>alphaå¹¶ä¸æ˜¯åˆ†åˆ«åº”ç”¨åˆ°æ¯ä¸€å±‚ä¸Šï¼Œè€Œæ˜¯æ•´ä¸ªlayerå›¾å±‚æ ‘å®Œæˆä¹‹åï¼Œå†ç»Ÿä¸€åŠ ä¸Šalphaï¼Œç„¶åå’Œåº•ä¸‹å…¶ä»–åƒç´ è¿›è¡Œèåˆã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<p>iOS7ä¹‹åallowsGroupOpacityé»˜è®¤ä¸ºYESï¼Œè¿™æ ·åšçš„åŸå› æ˜¯ä¸ºäº†ä¿æŒå­è§†å›¾å’Œçˆ¶è§†å›¾ä¿æŒåŒæ ·çš„é€æ˜åº¦</p>
<p><label style="color:red"><strong>allowsGroupOpacityè§¦å‘ç¦»å±æ¸²æŸ“çš„æ¡ä»¶</strong>ï¼š</label></p>
<ol>
<li>å½“è§†å›¾ä¸Šæœ‰å…¶ä»–å­è§†å›¾</li>
<li>è§†å›¾Viewçš„alphaå€¼åœ¨0 ï½ 1ä¹‹é—´</li>
<li>è§†å›¾view.layer.allowsGroupOpacity = YES</li>
</ol>
<h2 id="æ€»ç»“-4">æ€»ç»“</h2>
<p>ç¦»å±æ¸²æŸ“çš„å¤„ç†ä»…ä»…æ˜¯æˆ‘ä»¬æ—¥å¸¸æ‰€å…³æ³¨çš„æ€§èƒ½ä¸­çš„å…¶ä¸­ä¸€ä¸ªç‚¹ï¼Œåœ¨å¤„ç†çš„æ—¶å€™ä¹Ÿè¦æ ¹æ®å…·ä½“åœºæ™¯å…·ä½“åˆ†æï¼Œè¦æ³¨æ„å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç¦»å±æ¸²æŸ“éƒ½æ˜¯å¿…é¡»è¦å»é¿å…çš„ï¼Œå¼€è¾Ÿé¢å¤–çš„å¸§ç¼“å­˜è™½ç„¶æœ‰ä¸€å®šçš„æ€§èƒ½æŸè€—ï¼Œä½†æ˜¯ä¿å­˜æ¸²æŸ“ç»“æœå¹¶è¿›è¡Œæœ€ç»ˆçš„è§†å›¾æ˜¾ç¤ºä¹Ÿæ˜¯ä¸ºäº†ä¿æŒè§†å›¾çš„æµç•…æ€§ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>ç¦»å±æ¸²æŸ“</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘çª¥æ¢Classçš„ç»“æ„</title>
    <url>/posts/b55a18a8/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-28">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡ä¸»è¦æ¢ç©¶<code>Class</code>çš„å†…éƒ¨ç»“æ„ï¼Œåšä¸»è¿™é‡Œä½¿ç”¨çš„objc4çš„æºç ç‰ˆæœ¬æ˜¯<code>objc4-838</code>ï¼Œå»ºè®®å¤§å®¶åœ¨çœ‹çš„æ—¶å€™å¯ä»¥ä¸‹è½½æœ€æ–°æºç ã€‚</p>
<h2 id="Classçš„ç»“æ„-2">Classçš„ç»“æ„</h2>
<p>åœ¨å‰é¢å…³äº<a href="https://codersunny.com/posts/9efafc5a/">isaå’Œsuperclass</a>æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†ç±»å¯¹è±¡å’Œå…ƒç±»å¯¹è±¡çš„ç±»å‹éƒ½æ˜¯<code>Class</code>ï¼Œå†…å­˜é‡Œé¢ä¿å­˜çš„æ˜¯ï¼š</p>
<p>. isaæŒ‡é’ˆ</p>
<p>. superclassæŒ‡é’ˆ</p>
<p>. å±æ€§ä¿¡æ¯</p>
<p>. å¯¹è±¡æ–¹æ³•ä¿¡æ¯</p>
<p>. åè®®ä¿¡æ¯</p>
<p>. æˆå‘˜å˜é‡ä¿¡æ¯</p>
<p>ä»Šå¤©æˆ‘ä»¬å°±æ¥å‰–æä¸€ä¸‹<code>Class</code>çš„å†…éƒ¨ç»“æ„ï¼ŒéªŒè¯ä¸€ä¸‹æ˜¯ä¸æ˜¯å­˜æ”¾çš„è¿™äº›ä¿¡æ¯ï¼ŒåºŸè¯ä¸å¤šè¯´äº†ï¼Œæˆ‘ä»¬ç°åœ¨å°±å¼€å§‹å§ã€‚</p>
<p><code>Class</code>æ˜¯ä¸ª<code>objc_class</code>ç±»å‹çš„ç»“æ„ä½“ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_class *Class;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>objc4</code>æºç <code>objc-runtime-new.h</code>æ–‡ä»¶ä¸­ï¼Œå¯¹<code>objc_class</code>å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1123/1.png" alt="1"></p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1123/2.png" alt="2"></p>
<p>å› ä¸º<code>objc_class</code>ç»“æ„ä½“ä¸­æ•°æ®å¤ªå¤šï¼Œæˆ‘è¿™é‡Œæç‚¼å‡ºæ¥å¯¹æˆ‘ä»¬åˆ†æç»“æ„æœ‰ç”¨çš„æ•°æ®ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_class : objc_object &#123;</span><br><span class="line">  Class isa; <span class="comment">// isa</span></span><br><span class="line">  Class superclass; <span class="comment">// superclass</span></span><br><span class="line">  cache_t cache; <span class="comment">// æ–¹æ³•ç¼“å­˜</span></span><br><span class="line">  class_data_bits_t bits; <span class="comment">// å…·ä½“çš„ç±»ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>class_data_bits_t</code>ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> class_data_bits_t &#123;</span><br><span class="line">  class_rw_t *data() <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (class_rw_t *)(bits &amp; FAST_DATA_MASK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>class_rw_t</code>ç»“æ„ä¸­ï¼Œ<code>rw</code>ä¸€èˆ¬è¡¨ç¤ºreadwriteï¼ˆå¯è¯»å¯å†™ï¼‰ï¼Œ<code>t</code>ä¸€èˆ¬è¡¨ç¤ºtable,ç»“æ„ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> class_rw_t &#123;</span><br><span class="line">  uint32_t flags;</span><br><span class="line">  uint16_t witness;</span><br><span class="line">  Class firstSubclass;</span><br><span class="line">  Class nextSiblingClass;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  æ‰€æœ‰çš„ç±»ä¼šé“¾æ¥æˆä¸€ä¸ªæ ‘çŠ¶ç»“æ„ åˆ©ç”¨firstSubclass å’Œ nextSiblingClassæ¥å®ç°çš„ã€‚</span></span><br></pre></td></tr></table></figure>
<p><code>class_rw_ext_t</code>ç»“æ„ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> class_rw_ext_t &#123;</span><br><span class="line">  class_ro_t_authed_ptr&lt;<span class="keyword">const</span> class_ro_t&gt; ro;</span><br><span class="line">  method_array_t methods; <span class="comment">// æ–¹æ³•åˆ—è¡¨</span></span><br><span class="line">  property_array_t properties; <span class="comment">// å±æ€§åˆ—è¡¨</span></span><br><span class="line">  protocol_array_t protocols; <span class="comment">// åè®®åˆ—è¡¨</span></span><br><span class="line">  <span class="type">char</span> *demangledName;</span><br><span class="line">  uint32_t version;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<div class="note red no-icon flat"><p><strong>æé†’</strong>ï¼š</p>
<p>åœ¨WWDC2020ä¸­ï¼Œè‹¹æœä¿®æ”¹äº†ä¸€äº›åº•å±‚çš„ç±»ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„<code>class_rw_ext_t</code>ï¼Œè‡³äºè¿™ä¸ªç±»ä¸»è¦ä½œç”¨æ˜¯ä»€ä¹ˆå¤§å®¶æœ‰å…´è¶£çš„å¯ä»¥å»è¯¦ç»†äº†è§£ä¸€ä¸‹ï¼Œåšä¸»è¿™é‡Œå°±ä¸å±•å¼€æ¥è®²è¿™ä¸ªäº†ï¼Œå¤§æ¦‚çš„æ„æ€å°±æ˜¯ï¼šå®ƒåˆ©ç”¨äº†æ‡’åŠ è½½çš„æœºåˆ¶ï¼Œåœ¨ç±»çš„<code>methods</code>ã€<code>properties</code>ç­‰å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ‰ä¼šåˆå§‹åŒ–<code>class_rw_ext_t</code>æ¥å­˜å‚¨è¿™äº›åˆ—è¡¨ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘90%ä»¥å‰Runtimeä¸­çš„ç±»åœ¨<code>rw</code>ä¸­ç›´æ¥å¤åˆ¶<code>ro</code>ä¸­æ•°æ®æµªè´¹çš„å†…å­˜ã€‚</p>
</div>
<p><code>class_ro_t</code>ç»“æ„ä¸­ï¼Œ<code>ro</code>ä¸€èˆ¬è¡¨ç¤ºreadonlyï¼ˆåªè¯»ï¼‰ï¼Œ<code>t</code>ä¸€èˆ¬è¡¨ç¤ºtableï¼Œç»“æ„ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> class_ro_t &#123;</span><br><span class="line">  uint32_t flags;</span><br><span class="line">  uint32_t instanceStart;</span><br><span class="line">  uint32_t instanceSize; <span class="comment">// instanceå¯¹è±¡å ç”¨çš„å†…å­˜ç©ºé—´å¤§å°</span></span><br><span class="line">  </span><br><span class="line">  explicit_atomic&lt;<span class="keyword">const</span> <span class="type">char</span> *&gt; name; <span class="comment">// ç±»å</span></span><br><span class="line">  <span class="comment">// æ–¹æ³•åˆ—è¡¨ï¼ˆä¸åŒ…æ‹¬åˆ†ç±»çš„æ–¹æ³•åˆ—è¡¨ï¼‰</span></span><br><span class="line">  WrappedPtr&lt;method_list_t, method_list_t::Ptrauth&gt; baseMethods;</span><br><span class="line">  protocol_list_t * baseProtocols; <span class="comment">// åè®®ä¿¡æ¯åˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> ivar_list_t * ivars; <span class="comment">// æˆå‘˜å˜é‡åˆ—è¡¨</span></span><br><span class="line">  property_list_t *baseProperties; <span class="comment">// å±æ€§ä¿¡æ¯åˆ—è¡¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤ºClassç»“æ„ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1123/3.png" alt="3"></p>
<p>ä»ä¸Šé¢çš„ç»“æ„åˆ†ææˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šclasså¯¹è±¡æˆ–meta-classå¯¹è±¡é‡Œé¢ç¡®å®ä¿å­˜äº†<strong>æ–¹æ³•åˆ—è¡¨ã€å±æ€§åˆ—è¡¨ã€åè®®åˆ—è¡¨ã€æˆå‘˜å˜é‡åˆ—è¡¨</strong>ç­‰ä¿¡æ¯ã€‚</p>
<h2 id="å†™åœ¨æœ€å-19">å†™åœ¨æœ€å</h2>
<p>å…³äº<code>Class</code>ç»“æ„ä¿¡æ¯æˆ‘ä»¬å°±åˆ†æåˆ°è¿™é‡Œäº†ï¼Œå¦‚æœæœ‰ä»€ä¹ˆä¸å¯¹çš„åœ°æ–¹æœ›æŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€iOSé‡å­¦ã€‘çº¿ç¨‹ä¿æ´»</title>
    <url>/posts/f68de671/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-29">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡ä¸»è¦è®²ä¸€ä¸‹çº¿ç¨‹ä¿æ´»æ˜¯ä»€ä¹ˆã€çº¿ç¨‹ä¿æ´»çš„æ„ä¹‰ã€å¦‚ä½•å®ç°çº¿ç¨‹ä¿æ´»ã€‚</p>
<h2 id="çº¿ç¨‹ä¿æ´»">çº¿ç¨‹ä¿æ´»</h2>
<h3 id="çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ">çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</h3>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/2023/02/14/1.png" alt="1"></p>
<ul>
<li>ã€æ–°å»ºã€‘ï¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚</li>
<li>ã€å°±ç»ªã€‘ï¼šçº¿ç¨‹è°ƒç”¨<code>start</code>æ–¹æ³•ï¼Œå°†çº¿ç¨‹åŠ å…¥å¯è°ƒåº¦çº¿ç¨‹æ± ä¸­ï¼Œç­‰ç€CPUçš„è°ƒåº¦ã€‚</li>
<li>ã€è¿è¡Œã€‘ï¼šCPUè°ƒåº¦å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚</li>
<li>ã€é˜»å¡ã€‘ï¼šå½“æ»¡è¶³æŸä¸ªé¢„è®¾çš„æ¡ä»¶æ—¶ï¼ˆæ¯”å¦‚ä¼‘çœ æˆ–è€…åŒæ­¥é”ï¼‰ä¼šé˜»å¡çº¿ç¨‹æ‰§è¡Œï¼Œé‡æ–°å°†çº¿ç¨‹è®¾ç½®ä¸ºã€å°±ç»ªã€‘çŠ¶æ€ã€‚</li>
<li>ã€æ­»äº¡ã€‘ï¼šçº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æˆ–å¼ºåˆ¶é€€å‡ºï¼Œçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¿æ´»">ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¿æ´»</h3>
<p>çº¿ç¨‹ä¿æ´»ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå½“çº¿ç¨‹æ‰§è¡Œç©ä¸€æ¬¡ä»»åŠ¡ä¹‹åéœ€è¦è¿›è¡Œèµ„æºå›æ”¶ä¹Ÿå°±æ„å‘³ç€ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œçº¿ç¨‹ä¿æ´»å°±æ˜¯ä¿è¯çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸ç»“æŸã€‚</p>
<h3 id="çº¿ç¨‹ä¿æ´»çš„åº”ç”¨åœºæ™¯">çº¿ç¨‹ä¿æ´»çš„åº”ç”¨åœºæ™¯</h3>
<p>å½“ä¸€ä¸ªä»»åŠ¡éšæ—¶éƒ½æœ‰å¯èƒ½å»æ‰§è¡Œå®ƒï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡åº”è¯¥æ”¾åœ¨å­çº¿ç¨‹å»æ‰§è¡Œï¼Œå¹¶ä¸”è®©å­çº¿ç¨‹ä¸€ç›´å­˜æ´»ï¼Œé¿å…é¢‘ç¹åˆ›å»ºçº¿ç¨‹è€Œé€ æˆçš„æ€§èƒ½æŸè€—ã€‚<br>
å¤§å®¶å¦‚æœçœ‹è¿‡AFNetworkingçš„æºç å°±ä¼šçœ‹åˆ°æ¡†æ¶é‡Œé¢æ˜¯æœ‰ç”¨åˆ°çº¿ç¨‹ä¿æ´»çš„ã€‚</p>
<h3 id="å¦‚ä½•å®ç°çº¿ç¨‹ä¿æ´»">å¦‚ä½•å®ç°çº¿ç¨‹ä¿æ´»</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// WWPermenantThread ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WWPermenantThread</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> å…³é—­çº¿ç¨‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="type">void</span>)stop;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// åœ¨ä¿æ´»çš„çº¿ç¨‹é‡Œé¢æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line"><span class="comment">/// @param target ç›®æ ‡å¯¹è±¡</span></span><br><span class="line"><span class="comment">/// @param action selector</span></span><br><span class="line"><span class="comment">/// @param object object</span></span><br><span class="line">- (<span class="type">void</span>)excuteTaskWithTarget:(<span class="type">id</span>)target action:(SEL)action object:(<span class="type">id</span>)object;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// åœ¨ä¿æ´»çš„çº¿ç¨‹é‡Œæ‰§è¡Œä»»åŠ¡</span></span><br><span class="line"><span class="comment">/// @param task æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line">- (<span class="type">void</span>)excuteTask:(<span class="type">void</span>(^)(<span class="type">void</span>))task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WWPermenantThread</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSThread</span> *innerThread;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="type">BOOL</span> isStopped;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">WWPermenantThread</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)dealloc &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">    [<span class="keyword">self</span> stop];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="variable language_">super</span> init]) &#123;</span><br><span class="line">    <span class="keyword">self</span>.isStopped = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line">    __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">    <span class="keyword">self</span>.innerThread = [[<span class="built_in">NSThread</span> alloc] initWithBlock:^&#123;</span><br><span class="line">      <span class="comment">// æ·»åŠ Portåˆ°RunLoop</span></span><br><span class="line">      [[<span class="built_in">NSRunLoop</span> currentRunLoop] addPort:[[<span class="built_in">NSPort</span> alloc] init] forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line">      <span class="keyword">while</span> (weakSelf &amp;&amp; !weakSelf.isStopped) &#123;</span><br><span class="line">        <span class="comment">// å¼€å¯RunLoop</span></span><br><span class="line">          [[<span class="built_in">NSRunLoop</span> currentRunLoop] runMode:<span class="built_in">NSDefaultRunLoopMode</span> beforeDate:[<span class="built_in">NSDate</span> distantFuture]];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [<span class="keyword">self</span>.innerThread start];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)run &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">self</span>.innerThread) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="keyword">self</span>.innerThread start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)stop &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">self</span>.innerThread) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(__stop) onThread:<span class="keyword">self</span>.innerThread withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)__stop &#123;</span><br><span class="line">  <span class="keyword">self</span>.isStopped = <span class="literal">YES</span>;</span><br><span class="line">  <span class="comment">// é€€å‡ºå½“å‰RunLoop</span></span><br><span class="line">  <span class="built_in">CFRunLoopStop</span>(<span class="built_in">CFRunLoopGetCurrent</span>());</span><br><span class="line">  <span class="keyword">self</span>.innerThread = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)excuteTaskWithTarget:(<span class="type">id</span>)target action:(SEL)action object:(<span class="type">id</span>)object &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">self</span>.innerThread) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="keyword">self</span> performSelector:action onThread:<span class="keyword">self</span>.innerThread withObject:object waitUntilDone:<span class="literal">NO</span> ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)excuteTask:(<span class="type">void</span> (^)(<span class="type">void</span>))task &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">self</span>.innerThread || !task) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(__excuteTask:) onThread:<span class="keyword">self</span>.innerThread withObject:task waitUntilDone:<span class="literal">NO</span> ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)__excuteTask:(<span class="type">void</span>(^)(<span class="type">void</span>))task &#123;</span><br><span class="line">  task();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="å¦‚ä½•ä½¿ç”¨çº¿ç¨‹ä¿æ´»">å¦‚ä½•ä½¿ç”¨çº¿ç¨‹ä¿æ´»</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">  [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">self</span>.thread = [[WWPermenantThread alloc] init];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">  [<span class="keyword">self</span>.thread excuteTask:^&#123;</span><br><span class="line">      <span class="built_in">NSLog</span>(<span class="string">@&quot;æ‰§è¡Œä»»åŠ¡ - %@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">  &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="number">2023</span><span class="number">-02</span><span class="number">-15</span> <span class="number">10</span>:<span class="number">18</span>:<span class="number">56.211402</span>+<span class="number">0800</span> çº¿ç¨‹ä¿æ´»Demo1[<span class="number">10526</span>:<span class="number">21512893</span>] æ‰§è¡Œä»»åŠ¡ - &lt;<span class="built_in">NSThread</span>: <span class="number">0x600002e99680</span>&gt;&#123;number = <span class="number">9</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2023</span><span class="number">-02</span><span class="number">-15</span> <span class="number">10</span>:<span class="number">18</span>:<span class="number">56.830085</span>+<span class="number">0800</span> çº¿ç¨‹ä¿æ´»Demo1[<span class="number">10526</span>:<span class="number">21512893</span>] æ‰§è¡Œä»»åŠ¡ - &lt;<span class="built_in">NSThread</span>: <span class="number">0x600002e99680</span>&gt;&#123;number = <span class="number">9</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2023</span><span class="number">-02</span><span class="number">-15</span> <span class="number">10</span>:<span class="number">18</span>:<span class="number">57.279150</span>+<span class="number">0800</span> çº¿ç¨‹ä¿æ´»Demo1[<span class="number">10526</span>:<span class="number">21512893</span>] æ‰§è¡Œä»»åŠ¡ - &lt;<span class="built_in">NSThread</span>: <span class="number">0x600002e99680</span>&gt;&#123;number = <span class="number">9</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2023</span><span class="number">-02</span><span class="number">-15</span> <span class="number">10</span>:<span class="number">18</span>:<span class="number">58.212741</span>+<span class="number">0800</span> çº¿ç¨‹ä¿æ´»Demo1[<span class="number">10526</span>:<span class="number">21512893</span>] æ‰§è¡Œä»»åŠ¡ - &lt;<span class="built_in">NSThread</span>: <span class="number">0x600002e99680</span>&gt;&#123;number = <span class="number">9</span>, name = (null)&#125;</span><br><span class="line"><span class="number">2023</span><span class="number">-02</span><span class="number">-15</span> <span class="number">10</span>:<span class="number">19</span>:<span class="number">32.672529</span>+<span class="number">0800</span> çº¿ç¨‹ä¿æ´»Demo1[<span class="number">10526</span>:<span class="number">21512038</span>] -[OneViewController dealloc]</span><br><span class="line"><span class="number">2023</span><span class="number">-02</span><span class="number">-15</span> <span class="number">10</span>:<span class="number">19</span>:<span class="number">32.672800</span>+<span class="number">0800</span> çº¿ç¨‹ä¿æ´»Demo1[<span class="number">10526</span>:<span class="number">21512038</span>] -[WWPermenantThread dealloc]</span><br></pre></td></tr></table></figure>
<h2 id="å†™åœ¨æœ€å-20">å†™åœ¨æœ€å</h2>
<p>å…³äºå¦‚ä½•å®ç°çº¿ç¨‹ä¿æ´»çš„ç¬”è®°å°±è®°å½•åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>åº•å±‚åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ iOSé‡å­¦ã€‘è¯¦ç»†åˆ†æisaå’Œsuperclass</title>
    <url>/posts/9efafc5a/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-30">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡å°†ä»æºç ä¸Šæ¥è¯¦ç»†å‰–æOCå¯¹è±¡çš„åˆ†ç±»ã€isaã€superclassï¼Œå¸¦å¤§å®¶é‡æ–°è®¤è¯†iOSã€‚</p>
<p>è‹¹æœæºç ä¸‹è½½ï¼š</p>
<p>1.<a href="https://opensource.apple.com/releases/">https://opensource.apple.com/releases/</a>  æœç´¢objc4æ‰¾åˆ°æœ€æ–°èµ„æºè¿›è¡Œä¸‹è½½</p>
<p>2.<a href="https://opensource.apple.com/source/objc4/">https://opensource.apple.com/source/objc4/</a></p>
<p>3.<a href="https://opensource.apple.com/tarballs/objc4/">https://opensource.apple.com/tarballs/objc4/</a>  ï¼ˆè¿™ä¸ªæ˜¯å…¶ä»–åšæ–‡æåˆ°çš„ä¸‹è½½è·¯å¾„ ä½†æ˜¯åœ¨åšä¸»è¿™é‡Œä¼šæç¤º404äº†ï¼‰</p>
<h2 id="OCå¯¹è±¡çš„åˆ†ç±»">OCå¯¹è±¡çš„åˆ†ç±»</h2>
<p>OCå¯¹è±¡å¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼šinstanceå¯¹è±¡ï¼ˆå®ä¾‹å¯¹è±¡ï¼‰ã€classå¯¹è±¡ï¼ˆç±»å¯¹è±¡ï¼‰ã€meta-classå¯¹è±¡ï¼ˆå…ƒç±»å¯¹è±¡ï¼‰ï¼Œæˆ‘ä»¬ç°åœ¨æ¥ä¸€ä¸€åˆ†æè¿™ä¸‰ç§å¯¹è±¡ã€‚</p>
<h3 id="å®ä¾‹å¯¹è±¡">å®ä¾‹å¯¹è±¡</h3>
<p>instanceå¯¹è±¡æ˜¯è°ƒç”¨<code>alloc</code>çš„å¯¹è±¡ï¼Œæ¯æ¬¡è°ƒç”¨<code>alloc</code>éƒ½ä¼šäº§ç”Ÿæ–°çš„instanceå¯¹è±¡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSObject</span> *object1 = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line"><span class="built_in">NSObject</span> *object2 = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;object1:%p,object2:%p&quot;</span>,object1, object2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼šobject1:0x6000029982d0,object2:0x600002998220</span></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼š<code>object1</code>å’Œ<code>object2</code>å°±æ˜¯instanceå¯¹è±¡ï¼Œåˆ†åˆ«å æ®ä¸åŒçš„å†…å­˜ï¼Œå®ƒä»¬çš„å†…å­˜åœ°å€ä¹Ÿä¸ä¸€æ ·ã€‚</p>
<p><code>NSObject</code>çš„æºç ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSObject</span> &lt;<span class="title">NSObject</span>&gt; </span>&#123;</span><br><span class="line">    Class isa;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="note green no-icon flat"><p>instanceå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…å«ï¼š</p>
<p>1.isaæŒ‡é’ˆ</p>
<p>2.å…¶ä»–æˆå‘˜å˜é‡</p>
</div>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="type">int</span> age;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> weight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line">Person *person1 = [[Person alloc] init];</span><br><span class="line">person1.age = <span class="number">18</span>;</span><br><span class="line">person1.weight = <span class="number">45.</span>f;</span><br><span class="line"></span><br><span class="line">Person *person2 = [[Person alloc] init];</span><br><span class="line">person2.age = <span class="number">20</span>;</span><br><span class="line">person2.weight = <span class="number">50.</span>f;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;person1:%p, person2:%p&quot;</span>,person1, person2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼šperson1:0x600000374520, person2:0x6000003745e0</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢<code>person1</code>å’Œ<code>person2</code>çš„å†…å­˜å­˜å‚¨ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1111/1.png" alt="1"></p>
<h3 id="ç±»å¯¹è±¡">ç±»å¯¹è±¡</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSObject</span> *object = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line">Class objectClass1 = object_getClass(object);</span><br><span class="line">Class objectClass2 = [object <span class="keyword">class</span>];</span><br><span class="line">Class objectClass3 = [<span class="built_in">NSObject</span> <span class="keyword">class</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;objectClass1ï¼š%p, objectClass2ï¼š%p, objectClass3:%p&quot;</span>,objectClass1, objectClass2, objectClass3);</span><br><span class="line">          </span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼šobjectClass1ï¼š0x7fff865a7710, objectClass2ï¼š0x7fff865a7710, objectClass3:0x7fff865a7710</span></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼š<code>objectClass1</code>ã€<code>objectClass2</code>ã€<code>objectClass3</code>æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä»¬çš„å†…å­˜åœ°å€ç›¸åŒï¼Œè¿™ç§å«åšclasså¯¹è±¡ã€‚</p>
<p><strong>æ¯ä¸ªç±»åœ¨å†…å­˜é‡Œé¢æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªclasså¯¹è±¡ã€‚</strong></p>
<div class="note green no-icon flat"><p>classå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…å«ï¼š</p>
<p>1.isaæŒ‡é’ˆ</p>
<p>2.superclassæŒ‡é’ˆ</p>
<p>3.ç±»çš„<strong>å±æ€§ä¿¡æ¯</strong>ï¼ˆ@propertyï¼‰</p>
<p>4.ç±»çš„<strong>å¯¹è±¡æ–¹æ³•ä¿¡æ¯</strong>ï¼ˆinstance methodï¼‰</p>
<p>5.ç±»çš„<strong>åè®®ä¿¡æ¯</strong>ï¼ˆprotocolï¼‰</p>
<p>6.ç±»çš„<strong>æˆå‘˜å˜é‡ä¿¡æ¯</strong>ï¼ˆivarï¼‰</p>
<p>â€¦</p>
<p><strong>æ³¨æ„</strong>ï¼šè¿™é‡Œçš„<strong>æˆå‘˜å˜é‡ä¿¡æ¯</strong>è¦åŒºåˆ«äºinstanceå¯¹è±¡é‡Œé¢çš„<strong>æˆå‘˜å˜é‡</strong>ï¼Œclasså¯¹è±¡é‡Œé¢å­˜çš„æ˜¯åªéœ€è¦å­˜å‚¨ä¸€ä»½çš„ä¸œè¥¿ï¼Œæ¯”å¦‚åç§°ç­‰ï¼Œinstanceå¯¹è±¡é‡Œé¢å­˜çš„æ˜¯å…·ä½“çš„å€¼ï¼Œå› ä¸ºä¸åŒçš„å®ä¾‹å¯¹è±¡æˆå‘˜å˜é‡çš„å€¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™é‡Œå¤§å®¶è¦æ³¨æ„å»åŒºåˆ†ã€‚</p>
</div>
<p>classå¯¹è±¡å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…å«ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1111/2.png" alt="2"></p>
<h3 id="å…ƒç±»å¯¹è±¡">å…ƒç±»å¯¹è±¡</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">Class metaClass = object_getClass([<span class="built_in">NSObject</span> <span class="keyword">class</span>]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;metaClassï¼š%p&quot;</span>,metaClass);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼šmetaClassï¼š0x7fff865a76c0</span></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼š<code>metaClass</code>å°±æ˜¯meta-classå¯¹è±¡ã€‚</p>
<p>classå¯¹è±¡å’Œmeta-classå¯¹è±¡éƒ½æ˜¯<code>Class</code>ç±»ï¼Œæ‰€ä»¥meta-classå¯¹è±¡é‡Œé¢å­˜å‚¨çš„ä¿¡æ¯æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºè·Ÿclasså¯¹è±¡å­˜å‚¨çš„æ˜¯åŒæ ·çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„<strong>ç”¨é€”</strong>ä¸ä¸€æ ·ã€‚</p>
<p><strong>æ¯ä¸ªç±»åœ¨å†…å­˜é‡Œé¢æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªmeta-classå¯¹è±¡ã€‚</strong></p>
<div class="note green no-icon flat"><p>è¿™é‡Œå¤§å®¶å¯èƒ½ä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼šä¸ºä»€ä¹ˆ<code>object_getClass</code>ä¼ instanceå¯¹è±¡å’Œclasså¯¹è±¡å¾—åˆ°çš„æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Ÿ</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">Class gdb_object_getClass(<span class="type">id</span> obj)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!obj) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    <span class="comment">// 1.å¦‚æœæ˜¯instanceå¯¹è±¡ è¿”å›çš„æ˜¯classå¯¹è±¡</span></span><br><span class="line">    <span class="comment">// 2.å¦‚æœæ˜¯classå¯¹è±¡ è¿”å›çš„æ˜¯meta-classå¯¹è±¡</span></span><br><span class="line">    <span class="comment">// 3.å¦‚æœæ˜¯meta-classå¯¹è±¡ è¿”å›çš„æ˜¯åŸºç±»çš„meta-classå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> gdb_class_getClass(obj-&gt;getIsa());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼šæ˜¯å› ä¸º<code>isa</code>æŒ‡é’ˆï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨åé¢ä¼šå†è¯¦ç»†è§£é‡Šã€‚</p>
</div>
<h3 id="object-getClasså’Œobjc-getClass">object_getClasså’Œobjc_getClass</h3>
<p><code>object_getClass</code>å’Œ<code>objc_getClass</code>éƒ½æ˜¯<code>runtime</code>ä¸‹çš„ä¸¤ä¸ªå‡½æ•°ï¼ŒåŒºåˆ«å¦‚ä¸‹ï¼š</p>
<div class="note green no-icon flat"><p><code>object_getClass</code>ä¼ çš„æ˜¯<strong>å¯¹è±¡</strong>ï¼Œ<code>objc_getClass</code>ä¼ çš„æ˜¯<strong>å­—ç¬¦ä¸²</strong>ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">Class personCalss1 = object_getClass(person); </span><br><span class="line"></span><br><span class="line">Class personCalss2 = objc_getClass(<span class="string">&quot;Person&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;class:%p %p&quot;</span>,personCalss1, personCalss2);        </span><br></pre></td></tr></table></figure>
</div>
<h3 id="classå’Œ-class">+classå’Œ-class</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">+ (Class)<span class="keyword">class</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Class)<span class="keyword">class</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> object_getClass(<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="isaå’Œsuperclass">isaå’Œsuperclass</h2>
<h3 id="isaå’Œsuperclassçš„æ€»ç»“">isaå’Œsuperclassçš„æ€»ç»“</h3>
<p>è¿™é‡Œå€Ÿç”¨ç½‘å‹çš„ä¸€å¼ å›¾ç‰‡æ¥åšæ€»ç»“ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202211/1111/3.png" alt="3"></p>
<h3 id="isaæŒ‡é’ˆ">isaæŒ‡é’ˆ</h3>
<p>åœ¨å‰é¢æˆ‘ä»¬è¯´åˆ°instanceå¯¹è±¡çš„æ–¹æ³•æ˜¯å­˜æ”¾åœ¨classå¯¹è±¡çš„å†…å­˜é‡Œé¢ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´æ˜¯å¦‚ä½•ä¿æŒè¿™ç§å…³è”çš„ï¼Œå°±æ˜¯é€šè¿‡<code>isa</code>æŒ‡é’ˆæ¥ä¿æŒå…³è”çš„ã€‚</p>
<div class="note green no-icon flat"><p>1.instanceå¯¹è±¡çš„<code>isa</code>æŒ‡å‘classå¯¹è±¡ã€‚</p>
<p>2.classå¯¹è±¡çš„<code>isa</code>æŒ‡å‘meta-classå¯¹è±¡ã€‚</p>
<p>3.meta-classå¯¹è±¡çš„<code>isa</code>æŒ‡å‘<strong>åŸºç±»</strong>çš„meta-classå¯¹è±¡ã€‚</p>
</div>
<p>å¦‚ä½•è¯æ˜instanceå¯¹è±¡çš„<code>isa</code>æŒ‡å‘classå¯¹è±¡?</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> ww_objc_class &#123;</span><br><span class="line">    Class isa;</span><br><span class="line">&#125;; <span class="comment">// è¿™ä¸ªç»“æ„ä½“æ˜¯è‡ªå·±å®ç°çš„ å› ä¸ºOCçš„ç±»å¯¹è±¡çš„isaæ²¡æœ‰æš´éœ²å‡ºæ¥ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">  [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">  Person *person = [[Person alloc] init];</span><br><span class="line">  <span class="keyword">struct</span> ww_objc_class *wwPerson =  (__bridge <span class="keyword">struct</span> ww_objc_class *)(person);</span><br><span class="line">  Class personClass = [person <span class="keyword">class</span>];</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;---%p, %p&quot;</span>,wwPerson-&gt;isa, personClass);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼šp/x (long)person-&gt;isaï¼ˆç›´æ¥åœ¨æ§åˆ¶å™¨æŸ¥çœ‹isaå€¼ï¼‰</span></span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-13</span> <span class="number">17</span>:<span class="number">35</span>:<span class="number">42.687432</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">50885</span>:<span class="number">15128534</span>] --<span class="number">-0x10a69a540</span>, <span class="number">0x10a69a540</span></span><br></pre></td></tr></table></figure>
 <div class="note red no-icon flat"><p><strong>ç»“è®º</strong>ï¼šPersonç±»å¯¹è±¡çš„<code>isa</code>å€¼ = Personç±»å¯¹è±¡çš„åœ°å€å€¼ï¼ˆè¿™æ˜¯ä¸€ä¸ªAPPé¡¹ç›®ï¼‰</p>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœåˆ›å»ºä¸€ä¸ªå‘½ä»¤è¡Œé¡¹ç›®æ¥å¯¹æ¯”ä¸¤ä¸ªåœ°å€å€¼ï¼Œä¼šå‘ç°æ˜¯ä¸ç›¸ç­‰çš„éœ€è¦è¿›è¡Œä¸€æ¬¡ä½è¿ç®—æ‰ä¼šç›¸ç­‰ã€‚</p>
<p>å‘½ä»¤<code>uname -a</code>å¯ä»¥æŸ¥çœ‹å½“å‰ç¯å¢ƒæ˜¯64bitè¿˜æ˜¯32bitã€‚</p>
</div>
<h3 id="superclassæŒ‡é’ˆ">superclassæŒ‡é’ˆ</h3>
<div class="note pink no-icon flat"><p>1.instanceå¯¹è±¡æ²¡æœ‰<code>superclass</code>æŒ‡é’ˆã€‚</p>
<p>2.classå¯¹è±¡çš„<code>superclass</code>æŒ‡å‘<strong>çˆ¶ç±»</strong> çš„classå¯¹è±¡ã€‚</p>
<p>3.meta-classå¯¹è±¡çš„<code>superclass</code>æŒ‡å‘<strong>çˆ¶ç±»</strong>çš„meta-classå¯¹è±¡ã€‚</p>
<p>4.å¦‚æœæ²¡æœ‰<strong>çˆ¶ç±»</strong>ï¼Œ <code>superclass</code>æŒ‡å‘nilã€‚</p>
<p>5.åŸºç±»meta-classå¯¹è±¡çš„<code>superclass</code>æŒ‡å‘åŸºç±»çš„<strong>classå¯¹è±¡</strong>ã€‚</p>
</div>
<p>å¦‚ä½•éªŒè¯classå¯¹è±¡çš„<code>superclass</code>æŒ‡å‘çˆ¶ç±»çš„classå¯¹è±¡ï¼Ÿ</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> ww_objc_class &#123;</span><br><span class="line">    Class isa;</span><br><span class="line">    Class superclass;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">  [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">  Person *person = [[Person alloc] init];</span><br><span class="line"></span><br><span class="line">  Class PersonClass = [person <span class="keyword">class</span>];</span><br><span class="line">  <span class="keyword">struct</span> ww_objc_class *wwPersonClass =  (__bridge <span class="keyword">struct</span> ww_objc_class *)(PersonClass);</span><br><span class="line"></span><br><span class="line">  Class <span class="built_in">NSObjectClass</span> = [<span class="built_in">NSObject</span> <span class="keyword">class</span>];</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;---%p, %p&quot;</span>,wwPersonClass-&gt;superclass, <span class="built_in">NSObjectClass</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼š</span></span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-13</span> <span class="number">17</span>:<span class="number">42</span>:<span class="number">05.345430</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">50983</span>:<span class="number">15133846</span>] --<span class="number">-0x7fff865a7710</span>, <span class="number">0x7fff865a7710</span></span><br></pre></td></tr></table></figure>
 <div class="note red no-icon flat"><p><strong>ç»“è®º</strong>ï¼šPersonç±»å¯¹è±¡çš„<code>superclass</code>å€¼ = NSObjectç±»å¯¹è±¡çš„åœ°å€å€¼</p>
</div>
<h3 id="åœºæ™¯ä¸€">åœºæ™¯ä¸€</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Personç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="type">int</span> age;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> weight;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)run;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)run &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;---%s ---%@&quot;</span>,__func__, <span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Studentç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> : <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Student</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">  [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">  Student *student = [[Student alloc] init];</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;---Student:%@&quot;</span>,student);</span><br><span class="line">  [student run];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœï¼š</span></span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-13</span> <span class="number">16</span>:<span class="number">46</span>:<span class="number">19.413744</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">50121</span>:<span class="number">15084736</span>] ---Student:&lt;Student: <span class="number">0x600002127fc0</span>&gt;</span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-13</span> <span class="number">16</span>:<span class="number">46</span>:<span class="number">19.413912</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">50121</span>:<span class="number">15084736</span>] ----[Person run] ---&lt;Student: <span class="number">0x600002127fc0</span>&gt;</span><br></pre></td></tr></table></figure>
<p><code>student</code>è°ƒç”¨<code>run</code>æ–¹æ³•çš„è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>é€šè¿‡<code>student</code>çš„<code>isa</code>æŒ‡é’ˆæ‰¾åˆ°<code>Student</code>å¯¹è±¡ã€‚</li>
<li>æŸ¥æ‰¾<code>Student</code>å¯¹è±¡é‡Œé¢æ˜¯å¦æœ‰<code>run</code>æ–¹æ³•ã€‚</li>
<li>é€šè¿‡<code>Student</code>å¯¹è±¡çš„<code>superclass</code>æŒ‡é’ˆæ‰¾åˆ°<code>Person</code>å¯¹è±¡ã€‚</li>
<li>æŸ¥æ‰¾<code>Person</code>å¯¹è±¡çš„<code>run</code>æ–¹æ³•ã€‚</li>
</ol>
<h3 id="åœºæ™¯äºŒ">åœºæ™¯äºŒ</h3>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1.ä¸ºNSObjectå†™ä¸€ä¸ªåˆ†ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSObject</span> (<span class="title">fly</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)fly;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">fly</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)fly &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;-[NSObject fly] ---%p&quot;</span>,<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// Personç±»</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)fly;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// è°ƒç”¨</span></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;Person:%p&quot;</span>,[Person <span class="keyword">class</span>]);</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@&quot;NSObject:%p&quot;</span>,[<span class="built_in">NSObject</span> <span class="keyword">class</span>]);</span><br><span class="line">  [Person fly];  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœ</span></span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-13</span> <span class="number">17</span>:<span class="number">17</span>:<span class="number">07.265249</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">50673</span>:<span class="number">15113962</span>] Person:<span class="number">0x10197f568</span></span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-13</span> <span class="number">17</span>:<span class="number">17</span>:<span class="number">07.265404</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">50673</span>:<span class="number">15113962</span>] <span class="built_in">NSObject</span>:<span class="number">0x7fff865a7710</span></span><br><span class="line"><span class="number">2022</span><span class="number">-11</span><span class="number">-13</span> <span class="number">17</span>:<span class="number">17</span>:<span class="number">07.265539</span>+<span class="number">0800</span> OCå¯¹è±¡çš„æœ¬è´¨[<span class="number">50673</span>:<span class="number">15113962</span>] -[<span class="built_in">NSObject</span> fly] --<span class="number">-0x10197f568</span></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼š<code>Person</code>è°ƒç”¨<code>fly</code>è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯<code>Person</code>é‡Œé¢å¹¶æ²¡æœ‰å®ç°<code>fly</code>è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨<code>NSObject</code>çš„åˆ†ç±»æ–¹æ³•é‡Œé¢æœ‰ä¸€ä¸ª<code>fly</code>çš„å®ä¾‹æ–¹æ³•ã€‚</p>
<p>è°ƒç”¨<code>[Person fly]</code>å¹¶æ²¡æœ‰å‘ç”Ÿå´©æºƒï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li>é€šè¿‡<code>Person</code>classå¯¹è±¡çš„<code>isa</code>æŒ‡é’ˆæ‰¾åˆ°<code>Person</code>çš„meta-classå¯¹è±¡ã€‚</li>
<li>æŸ¥çœ‹<code>Person</code>çš„meta-classå¯¹è±¡çš„å†…å­˜é‡Œé¢æ˜¯å¦æœ‰<code>+fly</code>æ–¹æ³•ã€‚(NO)</li>
<li>é€šè¿‡<code>Person</code>meta-classå¯¹è±¡çš„<code>superclass</code>æŒ‡é’ˆæ‰¾åˆ°çˆ¶ç±»<code>NSObject</code>çš„meta-classå¯¹è±¡ã€‚</li>
<li>æŸ¥çœ‹<code>NSObject</code>çš„meta-classå¯¹è±¡çš„å†…å­˜é‡Œé¢æ˜¯å¦æœ‰<code>+fly</code>æ–¹æ³•ã€‚(NO)</li>
<li>é€šè¿‡<code>NSObject</code>meta-classå¯¹è±¡çš„<code>superclass</code>æŒ‡é’ˆæ‰¾åˆ°<code>NSObject</code>classå¯¹è±¡ã€‚</li>
<li>åœ¨<code>NSObject</code>classå¯¹è±¡ä¸­æ‰¾åˆ°<code>-fly</code>æ–¹æ³•å¾—ä»¥è°ƒç”¨ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€å·¥å…·ä½¿ç”¨ã€‘Revealå·¥å…·çš„ä½¿ç”¨ä»‹ç»</title>
    <url>/posts/745be31f/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢-31">å†™åœ¨å‰é¢</h2>
<p>æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½æƒ³è¦åˆ†æå…¶ä»–APPçš„ä¸€äº›æ•´ä½“Viewç»“æ„ï¼Œå°±åƒåœ¨Xcodeåˆ†ææˆ‘ä»¬è‡ªå·±çš„APPä¸€æ ·èƒ½å¤Ÿæ¸…æ¥šçœ‹åˆ°ä¸ªå±‚çº§ç»“æ„ï¼ŒRevealè¿™ä¸ªAPPä¸»è¦å°±æ˜¯è¿™ä¸ªåŠŸèƒ½ï¼šç”¨æ¥åˆ†æAPPçš„å±‚çº§ç»“æ„ã€‚</p>
<h2 id="Reveal">Reveal</h2>
<p>Reveal APP å®˜ç½‘ï¼š<a href="https://revealapp.com/">https://revealapp.com/</a></p>
<p>Reveal APPä¸‹è½½åœ°å€ï¼š<a href="https://revealapp.com/download/">https://revealapp.com/download/</a></p>
<p>è¿™ä¸ªæ˜¯å®˜ç½‘æ­£ç‰ˆï¼Œå¯ä»¥å…è´¹è¯•ç”¨14å¤©ã€‚</p>
<h2 id="Revealçš„åŸºæœ¬ä½¿ç”¨">Revealçš„åŸºæœ¬ä½¿ç”¨</h2>
<ul>
<li>
<p>æ‰“å¼€Revealï¼Œèœå•æ Help - Show Reveal Framework in Finder</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1226/1.png" alt="1"></p>
</li>
</ul>
<h3 id="çœŸæœºä¸‹çš„é…ç½®">çœŸæœºä¸‹çš„é…ç½®</h3>
<ul>
<li>
<p>æ‰¾åˆ°RevealServer.framework - ios-arm64 - RevealServer.framework</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1226/2.png" alt="2"></p>
</li>
<li>
<p>æ‰“å¼€iFunBox - å°†RevealServer.frameworkå¤åˆ¶åˆ°iFunBoxä¸­ Library/Frameworksä¸­</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1226/3.png" alt="3"></p>
</li>
<li>
<p>åœ¨æ‰‹æœºCydiaä¸­æœç´¢Reveal2Loaderè¿›è¡Œå®‰è£…</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1226/4.png" alt="4"></p>
</li>
<li>
<p>æ‰‹æœºè®¾ç½® - Reveal - Enabled Applications - é€‰æ‹©å…è®¸Revealè®¿é—®çš„APP</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1226/5.png" alt="5"></p>
</li>
<li>
<p>åœ¨æ‰‹æœºç»ˆç«¯æ‰§è¡Œ - killall SpringBoard</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1226/6.png" alt="6"></p>
</li>
</ul>
<h3 id="æ¨¡æ‹Ÿå™¨ä¸‹çš„é…ç½®">æ¨¡æ‹Ÿå™¨ä¸‹çš„é…ç½®</h3>
<ul>
<li>
<p>æ‰¾åˆ°RevealServer.framework - ios-arm64_x86_64-simulator - RevealServer.framework</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1226/7.png" alt="7"></p>
</li>
<li>
<p>åœ¨Xcodeé…ç½®ä¸­å¯¼å…¥RevealServer.framework</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1226/8.png" alt="8"></p>
</li>
</ul>
<h3 id="Revealçš„ä½¿ç”¨">Revealçš„ä½¿ç”¨</h3>
<p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»é…ç½®å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ­£å¼ä½¿ç”¨Revealäº†ã€‚</p>
<p>æ‰“å¼€æ‰‹æœºä¸Šçš„æŸä¸ªAPP - æ‰“å¼€Reveal - ä¼šåœ¨Revealçœ‹åˆ°æˆ‘ä»¬åˆšæ‰“å¼€çš„APP å¦‚ä¸‹ï¼š</p>
<p><img src="https://sunny-blog.oss-cn-beijing.aliyuncs.com/202212/1226/9.png" alt="9"></p>
<p>ä¸Šé¢ä¸€ä¸ªæ˜¯é€šè¿‡ç½‘ç»œè¿æ¥ã€ä¸€ä¸ªæ˜¯é€šè¿‡USBè¿æ¥ï¼Œæˆ‘ä»¬é€‰æ‹©æ›´å¿«çš„USBè¿æ¥å³å¯ä½¿ç”¨Revealã€‚</p>
<h2 id="å†™åœ¨æœ€å-21">å†™åœ¨æœ€å</h2>
<p>å…³äºRevealä½¿ç”¨å‰çš„é…ç½®å°±ç®€å•ä»‹ç»åˆ°è¿™é‡Œå•¦ï¼Œå¦‚æœ‰é”™è¯¯è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
]]></content>
      <categories>
        <category>å·¥å…·ä½¿ç”¨</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>é€†å‘</tag>
        <tag>å·¥å…·ä½¿ç”¨</tag>
      </tags>
  </entry>
</search>
